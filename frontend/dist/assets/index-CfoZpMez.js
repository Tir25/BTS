var sI=Object.defineProperty;var iI=(t,e,r)=>e in t?sI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Is=(t,e,r)=>iI(t,typeof e!="symbol"?e+"":e,r);function nI(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const c in n)if(c!=="default"&&!(c in t)){const d=Object.getOwnPropertyDescriptor(n,c);d&&Object.defineProperty(t,c,d.get?d:{enumerable:!0,get:()=>n[c]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();var Ji=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function x2(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function aI(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var c=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,c.get?c:{enumerable:!0,get:function(){return t[n]}})}),r}var b2={exports:{}},Lm={},w2={exports:{}},Xt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fd=Symbol.for("react.element"),oI=Symbol.for("react.portal"),lI=Symbol.for("react.fragment"),cI=Symbol.for("react.strict_mode"),uI=Symbol.for("react.profiler"),hI=Symbol.for("react.provider"),dI=Symbol.for("react.context"),fI=Symbol.for("react.forward_ref"),pI=Symbol.for("react.suspense"),mI=Symbol.for("react.memo"),gI=Symbol.for("react.lazy"),xw=Symbol.iterator;function yI(t){return t===null||typeof t!="object"?null:(t=xw&&t[xw]||t["@@iterator"],typeof t=="function"?t:null)}var S2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k2=Object.assign,T2={};function fu(t,e,r){this.props=t,this.context=e,this.refs=T2,this.updater=r||S2}fu.prototype.isReactComponent={};fu.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};fu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function E2(){}E2.prototype=fu.prototype;function Qv(t,e,r){this.props=t,this.context=e,this.refs=T2,this.updater=r||S2}var ex=Qv.prototype=new E2;ex.constructor=Qv;k2(ex,fu.prototype);ex.isPureReactComponent=!0;var bw=Array.isArray,C2=Object.prototype.hasOwnProperty,tx={current:null},A2={key:!0,ref:!0,__self:!0,__source:!0};function P2(t,e,r){var n,c={},d=null,m=null;if(e!=null)for(n in e.ref!==void 0&&(m=e.ref),e.key!==void 0&&(d=""+e.key),e)C2.call(e,n)&&!A2.hasOwnProperty(n)&&(c[n]=e[n]);var l=arguments.length-2;if(l===1)c.children=r;else if(1<l){for(var w=Array(l),k=0;k<l;k++)w[k]=arguments[k+2];c.children=w}if(t&&t.defaultProps)for(n in l=t.defaultProps,l)c[n]===void 0&&(c[n]=l[n]);return{$$typeof:Fd,type:t,key:d,ref:m,props:c,_owner:tx.current}}function _I(t,e){return{$$typeof:Fd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function rx(t){return typeof t=="object"&&t!==null&&t.$$typeof===Fd}function vI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var ww=/\/+/g;function _y(t,e){return typeof t=="object"&&t!==null&&t.key!=null?vI(""+t.key):e.toString(36)}function Rp(t,e,r,n,c){var d=typeof t;(d==="undefined"||d==="boolean")&&(t=null);var m=!1;if(t===null)m=!0;else switch(d){case"string":case"number":m=!0;break;case"object":switch(t.$$typeof){case Fd:case oI:m=!0}}if(m)return m=t,c=c(m),t=n===""?"."+_y(m,0):n,bw(c)?(r="",t!=null&&(r=t.replace(ww,"$&/")+"/"),Rp(c,e,r,"",function(k){return k})):c!=null&&(rx(c)&&(c=_I(c,r+(!c.key||m&&m.key===c.key?"":(""+c.key).replace(ww,"$&/")+"/")+t)),e.push(c)),1;if(m=0,n=n===""?".":n+":",bw(t))for(var l=0;l<t.length;l++){d=t[l];var w=n+_y(d,l);m+=Rp(d,e,r,w,c)}else if(w=yI(t),typeof w=="function")for(t=w.call(t),l=0;!(d=t.next()).done;)d=d.value,w=n+_y(d,l++),m+=Rp(d,e,r,w,c);else if(d==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return m}function lp(t,e,r){if(t==null)return t;var n=[],c=0;return Rp(t,n,"","",function(d){return e.call(r,d,c++)}),n}function xI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var vi={current:null},zp={transition:null},bI={ReactCurrentDispatcher:vi,ReactCurrentBatchConfig:zp,ReactCurrentOwner:tx};function I2(){throw Error("act(...) is not supported in production builds of React.")}Xt.Children={map:lp,forEach:function(t,e,r){lp(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return lp(t,function(){e++}),e},toArray:function(t){return lp(t,function(e){return e})||[]},only:function(t){if(!rx(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Xt.Component=fu;Xt.Fragment=lI;Xt.Profiler=uI;Xt.PureComponent=Qv;Xt.StrictMode=cI;Xt.Suspense=pI;Xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bI;Xt.act=I2;Xt.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=k2({},t.props),c=t.key,d=t.ref,m=t._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,m=tx.current),e.key!==void 0&&(c=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(w in e)C2.call(e,w)&&!A2.hasOwnProperty(w)&&(n[w]=e[w]===void 0&&l!==void 0?l[w]:e[w])}var w=arguments.length-2;if(w===1)n.children=r;else if(1<w){l=Array(w);for(var k=0;k<w;k++)l[k]=arguments[k+2];n.children=l}return{$$typeof:Fd,type:t.type,key:c,ref:d,props:n,_owner:m}};Xt.createContext=function(t){return t={$$typeof:dI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:hI,_context:t},t.Consumer=t};Xt.createElement=P2;Xt.createFactory=function(t){var e=P2.bind(null,t);return e.type=t,e};Xt.createRef=function(){return{current:null}};Xt.forwardRef=function(t){return{$$typeof:fI,render:t}};Xt.isValidElement=rx;Xt.lazy=function(t){return{$$typeof:gI,_payload:{_status:-1,_result:t},_init:xI}};Xt.memo=function(t,e){return{$$typeof:mI,type:t,compare:e===void 0?null:e}};Xt.startTransition=function(t){var e=zp.transition;zp.transition={};try{t()}finally{zp.transition=e}};Xt.unstable_act=I2;Xt.useCallback=function(t,e){return vi.current.useCallback(t,e)};Xt.useContext=function(t){return vi.current.useContext(t)};Xt.useDebugValue=function(){};Xt.useDeferredValue=function(t){return vi.current.useDeferredValue(t)};Xt.useEffect=function(t,e){return vi.current.useEffect(t,e)};Xt.useId=function(){return vi.current.useId()};Xt.useImperativeHandle=function(t,e,r){return vi.current.useImperativeHandle(t,e,r)};Xt.useInsertionEffect=function(t,e){return vi.current.useInsertionEffect(t,e)};Xt.useLayoutEffect=function(t,e){return vi.current.useLayoutEffect(t,e)};Xt.useMemo=function(t,e){return vi.current.useMemo(t,e)};Xt.useReducer=function(t,e,r){return vi.current.useReducer(t,e,r)};Xt.useRef=function(t){return vi.current.useRef(t)};Xt.useState=function(t){return vi.current.useState(t)};Xt.useSyncExternalStore=function(t,e,r){return vi.current.useSyncExternalStore(t,e,r)};Xt.useTransition=function(){return vi.current.useTransition()};Xt.version="18.3.1";w2.exports=Xt;var re=w2.exports;const sx=x2(re),wI=nI({__proto__:null,default:sx},[re]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SI=re,kI=Symbol.for("react.element"),TI=Symbol.for("react.fragment"),EI=Object.prototype.hasOwnProperty,CI=SI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,AI={key:!0,ref:!0,__self:!0,__source:!0};function M2(t,e,r){var n,c={},d=null,m=null;r!==void 0&&(d=""+r),e.key!==void 0&&(d=""+e.key),e.ref!==void 0&&(m=e.ref);for(n in e)EI.call(e,n)&&!AI.hasOwnProperty(n)&&(c[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)c[n]===void 0&&(c[n]=e[n]);return{$$typeof:kI,type:t,key:d,ref:m,props:c,_owner:CI.current}}Lm.Fragment=TI;Lm.jsx=M2;Lm.jsxs=M2;b2.exports=Lm;var v=b2.exports,__={},j2={exports:{}},en={},D2={exports:{}},N2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Be,st){var Fe=Be.length;Be.push(st);e:for(;0<Fe;){var Ct=Fe-1>>>1,Nt=Be[Ct];if(0<c(Nt,st))Be[Ct]=st,Be[Fe]=Nt,Fe=Ct;else break e}}function r(Be){return Be.length===0?null:Be[0]}function n(Be){if(Be.length===0)return null;var st=Be[0],Fe=Be.pop();if(Fe!==st){Be[0]=Fe;e:for(var Ct=0,Nt=Be.length,Ye=Nt>>>1;Ct<Ye;){var we=2*(Ct+1)-1,tt=Be[we],kt=we+1,Ht=Be[kt];if(0>c(tt,Fe))kt<Nt&&0>c(Ht,tt)?(Be[Ct]=Ht,Be[kt]=Fe,Ct=kt):(Be[Ct]=tt,Be[we]=Fe,Ct=we);else if(kt<Nt&&0>c(Ht,Fe))Be[Ct]=Ht,Be[kt]=Fe,Ct=kt;else break e}}return st}function c(Be,st){var Fe=Be.sortIndex-st.sortIndex;return Fe!==0?Fe:Be.id-st.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;t.unstable_now=function(){return d.now()}}else{var m=Date,l=m.now();t.unstable_now=function(){return m.now()-l}}var w=[],k=[],P=1,j=null,L=3,Z=!1,Y=!1,ce=!1,de=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function W(Be){for(var st=r(k);st!==null;){if(st.callback===null)n(k);else if(st.startTime<=Be)n(k),st.sortIndex=st.expirationTime,e(w,st);else break;st=r(k)}}function ue(Be){if(ce=!1,W(Be),!Y)if(r(w)!==null)Y=!0,ir(me);else{var st=r(k);st!==null&&vt(ue,st.startTime-Be)}}function me(Be,st){Y=!1,ce&&(ce=!1,G(Te),Te=-1),Z=!0;var Fe=L;try{for(W(st),j=r(w);j!==null&&(!(j.expirationTime>st)||Be&&!St());){var Ct=j.callback;if(typeof Ct=="function"){j.callback=null,L=j.priorityLevel;var Nt=Ct(j.expirationTime<=st);st=t.unstable_now(),typeof Nt=="function"?j.callback=Nt:j===r(w)&&n(w),W(st)}else n(w);j=r(w)}if(j!==null)var Ye=!0;else{var we=r(k);we!==null&&vt(ue,we.startTime-st),Ye=!1}return Ye}finally{j=null,L=Fe,Z=!1}}var be=!1,Ce=null,Te=-1,rt=5,Ue=-1;function St(){return!(t.unstable_now()-Ue<rt)}function Oe(){if(Ce!==null){var Be=t.unstable_now();Ue=Be;var st=!0;try{st=Ce(!0,Be)}finally{st?it():(be=!1,Ce=null)}}else be=!1}var it;if(typeof H=="function")it=function(){H(Oe)};else if(typeof MessageChannel<"u"){var qe=new MessageChannel,Et=qe.port2;qe.port1.onmessage=Oe,it=function(){Et.postMessage(null)}}else it=function(){de(Oe,0)};function ir(Be){Ce=Be,be||(be=!0,it())}function vt(Be,st){Te=de(function(){Be(t.unstable_now())},st)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Be){Be.callback=null},t.unstable_continueExecution=function(){Y||Z||(Y=!0,ir(me))},t.unstable_forceFrameRate=function(Be){0>Be||125<Be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):rt=0<Be?Math.floor(1e3/Be):5},t.unstable_getCurrentPriorityLevel=function(){return L},t.unstable_getFirstCallbackNode=function(){return r(w)},t.unstable_next=function(Be){switch(L){case 1:case 2:case 3:var st=3;break;default:st=L}var Fe=L;L=st;try{return Be()}finally{L=Fe}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Be,st){switch(Be){case 1:case 2:case 3:case 4:case 5:break;default:Be=3}var Fe=L;L=Be;try{return st()}finally{L=Fe}},t.unstable_scheduleCallback=function(Be,st,Fe){var Ct=t.unstable_now();switch(typeof Fe=="object"&&Fe!==null?(Fe=Fe.delay,Fe=typeof Fe=="number"&&0<Fe?Ct+Fe:Ct):Fe=Ct,Be){case 1:var Nt=-1;break;case 2:Nt=250;break;case 5:Nt=1073741823;break;case 4:Nt=1e4;break;default:Nt=5e3}return Nt=Fe+Nt,Be={id:P++,callback:st,priorityLevel:Be,startTime:Fe,expirationTime:Nt,sortIndex:-1},Fe>Ct?(Be.sortIndex=Fe,e(k,Be),r(w)===null&&Be===r(k)&&(ce?(G(Te),Te=-1):ce=!0,vt(ue,Fe-Ct))):(Be.sortIndex=Nt,e(w,Be),Y||Z||(Y=!0,ir(me))),Be},t.unstable_shouldYield=St,t.unstable_wrapCallback=function(Be){var st=L;return function(){var Fe=L;L=st;try{return Be.apply(this,arguments)}finally{L=Fe}}}})(N2);D2.exports=N2;var PI=D2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var II=re,Qi=PI;function Ze(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var L2=new Set,pd={};function Dl(t,e){su(t,e),su(t+"Capture",e)}function su(t,e){for(pd[t]=e,t=0;t<e.length;t++)L2.add(e[t])}var Oa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v_=Object.prototype.hasOwnProperty,MI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Sw={},kw={};function jI(t){return v_.call(kw,t)?!0:v_.call(Sw,t)?!1:MI.test(t)?kw[t]=!0:(Sw[t]=!0,!1)}function DI(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function NI(t,e,r,n){if(e===null||typeof e>"u"||DI(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function xi(t,e,r,n,c,d,m){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=d,this.removeEmptyString=m}var Vs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Vs[t]=new xi(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Vs[e]=new xi(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Vs[t]=new xi(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Vs[t]=new xi(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Vs[t]=new xi(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Vs[t]=new xi(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Vs[t]=new xi(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Vs[t]=new xi(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Vs[t]=new xi(t,5,!1,t.toLowerCase(),null,!1,!1)});var ix=/[\-:]([a-z])/g;function nx(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ix,nx);Vs[e]=new xi(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ix,nx);Vs[e]=new xi(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ix,nx);Vs[e]=new xi(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Vs[t]=new xi(t,1,!1,t.toLowerCase(),null,!1,!1)});Vs.xlinkHref=new xi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Vs[t]=new xi(t,1,!1,t.toLowerCase(),null,!0,!0)});function ax(t,e,r,n){var c=Vs.hasOwnProperty(e)?Vs[e]:null;(c!==null?c.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(NI(e,r,c,n)&&(r=null),n||c===null?jI(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):c.mustUseProperty?t[c.propertyName]=r===null?c.type===3?!1:"":r:(e=c.attributeName,n=c.attributeNamespace,r===null?t.removeAttribute(e):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Ga=II.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cp=Symbol.for("react.element"),Mc=Symbol.for("react.portal"),jc=Symbol.for("react.fragment"),ox=Symbol.for("react.strict_mode"),x_=Symbol.for("react.profiler"),R2=Symbol.for("react.provider"),z2=Symbol.for("react.context"),lx=Symbol.for("react.forward_ref"),b_=Symbol.for("react.suspense"),w_=Symbol.for("react.suspense_list"),cx=Symbol.for("react.memo"),yo=Symbol.for("react.lazy"),B2=Symbol.for("react.offscreen"),Tw=Symbol.iterator;function Ih(t){return t===null||typeof t!="object"?null:(t=Tw&&t[Tw]||t["@@iterator"],typeof t=="function"?t:null)}var Vr=Object.assign,vy;function Vh(t){if(vy===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);vy=e&&e[1]||""}return`
`+vy+t}var xy=!1;function by(t,e){if(!t||xy)return"";xy=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(k){var n=k}Reflect.construct(t,[],e)}else{try{e.call()}catch(k){n=k}t.call(e.prototype)}else{try{throw Error()}catch(k){n=k}t()}}catch(k){if(k&&n&&typeof k.stack=="string"){for(var c=k.stack.split(`
`),d=n.stack.split(`
`),m=c.length-1,l=d.length-1;1<=m&&0<=l&&c[m]!==d[l];)l--;for(;1<=m&&0<=l;m--,l--)if(c[m]!==d[l]){if(m!==1||l!==1)do if(m--,l--,0>l||c[m]!==d[l]){var w=`
`+c[m].replace(" at new "," at ");return t.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",t.displayName)),w}while(1<=m&&0<=l);break}}}finally{xy=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Vh(t):""}function LI(t){switch(t.tag){case 5:return Vh(t.type);case 16:return Vh("Lazy");case 13:return Vh("Suspense");case 19:return Vh("SuspenseList");case 0:case 2:case 15:return t=by(t.type,!1),t;case 11:return t=by(t.type.render,!1),t;case 1:return t=by(t.type,!0),t;default:return""}}function S_(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case jc:return"Fragment";case Mc:return"Portal";case x_:return"Profiler";case ox:return"StrictMode";case b_:return"Suspense";case w_:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case z2:return(t.displayName||"Context")+".Consumer";case R2:return(t._context.displayName||"Context")+".Provider";case lx:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case cx:return e=t.displayName||null,e!==null?e:S_(t.type)||"Memo";case yo:e=t._payload,t=t._init;try{return S_(t(e))}catch{}}return null}function RI(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return S_(e);case 8:return e===ox?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Lo(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function O2(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function zI(t){var e=O2(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,d=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return c.call(this)},set:function(m){n=""+m,d.call(this,m)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(m){n=""+m},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function up(t){t._valueTracker||(t._valueTracker=zI(t))}function F2(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=O2(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function sm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function k_(t,e){var r=e.checked;return Vr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Ew(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=Lo(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function $2(t,e){e=e.checked,e!=null&&ax(t,"checked",e,!1)}function T_(t,e){$2(t,e);var r=Lo(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?E_(t,e.type,r):e.hasOwnProperty("defaultValue")&&E_(t,e.type,Lo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Cw(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function E_(t,e,r){(e!=="number"||sm(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var qh=Array.isArray;function Hc(t,e,r,n){if(t=t.options,e){e={};for(var c=0;c<r.length;c++)e["$"+r[c]]=!0;for(r=0;r<t.length;r++)c=e.hasOwnProperty("$"+t[r].value),t[r].selected!==c&&(t[r].selected=c),c&&n&&(t[r].defaultSelected=!0)}else{for(r=""+Lo(r),e=null,c=0;c<t.length;c++){if(t[c].value===r){t[c].selected=!0,n&&(t[c].defaultSelected=!0);return}e!==null||t[c].disabled||(e=t[c])}e!==null&&(e.selected=!0)}}function C_(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ze(91));return Vr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Aw(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(Ze(92));if(qh(r)){if(1<r.length)throw Error(Ze(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:Lo(r)}}function U2(t,e){var r=Lo(e.value),n=Lo(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function Pw(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function V2(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function A_(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?V2(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var hp,q2=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,c){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,c)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(hp=hp||document.createElement("div"),hp.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hp.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function md(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var Xh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BI=["Webkit","ms","Moz","O"];Object.keys(Xh).forEach(function(t){BI.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Xh[e]=Xh[t]})});function G2(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||Xh.hasOwnProperty(t)&&Xh[t]?(""+e).trim():e+"px"}function W2(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,c=G2(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,c):t[r]=c}}var OI=Vr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function P_(t,e){if(e){if(OI[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ze(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ze(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ze(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ze(62))}}function I_(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var M_=null;function ux(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var j_=null,Kc=null,Xc=null;function Iw(t){if(t=Vd(t)){if(typeof j_!="function")throw Error(Ze(280));var e=t.stateNode;e&&(e=Fm(e),j_(t.stateNode,t.type,e))}}function Z2(t){Kc?Xc?Xc.push(t):Xc=[t]:Kc=t}function H2(){if(Kc){var t=Kc,e=Xc;if(Xc=Kc=null,Iw(t),e)for(t=0;t<e.length;t++)Iw(e[t])}}function K2(t,e){return t(e)}function X2(){}var wy=!1;function Y2(t,e,r){if(wy)return t(e,r);wy=!0;try{return K2(t,e,r)}finally{wy=!1,(Kc!==null||Xc!==null)&&(X2(),H2())}}function gd(t,e){var r=t.stateNode;if(r===null)return null;var n=Fm(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(Ze(231,e,typeof r));return r}var D_=!1;if(Oa)try{var Mh={};Object.defineProperty(Mh,"passive",{get:function(){D_=!0}}),window.addEventListener("test",Mh,Mh),window.removeEventListener("test",Mh,Mh)}catch{D_=!1}function FI(t,e,r,n,c,d,m,l,w){var k=Array.prototype.slice.call(arguments,3);try{e.apply(r,k)}catch(P){this.onError(P)}}var Yh=!1,im=null,nm=!1,N_=null,$I={onError:function(t){Yh=!0,im=t}};function UI(t,e,r,n,c,d,m,l,w){Yh=!1,im=null,FI.apply($I,arguments)}function VI(t,e,r,n,c,d,m,l,w){if(UI.apply(this,arguments),Yh){if(Yh){var k=im;Yh=!1,im=null}else throw Error(Ze(198));nm||(nm=!0,N_=k)}}function Nl(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function J2(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Mw(t){if(Nl(t)!==t)throw Error(Ze(188))}function qI(t){var e=t.alternate;if(!e){if(e=Nl(t),e===null)throw Error(Ze(188));return e!==t?null:t}for(var r=t,n=e;;){var c=r.return;if(c===null)break;var d=c.alternate;if(d===null){if(n=c.return,n!==null){r=n;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===r)return Mw(c),t;if(d===n)return Mw(c),e;d=d.sibling}throw Error(Ze(188))}if(r.return!==n.return)r=c,n=d;else{for(var m=!1,l=c.child;l;){if(l===r){m=!0,r=c,n=d;break}if(l===n){m=!0,n=c,r=d;break}l=l.sibling}if(!m){for(l=d.child;l;){if(l===r){m=!0,r=d,n=c;break}if(l===n){m=!0,n=d,r=c;break}l=l.sibling}if(!m)throw Error(Ze(189))}}if(r.alternate!==n)throw Error(Ze(190))}if(r.tag!==3)throw Error(Ze(188));return r.stateNode.current===r?t:e}function Q2(t){return t=qI(t),t!==null?ek(t):null}function ek(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=ek(t);if(e!==null)return e;t=t.sibling}return null}var tk=Qi.unstable_scheduleCallback,jw=Qi.unstable_cancelCallback,GI=Qi.unstable_shouldYield,WI=Qi.unstable_requestPaint,as=Qi.unstable_now,ZI=Qi.unstable_getCurrentPriorityLevel,hx=Qi.unstable_ImmediatePriority,rk=Qi.unstable_UserBlockingPriority,am=Qi.unstable_NormalPriority,HI=Qi.unstable_LowPriority,sk=Qi.unstable_IdlePriority,Rm=null,ca=null;function KI(t){if(ca&&typeof ca.onCommitFiberRoot=="function")try{ca.onCommitFiberRoot(Rm,t,void 0,(t.current.flags&128)===128)}catch{}}var qn=Math.clz32?Math.clz32:JI,XI=Math.log,YI=Math.LN2;function JI(t){return t>>>=0,t===0?32:31-(XI(t)/YI|0)|0}var dp=64,fp=4194304;function Gh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function om(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,c=t.suspendedLanes,d=t.pingedLanes,m=r&268435455;if(m!==0){var l=m&~c;l!==0?n=Gh(l):(d&=m,d!==0&&(n=Gh(d)))}else m=r&~c,m!==0?n=Gh(m):d!==0&&(n=Gh(d));if(n===0)return 0;if(e!==0&&e!==n&&!(e&c)&&(c=n&-n,d=e&-e,c>=d||c===16&&(d&4194240)!==0))return e;if(n&4&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-qn(e),c=1<<r,n|=t[r],e&=~c;return n}function QI(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eM(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,c=t.expirationTimes,d=t.pendingLanes;0<d;){var m=31-qn(d),l=1<<m,w=c[m];w===-1?(!(l&r)||l&n)&&(c[m]=QI(l,e)):w<=e&&(t.expiredLanes|=l),d&=~l}}function L_(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ik(){var t=dp;return dp<<=1,!(dp&4194240)&&(dp=64),t}function Sy(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function $d(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qn(e),t[e]=r}function tM(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var c=31-qn(r),d=1<<c;e[c]=0,n[c]=-1,t[c]=-1,r&=~d}}function dx(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-qn(r),c=1<<n;c&e|t[n]&e&&(t[n]|=e),r&=~c}}var fr=0;function nk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ak,fx,ok,lk,ck,R_=!1,pp=[],To=null,Eo=null,Co=null,yd=new Map,_d=new Map,vo=[],rM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dw(t,e){switch(t){case"focusin":case"focusout":To=null;break;case"dragenter":case"dragleave":Eo=null;break;case"mouseover":case"mouseout":Co=null;break;case"pointerover":case"pointerout":yd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_d.delete(e.pointerId)}}function jh(t,e,r,n,c,d){return t===null||t.nativeEvent!==d?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:d,targetContainers:[c]},e!==null&&(e=Vd(e),e!==null&&fx(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),t)}function sM(t,e,r,n,c){switch(e){case"focusin":return To=jh(To,t,e,r,n,c),!0;case"dragenter":return Eo=jh(Eo,t,e,r,n,c),!0;case"mouseover":return Co=jh(Co,t,e,r,n,c),!0;case"pointerover":var d=c.pointerId;return yd.set(d,jh(yd.get(d)||null,t,e,r,n,c)),!0;case"gotpointercapture":return d=c.pointerId,_d.set(d,jh(_d.get(d)||null,t,e,r,n,c)),!0}return!1}function uk(t){var e=vl(t.target);if(e!==null){var r=Nl(e);if(r!==null){if(e=r.tag,e===13){if(e=J2(r),e!==null){t.blockedOn=e,ck(t.priority,function(){ok(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Bp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=z_(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);M_=n,r.target.dispatchEvent(n),M_=null}else return e=Vd(r),e!==null&&fx(e),t.blockedOn=r,!1;e.shift()}return!0}function Nw(t,e,r){Bp(t)&&r.delete(e)}function iM(){R_=!1,To!==null&&Bp(To)&&(To=null),Eo!==null&&Bp(Eo)&&(Eo=null),Co!==null&&Bp(Co)&&(Co=null),yd.forEach(Nw),_d.forEach(Nw)}function Dh(t,e){t.blockedOn===e&&(t.blockedOn=null,R_||(R_=!0,Qi.unstable_scheduleCallback(Qi.unstable_NormalPriority,iM)))}function vd(t){function e(c){return Dh(c,t)}if(0<pp.length){Dh(pp[0],t);for(var r=1;r<pp.length;r++){var n=pp[r];n.blockedOn===t&&(n.blockedOn=null)}}for(To!==null&&Dh(To,t),Eo!==null&&Dh(Eo,t),Co!==null&&Dh(Co,t),yd.forEach(e),_d.forEach(e),r=0;r<vo.length;r++)n=vo[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<vo.length&&(r=vo[0],r.blockedOn===null);)uk(r),r.blockedOn===null&&vo.shift()}var Yc=Ga.ReactCurrentBatchConfig,lm=!0;function nM(t,e,r,n){var c=fr,d=Yc.transition;Yc.transition=null;try{fr=1,px(t,e,r,n)}finally{fr=c,Yc.transition=d}}function aM(t,e,r,n){var c=fr,d=Yc.transition;Yc.transition=null;try{fr=4,px(t,e,r,n)}finally{fr=c,Yc.transition=d}}function px(t,e,r,n){if(lm){var c=z_(t,e,r,n);if(c===null)Dy(t,e,n,cm,r),Dw(t,n);else if(sM(c,t,e,r,n))n.stopPropagation();else if(Dw(t,n),e&4&&-1<rM.indexOf(t)){for(;c!==null;){var d=Vd(c);if(d!==null&&ak(d),d=z_(t,e,r,n),d===null&&Dy(t,e,n,cm,r),d===c)break;c=d}c!==null&&n.stopPropagation()}else Dy(t,e,n,null,r)}}var cm=null;function z_(t,e,r,n){if(cm=null,t=ux(n),t=vl(t),t!==null)if(e=Nl(t),e===null)t=null;else if(r=e.tag,r===13){if(t=J2(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return cm=t,null}function hk(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ZI()){case hx:return 1;case rk:return 4;case am:case HI:return 16;case sk:return 536870912;default:return 16}default:return 16}}var wo=null,mx=null,Op=null;function dk(){if(Op)return Op;var t,e=mx,r=e.length,n,c="value"in wo?wo.value:wo.textContent,d=c.length;for(t=0;t<r&&e[t]===c[t];t++);var m=r-t;for(n=1;n<=m&&e[r-n]===c[d-n];n++);return Op=c.slice(t,1<n?1-n:void 0)}function Fp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function mp(){return!0}function Lw(){return!1}function tn(t){function e(r,n,c,d,m){this._reactName=r,this._targetInst=c,this.type=n,this.nativeEvent=d,this.target=m,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(r=t[l],this[l]=r?r(d):d[l]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?mp:Lw,this.isPropagationStopped=Lw,this}return Vr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=mp)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=mp)},persist:function(){},isPersistent:mp}),e}var pu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gx=tn(pu),Ud=Vr({},pu,{view:0,detail:0}),oM=tn(Ud),ky,Ty,Nh,zm=Vr({},Ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yx,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Nh&&(Nh&&t.type==="mousemove"?(ky=t.screenX-Nh.screenX,Ty=t.screenY-Nh.screenY):Ty=ky=0,Nh=t),ky)},movementY:function(t){return"movementY"in t?t.movementY:Ty}}),Rw=tn(zm),lM=Vr({},zm,{dataTransfer:0}),cM=tn(lM),uM=Vr({},Ud,{relatedTarget:0}),Ey=tn(uM),hM=Vr({},pu,{animationName:0,elapsedTime:0,pseudoElement:0}),dM=tn(hM),fM=Vr({},pu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),pM=tn(fM),mM=Vr({},pu,{data:0}),zw=tn(mM),gM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_M={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vM(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=_M[t])?!!e[t]:!1}function yx(){return vM}var xM=Vr({},Ud,{key:function(t){if(t.key){var e=gM[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Fp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yx,charCode:function(t){return t.type==="keypress"?Fp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Fp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),bM=tn(xM),wM=Vr({},zm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bw=tn(wM),SM=Vr({},Ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yx}),kM=tn(SM),TM=Vr({},pu,{propertyName:0,elapsedTime:0,pseudoElement:0}),EM=tn(TM),CM=Vr({},zm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),AM=tn(CM),PM=[9,13,27,32],_x=Oa&&"CompositionEvent"in window,Jh=null;Oa&&"documentMode"in document&&(Jh=document.documentMode);var IM=Oa&&"TextEvent"in window&&!Jh,fk=Oa&&(!_x||Jh&&8<Jh&&11>=Jh),Ow=" ",Fw=!1;function pk(t,e){switch(t){case"keyup":return PM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Dc=!1;function MM(t,e){switch(t){case"compositionend":return mk(e);case"keypress":return e.which!==32?null:(Fw=!0,Ow);case"textInput":return t=e.data,t===Ow&&Fw?null:t;default:return null}}function jM(t,e){if(Dc)return t==="compositionend"||!_x&&pk(t,e)?(t=dk(),Op=mx=wo=null,Dc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return fk&&e.locale!=="ko"?null:e.data;default:return null}}var DM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $w(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!DM[t.type]:e==="textarea"}function gk(t,e,r,n){Z2(n),e=um(e,"onChange"),0<e.length&&(r=new gx("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var Qh=null,xd=null;function NM(t){Ck(t,0)}function Bm(t){var e=Rc(t);if(F2(e))return t}function LM(t,e){if(t==="change")return e}var yk=!1;if(Oa){var Cy;if(Oa){var Ay="oninput"in document;if(!Ay){var Uw=document.createElement("div");Uw.setAttribute("oninput","return;"),Ay=typeof Uw.oninput=="function"}Cy=Ay}else Cy=!1;yk=Cy&&(!document.documentMode||9<document.documentMode)}function Vw(){Qh&&(Qh.detachEvent("onpropertychange",_k),xd=Qh=null)}function _k(t){if(t.propertyName==="value"&&Bm(xd)){var e=[];gk(e,xd,t,ux(t)),Y2(NM,e)}}function RM(t,e,r){t==="focusin"?(Vw(),Qh=e,xd=r,Qh.attachEvent("onpropertychange",_k)):t==="focusout"&&Vw()}function zM(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Bm(xd)}function BM(t,e){if(t==="click")return Bm(e)}function OM(t,e){if(t==="input"||t==="change")return Bm(e)}function FM(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Wn=typeof Object.is=="function"?Object.is:FM;function bd(t,e){if(Wn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var c=r[n];if(!v_.call(e,c)||!Wn(t[c],e[c]))return!1}return!0}function qw(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Gw(t,e){var r=qw(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=qw(r)}}function vk(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?vk(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function xk(){for(var t=window,e=sm();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=sm(t.document)}return e}function vx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function $M(t){var e=xk(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&vk(r.ownerDocument.documentElement,r)){if(n!==null&&vx(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var c=r.textContent.length,d=Math.min(n.start,c);n=n.end===void 0?d:Math.min(n.end,c),!t.extend&&d>n&&(c=n,n=d,d=c),c=Gw(r,d);var m=Gw(r,n);c&&m&&(t.rangeCount!==1||t.anchorNode!==c.node||t.anchorOffset!==c.offset||t.focusNode!==m.node||t.focusOffset!==m.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),t.removeAllRanges(),d>n?(t.addRange(e),t.extend(m.node,m.offset)):(e.setEnd(m.node,m.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var UM=Oa&&"documentMode"in document&&11>=document.documentMode,Nc=null,B_=null,ed=null,O_=!1;function Ww(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;O_||Nc==null||Nc!==sm(n)||(n=Nc,"selectionStart"in n&&vx(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ed&&bd(ed,n)||(ed=n,n=um(B_,"onSelect"),0<n.length&&(e=new gx("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=Nc)))}function gp(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var Lc={animationend:gp("Animation","AnimationEnd"),animationiteration:gp("Animation","AnimationIteration"),animationstart:gp("Animation","AnimationStart"),transitionend:gp("Transition","TransitionEnd")},Py={},bk={};Oa&&(bk=document.createElement("div").style,"AnimationEvent"in window||(delete Lc.animationend.animation,delete Lc.animationiteration.animation,delete Lc.animationstart.animation),"TransitionEvent"in window||delete Lc.transitionend.transition);function Om(t){if(Py[t])return Py[t];if(!Lc[t])return t;var e=Lc[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in bk)return Py[t]=e[r];return t}var wk=Om("animationend"),Sk=Om("animationiteration"),kk=Om("animationstart"),Tk=Om("transitionend"),Ek=new Map,Zw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Oo(t,e){Ek.set(t,e),Dl(e,[t])}for(var Iy=0;Iy<Zw.length;Iy++){var My=Zw[Iy],VM=My.toLowerCase(),qM=My[0].toUpperCase()+My.slice(1);Oo(VM,"on"+qM)}Oo(wk,"onAnimationEnd");Oo(Sk,"onAnimationIteration");Oo(kk,"onAnimationStart");Oo("dblclick","onDoubleClick");Oo("focusin","onFocus");Oo("focusout","onBlur");Oo(Tk,"onTransitionEnd");su("onMouseEnter",["mouseout","mouseover"]);su("onMouseLeave",["mouseout","mouseover"]);su("onPointerEnter",["pointerout","pointerover"]);su("onPointerLeave",["pointerout","pointerover"]);Dl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Dl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Dl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Dl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Dl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Dl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GM=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wh));function Hw(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,VI(n,e,void 0,t),t.currentTarget=null}function Ck(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],c=n.event;n=n.listeners;e:{var d=void 0;if(e)for(var m=n.length-1;0<=m;m--){var l=n[m],w=l.instance,k=l.currentTarget;if(l=l.listener,w!==d&&c.isPropagationStopped())break e;Hw(c,l,k),d=w}else for(m=0;m<n.length;m++){if(l=n[m],w=l.instance,k=l.currentTarget,l=l.listener,w!==d&&c.isPropagationStopped())break e;Hw(c,l,k),d=w}}}if(nm)throw t=N_,nm=!1,N_=null,t}function Pr(t,e){var r=e[q_];r===void 0&&(r=e[q_]=new Set);var n=t+"__bubble";r.has(n)||(Ak(e,t,2,!1),r.add(n))}function jy(t,e,r){var n=0;e&&(n|=4),Ak(r,t,n,e)}var yp="_reactListening"+Math.random().toString(36).slice(2);function wd(t){if(!t[yp]){t[yp]=!0,L2.forEach(function(r){r!=="selectionchange"&&(GM.has(r)||jy(r,!1,t),jy(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[yp]||(e[yp]=!0,jy("selectionchange",!1,e))}}function Ak(t,e,r,n){switch(hk(e)){case 1:var c=nM;break;case 4:c=aM;break;default:c=px}r=c.bind(null,e,r,t),c=void 0,!D_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),n?c!==void 0?t.addEventListener(e,r,{capture:!0,passive:c}):t.addEventListener(e,r,!0):c!==void 0?t.addEventListener(e,r,{passive:c}):t.addEventListener(e,r,!1)}function Dy(t,e,r,n,c){var d=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var m=n.tag;if(m===3||m===4){var l=n.stateNode.containerInfo;if(l===c||l.nodeType===8&&l.parentNode===c)break;if(m===4)for(m=n.return;m!==null;){var w=m.tag;if((w===3||w===4)&&(w=m.stateNode.containerInfo,w===c||w.nodeType===8&&w.parentNode===c))return;m=m.return}for(;l!==null;){if(m=vl(l),m===null)return;if(w=m.tag,w===5||w===6){n=d=m;continue e}l=l.parentNode}}n=n.return}Y2(function(){var k=d,P=ux(r),j=[];e:{var L=Ek.get(t);if(L!==void 0){var Z=gx,Y=t;switch(t){case"keypress":if(Fp(r)===0)break e;case"keydown":case"keyup":Z=bM;break;case"focusin":Y="focus",Z=Ey;break;case"focusout":Y="blur",Z=Ey;break;case"beforeblur":case"afterblur":Z=Ey;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=Rw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=cM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=kM;break;case wk:case Sk:case kk:Z=dM;break;case Tk:Z=EM;break;case"scroll":Z=oM;break;case"wheel":Z=AM;break;case"copy":case"cut":case"paste":Z=pM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=Bw}var ce=(e&4)!==0,de=!ce&&t==="scroll",G=ce?L!==null?L+"Capture":null:L;ce=[];for(var H=k,W;H!==null;){W=H;var ue=W.stateNode;if(W.tag===5&&ue!==null&&(W=ue,G!==null&&(ue=gd(H,G),ue!=null&&ce.push(Sd(H,ue,W)))),de)break;H=H.return}0<ce.length&&(L=new Z(L,Y,null,r,P),j.push({event:L,listeners:ce}))}}if(!(e&7)){e:{if(L=t==="mouseover"||t==="pointerover",Z=t==="mouseout"||t==="pointerout",L&&r!==M_&&(Y=r.relatedTarget||r.fromElement)&&(vl(Y)||Y[Fa]))break e;if((Z||L)&&(L=P.window===P?P:(L=P.ownerDocument)?L.defaultView||L.parentWindow:window,Z?(Y=r.relatedTarget||r.toElement,Z=k,Y=Y?vl(Y):null,Y!==null&&(de=Nl(Y),Y!==de||Y.tag!==5&&Y.tag!==6)&&(Y=null)):(Z=null,Y=k),Z!==Y)){if(ce=Rw,ue="onMouseLeave",G="onMouseEnter",H="mouse",(t==="pointerout"||t==="pointerover")&&(ce=Bw,ue="onPointerLeave",G="onPointerEnter",H="pointer"),de=Z==null?L:Rc(Z),W=Y==null?L:Rc(Y),L=new ce(ue,H+"leave",Z,r,P),L.target=de,L.relatedTarget=W,ue=null,vl(P)===k&&(ce=new ce(G,H+"enter",Y,r,P),ce.target=W,ce.relatedTarget=de,ue=ce),de=ue,Z&&Y)t:{for(ce=Z,G=Y,H=0,W=ce;W;W=Sc(W))H++;for(W=0,ue=G;ue;ue=Sc(ue))W++;for(;0<H-W;)ce=Sc(ce),H--;for(;0<W-H;)G=Sc(G),W--;for(;H--;){if(ce===G||G!==null&&ce===G.alternate)break t;ce=Sc(ce),G=Sc(G)}ce=null}else ce=null;Z!==null&&Kw(j,L,Z,ce,!1),Y!==null&&de!==null&&Kw(j,de,Y,ce,!0)}}e:{if(L=k?Rc(k):window,Z=L.nodeName&&L.nodeName.toLowerCase(),Z==="select"||Z==="input"&&L.type==="file")var me=LM;else if($w(L))if(yk)me=OM;else{me=zM;var be=RM}else(Z=L.nodeName)&&Z.toLowerCase()==="input"&&(L.type==="checkbox"||L.type==="radio")&&(me=BM);if(me&&(me=me(t,k))){gk(j,me,r,P);break e}be&&be(t,L,k),t==="focusout"&&(be=L._wrapperState)&&be.controlled&&L.type==="number"&&E_(L,"number",L.value)}switch(be=k?Rc(k):window,t){case"focusin":($w(be)||be.contentEditable==="true")&&(Nc=be,B_=k,ed=null);break;case"focusout":ed=B_=Nc=null;break;case"mousedown":O_=!0;break;case"contextmenu":case"mouseup":case"dragend":O_=!1,Ww(j,r,P);break;case"selectionchange":if(UM)break;case"keydown":case"keyup":Ww(j,r,P)}var Ce;if(_x)e:{switch(t){case"compositionstart":var Te="onCompositionStart";break e;case"compositionend":Te="onCompositionEnd";break e;case"compositionupdate":Te="onCompositionUpdate";break e}Te=void 0}else Dc?pk(t,r)&&(Te="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(Te="onCompositionStart");Te&&(fk&&r.locale!=="ko"&&(Dc||Te!=="onCompositionStart"?Te==="onCompositionEnd"&&Dc&&(Ce=dk()):(wo=P,mx="value"in wo?wo.value:wo.textContent,Dc=!0)),be=um(k,Te),0<be.length&&(Te=new zw(Te,t,null,r,P),j.push({event:Te,listeners:be}),Ce?Te.data=Ce:(Ce=mk(r),Ce!==null&&(Te.data=Ce)))),(Ce=IM?MM(t,r):jM(t,r))&&(k=um(k,"onBeforeInput"),0<k.length&&(P=new zw("onBeforeInput","beforeinput",null,r,P),j.push({event:P,listeners:k}),P.data=Ce))}Ck(j,e)})}function Sd(t,e,r){return{instance:t,listener:e,currentTarget:r}}function um(t,e){for(var r=e+"Capture",n=[];t!==null;){var c=t,d=c.stateNode;c.tag===5&&d!==null&&(c=d,d=gd(t,r),d!=null&&n.unshift(Sd(t,d,c)),d=gd(t,e),d!=null&&n.push(Sd(t,d,c))),t=t.return}return n}function Sc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Kw(t,e,r,n,c){for(var d=e._reactName,m=[];r!==null&&r!==n;){var l=r,w=l.alternate,k=l.stateNode;if(w!==null&&w===n)break;l.tag===5&&k!==null&&(l=k,c?(w=gd(r,d),w!=null&&m.unshift(Sd(r,w,l))):c||(w=gd(r,d),w!=null&&m.push(Sd(r,w,l)))),r=r.return}m.length!==0&&t.push({event:e,listeners:m})}var WM=/\r\n?/g,ZM=/\u0000|\uFFFD/g;function Xw(t){return(typeof t=="string"?t:""+t).replace(WM,`
`).replace(ZM,"")}function _p(t,e,r){if(e=Xw(e),Xw(t)!==e&&r)throw Error(Ze(425))}function hm(){}var F_=null,$_=null;function U_(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var V_=typeof setTimeout=="function"?setTimeout:void 0,HM=typeof clearTimeout=="function"?clearTimeout:void 0,Yw=typeof Promise=="function"?Promise:void 0,KM=typeof queueMicrotask=="function"?queueMicrotask:typeof Yw<"u"?function(t){return Yw.resolve(null).then(t).catch(XM)}:V_;function XM(t){setTimeout(function(){throw t})}function Ny(t,e){var r=e,n=0;do{var c=r.nextSibling;if(t.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(n===0){t.removeChild(c),vd(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=c}while(r);vd(e)}function Ao(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Jw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var mu=Math.random().toString(36).slice(2),la="__reactFiber$"+mu,kd="__reactProps$"+mu,Fa="__reactContainer$"+mu,q_="__reactEvents$"+mu,YM="__reactListeners$"+mu,JM="__reactHandles$"+mu;function vl(t){var e=t[la];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Fa]||r[la]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=Jw(t);t!==null;){if(r=t[la])return r;t=Jw(t)}return e}t=r,r=t.parentNode}return null}function Vd(t){return t=t[la]||t[Fa],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Rc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ze(33))}function Fm(t){return t[kd]||null}var G_=[],zc=-1;function Fo(t){return{current:t}}function Ir(t){0>zc||(t.current=G_[zc],G_[zc]=null,zc--)}function Tr(t,e){zc++,G_[zc]=t.current,t.current=e}var Ro={},ri=Fo(Ro),zi=Fo(!1),Al=Ro;function iu(t,e){var r=t.type.contextTypes;if(!r)return Ro;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var c={},d;for(d in r)c[d]=e[d];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=c),c}function Bi(t){return t=t.childContextTypes,t!=null}function dm(){Ir(zi),Ir(ri)}function Qw(t,e,r){if(ri.current!==Ro)throw Error(Ze(168));Tr(ri,e),Tr(zi,r)}function Pk(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var c in n)if(!(c in e))throw Error(Ze(108,RI(t)||"Unknown",c));return Vr({},r,n)}function fm(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ro,Al=ri.current,Tr(ri,t),Tr(zi,zi.current),!0}function e1(t,e,r){var n=t.stateNode;if(!n)throw Error(Ze(169));r?(t=Pk(t,e,Al),n.__reactInternalMemoizedMergedChildContext=t,Ir(zi),Ir(ri),Tr(ri,t)):Ir(zi),Tr(zi,r)}var La=null,$m=!1,Ly=!1;function Ik(t){La===null?La=[t]:La.push(t)}function QM(t){$m=!0,Ik(t)}function $o(){if(!Ly&&La!==null){Ly=!0;var t=0,e=fr;try{var r=La;for(fr=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}La=null,$m=!1}catch(c){throw La!==null&&(La=La.slice(t+1)),tk(hx,$o),c}finally{fr=e,Ly=!1}}return null}var Bc=[],Oc=0,pm=null,mm=0,gn=[],yn=0,Pl=null,Ra=1,za="";function pl(t,e){Bc[Oc++]=mm,Bc[Oc++]=pm,pm=t,mm=e}function Mk(t,e,r){gn[yn++]=Ra,gn[yn++]=za,gn[yn++]=Pl,Pl=t;var n=Ra;t=za;var c=32-qn(n)-1;n&=~(1<<c),r+=1;var d=32-qn(e)+c;if(30<d){var m=c-c%5;d=(n&(1<<m)-1).toString(32),n>>=m,c-=m,Ra=1<<32-qn(e)+c|r<<c|n,za=d+t}else Ra=1<<d|r<<c|n,za=t}function xx(t){t.return!==null&&(pl(t,1),Mk(t,1,0))}function bx(t){for(;t===pm;)pm=Bc[--Oc],Bc[Oc]=null,mm=Bc[--Oc],Bc[Oc]=null;for(;t===Pl;)Pl=gn[--yn],gn[yn]=null,za=gn[--yn],gn[yn]=null,Ra=gn[--yn],gn[yn]=null}var Yi=null,Xi=null,Nr=!1,Vn=null;function jk(t,e){var r=vn(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function t1(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Yi=t,Xi=Ao(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Yi=t,Xi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Pl!==null?{id:Ra,overflow:za}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=vn(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Yi=t,Xi=null,!0):!1;default:return!1}}function W_(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Z_(t){if(Nr){var e=Xi;if(e){var r=e;if(!t1(t,e)){if(W_(t))throw Error(Ze(418));e=Ao(r.nextSibling);var n=Yi;e&&t1(t,e)?jk(n,r):(t.flags=t.flags&-4097|2,Nr=!1,Yi=t)}}else{if(W_(t))throw Error(Ze(418));t.flags=t.flags&-4097|2,Nr=!1,Yi=t}}}function r1(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Yi=t}function vp(t){if(t!==Yi)return!1;if(!Nr)return r1(t),Nr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!U_(t.type,t.memoizedProps)),e&&(e=Xi)){if(W_(t))throw Dk(),Error(Ze(418));for(;e;)jk(t,e),e=Ao(e.nextSibling)}if(r1(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ze(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Xi=Ao(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Xi=null}}else Xi=Yi?Ao(t.stateNode.nextSibling):null;return!0}function Dk(){for(var t=Xi;t;)t=Ao(t.nextSibling)}function nu(){Xi=Yi=null,Nr=!1}function wx(t){Vn===null?Vn=[t]:Vn.push(t)}var ej=Ga.ReactCurrentBatchConfig;function Lh(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ze(309));var n=r.stateNode}if(!n)throw Error(Ze(147,t));var c=n,d=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(m){var l=c.refs;m===null?delete l[d]:l[d]=m},e._stringRef=d,e)}if(typeof t!="string")throw Error(Ze(284));if(!r._owner)throw Error(Ze(290,t))}return t}function xp(t,e){throw t=Object.prototype.toString.call(e),Error(Ze(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function s1(t){var e=t._init;return e(t._payload)}function Nk(t){function e(G,H){if(t){var W=G.deletions;W===null?(G.deletions=[H],G.flags|=16):W.push(H)}}function r(G,H){if(!t)return null;for(;H!==null;)e(G,H),H=H.sibling;return null}function n(G,H){for(G=new Map;H!==null;)H.key!==null?G.set(H.key,H):G.set(H.index,H),H=H.sibling;return G}function c(G,H){return G=jo(G,H),G.index=0,G.sibling=null,G}function d(G,H,W){return G.index=W,t?(W=G.alternate,W!==null?(W=W.index,W<H?(G.flags|=2,H):W):(G.flags|=2,H)):(G.flags|=1048576,H)}function m(G){return t&&G.alternate===null&&(G.flags|=2),G}function l(G,H,W,ue){return H===null||H.tag!==6?(H=Uy(W,G.mode,ue),H.return=G,H):(H=c(H,W),H.return=G,H)}function w(G,H,W,ue){var me=W.type;return me===jc?P(G,H,W.props.children,ue,W.key):H!==null&&(H.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===yo&&s1(me)===H.type)?(ue=c(H,W.props),ue.ref=Lh(G,H,W),ue.return=G,ue):(ue=Zp(W.type,W.key,W.props,null,G.mode,ue),ue.ref=Lh(G,H,W),ue.return=G,ue)}function k(G,H,W,ue){return H===null||H.tag!==4||H.stateNode.containerInfo!==W.containerInfo||H.stateNode.implementation!==W.implementation?(H=Vy(W,G.mode,ue),H.return=G,H):(H=c(H,W.children||[]),H.return=G,H)}function P(G,H,W,ue,me){return H===null||H.tag!==7?(H=Tl(W,G.mode,ue,me),H.return=G,H):(H=c(H,W),H.return=G,H)}function j(G,H,W){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Uy(""+H,G.mode,W),H.return=G,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case cp:return W=Zp(H.type,H.key,H.props,null,G.mode,W),W.ref=Lh(G,null,H),W.return=G,W;case Mc:return H=Vy(H,G.mode,W),H.return=G,H;case yo:var ue=H._init;return j(G,ue(H._payload),W)}if(qh(H)||Ih(H))return H=Tl(H,G.mode,W,null),H.return=G,H;xp(G,H)}return null}function L(G,H,W,ue){var me=H!==null?H.key:null;if(typeof W=="string"&&W!==""||typeof W=="number")return me!==null?null:l(G,H,""+W,ue);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case cp:return W.key===me?w(G,H,W,ue):null;case Mc:return W.key===me?k(G,H,W,ue):null;case yo:return me=W._init,L(G,H,me(W._payload),ue)}if(qh(W)||Ih(W))return me!==null?null:P(G,H,W,ue,null);xp(G,W)}return null}function Z(G,H,W,ue,me){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return G=G.get(W)||null,l(H,G,""+ue,me);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case cp:return G=G.get(ue.key===null?W:ue.key)||null,w(H,G,ue,me);case Mc:return G=G.get(ue.key===null?W:ue.key)||null,k(H,G,ue,me);case yo:var be=ue._init;return Z(G,H,W,be(ue._payload),me)}if(qh(ue)||Ih(ue))return G=G.get(W)||null,P(H,G,ue,me,null);xp(H,ue)}return null}function Y(G,H,W,ue){for(var me=null,be=null,Ce=H,Te=H=0,rt=null;Ce!==null&&Te<W.length;Te++){Ce.index>Te?(rt=Ce,Ce=null):rt=Ce.sibling;var Ue=L(G,Ce,W[Te],ue);if(Ue===null){Ce===null&&(Ce=rt);break}t&&Ce&&Ue.alternate===null&&e(G,Ce),H=d(Ue,H,Te),be===null?me=Ue:be.sibling=Ue,be=Ue,Ce=rt}if(Te===W.length)return r(G,Ce),Nr&&pl(G,Te),me;if(Ce===null){for(;Te<W.length;Te++)Ce=j(G,W[Te],ue),Ce!==null&&(H=d(Ce,H,Te),be===null?me=Ce:be.sibling=Ce,be=Ce);return Nr&&pl(G,Te),me}for(Ce=n(G,Ce);Te<W.length;Te++)rt=Z(Ce,G,Te,W[Te],ue),rt!==null&&(t&&rt.alternate!==null&&Ce.delete(rt.key===null?Te:rt.key),H=d(rt,H,Te),be===null?me=rt:be.sibling=rt,be=rt);return t&&Ce.forEach(function(St){return e(G,St)}),Nr&&pl(G,Te),me}function ce(G,H,W,ue){var me=Ih(W);if(typeof me!="function")throw Error(Ze(150));if(W=me.call(W),W==null)throw Error(Ze(151));for(var be=me=null,Ce=H,Te=H=0,rt=null,Ue=W.next();Ce!==null&&!Ue.done;Te++,Ue=W.next()){Ce.index>Te?(rt=Ce,Ce=null):rt=Ce.sibling;var St=L(G,Ce,Ue.value,ue);if(St===null){Ce===null&&(Ce=rt);break}t&&Ce&&St.alternate===null&&e(G,Ce),H=d(St,H,Te),be===null?me=St:be.sibling=St,be=St,Ce=rt}if(Ue.done)return r(G,Ce),Nr&&pl(G,Te),me;if(Ce===null){for(;!Ue.done;Te++,Ue=W.next())Ue=j(G,Ue.value,ue),Ue!==null&&(H=d(Ue,H,Te),be===null?me=Ue:be.sibling=Ue,be=Ue);return Nr&&pl(G,Te),me}for(Ce=n(G,Ce);!Ue.done;Te++,Ue=W.next())Ue=Z(Ce,G,Te,Ue.value,ue),Ue!==null&&(t&&Ue.alternate!==null&&Ce.delete(Ue.key===null?Te:Ue.key),H=d(Ue,H,Te),be===null?me=Ue:be.sibling=Ue,be=Ue);return t&&Ce.forEach(function(Oe){return e(G,Oe)}),Nr&&pl(G,Te),me}function de(G,H,W,ue){if(typeof W=="object"&&W!==null&&W.type===jc&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case cp:e:{for(var me=W.key,be=H;be!==null;){if(be.key===me){if(me=W.type,me===jc){if(be.tag===7){r(G,be.sibling),H=c(be,W.props.children),H.return=G,G=H;break e}}else if(be.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===yo&&s1(me)===be.type){r(G,be.sibling),H=c(be,W.props),H.ref=Lh(G,be,W),H.return=G,G=H;break e}r(G,be);break}else e(G,be);be=be.sibling}W.type===jc?(H=Tl(W.props.children,G.mode,ue,W.key),H.return=G,G=H):(ue=Zp(W.type,W.key,W.props,null,G.mode,ue),ue.ref=Lh(G,H,W),ue.return=G,G=ue)}return m(G);case Mc:e:{for(be=W.key;H!==null;){if(H.key===be)if(H.tag===4&&H.stateNode.containerInfo===W.containerInfo&&H.stateNode.implementation===W.implementation){r(G,H.sibling),H=c(H,W.children||[]),H.return=G,G=H;break e}else{r(G,H);break}else e(G,H);H=H.sibling}H=Vy(W,G.mode,ue),H.return=G,G=H}return m(G);case yo:return be=W._init,de(G,H,be(W._payload),ue)}if(qh(W))return Y(G,H,W,ue);if(Ih(W))return ce(G,H,W,ue);xp(G,W)}return typeof W=="string"&&W!==""||typeof W=="number"?(W=""+W,H!==null&&H.tag===6?(r(G,H.sibling),H=c(H,W),H.return=G,G=H):(r(G,H),H=Uy(W,G.mode,ue),H.return=G,G=H),m(G)):r(G,H)}return de}var au=Nk(!0),Lk=Nk(!1),gm=Fo(null),ym=null,Fc=null,Sx=null;function kx(){Sx=Fc=ym=null}function Tx(t){var e=gm.current;Ir(gm),t._currentValue=e}function H_(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Jc(t,e){ym=t,Sx=Fc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Li=!0),t.firstContext=null)}function wn(t){var e=t._currentValue;if(Sx!==t)if(t={context:t,memoizedValue:e,next:null},Fc===null){if(ym===null)throw Error(Ze(308));Fc=t,ym.dependencies={lanes:0,firstContext:t}}else Fc=Fc.next=t;return e}var xl=null;function Ex(t){xl===null?xl=[t]:xl.push(t)}function Rk(t,e,r,n){var c=e.interleaved;return c===null?(r.next=r,Ex(e)):(r.next=c.next,c.next=r),e.interleaved=r,$a(t,n)}function $a(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var _o=!1;function Cx(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zk(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ba(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Po(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,sr&2){var c=n.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),n.pending=e,$a(t,r)}return c=n.interleaved,c===null?(e.next=e,Ex(n)):(e.next=c.next,c.next=e),n.interleaved=e,$a(t,r)}function $p(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,dx(t,r)}}function i1(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var c=null,d=null;if(r=r.firstBaseUpdate,r!==null){do{var m={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};d===null?c=d=m:d=d.next=m,r=r.next}while(r!==null);d===null?c=d=e:d=d.next=e}else c=d=e;r={baseState:n.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function _m(t,e,r,n){var c=t.updateQueue;_o=!1;var d=c.firstBaseUpdate,m=c.lastBaseUpdate,l=c.shared.pending;if(l!==null){c.shared.pending=null;var w=l,k=w.next;w.next=null,m===null?d=k:m.next=k,m=w;var P=t.alternate;P!==null&&(P=P.updateQueue,l=P.lastBaseUpdate,l!==m&&(l===null?P.firstBaseUpdate=k:l.next=k,P.lastBaseUpdate=w))}if(d!==null){var j=c.baseState;m=0,P=k=w=null,l=d;do{var L=l.lane,Z=l.eventTime;if((n&L)===L){P!==null&&(P=P.next={eventTime:Z,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var Y=t,ce=l;switch(L=e,Z=r,ce.tag){case 1:if(Y=ce.payload,typeof Y=="function"){j=Y.call(Z,j,L);break e}j=Y;break e;case 3:Y.flags=Y.flags&-65537|128;case 0:if(Y=ce.payload,L=typeof Y=="function"?Y.call(Z,j,L):Y,L==null)break e;j=Vr({},j,L);break e;case 2:_o=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,L=c.effects,L===null?c.effects=[l]:L.push(l))}else Z={eventTime:Z,lane:L,tag:l.tag,payload:l.payload,callback:l.callback,next:null},P===null?(k=P=Z,w=j):P=P.next=Z,m|=L;if(l=l.next,l===null){if(l=c.shared.pending,l===null)break;L=l,l=L.next,L.next=null,c.lastBaseUpdate=L,c.shared.pending=null}}while(!0);if(P===null&&(w=j),c.baseState=w,c.firstBaseUpdate=k,c.lastBaseUpdate=P,e=c.shared.interleaved,e!==null){c=e;do m|=c.lane,c=c.next;while(c!==e)}else d===null&&(c.shared.lanes=0);Ml|=m,t.lanes=m,t.memoizedState=j}}function n1(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],c=n.callback;if(c!==null){if(n.callback=null,n=r,typeof c!="function")throw Error(Ze(191,c));c.call(n)}}}var qd={},ua=Fo(qd),Td=Fo(qd),Ed=Fo(qd);function bl(t){if(t===qd)throw Error(Ze(174));return t}function Ax(t,e){switch(Tr(Ed,e),Tr(Td,t),Tr(ua,qd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:A_(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=A_(e,t)}Ir(ua),Tr(ua,e)}function ou(){Ir(ua),Ir(Td),Ir(Ed)}function Bk(t){bl(Ed.current);var e=bl(ua.current),r=A_(e,t.type);e!==r&&(Tr(Td,t),Tr(ua,r))}function Px(t){Td.current===t&&(Ir(ua),Ir(Td))}var Fr=Fo(0);function vm(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ry=[];function Ix(){for(var t=0;t<Ry.length;t++)Ry[t]._workInProgressVersionPrimary=null;Ry.length=0}var Up=Ga.ReactCurrentDispatcher,zy=Ga.ReactCurrentBatchConfig,Il=0,Ur=null,ws=null,Ms=null,xm=!1,td=!1,Cd=0,tj=0;function Js(){throw Error(Ze(321))}function Mx(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Wn(t[r],e[r]))return!1;return!0}function jx(t,e,r,n,c,d){if(Il=d,Ur=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Up.current=t===null||t.memoizedState===null?nj:aj,t=r(n,c),td){d=0;do{if(td=!1,Cd=0,25<=d)throw Error(Ze(301));d+=1,Ms=ws=null,e.updateQueue=null,Up.current=oj,t=r(n,c)}while(td)}if(Up.current=bm,e=ws!==null&&ws.next!==null,Il=0,Ms=ws=Ur=null,xm=!1,e)throw Error(Ze(300));return t}function Dx(){var t=Cd!==0;return Cd=0,t}function aa(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ms===null?Ur.memoizedState=Ms=t:Ms=Ms.next=t,Ms}function Sn(){if(ws===null){var t=Ur.alternate;t=t!==null?t.memoizedState:null}else t=ws.next;var e=Ms===null?Ur.memoizedState:Ms.next;if(e!==null)Ms=e,ws=t;else{if(t===null)throw Error(Ze(310));ws=t,t={memoizedState:ws.memoizedState,baseState:ws.baseState,baseQueue:ws.baseQueue,queue:ws.queue,next:null},Ms===null?Ur.memoizedState=Ms=t:Ms=Ms.next=t}return Ms}function Ad(t,e){return typeof e=="function"?e(t):e}function By(t){var e=Sn(),r=e.queue;if(r===null)throw Error(Ze(311));r.lastRenderedReducer=t;var n=ws,c=n.baseQueue,d=r.pending;if(d!==null){if(c!==null){var m=c.next;c.next=d.next,d.next=m}n.baseQueue=c=d,r.pending=null}if(c!==null){d=c.next,n=n.baseState;var l=m=null,w=null,k=d;do{var P=k.lane;if((Il&P)===P)w!==null&&(w=w.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),n=k.hasEagerState?k.eagerState:t(n,k.action);else{var j={lane:P,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};w===null?(l=w=j,m=n):w=w.next=j,Ur.lanes|=P,Ml|=P}k=k.next}while(k!==null&&k!==d);w===null?m=n:w.next=l,Wn(n,e.memoizedState)||(Li=!0),e.memoizedState=n,e.baseState=m,e.baseQueue=w,r.lastRenderedState=n}if(t=r.interleaved,t!==null){c=t;do d=c.lane,Ur.lanes|=d,Ml|=d,c=c.next;while(c!==t)}else c===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function Oy(t){var e=Sn(),r=e.queue;if(r===null)throw Error(Ze(311));r.lastRenderedReducer=t;var n=r.dispatch,c=r.pending,d=e.memoizedState;if(c!==null){r.pending=null;var m=c=c.next;do d=t(d,m.action),m=m.next;while(m!==c);Wn(d,e.memoizedState)||(Li=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),r.lastRenderedState=d}return[d,n]}function Ok(){}function Fk(t,e){var r=Ur,n=Sn(),c=e(),d=!Wn(n.memoizedState,c);if(d&&(n.memoizedState=c,Li=!0),n=n.queue,Nx(Vk.bind(null,r,n,t),[t]),n.getSnapshot!==e||d||Ms!==null&&Ms.memoizedState.tag&1){if(r.flags|=2048,Pd(9,Uk.bind(null,r,n,c,e),void 0,null),js===null)throw Error(Ze(349));Il&30||$k(r,e,c)}return c}function $k(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Ur.updateQueue,e===null?(e={lastEffect:null,stores:null},Ur.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function Uk(t,e,r,n){e.value=r,e.getSnapshot=n,qk(e)&&Gk(t)}function Vk(t,e,r){return r(function(){qk(e)&&Gk(t)})}function qk(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Wn(t,r)}catch{return!0}}function Gk(t){var e=$a(t,1);e!==null&&Gn(e,t,1,-1)}function a1(t){var e=aa();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ad,lastRenderedState:t},e.queue=t,t=t.dispatch=ij.bind(null,Ur,t),[e.memoizedState,t]}function Pd(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Ur.updateQueue,e===null?(e={lastEffect:null,stores:null},Ur.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function Wk(){return Sn().memoizedState}function Vp(t,e,r,n){var c=aa();Ur.flags|=t,c.memoizedState=Pd(1|e,r,void 0,n===void 0?null:n)}function Um(t,e,r,n){var c=Sn();n=n===void 0?null:n;var d=void 0;if(ws!==null){var m=ws.memoizedState;if(d=m.destroy,n!==null&&Mx(n,m.deps)){c.memoizedState=Pd(e,r,d,n);return}}Ur.flags|=t,c.memoizedState=Pd(1|e,r,d,n)}function o1(t,e){return Vp(8390656,8,t,e)}function Nx(t,e){return Um(2048,8,t,e)}function Zk(t,e){return Um(4,2,t,e)}function Hk(t,e){return Um(4,4,t,e)}function Kk(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Xk(t,e,r){return r=r!=null?r.concat([t]):null,Um(4,4,Kk.bind(null,e,t),r)}function Lx(){}function Yk(t,e){var r=Sn();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&Mx(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function Jk(t,e){var r=Sn();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&Mx(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function Qk(t,e,r){return Il&21?(Wn(r,e)||(r=ik(),Ur.lanes|=r,Ml|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Li=!0),t.memoizedState=r)}function rj(t,e){var r=fr;fr=r!==0&&4>r?r:4,t(!0);var n=zy.transition;zy.transition={};try{t(!1),e()}finally{fr=r,zy.transition=n}}function eT(){return Sn().memoizedState}function sj(t,e,r){var n=Mo(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},tT(t))rT(e,r);else if(r=Rk(t,e,r,n),r!==null){var c=_i();Gn(r,t,n,c),sT(r,e,n)}}function ij(t,e,r){var n=Mo(t),c={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(tT(t))rT(e,c);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var m=e.lastRenderedState,l=d(m,r);if(c.hasEagerState=!0,c.eagerState=l,Wn(l,m)){var w=e.interleaved;w===null?(c.next=c,Ex(e)):(c.next=w.next,w.next=c),e.interleaved=c;return}}catch{}finally{}r=Rk(t,e,c,n),r!==null&&(c=_i(),Gn(r,t,n,c),sT(r,e,n))}}function tT(t){var e=t.alternate;return t===Ur||e!==null&&e===Ur}function rT(t,e){td=xm=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function sT(t,e,r){if(r&4194240){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,dx(t,r)}}var bm={readContext:wn,useCallback:Js,useContext:Js,useEffect:Js,useImperativeHandle:Js,useInsertionEffect:Js,useLayoutEffect:Js,useMemo:Js,useReducer:Js,useRef:Js,useState:Js,useDebugValue:Js,useDeferredValue:Js,useTransition:Js,useMutableSource:Js,useSyncExternalStore:Js,useId:Js,unstable_isNewReconciler:!1},nj={readContext:wn,useCallback:function(t,e){return aa().memoizedState=[t,e===void 0?null:e],t},useContext:wn,useEffect:o1,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Vp(4194308,4,Kk.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Vp(4194308,4,t,e)},useInsertionEffect:function(t,e){return Vp(4,2,t,e)},useMemo:function(t,e){var r=aa();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=aa();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=sj.bind(null,Ur,t),[n.memoizedState,t]},useRef:function(t){var e=aa();return t={current:t},e.memoizedState=t},useState:a1,useDebugValue:Lx,useDeferredValue:function(t){return aa().memoizedState=t},useTransition:function(){var t=a1(!1),e=t[0];return t=rj.bind(null,t[1]),aa().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Ur,c=aa();if(Nr){if(r===void 0)throw Error(Ze(407));r=r()}else{if(r=e(),js===null)throw Error(Ze(349));Il&30||$k(n,e,r)}c.memoizedState=r;var d={value:r,getSnapshot:e};return c.queue=d,o1(Vk.bind(null,n,d,t),[t]),n.flags|=2048,Pd(9,Uk.bind(null,n,d,r,e),void 0,null),r},useId:function(){var t=aa(),e=js.identifierPrefix;if(Nr){var r=za,n=Ra;r=(n&~(1<<32-qn(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=Cd++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=tj++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},aj={readContext:wn,useCallback:Yk,useContext:wn,useEffect:Nx,useImperativeHandle:Xk,useInsertionEffect:Zk,useLayoutEffect:Hk,useMemo:Jk,useReducer:By,useRef:Wk,useState:function(){return By(Ad)},useDebugValue:Lx,useDeferredValue:function(t){var e=Sn();return Qk(e,ws.memoizedState,t)},useTransition:function(){var t=By(Ad)[0],e=Sn().memoizedState;return[t,e]},useMutableSource:Ok,useSyncExternalStore:Fk,useId:eT,unstable_isNewReconciler:!1},oj={readContext:wn,useCallback:Yk,useContext:wn,useEffect:Nx,useImperativeHandle:Xk,useInsertionEffect:Zk,useLayoutEffect:Hk,useMemo:Jk,useReducer:Oy,useRef:Wk,useState:function(){return Oy(Ad)},useDebugValue:Lx,useDeferredValue:function(t){var e=Sn();return ws===null?e.memoizedState=t:Qk(e,ws.memoizedState,t)},useTransition:function(){var t=Oy(Ad)[0],e=Sn().memoizedState;return[t,e]},useMutableSource:Ok,useSyncExternalStore:Fk,useId:eT,unstable_isNewReconciler:!1};function On(t,e){if(t&&t.defaultProps){e=Vr({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function K_(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:Vr({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var Vm={isMounted:function(t){return(t=t._reactInternals)?Nl(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=_i(),c=Mo(t),d=Ba(n,c);d.payload=e,r!=null&&(d.callback=r),e=Po(t,d,c),e!==null&&(Gn(e,t,c,n),$p(e,t,c))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=_i(),c=Mo(t),d=Ba(n,c);d.tag=1,d.payload=e,r!=null&&(d.callback=r),e=Po(t,d,c),e!==null&&(Gn(e,t,c,n),$p(e,t,c))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=_i(),n=Mo(t),c=Ba(r,n);c.tag=2,e!=null&&(c.callback=e),e=Po(t,c,n),e!==null&&(Gn(e,t,n,r),$p(e,t,n))}};function l1(t,e,r,n,c,d,m){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,d,m):e.prototype&&e.prototype.isPureReactComponent?!bd(r,n)||!bd(c,d):!0}function iT(t,e,r){var n=!1,c=Ro,d=e.contextType;return typeof d=="object"&&d!==null?d=wn(d):(c=Bi(e)?Al:ri.current,n=e.contextTypes,d=(n=n!=null)?iu(t,c):Ro),e=new e(r,d),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vm,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=c,t.__reactInternalMemoizedMaskedChildContext=d),e}function c1(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&Vm.enqueueReplaceState(e,e.state,null)}function X_(t,e,r,n){var c=t.stateNode;c.props=r,c.state=t.memoizedState,c.refs={},Cx(t);var d=e.contextType;typeof d=="object"&&d!==null?c.context=wn(d):(d=Bi(e)?Al:ri.current,c.context=iu(t,d)),c.state=t.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(K_(t,e,d,r),c.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&Vm.enqueueReplaceState(c,c.state,null),_m(t,r,c,n),c.state=t.memoizedState),typeof c.componentDidMount=="function"&&(t.flags|=4194308)}function lu(t,e){try{var r="",n=e;do r+=LI(n),n=n.return;while(n);var c=r}catch(d){c=`
Error generating stack: `+d.message+`
`+d.stack}return{value:t,source:e,stack:c,digest:null}}function Fy(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Y_(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var lj=typeof WeakMap=="function"?WeakMap:Map;function nT(t,e,r){r=Ba(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){Sm||(Sm=!0,ov=n),Y_(t,e)},r}function aT(t,e,r){r=Ba(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var c=e.value;r.payload=function(){return n(c)},r.callback=function(){Y_(t,e)}}var d=t.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(r.callback=function(){Y_(t,e),typeof n!="function"&&(Io===null?Io=new Set([this]):Io.add(this));var m=e.stack;this.componentDidCatch(e.value,{componentStack:m!==null?m:""})}),r}function u1(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new lj;var c=new Set;n.set(e,c)}else c=n.get(e),c===void 0&&(c=new Set,n.set(e,c));c.has(r)||(c.add(r),t=wj.bind(null,t,e,r),e.then(t,t))}function h1(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function d1(t,e,r,n,c){return t.mode&1?(t.flags|=65536,t.lanes=c,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Ba(-1,1),e.tag=2,Po(r,e,1))),r.lanes|=1),t)}var cj=Ga.ReactCurrentOwner,Li=!1;function mi(t,e,r,n){e.child=t===null?Lk(e,null,r,n):au(e,t.child,r,n)}function f1(t,e,r,n,c){r=r.render;var d=e.ref;return Jc(e,c),n=jx(t,e,r,n,d,c),r=Dx(),t!==null&&!Li?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,Ua(t,e,c)):(Nr&&r&&xx(e),e.flags|=1,mi(t,e,n,c),e.child)}function p1(t,e,r,n,c){if(t===null){var d=r.type;return typeof d=="function"&&!Vx(d)&&d.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=d,oT(t,e,d,n,c)):(t=Zp(r.type,null,n,e,e.mode,c),t.ref=e.ref,t.return=e,e.child=t)}if(d=t.child,!(t.lanes&c)){var m=d.memoizedProps;if(r=r.compare,r=r!==null?r:bd,r(m,n)&&t.ref===e.ref)return Ua(t,e,c)}return e.flags|=1,t=jo(d,n),t.ref=e.ref,t.return=e,e.child=t}function oT(t,e,r,n,c){if(t!==null){var d=t.memoizedProps;if(bd(d,n)&&t.ref===e.ref)if(Li=!1,e.pendingProps=n=d,(t.lanes&c)!==0)t.flags&131072&&(Li=!0);else return e.lanes=t.lanes,Ua(t,e,c)}return J_(t,e,r,n,c)}function lT(t,e,r){var n=e.pendingProps,c=n.children,d=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tr(Uc,Ki),Ki|=r;else{if(!(r&1073741824))return t=d!==null?d.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Tr(Uc,Ki),Ki|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=d!==null?d.baseLanes:r,Tr(Uc,Ki),Ki|=n}else d!==null?(n=d.baseLanes|r,e.memoizedState=null):n=r,Tr(Uc,Ki),Ki|=n;return mi(t,e,c,r),e.child}function cT(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function J_(t,e,r,n,c){var d=Bi(r)?Al:ri.current;return d=iu(e,d),Jc(e,c),r=jx(t,e,r,n,d,c),n=Dx(),t!==null&&!Li?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,Ua(t,e,c)):(Nr&&n&&xx(e),e.flags|=1,mi(t,e,r,c),e.child)}function m1(t,e,r,n,c){if(Bi(r)){var d=!0;fm(e)}else d=!1;if(Jc(e,c),e.stateNode===null)qp(t,e),iT(e,r,n),X_(e,r,n,c),n=!0;else if(t===null){var m=e.stateNode,l=e.memoizedProps;m.props=l;var w=m.context,k=r.contextType;typeof k=="object"&&k!==null?k=wn(k):(k=Bi(r)?Al:ri.current,k=iu(e,k));var P=r.getDerivedStateFromProps,j=typeof P=="function"||typeof m.getSnapshotBeforeUpdate=="function";j||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(l!==n||w!==k)&&c1(e,m,n,k),_o=!1;var L=e.memoizedState;m.state=L,_m(e,n,m,c),w=e.memoizedState,l!==n||L!==w||zi.current||_o?(typeof P=="function"&&(K_(e,r,P,n),w=e.memoizedState),(l=_o||l1(e,r,l,n,L,w,k))?(j||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(e.flags|=4194308)):(typeof m.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=w),m.props=n,m.state=w,m.context=k,n=l):(typeof m.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{m=e.stateNode,zk(t,e),l=e.memoizedProps,k=e.type===e.elementType?l:On(e.type,l),m.props=k,j=e.pendingProps,L=m.context,w=r.contextType,typeof w=="object"&&w!==null?w=wn(w):(w=Bi(r)?Al:ri.current,w=iu(e,w));var Z=r.getDerivedStateFromProps;(P=typeof Z=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(l!==j||L!==w)&&c1(e,m,n,w),_o=!1,L=e.memoizedState,m.state=L,_m(e,n,m,c);var Y=e.memoizedState;l!==j||L!==Y||zi.current||_o?(typeof Z=="function"&&(K_(e,r,Z,n),Y=e.memoizedState),(k=_o||l1(e,r,k,n,L,Y,w)||!1)?(P||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(n,Y,w),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(n,Y,w)),typeof m.componentDidUpdate=="function"&&(e.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof m.componentDidUpdate!="function"||l===t.memoizedProps&&L===t.memoizedState||(e.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&L===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=Y),m.props=n,m.state=Y,m.context=w,n=k):(typeof m.componentDidUpdate!="function"||l===t.memoizedProps&&L===t.memoizedState||(e.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&L===t.memoizedState||(e.flags|=1024),n=!1)}return Q_(t,e,r,n,d,c)}function Q_(t,e,r,n,c,d){cT(t,e);var m=(e.flags&128)!==0;if(!n&&!m)return c&&e1(e,r,!1),Ua(t,e,d);n=e.stateNode,cj.current=e;var l=m&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&m?(e.child=au(e,t.child,null,d),e.child=au(e,null,l,d)):mi(t,e,l,d),e.memoizedState=n.state,c&&e1(e,r,!0),e.child}function uT(t){var e=t.stateNode;e.pendingContext?Qw(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Qw(t,e.context,!1),Ax(t,e.containerInfo)}function g1(t,e,r,n,c){return nu(),wx(c),e.flags|=256,mi(t,e,r,n),e.child}var ev={dehydrated:null,treeContext:null,retryLane:0};function tv(t){return{baseLanes:t,cachePool:null,transitions:null}}function hT(t,e,r){var n=e.pendingProps,c=Fr.current,d=!1,m=(e.flags&128)!==0,l;if((l=m)||(l=t!==null&&t.memoizedState===null?!1:(c&2)!==0),l?(d=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(c|=1),Tr(Fr,c&1),t===null)return Z_(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(m=n.children,t=n.fallback,d?(n=e.mode,d=e.child,m={mode:"hidden",children:m},!(n&1)&&d!==null?(d.childLanes=0,d.pendingProps=m):d=Wm(m,n,0,null),t=Tl(t,n,r,null),d.return=e,t.return=e,d.sibling=t,e.child=d,e.child.memoizedState=tv(r),e.memoizedState=ev,t):Rx(e,m));if(c=t.memoizedState,c!==null&&(l=c.dehydrated,l!==null))return uj(t,e,m,n,l,c,r);if(d){d=n.fallback,m=e.mode,c=t.child,l=c.sibling;var w={mode:"hidden",children:n.children};return!(m&1)&&e.child!==c?(n=e.child,n.childLanes=0,n.pendingProps=w,e.deletions=null):(n=jo(c,w),n.subtreeFlags=c.subtreeFlags&14680064),l!==null?d=jo(l,d):(d=Tl(d,m,r,null),d.flags|=2),d.return=e,n.return=e,n.sibling=d,e.child=n,n=d,d=e.child,m=t.child.memoizedState,m=m===null?tv(r):{baseLanes:m.baseLanes|r,cachePool:null,transitions:m.transitions},d.memoizedState=m,d.childLanes=t.childLanes&~r,e.memoizedState=ev,n}return d=t.child,t=d.sibling,n=jo(d,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function Rx(t,e){return e=Wm({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function bp(t,e,r,n){return n!==null&&wx(n),au(e,t.child,null,r),t=Rx(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function uj(t,e,r,n,c,d,m){if(r)return e.flags&256?(e.flags&=-257,n=Fy(Error(Ze(422))),bp(t,e,m,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(d=n.fallback,c=e.mode,n=Wm({mode:"visible",children:n.children},c,0,null),d=Tl(d,c,m,null),d.flags|=2,n.return=e,d.return=e,n.sibling=d,e.child=n,e.mode&1&&au(e,t.child,null,m),e.child.memoizedState=tv(m),e.memoizedState=ev,d);if(!(e.mode&1))return bp(t,e,m,null);if(c.data==="$!"){if(n=c.nextSibling&&c.nextSibling.dataset,n)var l=n.dgst;return n=l,d=Error(Ze(419)),n=Fy(d,n,void 0),bp(t,e,m,n)}if(l=(m&t.childLanes)!==0,Li||l){if(n=js,n!==null){switch(m&-m){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(n.suspendedLanes|m)?0:c,c!==0&&c!==d.retryLane&&(d.retryLane=c,$a(t,c),Gn(n,t,c,-1))}return Ux(),n=Fy(Error(Ze(421))),bp(t,e,m,n)}return c.data==="$?"?(e.flags|=128,e.child=t.child,e=Sj.bind(null,t),c._reactRetry=e,null):(t=d.treeContext,Xi=Ao(c.nextSibling),Yi=e,Nr=!0,Vn=null,t!==null&&(gn[yn++]=Ra,gn[yn++]=za,gn[yn++]=Pl,Ra=t.id,za=t.overflow,Pl=e),e=Rx(e,n.children),e.flags|=4096,e)}function y1(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),H_(t.return,e,r)}function $y(t,e,r,n,c){var d=t.memoizedState;d===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:c}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=n,d.tail=r,d.tailMode=c)}function dT(t,e,r){var n=e.pendingProps,c=n.revealOrder,d=n.tail;if(mi(t,e,n.children,r),n=Fr.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&y1(t,r,e);else if(t.tag===19)y1(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(Tr(Fr,n),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(r=e.child,c=null;r!==null;)t=r.alternate,t!==null&&vm(t)===null&&(c=r),r=r.sibling;r=c,r===null?(c=e.child,e.child=null):(c=r.sibling,r.sibling=null),$y(e,!1,c,r,d);break;case"backwards":for(r=null,c=e.child,e.child=null;c!==null;){if(t=c.alternate,t!==null&&vm(t)===null){e.child=c;break}t=c.sibling,c.sibling=r,r=c,c=t}$y(e,!0,r,null,d);break;case"together":$y(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function qp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ua(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Ml|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ze(153));if(e.child!==null){for(t=e.child,r=jo(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=jo(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function hj(t,e,r){switch(e.tag){case 3:uT(e),nu();break;case 5:Bk(e);break;case 1:Bi(e.type)&&fm(e);break;case 4:Ax(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,c=e.memoizedProps.value;Tr(gm,n._currentValue),n._currentValue=c;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Tr(Fr,Fr.current&1),e.flags|=128,null):r&e.child.childLanes?hT(t,e,r):(Tr(Fr,Fr.current&1),t=Ua(t,e,r),t!==null?t.sibling:null);Tr(Fr,Fr.current&1);break;case 19:if(n=(r&e.childLanes)!==0,t.flags&128){if(n)return dT(t,e,r);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Tr(Fr,Fr.current),n)break;return null;case 22:case 23:return e.lanes=0,lT(t,e,r)}return Ua(t,e,r)}var fT,rv,pT,mT;fT=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};rv=function(){};pT=function(t,e,r,n){var c=t.memoizedProps;if(c!==n){t=e.stateNode,bl(ua.current);var d=null;switch(r){case"input":c=k_(t,c),n=k_(t,n),d=[];break;case"select":c=Vr({},c,{value:void 0}),n=Vr({},n,{value:void 0}),d=[];break;case"textarea":c=C_(t,c),n=C_(t,n),d=[];break;default:typeof c.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=hm)}P_(r,n);var m;r=null;for(k in c)if(!n.hasOwnProperty(k)&&c.hasOwnProperty(k)&&c[k]!=null)if(k==="style"){var l=c[k];for(m in l)l.hasOwnProperty(m)&&(r||(r={}),r[m]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(pd.hasOwnProperty(k)?d||(d=[]):(d=d||[]).push(k,null));for(k in n){var w=n[k];if(l=c!=null?c[k]:void 0,n.hasOwnProperty(k)&&w!==l&&(w!=null||l!=null))if(k==="style")if(l){for(m in l)!l.hasOwnProperty(m)||w&&w.hasOwnProperty(m)||(r||(r={}),r[m]="");for(m in w)w.hasOwnProperty(m)&&l[m]!==w[m]&&(r||(r={}),r[m]=w[m])}else r||(d||(d=[]),d.push(k,r)),r=w;else k==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,l=l?l.__html:void 0,w!=null&&l!==w&&(d=d||[]).push(k,w)):k==="children"?typeof w!="string"&&typeof w!="number"||(d=d||[]).push(k,""+w):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(pd.hasOwnProperty(k)?(w!=null&&k==="onScroll"&&Pr("scroll",t),d||l===w||(d=[])):(d=d||[]).push(k,w))}r&&(d=d||[]).push("style",r);var k=d;(e.updateQueue=k)&&(e.flags|=4)}};mT=function(t,e,r,n){r!==n&&(e.flags|=4)};function Rh(t,e){if(!Nr)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Qs(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var c=t.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags&14680064,n|=c.flags&14680064,c.return=t,c=c.sibling;else for(c=t.child;c!==null;)r|=c.lanes|c.childLanes,n|=c.subtreeFlags,n|=c.flags,c.return=t,c=c.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function dj(t,e,r){var n=e.pendingProps;switch(bx(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qs(e),null;case 1:return Bi(e.type)&&dm(),Qs(e),null;case 3:return n=e.stateNode,ou(),Ir(zi),Ir(ri),Ix(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(vp(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Vn!==null&&(uv(Vn),Vn=null))),rv(t,e),Qs(e),null;case 5:Px(e);var c=bl(Ed.current);if(r=e.type,t!==null&&e.stateNode!=null)pT(t,e,r,n,c),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Ze(166));return Qs(e),null}if(t=bl(ua.current),vp(e)){n=e.stateNode,r=e.type;var d=e.memoizedProps;switch(n[la]=e,n[kd]=d,t=(e.mode&1)!==0,r){case"dialog":Pr("cancel",n),Pr("close",n);break;case"iframe":case"object":case"embed":Pr("load",n);break;case"video":case"audio":for(c=0;c<Wh.length;c++)Pr(Wh[c],n);break;case"source":Pr("error",n);break;case"img":case"image":case"link":Pr("error",n),Pr("load",n);break;case"details":Pr("toggle",n);break;case"input":Ew(n,d),Pr("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!d.multiple},Pr("invalid",n);break;case"textarea":Aw(n,d),Pr("invalid",n)}P_(r,d),c=null;for(var m in d)if(d.hasOwnProperty(m)){var l=d[m];m==="children"?typeof l=="string"?n.textContent!==l&&(d.suppressHydrationWarning!==!0&&_p(n.textContent,l,t),c=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(d.suppressHydrationWarning!==!0&&_p(n.textContent,l,t),c=["children",""+l]):pd.hasOwnProperty(m)&&l!=null&&m==="onScroll"&&Pr("scroll",n)}switch(r){case"input":up(n),Cw(n,d,!0);break;case"textarea":up(n),Pw(n);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(n.onclick=hm)}n=c,e.updateQueue=n,n!==null&&(e.flags|=4)}else{m=c.nodeType===9?c:c.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=V2(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=m.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=m.createElement(r,{is:n.is}):(t=m.createElement(r),r==="select"&&(m=t,n.multiple?m.multiple=!0:n.size&&(m.size=n.size))):t=m.createElementNS(t,r),t[la]=e,t[kd]=n,fT(t,e,!1,!1),e.stateNode=t;e:{switch(m=I_(r,n),r){case"dialog":Pr("cancel",t),Pr("close",t),c=n;break;case"iframe":case"object":case"embed":Pr("load",t),c=n;break;case"video":case"audio":for(c=0;c<Wh.length;c++)Pr(Wh[c],t);c=n;break;case"source":Pr("error",t),c=n;break;case"img":case"image":case"link":Pr("error",t),Pr("load",t),c=n;break;case"details":Pr("toggle",t),c=n;break;case"input":Ew(t,n),c=k_(t,n),Pr("invalid",t);break;case"option":c=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},c=Vr({},n,{value:void 0}),Pr("invalid",t);break;case"textarea":Aw(t,n),c=C_(t,n),Pr("invalid",t);break;default:c=n}P_(r,c),l=c;for(d in l)if(l.hasOwnProperty(d)){var w=l[d];d==="style"?W2(t,w):d==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&q2(t,w)):d==="children"?typeof w=="string"?(r!=="textarea"||w!=="")&&md(t,w):typeof w=="number"&&md(t,""+w):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(pd.hasOwnProperty(d)?w!=null&&d==="onScroll"&&Pr("scroll",t):w!=null&&ax(t,d,w,m))}switch(r){case"input":up(t),Cw(t,n,!1);break;case"textarea":up(t),Pw(t);break;case"option":n.value!=null&&t.setAttribute("value",""+Lo(n.value));break;case"select":t.multiple=!!n.multiple,d=n.value,d!=null?Hc(t,!!n.multiple,d,!1):n.defaultValue!=null&&Hc(t,!!n.multiple,n.defaultValue,!0);break;default:typeof c.onClick=="function"&&(t.onclick=hm)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Qs(e),null;case 6:if(t&&e.stateNode!=null)mT(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Ze(166));if(r=bl(Ed.current),bl(ua.current),vp(e)){if(n=e.stateNode,r=e.memoizedProps,n[la]=e,(d=n.nodeValue!==r)&&(t=Yi,t!==null))switch(t.tag){case 3:_p(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_p(n.nodeValue,r,(t.mode&1)!==0)}d&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[la]=e,e.stateNode=n}return Qs(e),null;case 13:if(Ir(Fr),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Nr&&Xi!==null&&e.mode&1&&!(e.flags&128))Dk(),nu(),e.flags|=98560,d=!1;else if(d=vp(e),n!==null&&n.dehydrated!==null){if(t===null){if(!d)throw Error(Ze(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(Ze(317));d[la]=e}else nu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Qs(e),d=!1}else Vn!==null&&(uv(Vn),Vn=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||Fr.current&1?Ss===0&&(Ss=3):Ux())),e.updateQueue!==null&&(e.flags|=4),Qs(e),null);case 4:return ou(),rv(t,e),t===null&&wd(e.stateNode.containerInfo),Qs(e),null;case 10:return Tx(e.type._context),Qs(e),null;case 17:return Bi(e.type)&&dm(),Qs(e),null;case 19:if(Ir(Fr),d=e.memoizedState,d===null)return Qs(e),null;if(n=(e.flags&128)!==0,m=d.rendering,m===null)if(n)Rh(d,!1);else{if(Ss!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(m=vm(t),m!==null){for(e.flags|=128,Rh(d,!1),n=m.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)d=r,t=n,d.flags&=14680066,m=d.alternate,m===null?(d.childLanes=0,d.lanes=t,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=m.childLanes,d.lanes=m.lanes,d.child=m.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=m.memoizedProps,d.memoizedState=m.memoizedState,d.updateQueue=m.updateQueue,d.type=m.type,t=m.dependencies,d.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Tr(Fr,Fr.current&1|2),e.child}t=t.sibling}d.tail!==null&&as()>cu&&(e.flags|=128,n=!0,Rh(d,!1),e.lanes=4194304)}else{if(!n)if(t=vm(m),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Rh(d,!0),d.tail===null&&d.tailMode==="hidden"&&!m.alternate&&!Nr)return Qs(e),null}else 2*as()-d.renderingStartTime>cu&&r!==1073741824&&(e.flags|=128,n=!0,Rh(d,!1),e.lanes=4194304);d.isBackwards?(m.sibling=e.child,e.child=m):(r=d.last,r!==null?r.sibling=m:e.child=m,d.last=m)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=as(),e.sibling=null,r=Fr.current,Tr(Fr,n?r&1|2:r&1),e):(Qs(e),null);case 22:case 23:return $x(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Ki&1073741824&&(Qs(e),e.subtreeFlags&6&&(e.flags|=8192)):Qs(e),null;case 24:return null;case 25:return null}throw Error(Ze(156,e.tag))}function fj(t,e){switch(bx(e),e.tag){case 1:return Bi(e.type)&&dm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ou(),Ir(zi),Ir(ri),Ix(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Px(e),null;case 13:if(Ir(Fr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ze(340));nu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ir(Fr),null;case 4:return ou(),null;case 10:return Tx(e.type._context),null;case 22:case 23:return $x(),null;case 24:return null;default:return null}}var wp=!1,ei=!1,pj=typeof WeakSet=="function"?WeakSet:Set,ft=null;function $c(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Xr(t,e,n)}else r.current=null}function sv(t,e,r){try{r()}catch(n){Xr(t,e,n)}}var _1=!1;function mj(t,e){if(F_=lm,t=xk(),vx(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var c=n.anchorOffset,d=n.focusNode;n=n.focusOffset;try{r.nodeType,d.nodeType}catch{r=null;break e}var m=0,l=-1,w=-1,k=0,P=0,j=t,L=null;t:for(;;){for(var Z;j!==r||c!==0&&j.nodeType!==3||(l=m+c),j!==d||n!==0&&j.nodeType!==3||(w=m+n),j.nodeType===3&&(m+=j.nodeValue.length),(Z=j.firstChild)!==null;)L=j,j=Z;for(;;){if(j===t)break t;if(L===r&&++k===c&&(l=m),L===d&&++P===n&&(w=m),(Z=j.nextSibling)!==null)break;j=L,L=j.parentNode}j=Z}r=l===-1||w===-1?null:{start:l,end:w}}else r=null}r=r||{start:0,end:0}}else r=null;for($_={focusedElem:t,selectionRange:r},lm=!1,ft=e;ft!==null;)if(e=ft,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ft=t;else for(;ft!==null;){e=ft;try{var Y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(Y!==null){var ce=Y.memoizedProps,de=Y.memoizedState,G=e.stateNode,H=G.getSnapshotBeforeUpdate(e.elementType===e.type?ce:On(e.type,ce),de);G.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var W=e.stateNode.containerInfo;W.nodeType===1?W.textContent="":W.nodeType===9&&W.documentElement&&W.removeChild(W.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ze(163))}}catch(ue){Xr(e,e.return,ue)}if(t=e.sibling,t!==null){t.return=e.return,ft=t;break}ft=e.return}return Y=_1,_1=!1,Y}function rd(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var c=n=n.next;do{if((c.tag&t)===t){var d=c.destroy;c.destroy=void 0,d!==void 0&&sv(e,r,d)}c=c.next}while(c!==n)}}function qm(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function iv(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function gT(t){var e=t.alternate;e!==null&&(t.alternate=null,gT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[la],delete e[kd],delete e[q_],delete e[YM],delete e[JM])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function yT(t){return t.tag===5||t.tag===3||t.tag===4}function v1(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||yT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function nv(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=hm));else if(n!==4&&(t=t.child,t!==null))for(nv(t,e,r),t=t.sibling;t!==null;)nv(t,e,r),t=t.sibling}function av(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(av(t,e,r),t=t.sibling;t!==null;)av(t,e,r),t=t.sibling}var Fs=null,Fn=!1;function fo(t,e,r){for(r=r.child;r!==null;)_T(t,e,r),r=r.sibling}function _T(t,e,r){if(ca&&typeof ca.onCommitFiberUnmount=="function")try{ca.onCommitFiberUnmount(Rm,r)}catch{}switch(r.tag){case 5:ei||$c(r,e);case 6:var n=Fs,c=Fn;Fs=null,fo(t,e,r),Fs=n,Fn=c,Fs!==null&&(Fn?(t=Fs,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Fs.removeChild(r.stateNode));break;case 18:Fs!==null&&(Fn?(t=Fs,r=r.stateNode,t.nodeType===8?Ny(t.parentNode,r):t.nodeType===1&&Ny(t,r),vd(t)):Ny(Fs,r.stateNode));break;case 4:n=Fs,c=Fn,Fs=r.stateNode.containerInfo,Fn=!0,fo(t,e,r),Fs=n,Fn=c;break;case 0:case 11:case 14:case 15:if(!ei&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){c=n=n.next;do{var d=c,m=d.destroy;d=d.tag,m!==void 0&&(d&2||d&4)&&sv(r,e,m),c=c.next}while(c!==n)}fo(t,e,r);break;case 1:if(!ei&&($c(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(l){Xr(r,e,l)}fo(t,e,r);break;case 21:fo(t,e,r);break;case 22:r.mode&1?(ei=(n=ei)||r.memoizedState!==null,fo(t,e,r),ei=n):fo(t,e,r);break;default:fo(t,e,r)}}function x1(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new pj),e.forEach(function(n){var c=kj.bind(null,t,n);r.has(n)||(r.add(n),n.then(c,c))})}}function Rn(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var c=r[n];try{var d=t,m=e,l=m;e:for(;l!==null;){switch(l.tag){case 5:Fs=l.stateNode,Fn=!1;break e;case 3:Fs=l.stateNode.containerInfo,Fn=!0;break e;case 4:Fs=l.stateNode.containerInfo,Fn=!0;break e}l=l.return}if(Fs===null)throw Error(Ze(160));_T(d,m,c),Fs=null,Fn=!1;var w=c.alternate;w!==null&&(w.return=null),c.return=null}catch(k){Xr(c,e,k)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)vT(e,t),e=e.sibling}function vT(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Rn(e,t),na(t),n&4){try{rd(3,t,t.return),qm(3,t)}catch(ce){Xr(t,t.return,ce)}try{rd(5,t,t.return)}catch(ce){Xr(t,t.return,ce)}}break;case 1:Rn(e,t),na(t),n&512&&r!==null&&$c(r,r.return);break;case 5:if(Rn(e,t),na(t),n&512&&r!==null&&$c(r,r.return),t.flags&32){var c=t.stateNode;try{md(c,"")}catch(ce){Xr(t,t.return,ce)}}if(n&4&&(c=t.stateNode,c!=null)){var d=t.memoizedProps,m=r!==null?r.memoizedProps:d,l=t.type,w=t.updateQueue;if(t.updateQueue=null,w!==null)try{l==="input"&&d.type==="radio"&&d.name!=null&&$2(c,d),I_(l,m);var k=I_(l,d);for(m=0;m<w.length;m+=2){var P=w[m],j=w[m+1];P==="style"?W2(c,j):P==="dangerouslySetInnerHTML"?q2(c,j):P==="children"?md(c,j):ax(c,P,j,k)}switch(l){case"input":T_(c,d);break;case"textarea":U2(c,d);break;case"select":var L=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!d.multiple;var Z=d.value;Z!=null?Hc(c,!!d.multiple,Z,!1):L!==!!d.multiple&&(d.defaultValue!=null?Hc(c,!!d.multiple,d.defaultValue,!0):Hc(c,!!d.multiple,d.multiple?[]:"",!1))}c[kd]=d}catch(ce){Xr(t,t.return,ce)}}break;case 6:if(Rn(e,t),na(t),n&4){if(t.stateNode===null)throw Error(Ze(162));c=t.stateNode,d=t.memoizedProps;try{c.nodeValue=d}catch(ce){Xr(t,t.return,ce)}}break;case 3:if(Rn(e,t),na(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{vd(e.containerInfo)}catch(ce){Xr(t,t.return,ce)}break;case 4:Rn(e,t),na(t);break;case 13:Rn(e,t),na(t),c=t.child,c.flags&8192&&(d=c.memoizedState!==null,c.stateNode.isHidden=d,!d||c.alternate!==null&&c.alternate.memoizedState!==null||(Ox=as())),n&4&&x1(t);break;case 22:if(P=r!==null&&r.memoizedState!==null,t.mode&1?(ei=(k=ei)||P,Rn(e,t),ei=k):Rn(e,t),na(t),n&8192){if(k=t.memoizedState!==null,(t.stateNode.isHidden=k)&&!P&&t.mode&1)for(ft=t,P=t.child;P!==null;){for(j=ft=P;ft!==null;){switch(L=ft,Z=L.child,L.tag){case 0:case 11:case 14:case 15:rd(4,L,L.return);break;case 1:$c(L,L.return);var Y=L.stateNode;if(typeof Y.componentWillUnmount=="function"){n=L,r=L.return;try{e=n,Y.props=e.memoizedProps,Y.state=e.memoizedState,Y.componentWillUnmount()}catch(ce){Xr(n,r,ce)}}break;case 5:$c(L,L.return);break;case 22:if(L.memoizedState!==null){w1(j);continue}}Z!==null?(Z.return=L,ft=Z):w1(j)}P=P.sibling}e:for(P=null,j=t;;){if(j.tag===5){if(P===null){P=j;try{c=j.stateNode,k?(d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(l=j.stateNode,w=j.memoizedProps.style,m=w!=null&&w.hasOwnProperty("display")?w.display:null,l.style.display=G2("display",m))}catch(ce){Xr(t,t.return,ce)}}}else if(j.tag===6){if(P===null)try{j.stateNode.nodeValue=k?"":j.memoizedProps}catch(ce){Xr(t,t.return,ce)}}else if((j.tag!==22&&j.tag!==23||j.memoizedState===null||j===t)&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===t)break e;for(;j.sibling===null;){if(j.return===null||j.return===t)break e;P===j&&(P=null),j=j.return}P===j&&(P=null),j.sibling.return=j.return,j=j.sibling}}break;case 19:Rn(e,t),na(t),n&4&&x1(t);break;case 21:break;default:Rn(e,t),na(t)}}function na(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(yT(r)){var n=r;break e}r=r.return}throw Error(Ze(160))}switch(n.tag){case 5:var c=n.stateNode;n.flags&32&&(md(c,""),n.flags&=-33);var d=v1(t);av(t,d,c);break;case 3:case 4:var m=n.stateNode.containerInfo,l=v1(t);nv(t,l,m);break;default:throw Error(Ze(161))}}catch(w){Xr(t,t.return,w)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function gj(t,e,r){ft=t,xT(t)}function xT(t,e,r){for(var n=(t.mode&1)!==0;ft!==null;){var c=ft,d=c.child;if(c.tag===22&&n){var m=c.memoizedState!==null||wp;if(!m){var l=c.alternate,w=l!==null&&l.memoizedState!==null||ei;l=wp;var k=ei;if(wp=m,(ei=w)&&!k)for(ft=c;ft!==null;)m=ft,w=m.child,m.tag===22&&m.memoizedState!==null?S1(c):w!==null?(w.return=m,ft=w):S1(c);for(;d!==null;)ft=d,xT(d),d=d.sibling;ft=c,wp=l,ei=k}b1(t)}else c.subtreeFlags&8772&&d!==null?(d.return=c,ft=d):b1(t)}}function b1(t){for(;ft!==null;){var e=ft;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ei||qm(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!ei)if(r===null)n.componentDidMount();else{var c=e.elementType===e.type?r.memoizedProps:On(e.type,r.memoizedProps);n.componentDidUpdate(c,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&n1(e,d,n);break;case 3:var m=e.updateQueue;if(m!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}n1(e,m,r)}break;case 5:var l=e.stateNode;if(r===null&&e.flags&4){r=l;var w=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&r.focus();break;case"img":w.src&&(r.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var k=e.alternate;if(k!==null){var P=k.memoizedState;if(P!==null){var j=P.dehydrated;j!==null&&vd(j)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ze(163))}ei||e.flags&512&&iv(e)}catch(L){Xr(e,e.return,L)}}if(e===t){ft=null;break}if(r=e.sibling,r!==null){r.return=e.return,ft=r;break}ft=e.return}}function w1(t){for(;ft!==null;){var e=ft;if(e===t){ft=null;break}var r=e.sibling;if(r!==null){r.return=e.return,ft=r;break}ft=e.return}}function S1(t){for(;ft!==null;){var e=ft;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{qm(4,e)}catch(w){Xr(e,r,w)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var c=e.return;try{n.componentDidMount()}catch(w){Xr(e,c,w)}}var d=e.return;try{iv(e)}catch(w){Xr(e,d,w)}break;case 5:var m=e.return;try{iv(e)}catch(w){Xr(e,m,w)}}}catch(w){Xr(e,e.return,w)}if(e===t){ft=null;break}var l=e.sibling;if(l!==null){l.return=e.return,ft=l;break}ft=e.return}}var yj=Math.ceil,wm=Ga.ReactCurrentDispatcher,zx=Ga.ReactCurrentOwner,xn=Ga.ReactCurrentBatchConfig,sr=0,js=null,us=null,Us=0,Ki=0,Uc=Fo(0),Ss=0,Id=null,Ml=0,Gm=0,Bx=0,sd=null,Di=null,Ox=0,cu=1/0,Da=null,Sm=!1,ov=null,Io=null,Sp=!1,So=null,km=0,id=0,lv=null,Gp=-1,Wp=0;function _i(){return sr&6?as():Gp!==-1?Gp:Gp=as()}function Mo(t){return t.mode&1?sr&2&&Us!==0?Us&-Us:ej.transition!==null?(Wp===0&&(Wp=ik()),Wp):(t=fr,t!==0||(t=window.event,t=t===void 0?16:hk(t.type)),t):1}function Gn(t,e,r,n){if(50<id)throw id=0,lv=null,Error(Ze(185));$d(t,r,n),(!(sr&2)||t!==js)&&(t===js&&(!(sr&2)&&(Gm|=r),Ss===4&&xo(t,Us)),Oi(t,n),r===1&&sr===0&&!(e.mode&1)&&(cu=as()+500,$m&&$o()))}function Oi(t,e){var r=t.callbackNode;eM(t,e);var n=om(t,t===js?Us:0);if(n===0)r!==null&&jw(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&jw(r),e===1)t.tag===0?QM(k1.bind(null,t)):Ik(k1.bind(null,t)),KM(function(){!(sr&6)&&$o()}),r=null;else{switch(nk(n)){case 1:r=hx;break;case 4:r=rk;break;case 16:r=am;break;case 536870912:r=sk;break;default:r=am}r=AT(r,bT.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function bT(t,e){if(Gp=-1,Wp=0,sr&6)throw Error(Ze(327));var r=t.callbackNode;if(Qc()&&t.callbackNode!==r)return null;var n=om(t,t===js?Us:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=Tm(t,n);else{e=n;var c=sr;sr|=2;var d=ST();(js!==t||Us!==e)&&(Da=null,cu=as()+500,kl(t,e));do try{xj();break}catch(l){wT(t,l)}while(!0);kx(),wm.current=d,sr=c,us!==null?e=0:(js=null,Us=0,e=Ss)}if(e!==0){if(e===2&&(c=L_(t),c!==0&&(n=c,e=cv(t,c))),e===1)throw r=Id,kl(t,0),xo(t,n),Oi(t,as()),r;if(e===6)xo(t,n);else{if(c=t.current.alternate,!(n&30)&&!_j(c)&&(e=Tm(t,n),e===2&&(d=L_(t),d!==0&&(n=d,e=cv(t,d))),e===1))throw r=Id,kl(t,0),xo(t,n),Oi(t,as()),r;switch(t.finishedWork=c,t.finishedLanes=n,e){case 0:case 1:throw Error(Ze(345));case 2:ml(t,Di,Da);break;case 3:if(xo(t,n),(n&130023424)===n&&(e=Ox+500-as(),10<e)){if(om(t,0)!==0)break;if(c=t.suspendedLanes,(c&n)!==n){_i(),t.pingedLanes|=t.suspendedLanes&c;break}t.timeoutHandle=V_(ml.bind(null,t,Di,Da),e);break}ml(t,Di,Da);break;case 4:if(xo(t,n),(n&4194240)===n)break;for(e=t.eventTimes,c=-1;0<n;){var m=31-qn(n);d=1<<m,m=e[m],m>c&&(c=m),n&=~d}if(n=c,n=as()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*yj(n/1960))-n,10<n){t.timeoutHandle=V_(ml.bind(null,t,Di,Da),n);break}ml(t,Di,Da);break;case 5:ml(t,Di,Da);break;default:throw Error(Ze(329))}}}return Oi(t,as()),t.callbackNode===r?bT.bind(null,t):null}function cv(t,e){var r=sd;return t.current.memoizedState.isDehydrated&&(kl(t,e).flags|=256),t=Tm(t,e),t!==2&&(e=Di,Di=r,e!==null&&uv(e)),t}function uv(t){Di===null?Di=t:Di.push.apply(Di,t)}function _j(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var c=r[n],d=c.getSnapshot;c=c.value;try{if(!Wn(d(),c))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function xo(t,e){for(e&=~Bx,e&=~Gm,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-qn(e),n=1<<r;t[r]=-1,e&=~n}}function k1(t){if(sr&6)throw Error(Ze(327));Qc();var e=om(t,0);if(!(e&1))return Oi(t,as()),null;var r=Tm(t,e);if(t.tag!==0&&r===2){var n=L_(t);n!==0&&(e=n,r=cv(t,n))}if(r===1)throw r=Id,kl(t,0),xo(t,e),Oi(t,as()),r;if(r===6)throw Error(Ze(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ml(t,Di,Da),Oi(t,as()),null}function Fx(t,e){var r=sr;sr|=1;try{return t(e)}finally{sr=r,sr===0&&(cu=as()+500,$m&&$o())}}function jl(t){So!==null&&So.tag===0&&!(sr&6)&&Qc();var e=sr;sr|=1;var r=xn.transition,n=fr;try{if(xn.transition=null,fr=1,t)return t()}finally{fr=n,xn.transition=r,sr=e,!(sr&6)&&$o()}}function $x(){Ki=Uc.current,Ir(Uc)}function kl(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,HM(r)),us!==null)for(r=us.return;r!==null;){var n=r;switch(bx(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&dm();break;case 3:ou(),Ir(zi),Ir(ri),Ix();break;case 5:Px(n);break;case 4:ou();break;case 13:Ir(Fr);break;case 19:Ir(Fr);break;case 10:Tx(n.type._context);break;case 22:case 23:$x()}r=r.return}if(js=t,us=t=jo(t.current,null),Us=Ki=e,Ss=0,Id=null,Bx=Gm=Ml=0,Di=sd=null,xl!==null){for(e=0;e<xl.length;e++)if(r=xl[e],n=r.interleaved,n!==null){r.interleaved=null;var c=n.next,d=r.pending;if(d!==null){var m=d.next;d.next=c,n.next=m}r.pending=n}xl=null}return t}function wT(t,e){do{var r=us;try{if(kx(),Up.current=bm,xm){for(var n=Ur.memoizedState;n!==null;){var c=n.queue;c!==null&&(c.pending=null),n=n.next}xm=!1}if(Il=0,Ms=ws=Ur=null,td=!1,Cd=0,zx.current=null,r===null||r.return===null){Ss=1,Id=e,us=null;break}e:{var d=t,m=r.return,l=r,w=e;if(e=Us,l.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var k=w,P=l,j=P.tag;if(!(P.mode&1)&&(j===0||j===11||j===15)){var L=P.alternate;L?(P.updateQueue=L.updateQueue,P.memoizedState=L.memoizedState,P.lanes=L.lanes):(P.updateQueue=null,P.memoizedState=null)}var Z=h1(m);if(Z!==null){Z.flags&=-257,d1(Z,m,l,d,e),Z.mode&1&&u1(d,k,e),e=Z,w=k;var Y=e.updateQueue;if(Y===null){var ce=new Set;ce.add(w),e.updateQueue=ce}else Y.add(w);break e}else{if(!(e&1)){u1(d,k,e),Ux();break e}w=Error(Ze(426))}}else if(Nr&&l.mode&1){var de=h1(m);if(de!==null){!(de.flags&65536)&&(de.flags|=256),d1(de,m,l,d,e),wx(lu(w,l));break e}}d=w=lu(w,l),Ss!==4&&(Ss=2),sd===null?sd=[d]:sd.push(d),d=m;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var G=nT(d,w,e);i1(d,G);break e;case 1:l=w;var H=d.type,W=d.stateNode;if(!(d.flags&128)&&(typeof H.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Io===null||!Io.has(W)))){d.flags|=65536,e&=-e,d.lanes|=e;var ue=aT(d,l,e);i1(d,ue);break e}}d=d.return}while(d!==null)}TT(r)}catch(me){e=me,us===r&&r!==null&&(us=r=r.return);continue}break}while(!0)}function ST(){var t=wm.current;return wm.current=bm,t===null?bm:t}function Ux(){(Ss===0||Ss===3||Ss===2)&&(Ss=4),js===null||!(Ml&268435455)&&!(Gm&268435455)||xo(js,Us)}function Tm(t,e){var r=sr;sr|=2;var n=ST();(js!==t||Us!==e)&&(Da=null,kl(t,e));do try{vj();break}catch(c){wT(t,c)}while(!0);if(kx(),sr=r,wm.current=n,us!==null)throw Error(Ze(261));return js=null,Us=0,Ss}function vj(){for(;us!==null;)kT(us)}function xj(){for(;us!==null&&!GI();)kT(us)}function kT(t){var e=CT(t.alternate,t,Ki);t.memoizedProps=t.pendingProps,e===null?TT(t):us=e,zx.current=null}function TT(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=fj(r,e),r!==null){r.flags&=32767,us=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ss=6,us=null;return}}else if(r=dj(r,e,Ki),r!==null){us=r;return}if(e=e.sibling,e!==null){us=e;return}us=e=t}while(e!==null);Ss===0&&(Ss=5)}function ml(t,e,r){var n=fr,c=xn.transition;try{xn.transition=null,fr=1,bj(t,e,r,n)}finally{xn.transition=c,fr=n}return null}function bj(t,e,r,n){do Qc();while(So!==null);if(sr&6)throw Error(Ze(327));r=t.finishedWork;var c=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(Ze(177));t.callbackNode=null,t.callbackPriority=0;var d=r.lanes|r.childLanes;if(tM(t,d),t===js&&(us=js=null,Us=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Sp||(Sp=!0,AT(am,function(){return Qc(),null})),d=(r.flags&15990)!==0,r.subtreeFlags&15990||d){d=xn.transition,xn.transition=null;var m=fr;fr=1;var l=sr;sr|=4,zx.current=null,mj(t,r),vT(r,t),$M($_),lm=!!F_,$_=F_=null,t.current=r,gj(r),WI(),sr=l,fr=m,xn.transition=d}else t.current=r;if(Sp&&(Sp=!1,So=t,km=c),d=t.pendingLanes,d===0&&(Io=null),KI(r.stateNode),Oi(t,as()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)c=e[r],n(c.value,{componentStack:c.stack,digest:c.digest});if(Sm)throw Sm=!1,t=ov,ov=null,t;return km&1&&t.tag!==0&&Qc(),d=t.pendingLanes,d&1?t===lv?id++:(id=0,lv=t):id=0,$o(),null}function Qc(){if(So!==null){var t=nk(km),e=xn.transition,r=fr;try{if(xn.transition=null,fr=16>t?16:t,So===null)var n=!1;else{if(t=So,So=null,km=0,sr&6)throw Error(Ze(331));var c=sr;for(sr|=4,ft=t.current;ft!==null;){var d=ft,m=d.child;if(ft.flags&16){var l=d.deletions;if(l!==null){for(var w=0;w<l.length;w++){var k=l[w];for(ft=k;ft!==null;){var P=ft;switch(P.tag){case 0:case 11:case 15:rd(8,P,d)}var j=P.child;if(j!==null)j.return=P,ft=j;else for(;ft!==null;){P=ft;var L=P.sibling,Z=P.return;if(gT(P),P===k){ft=null;break}if(L!==null){L.return=Z,ft=L;break}ft=Z}}}var Y=d.alternate;if(Y!==null){var ce=Y.child;if(ce!==null){Y.child=null;do{var de=ce.sibling;ce.sibling=null,ce=de}while(ce!==null)}}ft=d}}if(d.subtreeFlags&2064&&m!==null)m.return=d,ft=m;else e:for(;ft!==null;){if(d=ft,d.flags&2048)switch(d.tag){case 0:case 11:case 15:rd(9,d,d.return)}var G=d.sibling;if(G!==null){G.return=d.return,ft=G;break e}ft=d.return}}var H=t.current;for(ft=H;ft!==null;){m=ft;var W=m.child;if(m.subtreeFlags&2064&&W!==null)W.return=m,ft=W;else e:for(m=H;ft!==null;){if(l=ft,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:qm(9,l)}}catch(me){Xr(l,l.return,me)}if(l===m){ft=null;break e}var ue=l.sibling;if(ue!==null){ue.return=l.return,ft=ue;break e}ft=l.return}}if(sr=c,$o(),ca&&typeof ca.onPostCommitFiberRoot=="function")try{ca.onPostCommitFiberRoot(Rm,t)}catch{}n=!0}return n}finally{fr=r,xn.transition=e}}return!1}function T1(t,e,r){e=lu(r,e),e=nT(t,e,1),t=Po(t,e,1),e=_i(),t!==null&&($d(t,1,e),Oi(t,e))}function Xr(t,e,r){if(t.tag===3)T1(t,t,r);else for(;e!==null;){if(e.tag===3){T1(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Io===null||!Io.has(n))){t=lu(r,t),t=aT(e,t,1),e=Po(e,t,1),t=_i(),e!==null&&($d(e,1,t),Oi(e,t));break}}e=e.return}}function wj(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=_i(),t.pingedLanes|=t.suspendedLanes&r,js===t&&(Us&r)===r&&(Ss===4||Ss===3&&(Us&130023424)===Us&&500>as()-Ox?kl(t,0):Bx|=r),Oi(t,e)}function ET(t,e){e===0&&(t.mode&1?(e=fp,fp<<=1,!(fp&130023424)&&(fp=4194304)):e=1);var r=_i();t=$a(t,e),t!==null&&($d(t,e,r),Oi(t,r))}function Sj(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),ET(t,r)}function kj(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,c=t.memoizedState;c!==null&&(r=c.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(Ze(314))}n!==null&&n.delete(e),ET(t,r)}var CT;CT=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||zi.current)Li=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Li=!1,hj(t,e,r);Li=!!(t.flags&131072)}else Li=!1,Nr&&e.flags&1048576&&Mk(e,mm,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;qp(t,e),t=e.pendingProps;var c=iu(e,ri.current);Jc(e,r),c=jx(null,e,n,t,c,r);var d=Dx();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bi(n)?(d=!0,fm(e)):d=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,Cx(e),c.updater=Vm,e.stateNode=c,c._reactInternals=e,X_(e,n,t,r),e=Q_(null,e,n,!0,d,r)):(e.tag=0,Nr&&d&&xx(e),mi(null,e,c,r),e=e.child),e;case 16:n=e.elementType;e:{switch(qp(t,e),t=e.pendingProps,c=n._init,n=c(n._payload),e.type=n,c=e.tag=Ej(n),t=On(n,t),c){case 0:e=J_(null,e,n,t,r);break e;case 1:e=m1(null,e,n,t,r);break e;case 11:e=f1(null,e,n,t,r);break e;case 14:e=p1(null,e,n,On(n.type,t),r);break e}throw Error(Ze(306,n,""))}return e;case 0:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:On(n,c),J_(t,e,n,c,r);case 1:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:On(n,c),m1(t,e,n,c,r);case 3:e:{if(uT(e),t===null)throw Error(Ze(387));n=e.pendingProps,d=e.memoizedState,c=d.element,zk(t,e),_m(e,n,null,r);var m=e.memoizedState;if(n=m.element,d.isDehydrated)if(d={element:n,isDehydrated:!1,cache:m.cache,pendingSuspenseBoundaries:m.pendingSuspenseBoundaries,transitions:m.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){c=lu(Error(Ze(423)),e),e=g1(t,e,n,r,c);break e}else if(n!==c){c=lu(Error(Ze(424)),e),e=g1(t,e,n,r,c);break e}else for(Xi=Ao(e.stateNode.containerInfo.firstChild),Yi=e,Nr=!0,Vn=null,r=Lk(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(nu(),n===c){e=Ua(t,e,r);break e}mi(t,e,n,r)}e=e.child}return e;case 5:return Bk(e),t===null&&Z_(e),n=e.type,c=e.pendingProps,d=t!==null?t.memoizedProps:null,m=c.children,U_(n,c)?m=null:d!==null&&U_(n,d)&&(e.flags|=32),cT(t,e),mi(t,e,m,r),e.child;case 6:return t===null&&Z_(e),null;case 13:return hT(t,e,r);case 4:return Ax(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=au(e,null,n,r):mi(t,e,n,r),e.child;case 11:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:On(n,c),f1(t,e,n,c,r);case 7:return mi(t,e,e.pendingProps,r),e.child;case 8:return mi(t,e,e.pendingProps.children,r),e.child;case 12:return mi(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,c=e.pendingProps,d=e.memoizedProps,m=c.value,Tr(gm,n._currentValue),n._currentValue=m,d!==null)if(Wn(d.value,m)){if(d.children===c.children&&!zi.current){e=Ua(t,e,r);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var l=d.dependencies;if(l!==null){m=d.child;for(var w=l.firstContext;w!==null;){if(w.context===n){if(d.tag===1){w=Ba(-1,r&-r),w.tag=2;var k=d.updateQueue;if(k!==null){k=k.shared;var P=k.pending;P===null?w.next=w:(w.next=P.next,P.next=w),k.pending=w}}d.lanes|=r,w=d.alternate,w!==null&&(w.lanes|=r),H_(d.return,r,e),l.lanes|=r;break}w=w.next}}else if(d.tag===10)m=d.type===e.type?null:d.child;else if(d.tag===18){if(m=d.return,m===null)throw Error(Ze(341));m.lanes|=r,l=m.alternate,l!==null&&(l.lanes|=r),H_(m,r,e),m=d.sibling}else m=d.child;if(m!==null)m.return=d;else for(m=d;m!==null;){if(m===e){m=null;break}if(d=m.sibling,d!==null){d.return=m.return,m=d;break}m=m.return}d=m}mi(t,e,c.children,r),e=e.child}return e;case 9:return c=e.type,n=e.pendingProps.children,Jc(e,r),c=wn(c),n=n(c),e.flags|=1,mi(t,e,n,r),e.child;case 14:return n=e.type,c=On(n,e.pendingProps),c=On(n.type,c),p1(t,e,n,c,r);case 15:return oT(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,c=e.pendingProps,c=e.elementType===n?c:On(n,c),qp(t,e),e.tag=1,Bi(n)?(t=!0,fm(e)):t=!1,Jc(e,r),iT(e,n,c),X_(e,n,c,r),Q_(null,e,n,!0,t,r);case 19:return dT(t,e,r);case 22:return lT(t,e,r)}throw Error(Ze(156,e.tag))};function AT(t,e){return tk(t,e)}function Tj(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vn(t,e,r,n){return new Tj(t,e,r,n)}function Vx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ej(t){if(typeof t=="function")return Vx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===lx)return 11;if(t===cx)return 14}return 2}function jo(t,e){var r=t.alternate;return r===null?(r=vn(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Zp(t,e,r,n,c,d){var m=2;if(n=t,typeof t=="function")Vx(t)&&(m=1);else if(typeof t=="string")m=5;else e:switch(t){case jc:return Tl(r.children,c,d,e);case ox:m=8,c|=8;break;case x_:return t=vn(12,r,e,c|2),t.elementType=x_,t.lanes=d,t;case b_:return t=vn(13,r,e,c),t.elementType=b_,t.lanes=d,t;case w_:return t=vn(19,r,e,c),t.elementType=w_,t.lanes=d,t;case B2:return Wm(r,c,d,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case R2:m=10;break e;case z2:m=9;break e;case lx:m=11;break e;case cx:m=14;break e;case yo:m=16,n=null;break e}throw Error(Ze(130,t==null?t:typeof t,""))}return e=vn(m,r,e,c),e.elementType=t,e.type=n,e.lanes=d,e}function Tl(t,e,r,n){return t=vn(7,t,n,e),t.lanes=r,t}function Wm(t,e,r,n){return t=vn(22,t,n,e),t.elementType=B2,t.lanes=r,t.stateNode={isHidden:!1},t}function Uy(t,e,r){return t=vn(6,t,null,e),t.lanes=r,t}function Vy(t,e,r){return e=vn(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Cj(t,e,r,n,c){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Sy(0),this.expirationTimes=Sy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Sy(0),this.identifierPrefix=n,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function qx(t,e,r,n,c,d,m,l,w){return t=new Cj(t,e,r,l,w),e===1?(e=1,d===!0&&(e|=8)):e=0,d=vn(3,null,null,e),t.current=d,d.stateNode=t,d.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cx(d),t}function Aj(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Mc,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function PT(t){if(!t)return Ro;t=t._reactInternals;e:{if(Nl(t)!==t||t.tag!==1)throw Error(Ze(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ze(171))}if(t.tag===1){var r=t.type;if(Bi(r))return Pk(t,r,e)}return e}function IT(t,e,r,n,c,d,m,l,w){return t=qx(r,n,!0,t,c,d,m,l,w),t.context=PT(null),r=t.current,n=_i(),c=Mo(r),d=Ba(n,c),d.callback=e??null,Po(r,d,c),t.current.lanes=c,$d(t,c,n),Oi(t,n),t}function Zm(t,e,r,n){var c=e.current,d=_i(),m=Mo(c);return r=PT(r),e.context===null?e.context=r:e.pendingContext=r,e=Ba(d,m),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Po(c,e,m),t!==null&&(Gn(t,c,m,d),$p(t,c,m)),m}function Em(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function E1(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function Gx(t,e){E1(t,e),(t=t.alternate)&&E1(t,e)}function Pj(){return null}var MT=typeof reportError=="function"?reportError:function(t){console.error(t)};function Wx(t){this._internalRoot=t}Hm.prototype.render=Wx.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ze(409));Zm(t,e,null,null)};Hm.prototype.unmount=Wx.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;jl(function(){Zm(null,t,null,null)}),e[Fa]=null}};function Hm(t){this._internalRoot=t}Hm.prototype.unstable_scheduleHydration=function(t){if(t){var e=lk();t={blockedOn:null,target:t,priority:e};for(var r=0;r<vo.length&&e!==0&&e<vo[r].priority;r++);vo.splice(r,0,t),r===0&&uk(t)}};function Zx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Km(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function C1(){}function Ij(t,e,r,n,c){if(c){if(typeof n=="function"){var d=n;n=function(){var k=Em(m);d.call(k)}}var m=IT(e,n,t,0,null,!1,!1,"",C1);return t._reactRootContainer=m,t[Fa]=m.current,wd(t.nodeType===8?t.parentNode:t),jl(),m}for(;c=t.lastChild;)t.removeChild(c);if(typeof n=="function"){var l=n;n=function(){var k=Em(w);l.call(k)}}var w=qx(t,0,!1,null,null,!1,!1,"",C1);return t._reactRootContainer=w,t[Fa]=w.current,wd(t.nodeType===8?t.parentNode:t),jl(function(){Zm(e,w,r,n)}),w}function Xm(t,e,r,n,c){var d=r._reactRootContainer;if(d){var m=d;if(typeof c=="function"){var l=c;c=function(){var w=Em(m);l.call(w)}}Zm(e,m,t,c)}else m=Ij(r,e,t,c,n);return Em(m)}ak=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Gh(e.pendingLanes);r!==0&&(dx(e,r|1),Oi(e,as()),!(sr&6)&&(cu=as()+500,$o()))}break;case 13:jl(function(){var n=$a(t,1);if(n!==null){var c=_i();Gn(n,t,1,c)}}),Gx(t,1)}};fx=function(t){if(t.tag===13){var e=$a(t,134217728);if(e!==null){var r=_i();Gn(e,t,134217728,r)}Gx(t,134217728)}};ok=function(t){if(t.tag===13){var e=Mo(t),r=$a(t,e);if(r!==null){var n=_i();Gn(r,t,e,n)}Gx(t,e)}};lk=function(){return fr};ck=function(t,e){var r=fr;try{return fr=t,e()}finally{fr=r}};j_=function(t,e,r){switch(e){case"input":if(T_(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var c=Fm(n);if(!c)throw Error(Ze(90));F2(n),T_(n,c)}}}break;case"textarea":U2(t,r);break;case"select":e=r.value,e!=null&&Hc(t,!!r.multiple,e,!1)}};K2=Fx;X2=jl;var Mj={usingClientEntryPoint:!1,Events:[Vd,Rc,Fm,Z2,H2,Fx]},zh={findFiberByHostInstance:vl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},jj={bundleType:zh.bundleType,version:zh.version,rendererPackageName:zh.rendererPackageName,rendererConfig:zh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ga.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Q2(t),t===null?null:t.stateNode},findFiberByHostInstance:zh.findFiberByHostInstance||Pj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kp.isDisabled&&kp.supportsFiber)try{Rm=kp.inject(jj),ca=kp}catch{}}en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mj;en.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Zx(e))throw Error(Ze(200));return Aj(t,e,null,r)};en.createRoot=function(t,e){if(!Zx(t))throw Error(Ze(299));var r=!1,n="",c=MT;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=qx(t,1,!1,null,null,r,!1,n,c),t[Fa]=e.current,wd(t.nodeType===8?t.parentNode:t),new Wx(e)};en.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ze(188)):(t=Object.keys(t).join(","),Error(Ze(268,t)));return t=Q2(e),t=t===null?null:t.stateNode,t};en.flushSync=function(t){return jl(t)};en.hydrate=function(t,e,r){if(!Km(e))throw Error(Ze(200));return Xm(null,t,e,!0,r)};en.hydrateRoot=function(t,e,r){if(!Zx(t))throw Error(Ze(405));var n=r!=null&&r.hydratedSources||null,c=!1,d="",m=MT;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(m=r.onRecoverableError)),e=IT(e,null,t,1,r??null,c,!1,d,m),t[Fa]=e.current,wd(t),n)for(t=0;t<n.length;t++)r=n[t],c=r._getVersion,c=c(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,c]:e.mutableSourceEagerHydrationData.push(r,c);return new Hm(e)};en.render=function(t,e,r){if(!Km(e))throw Error(Ze(200));return Xm(null,t,e,!1,r)};en.unmountComponentAtNode=function(t){if(!Km(t))throw Error(Ze(40));return t._reactRootContainer?(jl(function(){Xm(null,null,t,!1,function(){t._reactRootContainer=null,t[Fa]=null})}),!0):!1};en.unstable_batchedUpdates=Fx;en.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!Km(r))throw Error(Ze(200));if(t==null||t._reactInternals===void 0)throw Error(Ze(38));return Xm(t,e,r,!1,n)};en.version="18.3.1-next-f1338f8080-20240426";function jT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jT)}catch(t){console.error(t)}}jT(),j2.exports=en;var Dj=j2.exports,A1=Dj;__.createRoot=A1.createRoot,__.hydrateRoot=A1.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Md(){return Md=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Md.apply(this,arguments)}var ko;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ko||(ko={}));const P1="popstate";function Nj(t){t===void 0&&(t={});function e(n,c){let{pathname:d,search:m,hash:l}=n.location;return hv("",{pathname:d,search:m,hash:l},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(n,c){return typeof c=="string"?c:Cm(c)}return Rj(e,r,null,t)}function ds(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function DT(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Lj(){return Math.random().toString(36).substr(2,8)}function I1(t,e){return{usr:t.state,key:t.key,idx:e}}function hv(t,e,r,n){return r===void 0&&(r=null),Md({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?gu(e):e,{state:r,key:e&&e.key||n||Lj()})}function Cm(t){let{pathname:e="/",search:r="",hash:n=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function gu(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function Rj(t,e,r,n){n===void 0&&(n={});let{window:c=document.defaultView,v5Compat:d=!1}=n,m=c.history,l=ko.Pop,w=null,k=P();k==null&&(k=0,m.replaceState(Md({},m.state,{idx:k}),""));function P(){return(m.state||{idx:null}).idx}function j(){l=ko.Pop;let de=P(),G=de==null?null:de-k;k=de,w&&w({action:l,location:ce.location,delta:G})}function L(de,G){l=ko.Push;let H=hv(ce.location,de,G);k=P()+1;let W=I1(H,k),ue=ce.createHref(H);try{m.pushState(W,"",ue)}catch(me){if(me instanceof DOMException&&me.name==="DataCloneError")throw me;c.location.assign(ue)}d&&w&&w({action:l,location:ce.location,delta:1})}function Z(de,G){l=ko.Replace;let H=hv(ce.location,de,G);k=P();let W=I1(H,k),ue=ce.createHref(H);m.replaceState(W,"",ue),d&&w&&w({action:l,location:ce.location,delta:0})}function Y(de){let G=c.location.origin!=="null"?c.location.origin:c.location.href,H=typeof de=="string"?de:Cm(de);return H=H.replace(/ $/,"%20"),ds(G,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,G)}let ce={get action(){return l},get location(){return t(c,m)},listen(de){if(w)throw new Error("A history only accepts one active listener");return c.addEventListener(P1,j),w=de,()=>{c.removeEventListener(P1,j),w=null}},createHref(de){return e(c,de)},createURL:Y,encodeLocation(de){let G=Y(de);return{pathname:G.pathname,search:G.search,hash:G.hash}},push:L,replace:Z,go(de){return m.go(de)}};return ce}var M1;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(M1||(M1={}));function zj(t,e,r){return r===void 0&&(r="/"),Bj(t,e,r)}function Bj(t,e,r,n){let c=typeof e=="string"?gu(e):e,d=Hx(c.pathname||"/",r);if(d==null)return null;let m=NT(t);Oj(m);let l=null;for(let w=0;l==null&&w<m.length;++w){let k=Yj(d);l=Hj(m[w],k)}return l}function NT(t,e,r,n){e===void 0&&(e=[]),r===void 0&&(r=[]),n===void 0&&(n="");let c=(d,m,l)=>{let w={relativePath:l===void 0?d.path||"":l,caseSensitive:d.caseSensitive===!0,childrenIndex:m,route:d};w.relativePath.startsWith("/")&&(ds(w.relativePath.startsWith(n),'Absolute route path "'+w.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),w.relativePath=w.relativePath.slice(n.length));let k=Do([n,w.relativePath]),P=r.concat(w);d.children&&d.children.length>0&&(ds(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+k+'".')),NT(d.children,e,P,k)),!(d.path==null&&!d.index)&&e.push({path:k,score:Wj(k,d.index),routesMeta:P})};return t.forEach((d,m)=>{var l;if(d.path===""||!((l=d.path)!=null&&l.includes("?")))c(d,m);else for(let w of LT(d.path))c(d,m,w)}),e}function LT(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,c=r.endsWith("?"),d=r.replace(/\?$/,"");if(n.length===0)return c?[d,""]:[d];let m=LT(n.join("/")),l=[];return l.push(...m.map(w=>w===""?d:[d,w].join("/"))),c&&l.push(...m),l.map(w=>t.startsWith("/")&&w===""?"/":w)}function Oj(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:Zj(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Fj=/^:[\w-]+$/,$j=3,Uj=2,Vj=1,qj=10,Gj=-2,j1=t=>t==="*";function Wj(t,e){let r=t.split("/"),n=r.length;return r.some(j1)&&(n+=Gj),e&&(n+=Uj),r.filter(c=>!j1(c)).reduce((c,d)=>c+(Fj.test(d)?$j:d===""?Vj:qj),n)}function Zj(t,e){return t.length===e.length&&t.slice(0,-1).every((n,c)=>n===e[c])?t[t.length-1]-e[e.length-1]:0}function Hj(t,e,r){let{routesMeta:n}=t,c={},d="/",m=[];for(let l=0;l<n.length;++l){let w=n[l],k=l===n.length-1,P=d==="/"?e:e.slice(d.length)||"/",j=Kj({path:w.relativePath,caseSensitive:w.caseSensitive,end:k},P),L=w.route;if(!j)return null;Object.assign(c,j.params),m.push({params:c,pathname:Do([d,j.pathname]),pathnameBase:tD(Do([d,j.pathnameBase])),route:L}),j.pathnameBase!=="/"&&(d=Do([d,j.pathnameBase]))}return m}function Kj(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=Xj(t.path,t.caseSensitive,t.end),c=e.match(r);if(!c)return null;let d=c[0],m=d.replace(/(.)\/+$/,"$1"),l=c.slice(1);return{params:n.reduce((k,P,j)=>{let{paramName:L,isOptional:Z}=P;if(L==="*"){let ce=l[j]||"";m=d.slice(0,d.length-ce.length).replace(/(.)\/+$/,"$1")}const Y=l[j];return Z&&!Y?k[L]=void 0:k[L]=(Y||"").replace(/%2F/g,"/"),k},{}),pathname:d,pathnameBase:m,pattern:t}}function Xj(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),DT(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],c="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,l,w)=>(n.push({paramName:l,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),c+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":t!==""&&t!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),n]}function Yj(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return DT(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Hx(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}function Jj(t,e){e===void 0&&(e="/");let{pathname:r,search:n="",hash:c=""}=typeof t=="string"?gu(t):t;return{pathname:r?r.startsWith("/")?r:Qj(r,e):e,search:rD(n),hash:sD(c)}}function Qj(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function qy(t,e,r,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function eD(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function RT(t,e){let r=eD(t);return e?r.map((n,c)=>c===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function zT(t,e,r,n){n===void 0&&(n=!1);let c;typeof t=="string"?c=gu(t):(c=Md({},t),ds(!c.pathname||!c.pathname.includes("?"),qy("?","pathname","search",c)),ds(!c.pathname||!c.pathname.includes("#"),qy("#","pathname","hash",c)),ds(!c.search||!c.search.includes("#"),qy("#","search","hash",c)));let d=t===""||c.pathname==="",m=d?"/":c.pathname,l;if(m==null)l=r;else{let j=e.length-1;if(!n&&m.startsWith("..")){let L=m.split("/");for(;L[0]==="..";)L.shift(),j-=1;c.pathname=L.join("/")}l=j>=0?e[j]:"/"}let w=Jj(c,l),k=m&&m!=="/"&&m.endsWith("/"),P=(d||m===".")&&r.endsWith("/");return!w.pathname.endsWith("/")&&(k||P)&&(w.pathname+="/"),w}const Do=t=>t.join("/").replace(/\/\/+/g,"/"),tD=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),rD=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,sD=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function iD(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const BT=["post","put","patch","delete"];new Set(BT);const nD=["get",...BT];new Set(nD);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jd(){return jd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},jd.apply(this,arguments)}const Kx=re.createContext(null),aD=re.createContext(null),Ll=re.createContext(null),Ym=re.createContext(null),Rl=re.createContext({outlet:null,matches:[],isDataRoute:!1}),OT=re.createContext(null);function oD(t,e){let{relative:r}=e===void 0?{}:e;Gd()||ds(!1);let{basename:n,navigator:c}=re.useContext(Ll),{hash:d,pathname:m,search:l}=$T(t,{relative:r}),w=m;return n!=="/"&&(w=m==="/"?n:Do([n,m])),c.createHref({pathname:w,search:l,hash:d})}function Gd(){return re.useContext(Ym)!=null}function Wd(){return Gd()||ds(!1),re.useContext(Ym).location}function FT(t){re.useContext(Ll).static||re.useLayoutEffect(t)}function Jm(){let{isDataRoute:t}=re.useContext(Rl);return t?xD():lD()}function lD(){Gd()||ds(!1);let t=re.useContext(Kx),{basename:e,future:r,navigator:n}=re.useContext(Ll),{matches:c}=re.useContext(Rl),{pathname:d}=Wd(),m=JSON.stringify(RT(c,r.v7_relativeSplatPath)),l=re.useRef(!1);return FT(()=>{l.current=!0}),re.useCallback(function(k,P){if(P===void 0&&(P={}),!l.current)return;if(typeof k=="number"){n.go(k);return}let j=zT(k,JSON.parse(m),d,P.relative==="path");t==null&&e!=="/"&&(j.pathname=j.pathname==="/"?e:Do([e,j.pathname])),(P.replace?n.replace:n.push)(j,P.state,P)},[e,n,m,d,t])}function $T(t,e){let{relative:r}=e===void 0?{}:e,{future:n}=re.useContext(Ll),{matches:c}=re.useContext(Rl),{pathname:d}=Wd(),m=JSON.stringify(RT(c,n.v7_relativeSplatPath));return re.useMemo(()=>zT(t,JSON.parse(m),d,r==="path"),[t,m,d,r])}function cD(t,e){return uD(t,e)}function uD(t,e,r,n){Gd()||ds(!1);let{navigator:c}=re.useContext(Ll),{matches:d}=re.useContext(Rl),m=d[d.length-1],l=m?m.params:{};m&&m.pathname;let w=m?m.pathnameBase:"/";m&&m.route;let k=Wd(),P;if(e){var j;let de=typeof e=="string"?gu(e):e;w==="/"||(j=de.pathname)!=null&&j.startsWith(w)||ds(!1),P=de}else P=k;let L=P.pathname||"/",Z=L;if(w!=="/"){let de=w.replace(/^\//,"").split("/");Z="/"+L.replace(/^\//,"").split("/").slice(de.length).join("/")}let Y=zj(t,{pathname:Z}),ce=mD(Y&&Y.map(de=>Object.assign({},de,{params:Object.assign({},l,de.params),pathname:Do([w,c.encodeLocation?c.encodeLocation(de.pathname).pathname:de.pathname]),pathnameBase:de.pathnameBase==="/"?w:Do([w,c.encodeLocation?c.encodeLocation(de.pathnameBase).pathname:de.pathnameBase])})),d,r,n);return e&&ce?re.createElement(Ym.Provider,{value:{location:jd({pathname:"/",search:"",hash:"",state:null,key:"default"},P),navigationType:ko.Pop}},ce):ce}function hD(){let t=vD(),e=iD(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return re.createElement(re.Fragment,null,re.createElement("h2",null,"Unexpected Application Error!"),re.createElement("h3",{style:{fontStyle:"italic"}},e),r?re.createElement("pre",{style:c},r):null,null)}const dD=re.createElement(hD,null);class fD extends re.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?re.createElement(Rl.Provider,{value:this.props.routeContext},re.createElement(OT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pD(t){let{routeContext:e,match:r,children:n}=t,c=re.useContext(Kx);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),re.createElement(Rl.Provider,{value:e},n)}function mD(t,e,r,n){var c;if(e===void 0&&(e=[]),r===void 0&&(r=null),n===void 0&&(n=null),t==null){var d;if(!r)return null;if(r.errors)t=r.matches;else if((d=n)!=null&&d.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let m=t,l=(c=r)==null?void 0:c.errors;if(l!=null){let P=m.findIndex(j=>j.route.id&&(l==null?void 0:l[j.route.id])!==void 0);P>=0||ds(!1),m=m.slice(0,Math.min(m.length,P+1))}let w=!1,k=-1;if(r&&n&&n.v7_partialHydration)for(let P=0;P<m.length;P++){let j=m[P];if((j.route.HydrateFallback||j.route.hydrateFallbackElement)&&(k=P),j.route.id){let{loaderData:L,errors:Z}=r,Y=j.route.loader&&L[j.route.id]===void 0&&(!Z||Z[j.route.id]===void 0);if(j.route.lazy||Y){w=!0,k>=0?m=m.slice(0,k+1):m=[m[0]];break}}}return m.reduceRight((P,j,L)=>{let Z,Y=!1,ce=null,de=null;r&&(Z=l&&j.route.id?l[j.route.id]:void 0,ce=j.route.errorElement||dD,w&&(k<0&&L===0?(bD("route-fallback"),Y=!0,de=null):k===L&&(Y=!0,de=j.route.hydrateFallbackElement||null)));let G=e.concat(m.slice(0,L+1)),H=()=>{let W;return Z?W=ce:Y?W=de:j.route.Component?W=re.createElement(j.route.Component,null):j.route.element?W=j.route.element:W=P,re.createElement(pD,{match:j,routeContext:{outlet:P,matches:G,isDataRoute:r!=null},children:W})};return r&&(j.route.ErrorBoundary||j.route.errorElement||L===0)?re.createElement(fD,{location:r.location,revalidation:r.revalidation,component:ce,error:Z,children:H(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):H()},null)}var UT=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(UT||{}),VT=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(VT||{});function gD(t){let e=re.useContext(Kx);return e||ds(!1),e}function yD(t){let e=re.useContext(aD);return e||ds(!1),e}function _D(t){let e=re.useContext(Rl);return e||ds(!1),e}function qT(t){let e=_D(),r=e.matches[e.matches.length-1];return r.route.id||ds(!1),r.route.id}function vD(){var t;let e=re.useContext(OT),r=yD(),n=qT();return e!==void 0?e:(t=r.errors)==null?void 0:t[n]}function xD(){let{router:t}=gD(UT.UseNavigateStable),e=qT(VT.UseNavigateStable),r=re.useRef(!1);return FT(()=>{r.current=!0}),re.useCallback(function(c,d){d===void 0&&(d={}),r.current&&(typeof c=="number"?t.navigate(c):t.navigate(c,jd({fromRouteId:e},d)))},[t,e])}const D1={};function bD(t,e,r){D1[t]||(D1[t]=!0)}function wD(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function pn(t){ds(!1)}function SD(t){let{basename:e="/",children:r=null,location:n,navigationType:c=ko.Pop,navigator:d,static:m=!1,future:l}=t;Gd()&&ds(!1);let w=e.replace(/^\/*/,"/"),k=re.useMemo(()=>({basename:w,navigator:d,static:m,future:jd({v7_relativeSplatPath:!1},l)}),[w,l,d,m]);typeof n=="string"&&(n=gu(n));let{pathname:P="/",search:j="",hash:L="",state:Z=null,key:Y="default"}=n,ce=re.useMemo(()=>{let de=Hx(P,w);return de==null?null:{location:{pathname:de,search:j,hash:L,state:Z,key:Y},navigationType:c}},[w,P,j,L,Z,Y,c]);return ce==null?null:re.createElement(Ll.Provider,{value:k},re.createElement(Ym.Provider,{children:r,value:ce}))}function kD(t){let{children:e,location:r}=t;return cD(dv(e),r)}new Promise(()=>{});function dv(t,e){e===void 0&&(e=[]);let r=[];return re.Children.forEach(t,(n,c)=>{if(!re.isValidElement(n))return;let d=[...e,c];if(n.type===re.Fragment){r.push.apply(r,dv(n.props.children,d));return}n.type!==pn&&ds(!1),!n.props.index||!n.props.children||ds(!1);let m={id:n.props.id||d.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(m.children=dv(n.props.children,d)),r.push(m)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fv(){return fv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},fv.apply(this,arguments)}function TD(t,e){if(t==null)return{};var r={},n=Object.keys(t),c,d;for(d=0;d<n.length;d++)c=n[d],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function ED(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function CD(t,e){return t.button===0&&(!e||e==="_self")&&!ED(t)}const AD=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],PD="6";try{window.__reactRouterVersion=PD}catch{}const ID="startTransition",N1=wI[ID];function MD(t){let{basename:e,children:r,future:n,window:c}=t,d=re.useRef();d.current==null&&(d.current=Nj({window:c,v5Compat:!0}));let m=d.current,[l,w]=re.useState({action:m.action,location:m.location}),{v7_startTransition:k}=n||{},P=re.useCallback(j=>{k&&N1?N1(()=>w(j)):w(j)},[w,k]);return re.useLayoutEffect(()=>m.listen(P),[m,P]),re.useEffect(()=>wD(n),[n]),re.createElement(SD,{basename:e,children:r,location:l.location,navigationType:l.action,navigator:m,future:n})}const jD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",DD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Bh=re.forwardRef(function(e,r){let{onClick:n,relative:c,reloadDocument:d,replace:m,state:l,target:w,to:k,preventScrollReset:P,viewTransition:j}=e,L=TD(e,AD),{basename:Z}=re.useContext(Ll),Y,ce=!1;if(typeof k=="string"&&DD.test(k)&&(Y=k,jD))try{let W=new URL(window.location.href),ue=k.startsWith("//")?new URL(W.protocol+k):new URL(k),me=Hx(ue.pathname,Z);ue.origin===W.origin&&me!=null?k=me+ue.search+ue.hash:ce=!0}catch{}let de=oD(k,{relative:c}),G=ND(k,{replace:m,state:l,target:w,preventScrollReset:P,relative:c,viewTransition:j});function H(W){n&&n(W),W.defaultPrevented||G(W)}return re.createElement("a",fv({},L,{href:Y||de,onClick:ce||d?n:H,ref:r,target:w}))});var L1;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(L1||(L1={}));var R1;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(R1||(R1={}));function ND(t,e){let{target:r,replace:n,state:c,preventScrollReset:d,relative:m,viewTransition:l}=e===void 0?{}:e,w=Jm(),k=Wd(),P=$T(t,{relative:m});return re.useCallback(j=>{if(CD(j,r)){j.preventDefault();let L=n!==void 0?n:Cm(k)===Cm(P);w(t,{replace:L,state:c,preventScrollReset:d,relative:m,viewTransition:l})}},[k,w,P,n,c,r,t,d,m,l])}const LD="modulepreload",RD=function(t){return"/"+t},z1={},Zd=function(e,r,n){let c=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),l=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));c=Promise.allSettled(r.map(w=>{if(w=RD(w),w in z1)return;z1[w]=!0;const k=w.endsWith(".css"),P=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${P}`))return;const j=document.createElement("link");if(j.rel=k?"stylesheet":LD,k||(j.as="script"),j.crossOrigin="",j.href=w,l&&j.setAttribute("nonce",l),document.head.appendChild(j),k)return new Promise((L,Z)=>{j.addEventListener("load",L),j.addEventListener("error",()=>Z(new Error(`Unable to preload CSS for ${w}`)))})}))}function d(m){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=m,window.dispatchEvent(l),!l.defaultPrevented)throw m}return c.then(m=>{for(const l of m||[])l.status==="rejected"&&d(l.reason);return e().catch(d)})},zD=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Zd(async()=>{const{default:n}=await Promise.resolve().then(()=>yu);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class Xx extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class BD extends Xx{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class B1 extends Xx{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class O1 extends Xx{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var pv;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(pv||(pv={}));var OD=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};class FD{constructor(e,{headers:r={},customFetch:n,region:c=pv.Any}={}){this.url=e,this.headers=r,this.region=c,this.fetch=zD(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return OD(this,void 0,void 0,function*(){try{const{headers:c,method:d,body:m}=r;let l={},{region:w}=r;w||(w=this.region);const k=new URL(`${this.url}/${e}`);w&&w!=="any"&&(l["x-region"]=w,k.searchParams.set("forceFunctionRegion",w));let P;m&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)&&(typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",P=m):typeof m=="string"?(l["Content-Type"]="text/plain",P=m):typeof FormData<"u"&&m instanceof FormData?P=m:(l["Content-Type"]="application/json",P=JSON.stringify(m)));const j=yield this.fetch(k.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),c),body:P}).catch(ce=>{throw new BD(ce)}),L=j.headers.get("x-relay-error");if(L&&L==="true")throw new B1(j);if(!j.ok)throw new O1(j);let Z=((n=j.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),Y;return Z==="application/json"?Y=yield j.json():Z==="application/octet-stream"?Y=yield j.blob():Z==="text/event-stream"?Y=j:Z==="multipart/form-data"?Y=yield j.formData():Y=yield j.text(),{data:Y,error:null,response:j}}catch(c){return{data:null,error:c,response:c instanceof O1||c instanceof B1?c.context:void 0}}})}}var Ni={},Yx={},Qm={},Hd={},eg={},tg={},$D=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},uu=$D();const UD=uu.fetch,GT=uu.fetch.bind(uu),WT=uu.Headers,VD=uu.Request,qD=uu.Response,yu=Object.freeze(Object.defineProperty({__proto__:null,Headers:WT,Request:VD,Response:qD,default:GT,fetch:UD},Symbol.toStringTag,{value:"Module"})),GD=aI(yu);var rg={};Object.defineProperty(rg,"__esModule",{value:!0});let WD=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};rg.default=WD;var ZT=Ji&&Ji.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(tg,"__esModule",{value:!0});const ZD=ZT(GD),HD=ZT(rg);let KD=class{constructor(e){var r,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(r=e.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ZD.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,r){return this.headers=new Headers(this.headers),this.headers.set(e,r),this}then(e,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let c=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var m,l,w,k;let P=null,j=null,L=null,Z=d.status,Y=d.statusText;if(d.ok){if(this.method!=="HEAD"){const H=await d.text();H===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((m=this.headers.get("Accept"))===null||m===void 0)&&m.includes("application/vnd.pgrst.plan+text"))?j=H:j=JSON.parse(H))}const de=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),G=(w=d.headers.get("content-range"))===null||w===void 0?void 0:w.split("/");de&&G&&G.length>1&&(L=parseInt(G[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(j)&&(j.length>1?(P={code:"PGRST116",details:`Results contain ${j.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},j=null,L=null,Z=406,Y="Not Acceptable"):j.length===1?j=j[0]:j=null)}else{const de=await d.text();try{P=JSON.parse(de),Array.isArray(P)&&d.status===404&&(j=[],P=null,Z=200,Y="OK")}catch{d.status===404&&de===""?(Z=204,Y="No Content"):P={message:de}}if(P&&this.isMaybeSingle&&(!((k=P==null?void 0:P.details)===null||k===void 0)&&k.includes("0 rows"))&&(P=null,Z=200,Y="OK"),P&&this.shouldThrowOnError)throw new HD.default(P)}return{error:P,data:j,count:L,status:Z,statusText:Y}});return this.shouldThrowOnError||(c=c.catch(d=>{var m,l,w;return{error:{message:`${(m=d==null?void 0:d.name)!==null&&m!==void 0?m:"FetchError"}: ${d==null?void 0:d.message}`,details:`${(l=d==null?void 0:d.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(w=d==null?void 0:d.code)!==null&&w!==void 0?w:""}`},data:null,count:null,status:0,statusText:""}})),c.then(e,r)}returns(){return this}overrideTypes(){return this}};tg.default=KD;var XD=Ji&&Ji.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(eg,"__esModule",{value:!0});const YD=XD(tg);let JD=class extends YD.default{select(e){let r=!1;const n=(e??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:r=!0,nullsFirst:n,foreignTable:c,referencedTable:d=c}={}){const m=d?`${d}.order`:"order",l=this.url.searchParams.get(m);return this.url.searchParams.set(m,`${l?`${l},`:""}${e}.${r?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:r,referencedTable:n=r}={}){const c=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(c,`${e}`),this}range(e,r,{foreignTable:n,referencedTable:c=n}={}){const d=typeof c>"u"?"offset":`${c}.offset`,m=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${e}`),this.url.searchParams.set(m,`${r-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:r=!1,settings:n=!1,buffers:c=!1,wal:d=!1,format:m="text"}={}){var l;const w=[e?"analyze":null,r?"verbose":null,n?"settings":null,c?"buffers":null,d?"wal":null].filter(Boolean).join("|"),k=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${m}; for="${k}"; options=${w};`),m==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};eg.default=JD;var QD=Ji&&Ji.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Hd,"__esModule",{value:!0});const eN=QD(eg);let tN=class extends eN.default{eq(e,r){return this.url.searchParams.append(e,`eq.${r}`),this}neq(e,r){return this.url.searchParams.append(e,`neq.${r}`),this}gt(e,r){return this.url.searchParams.append(e,`gt.${r}`),this}gte(e,r){return this.url.searchParams.append(e,`gte.${r}`),this}lt(e,r){return this.url.searchParams.append(e,`lt.${r}`),this}lte(e,r){return this.url.searchParams.append(e,`lte.${r}`),this}like(e,r){return this.url.searchParams.append(e,`like.${r}`),this}likeAllOf(e,r){return this.url.searchParams.append(e,`like(all).{${r.join(",")}}`),this}likeAnyOf(e,r){return this.url.searchParams.append(e,`like(any).{${r.join(",")}}`),this}ilike(e,r){return this.url.searchParams.append(e,`ilike.${r}`),this}ilikeAllOf(e,r){return this.url.searchParams.append(e,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(e,r){return this.url.searchParams.append(e,`ilike(any).{${r.join(",")}}`),this}is(e,r){return this.url.searchParams.append(e,`is.${r}`),this}in(e,r){const n=Array.from(new Set(r)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,r){return typeof r=="string"?this.url.searchParams.append(e,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(e,`cs.{${r.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(r)}`),this}containedBy(e,r){return typeof r=="string"?this.url.searchParams.append(e,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(e,`cd.{${r.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(r)}`),this}rangeGt(e,r){return this.url.searchParams.append(e,`sr.${r}`),this}rangeGte(e,r){return this.url.searchParams.append(e,`nxl.${r}`),this}rangeLt(e,r){return this.url.searchParams.append(e,`sl.${r}`),this}rangeLte(e,r){return this.url.searchParams.append(e,`nxr.${r}`),this}rangeAdjacent(e,r){return this.url.searchParams.append(e,`adj.${r}`),this}overlaps(e,r){return typeof r=="string"?this.url.searchParams.append(e,`ov.${r}`):this.url.searchParams.append(e,`ov.{${r.join(",")}}`),this}textSearch(e,r,{config:n,type:c}={}){let d="";c==="plain"?d="pl":c==="phrase"?d="ph":c==="websearch"&&(d="w");const m=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${d}fts${m}.${r}`),this}match(e){return Object.entries(e).forEach(([r,n])=>{this.url.searchParams.append(r,`eq.${n}`)}),this}not(e,r,n){return this.url.searchParams.append(e,`not.${r}.${n}`),this}or(e,{foreignTable:r,referencedTable:n=r}={}){const c=n?`${n}.or`:"or";return this.url.searchParams.append(c,`(${e})`),this}filter(e,r,n){return this.url.searchParams.append(e,`${r}.${n}`),this}};Hd.default=tN;var rN=Ji&&Ji.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Qm,"__esModule",{value:!0});const Oh=rN(Hd);let sN=class{constructor(e,{headers:r={},schema:n,fetch:c}){this.url=e,this.headers=new Headers(r),this.schema=n,this.fetch=c}select(e,{head:r=!1,count:n}={}){const c=r?"HEAD":"GET";let d=!1;const m=(e??"*").split("").map(l=>/\s/.test(l)&&!d?"":(l==='"'&&(d=!d),l)).join("");return this.url.searchParams.set("select",m),n&&this.headers.append("Prefer",`count=${n}`),new Oh.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:r,defaultToNull:n=!0}={}){var c;const d="POST";if(r&&this.headers.append("Prefer",`count=${r}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const m=e.reduce((l,w)=>l.concat(Object.keys(w)),[]);if(m.length>0){const l=[...new Set(m)].map(w=>`"${w}"`);this.url.searchParams.set("columns",l.join(","))}}return new Oh.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}upsert(e,{onConflict:r,ignoreDuplicates:n=!1,count:c,defaultToNull:d=!0}={}){var m;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),r!==void 0&&this.url.searchParams.set("on_conflict",r),c&&this.headers.append("Prefer",`count=${c}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const w=e.reduce((k,P)=>k.concat(Object.keys(P)),[]);if(w.length>0){const k=[...new Set(w)].map(P=>`"${P}"`);this.url.searchParams.set("columns",k.join(","))}}return new Oh.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}update(e,{count:r}={}){var n;const c="PATCH";return r&&this.headers.append("Prefer",`count=${r}`),new Oh.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:e}={}){var r;const n="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Oh.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}};Qm.default=sN;var HT=Ji&&Ji.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Yx,"__esModule",{value:!0});const iN=HT(Qm),nN=HT(Hd);let aN=class KT{constructor(e,{headers:r={},schema:n,fetch:c}={}){this.url=e,this.headers=new Headers(r),this.schemaName=n,this.fetch=c}from(e){const r=new URL(`${this.url}/${e}`);return new iN.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new KT(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:n=!1,get:c=!1,count:d}={}){var m;let l;const w=new URL(`${this.url}/rpc/${e}`);let k;n||c?(l=n?"HEAD":"GET",Object.entries(r).filter(([j,L])=>L!==void 0).map(([j,L])=>[j,Array.isArray(L)?`{${L.join(",")}}`:`${L}`]).forEach(([j,L])=>{w.searchParams.append(j,L)})):(l="POST",k=r);const P=new Headers(this.headers);return d&&P.set("Prefer",`count=${d}`),new nN.default({method:l,url:w,headers:P,schema:this.schemaName,body:k,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}};Yx.default=aN;var _u=Ji&&Ji.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ni,"__esModule",{value:!0});Ni.PostgrestError=Ni.PostgrestBuilder=Ni.PostgrestTransformBuilder=Ni.PostgrestFilterBuilder=Ni.PostgrestQueryBuilder=Ni.PostgrestClient=void 0;const XT=_u(Yx);Ni.PostgrestClient=XT.default;const YT=_u(Qm);Ni.PostgrestQueryBuilder=YT.default;const JT=_u(Hd);Ni.PostgrestFilterBuilder=JT.default;const QT=_u(eg);Ni.PostgrestTransformBuilder=QT.default;const eE=_u(tg);Ni.PostgrestBuilder=eE.default;const tE=_u(rg);Ni.PostgrestError=tE.default;var oN=Ni.default={PostgrestClient:XT.default,PostgrestQueryBuilder:YT.default,PostgrestFilterBuilder:JT.default,PostgrestTransformBuilder:QT.default,PostgrestBuilder:eE.default,PostgrestError:tE.default};const{PostgrestClient:lN,PostgrestQueryBuilder:rO,PostgrestFilterBuilder:sO,PostgrestTransformBuilder:iO,PostgrestBuilder:nO,PostgrestError:aO}=oN;class cN{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const r=parseInt(process.versions.node.split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const n=this.getWebSocketConstructor();return new n(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const uN="2.15.1",hN=`realtime-js/${uN}`,dN="1.0.0",mv=1e4,fN=1e3,pN=100;var nd;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(nd||(nd={}));var xs;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(xs||(xs={}));var $n;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})($n||($n={}));var gv;(function(t){t.websocket="websocket"})(gv||(gv={}));var _l;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(_l||(_l={}));class mN{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const c=r.getUint8(1),d=r.getUint8(2);let m=this.HEADER_LENGTH+2;const l=n.decode(e.slice(m,m+c));m=m+c;const w=n.decode(e.slice(m,m+d));m=m+d;const k=JSON.parse(n.decode(e.slice(m,e.byteLength)));return{ref:null,topic:l,event:w,payload:k}}}class rE{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var kr;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(kr||(kr={}));const F1=(t,e,r={})=>{var n;const c=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((d,m)=>(d[m]=gN(m,t,e,c),d),{})},gN=(t,e,r,n)=>{const c=e.find(l=>l.name===t),d=c==null?void 0:c.type,m=r[t];return d&&!n.includes(d)?sE(d,m):yv(m)},sE=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return xN(e,r)}switch(t){case kr.bool:return yN(e);case kr.float4:case kr.float8:case kr.int2:case kr.int4:case kr.int8:case kr.numeric:case kr.oid:return _N(e);case kr.json:case kr.jsonb:return vN(e);case kr.timestamp:return bN(e);case kr.abstime:case kr.date:case kr.daterange:case kr.int4range:case kr.int8range:case kr.money:case kr.reltime:case kr.text:case kr.time:case kr.timestamptz:case kr.timetz:case kr.tsrange:case kr.tstzrange:return yv(e);default:return yv(e)}},yv=t=>t,yN=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},_N=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},vN=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},xN=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let d;const m=t.slice(1,r);try{d=JSON.parse("["+m+"]")}catch{d=m?m.split(","):[]}return d.map(l=>sE(e,l))}return t},bN=t=>typeof t=="string"?t.replace(" ","T"):t,iE=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Gy{constructor(e,r,n={},c=mv){this.channel=e,this.event=r,this.payload=n,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var $1;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})($1||($1={}));class ad{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},c=>{const{onJoin:d,onLeave:m,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ad.syncState(this.state,c,d,m),this.pendingDiffs.forEach(w=>{this.state=ad.syncDiff(this.state,w,d,m)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},c=>{const{onJoin:d,onLeave:m,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=ad.syncDiff(this.state,c,d,m),l())}),this.onJoin((c,d,m)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:d,newPresences:m})}),this.onLeave((c,d,m)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:d,leftPresences:m})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,c){const d=this.cloneDeep(e),m=this.transformState(r),l={},w={};return this.map(d,(k,P)=>{m[k]||(w[k]=P)}),this.map(m,(k,P)=>{const j=d[k];if(j){const L=P.map(de=>de.presence_ref),Z=j.map(de=>de.presence_ref),Y=P.filter(de=>Z.indexOf(de.presence_ref)<0),ce=j.filter(de=>L.indexOf(de.presence_ref)<0);Y.length>0&&(l[k]=Y),ce.length>0&&(w[k]=ce)}else l[k]=P}),this.syncDiff(d,{joins:l,leaves:w},n,c)}static syncDiff(e,r,n,c){const{joins:d,leaves:m}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),c||(c=()=>{}),this.map(d,(l,w)=>{var k;const P=(k=e[l])!==null&&k!==void 0?k:[];if(e[l]=this.cloneDeep(w),P.length>0){const j=e[l].map(Z=>Z.presence_ref),L=P.filter(Z=>j.indexOf(Z.presence_ref)<0);e[l].unshift(...L)}n(l,P,w)}),this.map(m,(l,w)=>{let k=e[l];if(!k)return;const P=w.map(j=>j.presence_ref);k=k.filter(j=>P.indexOf(j.presence_ref)<0),e[l]=k,c(l,k,w),k.length===0&&delete e[l]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const c=e[n];return"metas"in c?r[n]=c.metas.map(d=>(d.presence_ref=d.phx_ref,delete d.phx_ref,delete d.phx_ref_prev,d)):r[n]=c,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var U1;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(U1||(U1={}));var od;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(od||(od={}));var Na;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Na||(Na={}));class Jx{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=xs.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Gy(this,$n.join,this.params,this.timeout),this.rejoinTimer=new rE(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=xs.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=xs.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=xs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=xs.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=xs.errored,this.rejoinTimer.scheduleTimeout())}),this._on($n.reply,{},(c,d)=>{this._trigger(this._replyEventName(d),c)}),this.presence=new ad(this),this.broadcastEndpointURL=iE(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,c;if(this.socket.isConnected()||this.socket.connect(),this.state==xs.closed){const{config:{broadcast:d,presence:m,private:l}}=this.params,w=(c=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(L=>L.filter))!==null&&c!==void 0?c:[],k=!!this.bindings[od.PRESENCE]&&this.bindings[od.PRESENCE].length>0,P={},j={broadcast:d,presence:Object.assign(Object.assign({},m),{enabled:k}),postgres_changes:w,private:l};this.socket.accessTokenValue&&(P.access_token=this.socket.accessTokenValue),this._onError(L=>e==null?void 0:e(Na.CHANNEL_ERROR,L)),this._onClose(()=>e==null?void 0:e(Na.CLOSED)),this.updateJoinPayload(Object.assign({config:j},P)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:L})=>{var Z;if(this.socket.setAuth(),L===void 0){e==null||e(Na.SUBSCRIBED);return}else{const Y=this.bindings.postgres_changes,ce=(Z=Y==null?void 0:Y.length)!==null&&Z!==void 0?Z:0,de=[];for(let G=0;G<ce;G++){const H=Y[G],{filter:{event:W,schema:ue,table:me,filter:be}}=H,Ce=L&&L[G];if(Ce&&Ce.event===W&&Ce.schema===ue&&Ce.table===me&&Ce.filter===be)de.push(Object.assign(Object.assign({},H),{id:Ce.id}));else{this.unsubscribe(),this.state=xs.errored,e==null||e(Na.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=de,e&&e(Na.SUBSCRIBED);return}}).receive("error",L=>{this.state=xs.errored,e==null||e(Na.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(L).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Na.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this.state===xs.joined&&e===od.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,r,n)}async send(e,r={}){var n,c;if(!this._canPush()&&e.type==="broadcast"){const{event:d,payload:m}=e,w={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:d,payload:m,private:this.private}]})};try{const k=await this._fetchWithTimeout(this.broadcastEndpointURL,w,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((c=k.body)===null||c===void 0?void 0:c.cancel()),k.ok?"ok":"error"}catch(k){return k.name==="AbortError"?"timed out":"error"}}else return new Promise(d=>{var m,l,w;const k=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((w=(l=(m=this.params)===null||m===void 0?void 0:m.config)===null||l===void 0?void 0:l.broadcast)===null||w===void 0)&&w.ack)&&d("ok"),k.receive("ok",()=>d("ok")),k.receive("error",()=>d("error")),k.receive("timeout",()=>d("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=xs.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger($n.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(c=>{n=new Gy(this,$n.leave,{},e),n.receive("ok",()=>{r(),c("ok")}).receive("timeout",()=>{r(),c("timed out")}).receive("error",()=>{c("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=xs.closed,this.bindings={}}async _fetchWithTimeout(e,r,n){const c=new AbortController,d=setTimeout(()=>c.abort(),n),m=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:c.signal}));return clearTimeout(d),m}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new Gy(this,e,r,n);return this._canPush()?c.send():this._addToPushBuffer(c),c}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>pN){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var c,d;const m=e.toLocaleLowerCase(),{close:l,error:w,leave:k,join:P}=$n;if(n&&[l,w,k,P].indexOf(m)>=0&&n!==this._joinRef())return;let L=this._onMessage(m,r,n);if(r&&!L)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(m)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(Z=>{var Y,ce,de;return((Y=Z.filter)===null||Y===void 0?void 0:Y.event)==="*"||((de=(ce=Z.filter)===null||ce===void 0?void 0:ce.event)===null||de===void 0?void 0:de.toLocaleLowerCase())===m}).map(Z=>Z.callback(L,n)):(d=this.bindings[m])===null||d===void 0||d.filter(Z=>{var Y,ce,de,G,H,W;if(["broadcast","presence","postgres_changes"].includes(m))if("id"in Z){const ue=Z.id,me=(Y=Z.filter)===null||Y===void 0?void 0:Y.event;return ue&&((ce=r.ids)===null||ce===void 0?void 0:ce.includes(ue))&&(me==="*"||(me==null?void 0:me.toLocaleLowerCase())===((de=r.data)===null||de===void 0?void 0:de.type.toLocaleLowerCase()))}else{const ue=(H=(G=Z==null?void 0:Z.filter)===null||G===void 0?void 0:G.event)===null||H===void 0?void 0:H.toLocaleLowerCase();return ue==="*"||ue===((W=r==null?void 0:r.event)===null||W===void 0?void 0:W.toLocaleLowerCase())}else return Z.type.toLocaleLowerCase()===m}).map(Z=>{if(typeof L=="object"&&"ids"in L){const Y=L.data,{schema:ce,table:de,commit_timestamp:G,type:H,errors:W}=Y;L=Object.assign(Object.assign({},{schema:ce,table:de,commit_timestamp:G,eventType:H,new:{},old:{},errors:W}),this._getPayloadRecords(Y))}Z.callback(L,n)})}_isClosed(){return this.state===xs.closed}_isJoined(){return this.state===xs.joined}_isJoining(){return this.state===xs.joining}_isLeaving(){return this.state===xs.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const c=e.toLocaleLowerCase(),d={type:c,filter:r,callback:n};return this.bindings[c]?this.bindings[c].push(d):this.bindings[c]=[d],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(c=>{var d;return!(((d=c.type)===null||d===void 0?void 0:d.toLocaleLowerCase())===n&&Jx.isEqual(c.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on($n.close,{},e)}_onError(e){this._on($n.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=xs.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=F1(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=F1(e.columns,e.old_record)),r}}const V1=()=>{},Tp={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},wN=[1e3,2e3,5e3,1e4],SN=1e4,kN=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class TN{constructor(e,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=mv,this.transport=null,this.heartbeatIntervalMs=Tp.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=V1,this.ref=0,this.reconnectTimer=null,this.logger=V1,this.conn=null,this.sendBuffer=[],this.serializer=new mN,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=c=>{let d;return c?d=c:typeof fetch>"u"?d=(...m)=>Zd(async()=>{const{default:l}=await Promise.resolve().then(()=>yu);return{default:l}},void 0).then(({default:l})=>l(...m)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):d=fetch,(...m)=>d(...m)},!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${gv.websocket}`,this.httpEndpoint=iE(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=cN.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:dN}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case nd.connecting:return _l.Connecting;case nd.open:return _l.Open;case nd.closing:return _l.Closing;default:return _l.Closed}}isConnected(){return this.connectionState()===_l.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const n=`realtime:${e}`,c=this.getChannels().find(d=>d.topic===n);if(c)return c;{const d=new Jx(`realtime:${e}`,r,this);return this.channels.push(d),d}}push(e){const{topic:r,event:n,payload:c,ref:d}=e,m=()=>{this.encode(e,l=>{var w;(w=this.conn)===null||w===void 0||w.send(l)})};this.log("push",`${r} ${n} (${d})`,c),this.isConnected()?m():this.sendBuffer.push(m)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(fN,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},Tp.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{r.topic==="phoenix"&&r.event==="phx_reply"&&this.heartbeatCallback(r.payload.status==="ok"?"ok":"error"),r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:c,payload:d,ref:m}=r,l=m?`(${m})`:"",w=d.status||"";this.log("receive",`${w} ${n} ${c} ${l}`.trim(),d),this.channels.filter(k=>k._isMember(n)).forEach(k=>k._trigger(c,d,m)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger($n.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",c=new URLSearchParams(r);return`${e}${n}${c}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([kN],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r;e?r=e:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const c={access_token:r,version:hN};r&&n.updateJoinPayload(c),n.joinedOnce&&n._isJoined()&&n._push($n.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(r)}catch(c){this.log("error",`error in ${e} callback`,c)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new rE(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Tp.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,n,c,d,m,l,w,k;if(this.transport=(r=e==null?void 0:e.transport)!==null&&r!==void 0?r:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:mv,this.heartbeatIntervalMs=(c=e==null?void 0:e.heartbeatIntervalMs)!==null&&c!==void 0?c:Tp.HEARTBEAT_INTERVAL,this.worker=(d=e==null?void 0:e.worker)!==null&&d!==void 0?d:!1,this.accessToken=(m=e==null?void 0:e.accessToken)!==null&&m!==void 0?m:null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:P=>wN[P-1]||SN,this.encode=(w=e==null?void 0:e.encode)!==null&&w!==void 0?w:(P,j)=>j(JSON.stringify(P)),this.decode=(k=e==null?void 0:e.decode)!==null&&k!==void 0?k:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Qx extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function bs(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class EN extends Qx{constructor(e,r,n){super(e),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class _v extends Qx{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var CN=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};const nE=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Zd(async()=>{const{default:n}=await Promise.resolve().then(()=>yu);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},AN=()=>CN(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Zd(()=>Promise.resolve().then(()=>yu),void 0)).Response:Response}),vv=t=>{if(Array.isArray(t))return t.map(r=>vv(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const c=r.replace(/([-_][a-z])/gi,d=>d.toUpperCase().replace(/[-_]/g,""));e[c]=vv(n)}),e},PN=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var zl=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};const Wy=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),IN=(t,e,r)=>zl(void 0,void 0,void 0,function*(){const n=yield AN();t instanceof n&&!(r!=null&&r.noResolveJson)?t.json().then(c=>{const d=t.status||500,m=(c==null?void 0:c.statusCode)||d+"";e(new EN(Wy(c),d,m))}).catch(c=>{e(new _v(Wy(c),c))}):e(new _v(Wy(t),t))}),MN=(t,e,r,n)=>{const c={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!n?c:(PN(n)?(c.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),c.body=JSON.stringify(n)):c.body=n,e!=null&&e.duplex&&(c.duplex=e.duplex),Object.assign(Object.assign({},c),r))};function Kd(t,e,r,n,c,d){return zl(this,void 0,void 0,function*(){return new Promise((m,l)=>{t(r,MN(e,n,c,d)).then(w=>{if(!w.ok)throw w;return n!=null&&n.noResolveJson?w:w.json()}).then(w=>m(w)).catch(w=>IN(w,l,n))})})}function Am(t,e,r,n){return zl(this,void 0,void 0,function*(){return Kd(t,"GET",e,r,n)})}function oa(t,e,r,n,c){return zl(this,void 0,void 0,function*(){return Kd(t,"POST",e,n,c,r)})}function xv(t,e,r,n,c){return zl(this,void 0,void 0,function*(){return Kd(t,"PUT",e,n,c,r)})}function jN(t,e,r,n){return zl(this,void 0,void 0,function*(){return Kd(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function aE(t,e,r,n,c){return zl(this,void 0,void 0,function*(){return Kd(t,"DELETE",e,n,c,r)})}var pi=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};const DN={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},q1={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class NN{constructor(e,r={},n,c){this.url=e,this.headers=r,this.bucketId=n,this.fetch=nE(c)}uploadOrUpdate(e,r,n,c){return pi(this,void 0,void 0,function*(){try{let d;const m=Object.assign(Object.assign({},q1),c);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(m.upsert)});const w=m.metadata;typeof Blob<"u"&&n instanceof Blob?(d=new FormData,d.append("cacheControl",m.cacheControl),w&&d.append("metadata",this.encodeMetadata(w)),d.append("",n)):typeof FormData<"u"&&n instanceof FormData?(d=n,d.append("cacheControl",m.cacheControl),w&&d.append("metadata",this.encodeMetadata(w))):(d=n,l["cache-control"]=`max-age=${m.cacheControl}`,l["content-type"]=m.contentType,w&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(w)))),c!=null&&c.headers&&(l=Object.assign(Object.assign({},l),c.headers));const k=this._removeEmptyFolders(r),P=this._getFinalPath(k),j=yield(e=="PUT"?xv:oa)(this.fetch,`${this.url}/object/${P}`,d,Object.assign({headers:l},m!=null&&m.duplex?{duplex:m.duplex}:{}));return{data:{path:k,id:j.Id,fullPath:j.Key},error:null}}catch(d){if(bs(d))return{data:null,error:d};throw d}})}upload(e,r,n){return pi(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,c){return pi(this,void 0,void 0,function*(){const d=this._removeEmptyFolders(e),m=this._getFinalPath(d),l=new URL(this.url+`/object/upload/sign/${m}`);l.searchParams.set("token",r);try{let w;const k=Object.assign({upsert:q1.upsert},c),P=Object.assign(Object.assign({},this.headers),{"x-upsert":String(k.upsert)});typeof Blob<"u"&&n instanceof Blob?(w=new FormData,w.append("cacheControl",k.cacheControl),w.append("",n)):typeof FormData<"u"&&n instanceof FormData?(w=n,w.append("cacheControl",k.cacheControl)):(w=n,P["cache-control"]=`max-age=${k.cacheControl}`,P["content-type"]=k.contentType);const j=yield xv(this.fetch,l.toString(),w,{headers:P});return{data:{path:d,fullPath:j.Key},error:null}}catch(w){if(bs(w))return{data:null,error:w};throw w}})}createSignedUploadUrl(e,r){return pi(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const c=Object.assign({},this.headers);r!=null&&r.upsert&&(c["x-upsert"]="true");const d=yield oa(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:c}),m=new URL(this.url+d.url),l=m.searchParams.get("token");if(!l)throw new Qx("No token returned by API");return{data:{signedUrl:m.toString(),path:e,token:l},error:null}}catch(n){if(bs(n))return{data:null,error:n};throw n}})}update(e,r,n){return pi(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return pi(this,void 0,void 0,function*(){try{return{data:yield oa(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(c){if(bs(c))return{data:null,error:c};throw c}})}copy(e,r,n){return pi(this,void 0,void 0,function*(){try{return{data:{path:(yield oa(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(c){if(bs(c))return{data:null,error:c};throw c}})}createSignedUrl(e,r,n){return pi(this,void 0,void 0,function*(){try{let c=this._getFinalPath(e),d=yield oa(this.fetch,`${this.url}/object/sign/${c}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const m=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return d={signedUrl:encodeURI(`${this.url}${d.signedURL}${m}`)},{data:d,error:null}}catch(c){if(bs(c))return{data:null,error:c};throw c}})}createSignedUrls(e,r,n){return pi(this,void 0,void 0,function*(){try{const c=yield oa(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),d=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:c.map(m=>Object.assign(Object.assign({},m),{signedUrl:m.signedURL?encodeURI(`${this.url}${m.signedURL}${d}`):null})),error:null}}catch(c){if(bs(c))return{data:null,error:c};throw c}})}download(e,r){return pi(this,void 0,void 0,function*(){const c=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",d=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),m=d?`?${d}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield Am(this.fetch,`${this.url}/${c}/${l}${m}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(bs(l))return{data:null,error:l};throw l}})}info(e){return pi(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield Am(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:vv(n),error:null}}catch(n){if(bs(n))return{data:null,error:n};throw n}})}exists(e){return pi(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield jN(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(bs(n)&&n instanceof _v){const c=n.originalError;if([400,404].includes(c==null?void 0:c.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),c=[],d=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";d!==""&&c.push(d);const l=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",w=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});w!==""&&c.push(w);let k=c.join("&");return k!==""&&(k=`?${k}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${k}`)}}}remove(e){return pi(this,void 0,void 0,function*(){try{return{data:yield aE(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(bs(r))return{data:null,error:r};throw r}})}list(e,r,n){return pi(this,void 0,void 0,function*(){try{const c=Object.assign(Object.assign(Object.assign({},DN),r),{prefix:e||""});return{data:yield oa(this.fetch,`${this.url}/object/list/${this.bucketId}`,c,{headers:this.headers},n),error:null}}catch(c){if(bs(c))return{data:null,error:c};throw c}})}listV2(e,r){return pi(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield oa(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(bs(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const LN="2.11.0",RN={"X-Client-Info":`storage-js/${LN}`};var kc=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};class zN{constructor(e,r={},n,c){const d=new URL(e);c!=null&&c.useNewHostname&&/supabase\.(co|in|red)$/.test(d.hostname)&&!d.hostname.includes("storage.supabase.")&&(d.hostname=d.hostname.replace("supabase.","storage.supabase.")),this.url=d.href,this.headers=Object.assign(Object.assign({},RN),r),this.fetch=nE(n)}listBuckets(){return kc(this,void 0,void 0,function*(){try{return{data:yield Am(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(bs(e))return{data:null,error:e};throw e}})}getBucket(e){return kc(this,void 0,void 0,function*(){try{return{data:yield Am(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(bs(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return kc(this,void 0,void 0,function*(){try{return{data:yield oa(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(bs(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return kc(this,void 0,void 0,function*(){try{return{data:yield xv(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(bs(n))return{data:null,error:n};throw n}})}emptyBucket(e){return kc(this,void 0,void 0,function*(){try{return{data:yield oa(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(bs(r))return{data:null,error:r};throw r}})}deleteBucket(e){return kc(this,void 0,void 0,function*(){try{return{data:yield aE(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(bs(r))return{data:null,error:r};throw r}})}}class BN extends zN{constructor(e,r={},n,c){super(e,r,n,c)}from(e){return new NN(this.url,this.headers,e,this.fetch)}}const ON="2.56.0";let Zh="";typeof Deno<"u"?Zh="deno":typeof document<"u"?Zh="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Zh="react-native":Zh="node";const FN={"X-Client-Info":`supabase-js-${Zh}/${ON}`},$N={headers:FN},UN={schema:"public"},VN={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},qN={};var GN=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};const WN=t=>{let e;return t?e=t:typeof fetch>"u"?e=GT:e=fetch,(...r)=>e(...r)},ZN=()=>typeof Headers>"u"?WT:Headers,HN=(t,e,r)=>{const n=WN(r),c=ZN();return(d,m)=>GN(void 0,void 0,void 0,function*(){var l;const w=(l=yield e())!==null&&l!==void 0?l:t;let k=new c(m==null?void 0:m.headers);return k.has("apikey")||k.set("apikey",t),k.has("Authorization")||k.set("Authorization",`Bearer ${w}`),n(d,Object.assign(Object.assign({},m),{headers:k}))})};var KN=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};function XN(t){return t.endsWith("/")?t:t+"/"}function YN(t,e){var r,n;const{db:c,auth:d,realtime:m,global:l}=t,{db:w,auth:k,realtime:P,global:j}=e,L={db:Object.assign(Object.assign({},w),c),auth:Object.assign(Object.assign({},k),d),realtime:Object.assign(Object.assign({},P),m),storage:{},global:Object.assign(Object.assign(Object.assign({},j),l),{headers:Object.assign(Object.assign({},(r=j==null?void 0:j.headers)!==null&&r!==void 0?r:{}),(n=l==null?void 0:l.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>KN(this,void 0,void 0,function*(){return""})};return t.accessToken?L.accessToken=t.accessToken:delete L.accessToken,L}const oE="2.71.1",Pc=30*1e3,bv=3,Zy=bv*Pc,JN="http://localhost:9999",QN="supabase.auth.token",eL={"X-Client-Info":`gotrue-js/${oE}`},wv="X-Supabase-Api-Version",lE={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},tL=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,rL=10*60*1e3;class e0 extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function Ft(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class sL extends e0{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function iL(t){return Ft(t)&&t.name==="AuthApiError"}class cE extends e0{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class Uo extends e0{constructor(e,r,n,c){super(e,n,c),this.name=r,this.status=n}}class mo extends Uo{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function nL(t){return Ft(t)&&t.name==="AuthSessionMissingError"}class Ep extends Uo{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Cp extends Uo{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ap extends Uo{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function aL(t){return Ft(t)&&t.name==="AuthImplicitGrantRedirectError"}class G1 extends Uo{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Sv extends Uo{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Hy(t){return Ft(t)&&t.name==="AuthRetryableFetchError"}class W1 extends Uo{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class kv extends Uo{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Pm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Z1=` 	
\r=`.split(""),oL=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Z1.length;e+=1)t[Z1[e].charCodeAt(0)]=-2;for(let e=0;e<Pm.length;e+=1)t[Pm[e].charCodeAt(0)]=e;return t})();function H1(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Pm[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Pm[n]),e.queuedBits-=6}}function uE(t,e,r){const n=oL[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function K1(t){const e=[],r=m=>{e.push(String.fromCodePoint(m))},n={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},d=m=>{uL(m,n,r)};for(let m=0;m<t.length;m+=1)uE(t.charCodeAt(m),c,d);return e.join("")}function lL(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function cL(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const c=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|c)+65536,r+=1}lL(n,e)}}function uL(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if(!(t>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function hL(t){const e=[],r={queue:0,queuedBits:0},n=c=>{e.push(c)};for(let c=0;c<t.length;c+=1)uE(t.charCodeAt(c),r,n);return new Uint8Array(e)}function dL(t){const e=[];return cL(t,r=>e.push(r)),new Uint8Array(e)}function fL(t){const e=[],r={queue:0,queuedBits:0},n=c=>{e.push(c)};return t.forEach(c=>H1(c,r,n)),H1(null,r,n),e.join("")}function pL(t){return Math.round(Date.now()/1e3)+t}function mL(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const zn=()=>typeof window<"u"&&typeof document<"u",hl={tested:!1,writable:!1},hE=()=>{if(!zn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(hl.tested)return hl.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),hl.tested=!0,hl.writable=!0}catch{hl.tested=!0,hl.writable=!1}return hl.writable};function gL(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((c,d)=>{e[d]=c})}catch{}return r.searchParams.forEach((n,c)=>{e[c]=n}),e}const dE=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>Zd(async()=>{const{default:n}=await Promise.resolve().then(()=>yu);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},yL=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Ic=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},dl=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},po=async(t,e)=>{await t.removeItem(e)};class sg{constructor(){this.promise=new sg.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}sg.promiseConstructor=Promise;function Ky(t){const e=t.split(".");if(e.length!==3)throw new kv("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!tL.test(e[n]))throw new kv("JWT not in base64url format");return{header:JSON.parse(K1(e[0])),payload:JSON.parse(K1(e[1])),signature:hL(e[2]),raw:{header:e[0],payload:e[1]}}}async function _L(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function vL(t,e){return new Promise((n,c)=>{(async()=>{for(let d=0;d<1/0;d++)try{const m=await t(d);if(!e(d,null,m)){n(m);return}}catch(m){if(!e(d,m)){c(m);return}}})()})}function xL(t){return("0"+t.toString(16)).substr(-2)}function bL(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let c="";for(let d=0;d<56;d++)c+=r.charAt(Math.floor(Math.random()*n));return c}return crypto.getRandomValues(e),Array.from(e,xL).join("")}async function wL(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),c=new Uint8Array(n);return Array.from(c).map(d=>String.fromCharCode(d)).join("")}async function SL(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await wL(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Tc(t,e,r=!1){const n=bL();let c=n;r&&(c+="/PASSWORD_RECOVERY"),await Ic(t,`${e}-code-verifier`,c);const d=await SL(n);return[d,n===d?"plain":"s256"]}const kL=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function TL(t){const e=t.headers.get(wv);if(!e||!e.match(kL))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function EL(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function CL(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const AL=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ec(t){if(!AL.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Xy(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function X1(t){return JSON.parse(JSON.stringify(t))}var PL=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)e.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(r[n[c]]=t[n[c]]);return r};const gl=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),IL=[502,503,504];async function Y1(t){var e;if(!yL(t))throw new Sv(gl(t),0);if(IL.includes(t.status))throw new Sv(gl(t),t.status);let r;try{r=await t.json()}catch(d){throw new cE(gl(d),d)}let n;const c=TL(t);if(c&&c.getTime()>=lE["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new W1(gl(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new mo}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((d,m)=>d&&typeof m=="string",!0))throw new W1(gl(r),t.status,r.weak_password.reasons);throw new sL(gl(r),t.status||500,n)}const ML=(t,e,r,n)=>{const c={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),c.body=JSON.stringify(n),Object.assign(Object.assign({},c),r))};async function Kt(t,e,r,n){var c;const d=Object.assign({},n==null?void 0:n.headers);d[wv]||(d[wv]=lE["2024-01-01"].name),n!=null&&n.jwt&&(d.Authorization=`Bearer ${n.jwt}`);const m=(c=n==null?void 0:n.query)!==null&&c!==void 0?c:{};n!=null&&n.redirectTo&&(m.redirect_to=n.redirectTo);const l=Object.keys(m).length?"?"+new URLSearchParams(m).toString():"",w=await jL(t,e,r+l,{headers:d,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(w):{data:Object.assign({},w),error:null}}async function jL(t,e,r,n,c,d){const m=ML(e,n,c,d);let l;try{l=await t(r,Object.assign({},m))}catch(w){throw console.error(w),new Sv(gl(w),0)}if(l.ok||await Y1(l),n!=null&&n.noResolveJson)return l;try{return await l.json()}catch(w){await Y1(w)}}function ja(t){var e;let r=null;RL(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=pL(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function J1(t){const e=ja(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function bo(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function DL(t){return{data:t,error:null}}function NL(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:c,verification_type:d}=t,m=PL(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:r,hashed_token:n,redirect_to:c,verification_type:d},w=Object.assign({},m);return{data:{properties:l,user:w},error:null}}function LL(t){return t}function RL(t){return t.access_token&&t.refresh_token&&t.expires_in}const Yy=["global","local","others"];var zL=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,n=Object.getOwnPropertySymbols(t);c<n.length;c++)e.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(t,n[c])&&(r[n[c]]=t[n[c]]);return r};class BL{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=dE(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=Yy[0]){if(Yy.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Yy.join(", ")}`);try{return await Kt(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Ft(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await Kt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:bo})}catch(n){if(Ft(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=zL(e,["options"]),c=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(c.new_email=n==null?void 0:n.newEmail,delete c.newEmail),await Kt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:NL,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(Ft(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await Kt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:bo})}catch(r){if(Ft(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,c,d,m,l,w;try{const k={nextPage:null,lastPage:0,total:0},P=await Kt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(d=(c=e==null?void 0:e.perPage)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""},xform:LL});if(P.error)throw P.error;const j=await P.json(),L=(m=P.headers.get("x-total-count"))!==null&&m!==void 0?m:0,Z=(w=(l=P.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&w!==void 0?w:[];return Z.length>0&&(Z.forEach(Y=>{const ce=parseInt(Y.split(";")[0].split("=")[1].substring(0,1)),de=JSON.parse(Y.split(";")[1].split("=")[1]);k[`${de}Page`]=ce}),k.total=parseInt(L)),{data:Object.assign(Object.assign({},j),k),error:null}}catch(k){if(Ft(k))return{data:{users:[]},error:k};throw k}}async getUserById(e){Ec(e);try{return await Kt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:bo})}catch(r){if(Ft(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Ec(e);try{return await Kt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:bo})}catch(n){if(Ft(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){Ec(e);try{return await Kt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:bo})}catch(n){if(Ft(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Ec(e.userId);try{const{data:r,error:n}=await Kt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:r,error:n}}catch(r){if(Ft(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Ec(e.userId),Ec(e.id);try{return{data:await Kt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(Ft(r))return{data:null,error:r};throw r}}}function Q1(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function OL(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Cc={debug:!!(globalThis&&hE()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fE extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class FL extends fE{}async function $L(t,e,r){Cc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Cc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async c=>{if(c){Cc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,c.name);try{return await r()}finally{Cc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,c.name)}}else{if(e===0)throw Cc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new FL(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Cc.debug)try{const d=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(d,null,"  "))}catch(d){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",d)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}OL();const UL={url:JN,storageKey:QN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:eL,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function eS(t,e,r){return await r()}const Ac={};class Dd{constructor(e){var r,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Dd.nextInstanceID,Dd.nextInstanceID+=1,this.instanceID>0&&zn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const c=Object.assign(Object.assign({},UL),e);if(this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.persistSession=c.persistSession,this.storageKey=c.storageKey,this.autoRefreshToken=c.autoRefreshToken,this.admin=new BL({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=dE(c.fetch),this.lock=c.lock||eS,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,c.lock?this.lock=c.lock:zn()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=$L:this.lock=eS,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(c.storage?this.storage=c.storage:hE()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Q1(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=Q1(this.memoryStorage)),zn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}get jwks(){var e,r;return(r=(e=Ac[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Ac[this.storageKey]=Object.assign(Object.assign({},Ac[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Ac[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ac[this.storageKey]=Object.assign(Object.assign({},Ac[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${oE}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=gL(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),zn()&&this.detectSessionInUrl&&n!=="none"){const{data:c,error:d}=await this._getSessionFromURL(r,n);if(d){if(this._debug("#_initialize()","error detecting session from URL",d),aL(d)){const w=(e=d.details)===null||e===void 0?void 0:e.code;if(w==="identity_already_exists"||w==="identity_not_found"||w==="single_identity_not_deletable")return{error:d}}return await this._removeSession(),{error:d}}const{session:m,redirectType:l}=c;return this._debug("#_initialize()","detected session in URL",m,"redirect type",l),await this._saveSession(m),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",m):await this._notifyAllSubscribers("SIGNED_IN",m)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Ft(r)?{error:r}:{error:new cE("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,c;try{const d=await Kt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(c=e==null?void 0:e.options)===null||c===void 0?void 0:c.captchaToken}},xform:ja}),{data:m,error:l}=d;if(l||!m)return{data:{user:null,session:null},error:l};const w=m.session,k=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",w)),{data:{user:k,session:w},error:null}}catch(d){if(Ft(d))return{data:{user:null,session:null},error:d};throw d}}async signUp(e){var r,n,c;try{let d;if("email"in e){const{email:P,password:j,options:L}=e;let Z=null,Y=null;this.flowType==="pkce"&&([Z,Y]=await Tc(this.storage,this.storageKey)),d=await Kt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:L==null?void 0:L.emailRedirectTo,body:{email:P,password:j,data:(r=L==null?void 0:L.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:L==null?void 0:L.captchaToken},code_challenge:Z,code_challenge_method:Y},xform:ja})}else if("phone"in e){const{phone:P,password:j,options:L}=e;d=await Kt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:P,password:j,data:(n=L==null?void 0:L.data)!==null&&n!==void 0?n:{},channel:(c=L==null?void 0:L.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:L==null?void 0:L.captchaToken}},xform:ja})}else throw new Cp("You must provide either an email or phone number and a password");const{data:m,error:l}=d;if(l||!m)return{data:{user:null,session:null},error:l};const w=m.session,k=m.user;return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",w)),{data:{user:k,session:w},error:null}}catch(d){if(Ft(d))return{data:{user:null,session:null},error:d};throw d}}async signInWithPassword(e){try{let r;if("email"in e){const{email:d,password:m,options:l}=e;r=await Kt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:d,password:m,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:J1})}else if("phone"in e){const{phone:d,password:m,options:l}=e;r=await Kt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:d,password:m,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:J1})}else throw new Cp("You must provide either an email or phone number and a password");const{data:n,error:c}=r;return c?{data:{user:null,session:null},error:c}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Ep}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:c})}catch(r){if(Ft(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,c,d;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(d=e.options)===null||d===void 0?void 0:d.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,c,d,m,l,w,k,P,j,L,Z;let Y,ce;if("message"in e)Y=e.message,ce=e.signature;else{const{chain:de,wallet:G,statement:H,options:W}=e;let ue;if(zn())if(typeof G=="object")ue=G;else{const be=window;if("solana"in be&&typeof be.solana=="object"&&("signIn"in be.solana&&typeof be.solana.signIn=="function"||"signMessage"in be.solana&&typeof be.solana.signMessage=="function"))ue=be.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof G!="object"||!(W!=null&&W.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ue=G}const me=new URL((r=W==null?void 0:W.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in ue&&ue.signIn){const be=await ue.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},W==null?void 0:W.signInWithSolana),{version:"1",domain:me.host,uri:me.href}),H?{statement:H}:null));let Ce;if(Array.isArray(be)&&be[0]&&typeof be[0]=="object")Ce=be[0];else if(be&&typeof be=="object"&&"signedMessage"in be&&"signature"in be)Ce=be;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Ce&&"signature"in Ce&&(typeof Ce.signedMessage=="string"||Ce.signedMessage instanceof Uint8Array)&&Ce.signature instanceof Uint8Array)Y=typeof Ce.signedMessage=="string"?Ce.signedMessage:new TextDecoder().decode(Ce.signedMessage),ce=Ce.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ue)||typeof ue.signMessage!="function"||!("publicKey"in ue)||typeof ue!="object"||!ue.publicKey||!("toBase58"in ue.publicKey)||typeof ue.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");Y=[`${me.host} wants you to sign in with your Solana account:`,ue.publicKey.toBase58(),...H?["",H,""]:[""],"Version: 1",`URI: ${me.href}`,`Issued At: ${(c=(n=W==null?void 0:W.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((d=W==null?void 0:W.signInWithSolana)===null||d===void 0)&&d.notBefore?[`Not Before: ${W.signInWithSolana.notBefore}`]:[],...!((m=W==null?void 0:W.signInWithSolana)===null||m===void 0)&&m.expirationTime?[`Expiration Time: ${W.signInWithSolana.expirationTime}`]:[],...!((l=W==null?void 0:W.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${W.signInWithSolana.chainId}`]:[],...!((w=W==null?void 0:W.signInWithSolana)===null||w===void 0)&&w.nonce?[`Nonce: ${W.signInWithSolana.nonce}`]:[],...!((k=W==null?void 0:W.signInWithSolana)===null||k===void 0)&&k.requestId?[`Request ID: ${W.signInWithSolana.requestId}`]:[],...!((j=(P=W==null?void 0:W.signInWithSolana)===null||P===void 0?void 0:P.resources)===null||j===void 0)&&j.length?["Resources",...W.signInWithSolana.resources.map(Ce=>`- ${Ce}`)]:[]].join(`
`);const be=await ue.signMessage(new TextEncoder().encode(Y),"utf8");if(!be||!(be instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");ce=be}}try{const{data:de,error:G}=await Kt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:Y,signature:fL(ce)},!((L=e.options)===null||L===void 0)&&L.captchaToken?{gotrue_meta_security:{captcha_token:(Z=e.options)===null||Z===void 0?void 0:Z.captchaToken}}:null),xform:ja});if(G)throw G;return!de||!de.session||!de.user?{data:{user:null,session:null},error:new Ep}:(de.session&&(await this._saveSession(de.session),await this._notifyAllSubscribers("SIGNED_IN",de.session)),{data:Object.assign({},de),error:G})}catch(de){if(Ft(de))return{data:{user:null,session:null},error:de};throw de}}async _exchangeCodeForSession(e){const r=await dl(this.storage,`${this.storageKey}-code-verifier`),[n,c]=(r??"").split("/");try{const{data:d,error:m}=await Kt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:ja});if(await po(this.storage,`${this.storageKey}-code-verifier`),m)throw m;return!d||!d.session||!d.user?{data:{user:null,session:null,redirectType:null},error:new Ep}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),{data:Object.assign(Object.assign({},d),{redirectType:c??null}),error:m})}catch(d){if(Ft(d))return{data:{user:null,session:null,redirectType:null},error:d};throw d}}async signInWithIdToken(e){try{const{options:r,provider:n,token:c,access_token:d,nonce:m}=e,l=await Kt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:c,access_token:d,nonce:m,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:ja}),{data:w,error:k}=l;return k?{data:{user:null,session:null},error:k}:!w||!w.session||!w.user?{data:{user:null,session:null},error:new Ep}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:w,error:k})}catch(r){if(Ft(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,c,d,m;try{if("email"in e){const{email:l,options:w}=e;let k=null,P=null;this.flowType==="pkce"&&([k,P]=await Tc(this.storage,this.storageKey));const{error:j}=await Kt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=w==null?void 0:w.data)!==null&&r!==void 0?r:{},create_user:(n=w==null?void 0:w.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},code_challenge:k,code_challenge_method:P},redirectTo:w==null?void 0:w.emailRedirectTo});return{data:{user:null,session:null},error:j}}if("phone"in e){const{phone:l,options:w}=e,{data:k,error:P}=await Kt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(c=w==null?void 0:w.data)!==null&&c!==void 0?c:{},create_user:(d=w==null?void 0:w.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},channel:(m=w==null?void 0:w.channel)!==null&&m!==void 0?m:"sms"}});return{data:{user:null,session:null,messageId:k==null?void 0:k.message_id},error:P}}throw new Cp("You must provide either an email or phone number.")}catch(l){if(Ft(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var r,n;try{let c,d;"options"in e&&(c=(r=e.options)===null||r===void 0?void 0:r.redirectTo,d=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:m,error:l}=await Kt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:d}}),redirectTo:c,xform:ja});if(l)throw l;if(!m)throw new Error("An error occurred on token verification.");const w=m.session,k=m.user;return w!=null&&w.access_token&&(await this._saveSession(w),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",w)),{data:{user:k,session:w},error:null}}catch(c){if(Ft(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithSSO(e){var r,n,c;try{let d=null,m=null;return this.flowType==="pkce"&&([d,m]=await Tc(this.storage,this.storageKey)),await Kt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((c=e==null?void 0:e.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:d,code_challenge_method:m}),headers:this.headers,xform:DL})}catch(d){if(Ft(d))return{data:null,error:d};throw d}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new mo;const{error:c}=await Kt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:c}})}catch(e){if(Ft(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:c,options:d}=e,{error:m}=await Kt(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},redirectTo:d==null?void 0:d.emailRedirectTo});return{data:{user:null,session:null},error:m}}else if("phone"in e){const{phone:n,type:c,options:d}=e,{data:m,error:l}=await Kt(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}}});return{data:{user:null,session:null,messageId:m==null?void 0:m.message_id},error:l}}throw new Cp("You must provide either an email or phone number and a type")}catch(r){if(Ft(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await dl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Zy:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const m=await dl(this.userStorage,this.storageKey+"-user");m!=null&&m.user?e.user=m.user:e.user=Xy()}if(this.storage.isServer&&e.user){let m=this.suppressGetSessionWarning;e=new Proxy(e,{get:(w,k,P)=>(!m&&k==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),m=!0,this.suppressGetSessionWarning=!0),Reflect.get(w,k,P))})}return{data:{session:e},error:null}}const{session:c,error:d}=await this._callRefreshToken(e.refresh_token);return d?{data:{session:null},error:d}:{data:{session:c},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Kt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:bo}):await this._useSession(async r=>{var n,c,d;const{data:m,error:l}=r;if(l)throw l;return!(!((n=m.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new mo}:await Kt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(d=(c=m.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0,xform:bo})})}catch(r){if(Ft(r))return nL(r)&&(await this._removeSession(),await po(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:c,error:d}=n;if(d)throw d;if(!c.session)throw new mo;const m=c.session;let l=null,w=null;this.flowType==="pkce"&&e.email!=null&&([l,w]=await Tc(this.storage,this.storageKey));const{data:k,error:P}=await Kt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:w}),jwt:m.access_token,xform:bo});if(P)throw P;return m.user=k.user,await this._saveSession(m),await this._notifyAllSubscribers("USER_UPDATED",m),{data:{user:m.user},error:null}})}catch(n){if(Ft(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new mo;const r=Date.now()/1e3;let n=r,c=!0,d=null;const{payload:m}=Ky(e.access_token);if(m.exp&&(n=m.exp,c=n<=r),c){const{session:l,error:w}=await this._callRefreshToken(e.refresh_token);if(w)return{data:{user:null,session:null},error:w};if(!l)return{data:{user:null,session:null},error:null};d=l}else{const{data:l,error:w}=await this._getUser(e.access_token);if(w)throw w;d={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)}return{data:{user:d.user,session:d},error:null}}catch(r){if(Ft(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:m,error:l}=r;if(l)throw l;e=(n=m.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new mo;const{session:c,error:d}=await this._callRefreshToken(e.refresh_token);return d?{data:{user:null,session:null},error:d}:c?{data:{user:c.user,session:c},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Ft(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!zn())throw new Ap("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ap(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new G1("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ap("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new G1("No code detected.");const{data:H,error:W}=await this._exchangeCodeForSession(e.code);if(W)throw W;const ue=new URL(window.location.href);return ue.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ue.toString()),{data:{session:H.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:c,access_token:d,refresh_token:m,expires_in:l,expires_at:w,token_type:k}=e;if(!d||!l||!m||!k)throw new Ap("No session defined in URL");const P=Math.round(Date.now()/1e3),j=parseInt(l);let L=P+j;w&&(L=parseInt(w));const Z=L-P;Z*1e3<=Pc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${Z}s, should have been closer to ${j}s`);const Y=L-j;P-Y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",Y,L,P):P-Y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",Y,L,P);const{data:ce,error:de}=await this._getUser(d);if(de)throw de;const G={provider_token:n,provider_refresh_token:c,access_token:d,expires_in:j,expires_at:L,refresh_token:m,token_type:k,user:ce.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:G,redirectType:e.type},error:null}}catch(n){if(Ft(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await dl(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:c,error:d}=r;if(d)return{error:d};const m=(n=c.session)===null||n===void 0?void 0:n.access_token;if(m){const{error:l}=await this.admin.signOut(m,e);if(l&&!(iL(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await po(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=mL(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,c;try{const{data:{session:d},error:m}=r;if(m)throw m;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",e,"session",d)}catch(d){await((c=this.stateChangeEmitters.get(e))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",d),console.error(d)}})}async resetPasswordForEmail(e,r={}){let n=null,c=null;this.flowType==="pkce"&&([n,c]=await Tc(this.storage,this.storageKey,!0));try{return await Kt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:c,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(d){if(Ft(d))return{data:null,error:d};throw d}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(Ft(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:c}=await this._useSession(async d=>{var m,l,w,k,P;const{data:j,error:L}=d;if(L)throw L;const Z=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(m=e.options)===null||m===void 0?void 0:m.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(w=e.options)===null||w===void 0?void 0:w.queryParams,skipBrowserRedirect:!0});return await Kt(this.fetch,"GET",Z,{headers:this.headers,jwt:(P=(k=j.session)===null||k===void 0?void 0:k.access_token)!==null&&P!==void 0?P:void 0})});if(c)throw c;return zn()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(Ft(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,c;const{data:d,error:m}=r;if(m)throw m;return await Kt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(c=(n=d.session)===null||n===void 0?void 0:n.access_token)!==null&&c!==void 0?c:void 0})})}catch(r){if(Ft(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await vL(async c=>(c>0&&await _L(200*Math.pow(2,c-1)),this._debug(r,"refreshing attempt",c),await Kt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ja})),(c,d)=>{const m=200*Math.pow(2,c);return d&&Hy(d)&&Date.now()+m-n<Pc})}catch(n){if(this._debug(r,"error",n),Ft(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),zn()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const c=await dl(this.storage,this.storageKey);if(c&&this.userStorage){let m=await dl(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!m&&(m={user:c.user},await Ic(this.userStorage,this.storageKey+"-user",m)),c.user=(e=m==null?void 0:m.user)!==null&&e!==void 0?e:Xy()}else if(c&&!c.user&&!c.user){const m=await dl(this.storage,this.storageKey+"-user");m&&(m!=null&&m.user)?(c.user=m.user,await po(this.storage,this.storageKey+"-user"),await Ic(this.storage,this.storageKey,c)):c.user=Xy()}if(this._debug(n,"session from storage",c),!this._isValidSession(c)){this._debug(n,"session is not valid"),c!==null&&await this._removeSession();return}const d=((r=c.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Zy;if(this._debug(n,`session has${d?"":" not"} expired with margin of ${Zy}s`),d){if(this.autoRefreshToken&&c.refresh_token){const{error:m}=await this._callRefreshToken(c.refresh_token);m&&(console.error(m),Hy(m)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",m),await this._removeSession()))}}else if(c.user&&c.user.__isUserNotAvailableProxy===!0)try{const{data:m,error:l}=await this._getUser(c.access_token);!l&&(m!=null&&m.user)?(c.user=m.user,await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(m){console.error("Error getting user data:",m),this._debug(n,"error getting user data, skipping SIGNED_IN notification",m)}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(c){this._debug(n,"error",c),console.error(c);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new mo;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new sg;const{data:d,error:m}=await this._refreshAccessToken(e);if(m)throw m;if(!d.session)throw new mo;await this._saveSession(d.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",d.session);const l={session:d.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(d){if(this._debug(c,"error",d),Ft(d)){const m={session:null,error:d};return Hy(d)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(m),m}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(d),d}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(e,r,n=!0){const c=`#_notifyAllSubscribers(${e})`;this._debug(c,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const d=[],m=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(w){d.push(w)}});if(await Promise.all(m),d.length>0){for(let l=0;l<d.length;l+=1)console.error(d[l]);throw d[0]}}finally{this._debug(c,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Ic(this.userStorage,this.storageKey+"-user",{user:r.user});const c=Object.assign({},r);delete c.user;const d=X1(c);await Ic(this.storage,this.storageKey,d)}else{const c=X1(r);await Ic(this.storage,this.storageKey,c)}}async _removeSession(){this._debug("#_removeSession()"),await po(this.storage,this.storageKey),await po(this.storage,this.storageKey+"-code-verifier"),await po(this.storage,this.storageKey+"-user"),this.userStorage&&await po(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&zn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Pc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((n.expires_at*1e3-e)/Pc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${Pc}ms, refresh threshold is ${bv} ticks`),c<=bv&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof fE)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!zn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const c=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&c.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&c.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[d,m]=await Tc(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(d)}`,code_challenge_method:`${encodeURIComponent(m)}`});c.push(l.toString())}if(n!=null&&n.queryParams){const d=new URLSearchParams(n.queryParams);c.push(d.toString())}return n!=null&&n.skipBrowserRedirect&&c.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${c.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:c,error:d}=r;return d?{data:null,error:d}:await Kt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=c==null?void 0:c.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Ft(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,c;const{data:d,error:m}=r;if(m)return{data:null,error:m};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:w,error:k}=await Kt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=d==null?void 0:d.session)===null||n===void 0?void 0:n.access_token});return k?{data:null,error:k}:(e.factorType==="totp"&&(!((c=w==null?void 0:w.totp)===null||c===void 0)&&c.qr_code)&&(w.totp.qr_code=`data:image/svg+xml;utf-8,${w.totp.qr_code}`),{data:w,error:null})})}catch(r){if(Ft(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:d}=r;if(d)return{data:null,error:d};const{data:m,error:l}=await Kt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=c==null?void 0:c.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+m.expires_in},m)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",m),{data:m,error:l})})}catch(r){if(Ft(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:c,error:d}=r;return d?{data:null,error:d}:await Kt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=c==null?void 0:c.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(Ft(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=(e==null?void 0:e.factors)||[],c=n.filter(m=>m.factor_type==="totp"&&m.status==="verified"),d=n.filter(m=>m.factor_type==="phone"&&m.status==="verified");return{data:{all:n,totp:c,phone:d},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:c},error:d}=e;if(d)return{data:null,error:d};if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:m}=Ky(c.access_token);let l=null;m.aal&&(l=m.aal);let w=l;((n=(r=c.user.factors)===null||r===void 0?void 0:r.filter(j=>j.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(w="aal2");const P=m.amr||[];return{data:{currentLevel:l,nextLevel:w,currentAuthenticationMethods:P},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(l=>l.kid===e);if(n)return n;const c=Date.now();if(n=this.jwks.keys.find(l=>l.kid===e),n&&this.jwks_cached_at+rL>c)return n;const{data:d,error:m}=await Kt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(m)throw m;return!d.keys||d.keys.length===0||(this.jwks=d,this.jwks_cached_at=c,n=d.keys.find(l=>l.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:Z,error:Y}=await this.getSession();if(Y||!Z.session)return{data:null,error:Y};n=Z.session.access_token}const{header:c,payload:d,signature:m,raw:{header:l,payload:w}}=Ky(n);r!=null&&r.allowExpired||EL(d.exp);const k=!c.alg||c.alg.startsWith("HS")||!c.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(c.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!k){const{error:Z}=await this.getUser(n);if(Z)throw Z;return{data:{claims:d,header:c,signature:m},error:null}}const P=CL(c.alg),j=await crypto.subtle.importKey("jwk",k,P,!0,["verify"]);if(!await crypto.subtle.verify(P,j,m,dL(`${l}.${w}`)))throw new kv("Invalid JWT signature");return{data:{claims:d,header:c,signature:m},error:null}}catch(n){if(Ft(n))return{data:null,error:n};throw n}}}Dd.nextInstanceID=0;const VL=Dd;class qL extends VL{constructor(e){super(e)}}var GL=function(t,e,r,n){function c(d){return d instanceof r?d:new r(function(m){m(d)})}return new(r||(r=Promise))(function(d,m){function l(P){try{k(n.next(P))}catch(j){m(j)}}function w(P){try{k(n.throw(P))}catch(j){m(j)}}function k(P){P.done?d(P.value):c(P.value).then(l,w)}k((n=n.apply(t,e||[])).next())})};class WL{constructor(e,r,n){var c,d,m;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const l=XN(e),w=new URL(l);this.realtimeUrl=new URL("realtime/v1",w),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",w),this.storageUrl=new URL("storage/v1",w),this.functionsUrl=new URL("functions/v1",w);const k=`sb-${w.hostname.split(".")[0]}-auth-token`,P={db:UN,realtime:qN,auth:Object.assign(Object.assign({},VN),{storageKey:k}),global:$N},j=YN(n??{},P);this.storageKey=(c=j.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(d=j.global.headers)!==null&&d!==void 0?d:{},j.accessToken?(this.accessToken=j.accessToken,this.auth=new Proxy({},{get:(L,Z)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(Z)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((m=j.auth)!==null&&m!==void 0?m:{},this.headers,j.global.fetch),this.fetch=HN(r,this._getAccessToken.bind(this),j.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},j.realtime)),this.rest=new lN(new URL("rest/v1",w).href,{headers:this.headers,schema:j.db.schema,fetch:this.fetch}),this.storage=new BN(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),j.accessToken||this._listenForAuthEvents()}get functions(){return new FD(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return GL(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:c,storageKey:d,flowType:m,lock:l,debug:w},k,P){const j={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new qL({url:this.authUrl.href,headers:Object.assign(Object.assign({},j),k),storageKey:d,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:c,flowType:m,lock:l,debug:w,fetch:P,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new TN(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ZL=(t,e,r)=>new WL(t,e,r);function HL(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}HL()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const KL=()=>(console.log("🔧 Using environment variable API URL:","http://localhost:3000"),"http://localhost:3000"),XL=()=>(console.log("🔧 Using environment variable WebSocket URL:","ws://localhost:3000"),"ws://localhost:3000"),vu={supabase:{url:"https://gthwmwfwvhyriygpcdlr.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0aHdtd2Z3dmh5cml5Z3BjZGxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5NzE0NTUsImV4cCI6MjA3MDU0NzQ1NX0.gY0ghDtKZ9b8XlgE7XtbQsT3efXYOBizGQKPJABGvAI"},get api(){return{url:KL(),websocketUrl:XL()}},isDevelopment:!1,isProduction:!0},YL=()=>{const{url:t,anonKey:e}=vu.supabase;if(console.log("🔧 Validating Supabase configuration:",{url:t?"✅ Set":"❌ Missing",anonKey:e?"✅ Set":"❌ Missing",envVars:{VITE_SUPABASE_URL:"✅ Set",VITE_SUPABASE_ANON_KEY:"✅ Set"}}),!t||t==="your_supabase_project_url"||t==="")throw console.error("❌ Supabase URL validation failed:",{url:t,envVar:"https://gthwmwfwvhyriygpcdlr.supabase.co"}),new Error("Invalid Supabase URL. Please check your environment variables.");if(!e||e==="your_supabase_anon_key_here"||e==="")throw console.error("❌ Supabase anon key validation failed:",{anonKey:e?"SET":"MISSING",envVar:"SET"}),new Error("Invalid Supabase anon key. Please check your environment variables.");try{new URL(t)}catch(r){throw console.error("❌ Supabase URL format validation failed:",{url:t,error:r}),new Error(`Invalid Supabase URL format: ${t}`)}return console.log("✅ Supabase configuration validated successfully"),{url:t,anonKey:e}},JL=()=>{try{const t=YL(),e=ZL(t.url,t.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"X-Client-Info":"bus-tracking-admin"}},realtime:{params:{eventsPerSecond:10}}});return console.log("✅ Supabase client created successfully"),e}catch(t){throw console.error("❌ Failed to create Supabase client:",t),t}},Or=JL();class QL{constructor(){Is(this,"currentUser",null);Is(this,"currentSession",null);Is(this,"currentProfile",null);Is(this,"authStateChangeListener",null);Is(this,"_isInitialized",!1);this.initializeAuth()}async initializeAuth(){try{const{data:{session:e},error:r}=await Or.auth.getSession();if(r){console.error("❌ Error getting session:",r),this._isInitialized=!0;return}e&&(console.log("🔑 Setting initial session for user:",e.user.email),this.currentSession=e,this.currentUser=e.user,console.log("🔑 Session access token:",e.access_token?"Exists":"Missing"),await this.loadUserProfile(e.user.id));const{data:{subscription:n}}=Or.auth.onAuthStateChange(async(c,d)=>{var m;console.log("🔄 Auth state changed:",c,(m=d==null?void 0:d.user)==null?void 0:m.email),this.currentSession=d,this.currentUser=(d==null?void 0:d.user)||null,d&&console.log("🔑 Auth state change - Session access token:",d.access_token?"Exists":"Missing"),d!=null&&d.user?await this.loadUserProfile(d.user.id):this.currentProfile=null,this.authStateChangeListener&&this.authStateChangeListener()});return this._isInitialized=!0,console.log("✅ Auth service initialized"),()=>n.unsubscribe()}catch(e){console.error("❌ Error initializing auth:",e),this._isInitialized=!0}}async loadUserProfile(e){var r,n,c,d,m,l,w,k,P,j,L,Z,Y;try{const ce=(n=(r=this.currentUser)==null?void 0:r.user_metadata)==null?void 0:n.roles;if(ce&&Array.isArray(ce)&&ce.length>1){const be=window.location.pathname;let Ce="admin";be.includes("/driver")?Ce="driver":be.includes("/admin")?Ce="admin":Ce=["siddharthmali.211@gmail.com"].includes(((d=(c=this.currentUser)==null?void 0:c.email)==null?void 0:d.toLowerCase())||"")?"admin":"driver";const{data:Te,error:rt}=await Or.from("profiles").select("*").eq("id",e).single();if(rt){console.error("❌ Error loading user profile:",rt),this.setTemporaryProfileWithRoleCheck(e,this.currentUser);return}this.currentProfile={id:Te.id,email:((m=this.currentUser)==null?void 0:m.email)||"",role:Ce,full_name:Te.full_name,first_name:((l=Te.full_name)==null?void 0:l.split(" ")[0])||"",last_name:((w=Te.full_name)==null?void 0:w.split(" ").slice(1).join(" "))||"",created_at:Te.created_at,updated_at:Te.updated_at};return}const{data:G,error:H}=await Or.from("profiles").select("*").eq("id",e).single();if(H){console.error("❌ Error loading user profile:",H),this.setTemporaryProfileWithRoleCheck(e,this.currentUser);return}const ue=["siddharthmali.211@gmail.com"].includes(((P=(k=this.currentUser)==null?void 0:k.email)==null?void 0:P.toLowerCase())||""),me=ue?"admin":G.role;console.log(`🔍 User ${(j=this.currentUser)==null?void 0:j.email} - Database role: ${G.role}, Admin check: ${ue}, Final role: ${me}`),this.currentProfile={id:G.id,email:((L=this.currentUser)==null?void 0:L.email)||"",role:me,full_name:G.full_name,first_name:((Z=G.full_name)==null?void 0:Z.split(" ")[0])||"",last_name:((Y=G.full_name)==null?void 0:Y.split(" ").slice(1).join(" "))||"",created_at:G.created_at,updated_at:G.updated_at}}catch(ce){console.error("❌ Error in loadUserProfile:",ce),this.setTemporaryProfileWithRoleCheck(e,this.currentUser)}}setTemporaryProfileWithRoleCheck(e,r){var m,l,w,k,P,j,L,Z;console.log("🔄 Setting temporary profile with role check for user login");const d=["siddharthmali.211@gmail.com"].includes(((m=r.email)==null?void 0:m.toLowerCase())||"")?"admin":"student";console.log(`🔍 User ${r.email} assigned role: ${d}`),this.currentProfile={id:e,email:r.email||"",role:d,full_name:((l=r.user_metadata)==null?void 0:l.full_name)||((w=r.email)==null?void 0:w.split("@")[0])||"User",first_name:((P=(k=r.user_metadata)==null?void 0:k.full_name)==null?void 0:P.split(" ")[0])||((j=r.email)==null?void 0:j.split("@")[0])||"User",last_name:((Z=(L=r.user_metadata)==null?void 0:L.full_name)==null?void 0:Z.split(" ").slice(1).join(" "))||"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}async signIn(e,r){var n,c;try{console.log("🔐 Starting sign in process for:",e);const{data:d,error:m}=await Or.auth.signInWithPassword({email:e,password:r});if(m)return console.error("❌ Sign in error:",m),{success:!1,error:m.message};if(console.log("✅ Supabase authentication successful"),d.user&&d.session){console.log("👤 User data received:",d.user.email),this.currentUser=d.user,this.currentSession=d.session,console.log("📋 Loading user profile...");try{const l=this.loadUserProfile(d.user.id),w=new Promise((k,P)=>{setTimeout(()=>P(new Error("Profile loading timeout")),1e4)});await Promise.race([l,w]),console.log("✅ Profile loaded:",(n=this.currentProfile)==null?void 0:n.role)}catch(l){console.warn("⚠️ Profile loading failed, using temporary profile:",l);try{console.log("🔄 Retrying profile loading..."),await this.loadUserProfile(d.user.id),console.log("✅ Profile loaded on retry:",(c=this.currentProfile)==null?void 0:c.role)}catch{console.warn("⚠️ Profile retry also failed, using temporary profile"),this.setTemporaryProfileWithRoleCheck(d.user.id,d.user)}}return this.authStateChangeListener&&this.authStateChangeListener(),{success:!0,user:this.currentProfile||void 0}}return console.error("❌ No user or session data received"),{success:!1,error:"Authentication failed"}}catch(d){return console.error("❌ Sign in error:",d),d instanceof Error&&d.message.includes("NetworkError")?{success:!1,error:"Network connection error. Please check your internet connection and try again."}:{success:!1,error:"Network error during sign in"}}}async signUp(e,r,n){try{const{data:c,error:d}=await Or.auth.signUp({email:e,password:r,options:{data:{full_name:n.full_name,role:n.role||"student"}}});if(d)return console.error("❌ Sign up error:",d),{success:!1,error:d.message};if(c.user){const{error:m}=await Or.from("profiles").insert({id:c.user.id,full_name:n.full_name||"Unknown User",role:n.role||"student"});return m?(console.error("❌ Error creating profile:",m),{success:!1,error:"Profile creation failed"}):{success:!0}}return{success:!1,error:"Registration failed"}}catch(c){return console.error("❌ Sign up error:",c),{success:!1,error:"Network error during sign up"}}}async signOut(){try{console.log("🔐 Starting sign out process...");const{error:e}=await Or.auth.signOut();return e?(console.error("❌ Sign out error:",e),{success:!1,error:e.message}):(console.log("✅ Sign out successful"),this.currentUser=null,this.currentSession=null,this.currentProfile=null,this.authStateChangeListener&&this.authStateChangeListener(),{success:!0})}catch(e){return console.error("❌ Sign out error:",e),{success:!1,error:"Network error during sign out"}}}getCurrentUser(){return this.currentUser}getCurrentSession(){return this.currentSession}getCurrentProfile(){return this.currentProfile}isInitialized(){return this._isInitialized}isAuthenticated(){return!!this.currentUser&&!!this.currentSession}hasRole(e){var r;return((r=this.currentProfile)==null?void 0:r.role)===e}isAdmin(){return this.hasRole("admin")}isDriver(){return this.hasRole("driver")}isStudent(){return this.hasRole("student")}getAccessToken(){var r,n,c;let e=((r=this.currentSession)==null?void 0:r.access_token)||null;if(!e)try{const d=["supabase.auth.token","sb-gthwmwfwvhyriygpcdlr-auth-token","supabase.auth.session"];for(const m of d){const l=localStorage.getItem(m);if(l){const w=JSON.parse(l);if(e=((n=w==null?void 0:w.currentSession)==null?void 0:n.access_token)||(w==null?void 0:w.access_token)||((c=w==null?void 0:w.session)==null?void 0:c.access_token)||null,e){console.log(`🔑 Retrieved token from localStorage fallback (${m})`);break}}}}catch(d){console.warn("⚠️ Error reading token from localStorage:",d)}return console.log("🔑 getAccessToken called:",e?"Token exists":"No token","Session:",!!this.currentSession),e}async refreshSession(){try{if(!this.currentSession)return console.log("🔄 No current session to refresh"),{success:!1,error:"No session to refresh"};const{data:e,error:r}=await Or.auth.refreshSession();return r?r.message.includes("Auth session missing")?(console.log("🔄 No session to refresh (expected for unauthenticated users)"),{success:!1,error:"No session to refresh"}):(console.error("❌ Session refresh error:",r),{success:!1,error:r.message}):e.session?(this.currentSession=e.session,this.currentUser=e.user,{success:!0}):{success:!1,error:"Session refresh failed"}}catch(e){return console.error("❌ Session refresh error:",e),{success:!1,error:"Network error during session refresh"}}}async updateProfile(e){if(!this.currentUser)return{success:!1,error:"No authenticated user"};try{const{error:r}=await Or.from("profiles").update(e).eq("id",this.currentUser.id);return r?(console.error("❌ Profile update error:",r),{success:!1,error:r.message}):(await this.loadUserProfile(this.currentUser.id),{success:!0})}catch(r){return console.error("❌ Profile update error:",r),{success:!1,error:"Network error during profile update"}}}onAuthStateChange(e){this.authStateChangeListener=e}removeAuthStateChangeListener(){this.authStateChangeListener=null}getAuthState(){return{initialized:this._isInitialized,user:this.currentUser,session:this.currentSession,profile:this.currentProfile,isAuthenticated:this.isAuthenticated(),isAdmin:this.isAdmin()}}async forceFreshLogin(){try{console.log("🔄 Forcing fresh login...");const e=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);n&&(n.includes("supabase")||n.includes("auth")||n.includes("sb-"))&&e.push(n)}return e.forEach(r=>{localStorage.removeItem(r),console.log(`🗑️ Removed localStorage key: ${r}`)}),this.currentSession=null,this.currentUser=null,this.currentProfile=null,console.log("✅ Fresh login state prepared"),{success:!0}}catch(e){return console.error("❌ Error forcing fresh login:",e),{success:!1,error:"Failed to force fresh login"}}}async recoverSession(){var e,r,n,c;try{console.log("🔄 Attempting to recover session from localStorage...");const d=["supabase.auth.token","sb-gthwmwfwvhyriygpcdlr-auth-token","supabase.auth.session"];let m=null,l=null;for(const L of d){const Z=localStorage.getItem(L);if(Z){m=Z,l=L,console.log(`📝 Found session in localStorage key: ${L}`);break}}if(!m)return console.log("📝 No stored session found in any localStorage key"),{success:!1,error:"No stored session"};let w;try{w=JSON.parse(m)}catch(L){return console.log("❌ Failed to parse stored session:",L),{success:!1,error:"Invalid session format"}}const k=((e=w==null?void 0:w.currentSession)==null?void 0:e.access_token)||(w==null?void 0:w.access_token)||((r=w==null?void 0:w.session)==null?void 0:r.access_token);if(!k)return console.log("🔑 No access token found in stored session structure:",w),{success:!1,error:"No access token in stored session"};console.log("🔑 Found access token, validating...");const{data:{user:P},error:j}=await Or.auth.getUser(k);return j||!P?(console.log("❌ Stored token is invalid:",j==null?void 0:j.message),l&&localStorage.removeItem(l),{success:!1,error:"Stored token is invalid"}):(this.currentSession={access_token:k,refresh_token:((n=w==null?void 0:w.currentSession)==null?void 0:n.refresh_token)||(w==null?void 0:w.refresh_token),expires_in:((c=w==null?void 0:w.currentSession)==null?void 0:c.expires_in)||(w==null?void 0:w.expires_in),token_type:"bearer",user:P},this.currentUser=P,await this.loadUserProfile(P.id),console.log("✅ Session recovered successfully for user:",P.email),{success:!0})}catch(d){return console.error("❌ Error recovering session:",d),{success:!1,error:"Failed to recover session"}}}}const tr=new QL,eR=vu.api.url;class tR{constructor(e){Is(this,"baseUrl");this.baseUrl=e}async backendRequest(e,r){const n=`${this.baseUrl}${e}`,c={"Content-Type":"application/json"};try{const m=tr.getAccessToken();m&&(c.Authorization=`Bearer ${m}`)}catch{console.log("🔓 Public access - no authentication token available")}r!=null&&r.headers&&Object.assign(c,r.headers);const d=await fetch(n,{headers:c,...r});if(!d.ok)throw new Error(`API request failed: ${d.status} ${d.statusText}`);return d.json()}async getHealth(){return this.backendRequest("/health")}async getAllBuses(){try{const e=await this.backendRequest("/buses");return e.success&&e.data?{success:!0,data:e.data,timestamp:new Date().toISOString()}:(console.error("❌ Error fetching buses from backend:",e.error),{success:!1,data:[],timestamp:new Date().toISOString()})}catch(e){return console.error("❌ Error in getAllBuses:",e),{success:!1,data:[],timestamp:new Date().toISOString()}}}async getBusInfo(e){try{const r=await this.backendRequest(`/buses/${e}`);return r.success&&r.data?{success:!0,data:r.data,timestamp:new Date().toISOString()}:(console.error("❌ Error fetching bus info from backend:",r.error),{success:!1,data:null,timestamp:new Date().toISOString()})}catch(r){return console.error("❌ Error in getBusInfo:",r),{success:!1,data:null,timestamp:new Date().toISOString()}}}async getRoutes(){try{const e=await this.backendRequest("/routes");return e.success&&e.data?{success:!0,data:e.data,timestamp:new Date().toISOString()}:(console.error("❌ Error fetching routes from backend:",e.error),{success:!1,data:[],timestamp:new Date().toISOString()})}catch(e){return console.error("❌ Error in getRoutes:",e),{success:!1,data:[],timestamp:new Date().toISOString()}}}async getRouteInfo(e){try{const{data:r,error:n}=await Or.from("routes").select("*").eq("id",e).single();return n?(console.error("❌ Error fetching route info:",n),{success:!1,data:null,timestamp:new Date().toISOString()}):{success:!0,data:r,timestamp:new Date().toISOString()}}catch(r){return console.error("❌ Error in getRouteInfo:",r),{success:!1,data:null,timestamp:new Date().toISOString()}}}async getAllDrivers(){try{const{data:e,error:r}=await Or.from("users").select("*").eq("role","driver").order("created_at",{ascending:!1});return r?(console.error("❌ Error fetching drivers:",r),{success:!1,data:[],timestamp:new Date().toISOString()}):{success:!0,data:e||[],timestamp:new Date().toISOString()}}catch(e){return console.error("❌ Error in getAllDrivers:",e),{success:!1,data:[],timestamp:new Date().toISOString()}}}async getDriverInfo(e){try{const{data:r,error:n}=await Or.from("users").select("*").eq("id",e).eq("role","driver").single();return n?(console.error("❌ Error fetching driver info:",n),{success:!1,data:null,timestamp:new Date().toISOString()}):{success:!0,data:r,timestamp:new Date().toISOString()}}catch(r){return console.error("❌ Error in getDriverInfo:",r),{success:!1,data:null,timestamp:new Date().toISOString()}}}async getLiveLocations(){try{const{data:e,error:r}=await Or.from("live_locations").select(`
          *,
          bus:buses!live_locations_bus_id_fkey (
            id,
            bus_number,
            capacity,
            bus_image_url
          ),
          driver:users!live_locations_driver_id_fkey (
            id,
            first_name,
            last_name,
            email,
            phone
          )
        `).order("updated_at",{ascending:!1});return r?(console.error("❌ Error fetching live locations:",r),{success:!1,data:[],timestamp:new Date().toISOString()}):{success:!0,data:e||[],timestamp:new Date().toISOString()}}catch(e){return console.error("❌ Error in getLiveLocations:",e),{success:!1,data:[],timestamp:new Date().toISOString()}}}async updateLiveLocation(e,r,n){try{const{data:c,error:d}=await Or.from("live_locations").upsert({bus_id:e,driver_id:r,latitude:n.latitude,longitude:n.longitude,updated_at:new Date().toISOString()}).select().single();return d?(console.error("❌ Error updating live location:",d),{success:!1,data:null,timestamp:new Date().toISOString()}):{success:!0,data:c,timestamp:new Date().toISOString()}}catch(c){return console.error("❌ Error in updateLiveLocation:",c),{success:!1,data:null,timestamp:new Date().toISOString()}}}}const Tv=new tR(eR),pa=Object.create(null);pa.open="0";pa.close="1";pa.ping="2";pa.pong="3";pa.message="4";pa.upgrade="5";pa.noop="6";const Hp=Object.create(null);Object.keys(pa).forEach(t=>{Hp[pa[t]]=t});const Ev={type:"error",data:"parser error"},pE=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",mE=typeof ArrayBuffer=="function",gE=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,t0=({type:t,data:e},r,n)=>pE&&e instanceof Blob?r?n(e):tS(e,n):mE&&(e instanceof ArrayBuffer||gE(e))?r?n(e):tS(new Blob([e]),n):n(pa[t]+(e||"")),tS=(t,e)=>{const r=new FileReader;return r.onload=function(){const n=r.result.split(",")[1];e("b"+(n||""))},r.readAsDataURL(t)};function rS(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let Jy;function rR(t,e){if(pE&&t.data instanceof Blob)return t.data.arrayBuffer().then(rS).then(e);if(mE&&(t.data instanceof ArrayBuffer||gE(t.data)))return e(rS(t.data));t0(t,!1,r=>{Jy||(Jy=new TextEncoder),e(Jy.encode(r))})}const sS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<sS.length;t++)Hh[sS.charCodeAt(t)]=t;const sR=t=>{let e=t.length*.75,r=t.length,n,c=0,d,m,l,w;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const k=new ArrayBuffer(e),P=new Uint8Array(k);for(n=0;n<r;n+=4)d=Hh[t.charCodeAt(n)],m=Hh[t.charCodeAt(n+1)],l=Hh[t.charCodeAt(n+2)],w=Hh[t.charCodeAt(n+3)],P[c++]=d<<2|m>>4,P[c++]=(m&15)<<4|l>>2,P[c++]=(l&3)<<6|w&63;return k},iR=typeof ArrayBuffer=="function",r0=(t,e)=>{if(typeof t!="string")return{type:"message",data:yE(t,e)};const r=t.charAt(0);return r==="b"?{type:"message",data:nR(t.substring(1),e)}:Hp[r]?t.length>1?{type:Hp[r],data:t.substring(1)}:{type:Hp[r]}:Ev},nR=(t,e)=>{if(iR){const r=sR(t);return yE(r,e)}else return{base64:!0,data:t}},yE=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},_E="",aR=(t,e)=>{const r=t.length,n=new Array(r);let c=0;t.forEach((d,m)=>{t0(d,!1,l=>{n[m]=l,++c===r&&e(n.join(_E))})})},oR=(t,e)=>{const r=t.split(_E),n=[];for(let c=0;c<r.length;c++){const d=r0(r[c],e);if(n.push(d),d.type==="error")break}return n};function lR(){return new TransformStream({transform(t,e){rR(t,r=>{const n=r.length;let c;if(n<126)c=new Uint8Array(1),new DataView(c.buffer).setUint8(0,n);else if(n<65536){c=new Uint8Array(3);const d=new DataView(c.buffer);d.setUint8(0,126),d.setUint16(1,n)}else{c=new Uint8Array(9);const d=new DataView(c.buffer);d.setUint8(0,127),d.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(c[0]|=128),e.enqueue(c),e.enqueue(r)})}})}let Qy;function Pp(t){return t.reduce((e,r)=>e+r.length,0)}function Ip(t,e){if(t[0].length===e)return t.shift();const r=new Uint8Array(e);let n=0;for(let c=0;c<e;c++)r[c]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),r}function cR(t,e){Qy||(Qy=new TextDecoder);const r=[];let n=0,c=-1,d=!1;return new TransformStream({transform(m,l){for(r.push(m);;){if(n===0){if(Pp(r)<1)break;const w=Ip(r,1);d=(w[0]&128)===128,c=w[0]&127,c<126?n=3:c===126?n=1:n=2}else if(n===1){if(Pp(r)<2)break;const w=Ip(r,2);c=new DataView(w.buffer,w.byteOffset,w.length).getUint16(0),n=3}else if(n===2){if(Pp(r)<8)break;const w=Ip(r,8),k=new DataView(w.buffer,w.byteOffset,w.length),P=k.getUint32(0);if(P>Math.pow(2,21)-1){l.enqueue(Ev);break}c=P*Math.pow(2,32)+k.getUint32(4),n=3}else{if(Pp(r)<c)break;const w=Ip(r,c);l.enqueue(r0(d?w:Qy.decode(w),e)),n=0}if(c===0||c>t){l.enqueue(Ev);break}}}})}const vE=4;function hs(t){if(t)return uR(t)}function uR(t){for(var e in hs.prototype)t[e]=hs.prototype[e];return t}hs.prototype.on=hs.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};hs.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this};hs.prototype.off=hs.prototype.removeListener=hs.prototype.removeAllListeners=hs.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+t];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,c=0;c<r.length;c++)if(n=r[c],n===e||n.fn===e){r.splice(c,1);break}return r.length===0&&delete this._callbacks["$"+t],this};hs.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,c=r.length;n<c;++n)r[n].apply(this,e)}return this};hs.prototype.emitReserved=hs.prototype.emit;hs.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};hs.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ig=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,r)=>r(e,0),_n=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),hR="arraybuffer";function xE(t,...e){return e.reduce((r,n)=>(t.hasOwnProperty(n)&&(r[n]=t[n]),r),{})}const dR=_n.setTimeout,fR=_n.clearTimeout;function ng(t,e){e.useNativeTimers?(t.setTimeoutFn=dR.bind(_n),t.clearTimeoutFn=fR.bind(_n)):(t.setTimeoutFn=_n.setTimeout.bind(_n),t.clearTimeoutFn=_n.clearTimeout.bind(_n))}const pR=1.33;function mR(t){return typeof t=="string"?gR(t):Math.ceil((t.byteLength||t.size)*pR)}function gR(t){let e=0,r=0;for(let n=0,c=t.length;n<c;n++)e=t.charCodeAt(n),e<128?r+=1:e<2048?r+=2:e<55296||e>=57344?r+=3:(n++,r+=4);return r}function bE(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function yR(t){let e="";for(let r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e}function _R(t){let e={},r=t.split("&");for(let n=0,c=r.length;n<c;n++){let d=r[n].split("=");e[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return e}class vR extends Error{constructor(e,r,n){super(e),this.description=r,this.context=n,this.type="TransportError"}}class s0 extends hs{constructor(e){super(),this.writable=!1,ng(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,r,n){return super.emitReserved("error",new vR(e,r,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const r=r0(e,this.socket.binaryType);this.onPacket(r)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,r={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const r=yR(e);return r.length?"?"+r:""}}class xR extends s0{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const r=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||r()})),this.writable||(n++,this.once("drain",function(){--n||r()}))}else r()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const r=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};oR(e,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,aR(e,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=bE()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(e,r)}}let wE=!1;try{wE=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const bR=wE;function wR(){}class SR extends xR{constructor(e){if(super(e),typeof location<"u"){const r=location.protocol==="https:";let n=location.port;n||(n=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,r){const n=this.request({method:"POST",data:e});n.on("success",r),n.on("error",(c,d)=>{this.onError("xhr post error",c,d)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(r,n)=>{this.onError("xhr poll error",r,n)}),this.pollXhr=e}}let eu=class Kp extends hs{constructor(e,r,n){super(),this.createRequest=e,ng(this,n),this._opts=n,this._method=n.method||"GET",this._uri=r,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var e;const r=xE(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(r);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let c in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(c)&&n.setRequestHeader(c,this._opts.extraHeaders[c])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var c;n.readyState===3&&((c=this._opts.cookieJar)===null||c===void 0||c.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(c){this.setTimeoutFn(()=>{this._onError(c)},0);return}typeof document<"u"&&(this._index=Kp.requestsCount++,Kp.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=wR,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Kp.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};eu.requestsCount=0;eu.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",iS);else if(typeof addEventListener=="function"){const t="onpagehide"in _n?"pagehide":"unload";addEventListener(t,iS,!1)}}function iS(){for(let t in eu.requests)eu.requests.hasOwnProperty(t)&&eu.requests[t].abort()}const kR=function(){const t=SE({xdomain:!1});return t&&t.responseType!==null}();class TR extends SR{constructor(e){super(e);const r=e&&e.forceBase64;this.supportsBinary=kR&&!r}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new eu(SE,this.uri(),e)}}function SE(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||bR))return new XMLHttpRequest}catch{}if(!e)try{return new _n[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const kE=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ER extends s0{get name(){return"websocket"}doOpen(){const e=this.uri(),r=this.opts.protocols,n=kE?{}:xE(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,r,n)}catch(c){return this.emitReserved("error",c)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let r=0;r<e.length;r++){const n=e[r],c=r===e.length-1;t0(n,this.supportsBinary,d=>{try{this.doWrite(n,d)}catch{}c&&ig(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=bE()),this.supportsBinary||(r.b64=1),this.createUri(e,r)}}const e_=_n.WebSocket||_n.MozWebSocket;class CR extends ER{createSocket(e,r,n){return kE?new e_(e,r,n):r?new e_(e,r):new e_(e)}doWrite(e,r){this.ws.send(r)}}class AR extends s0{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const r=cR(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(r).getReader(),c=lR();c.readable.pipeTo(e.writable),this._writer=c.writable.getWriter();const d=()=>{n.read().then(({done:l,value:w})=>{l||(this.onPacket(w),d())}).catch(l=>{})};d();const m={type:"open"};this.query.sid&&(m.data=`{"sid":"${this.query.sid}"}`),this._writer.write(m).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let r=0;r<e.length;r++){const n=e[r],c=r===e.length-1;this._writer.write(n).then(()=>{c&&ig(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const PR={websocket:CR,webtransport:AR,polling:TR},IR=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,MR=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Cv(t){if(t.length>8e3)throw"URI too long";const e=t,r=t.indexOf("["),n=t.indexOf("]");r!=-1&&n!=-1&&(t=t.substring(0,r)+t.substring(r,n).replace(/:/g,";")+t.substring(n,t.length));let c=IR.exec(t||""),d={},m=14;for(;m--;)d[MR[m]]=c[m]||"";return r!=-1&&n!=-1&&(d.source=e,d.host=d.host.substring(1,d.host.length-1).replace(/;/g,":"),d.authority=d.authority.replace("[","").replace("]","").replace(/;/g,":"),d.ipv6uri=!0),d.pathNames=jR(d,d.path),d.queryKey=DR(d,d.query),d}function jR(t,e){const r=/\/{2,9}/g,n=e.replace(r,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function DR(t,e){const r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,c,d){c&&(r[c]=d)}),r}const Av=typeof addEventListener=="function"&&typeof removeEventListener=="function",Xp=[];Av&&addEventListener("offline",()=>{Xp.forEach(t=>t())},!1);class No extends hs{constructor(e,r){if(super(),this.binaryType=hR,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(r=e,e=null),e){const n=Cv(e);r.hostname=n.host,r.secure=n.protocol==="https"||n.protocol==="wss",r.port=n.port,n.query&&(r.query=n.query)}else r.host&&(r.hostname=Cv(r.host).host);ng(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(n=>{const c=n.prototype.name;this.transports.push(c),this._transportsByName[c]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=_R(this.opts.query)),Av&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Xp.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const r=Object.assign({},this.opts.query);r.EIO=vE,r.transport=e,this.id&&(r.sid=this.id);const n=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&No.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const r=this.createTransport(e);r.open(),this.setTransport(r)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){this.readyState="open",No.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const r=new Error("server error");r.code=e.data,this._onError(r);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let n=0;n<this.writeBuffer.length;n++){const c=this.writeBuffer[n].data;if(c&&(r+=mR(c)),n>0&&r>this._maxPayload)return this.writeBuffer.slice(0,n);r+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,ig(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,r,n){return this._sendPacket("message",e,r,n),this}send(e,r,n){return this._sendPacket("message",e,r,n),this}_sendPacket(e,r,n,c){if(typeof r=="function"&&(c=r,r=void 0),typeof n=="function"&&(c=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const d={type:e,data:r,options:n};this.emitReserved("packetCreate",d),this.writeBuffer.push(d),c&&this.once("flush",c),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),e()},n=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(No.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Av&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=Xp.indexOf(this._offlineEventListener);n!==-1&&Xp.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,r),this.writeBuffer=[],this._prevBufferLen=0}}}No.protocol=vE;class NR extends No{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let r=this.createTransport(e),n=!1;No.priorWebsocketSuccess=!1;const c=()=>{n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",j=>{if(!n)if(j.type==="pong"&&j.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;No.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(P(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const L=new Error("probe error");L.transport=r.name,this.emitReserved("upgradeError",L)}}))};function d(){n||(n=!0,P(),r.close(),r=null)}const m=j=>{const L=new Error("probe error: "+j);L.transport=r.name,d(),this.emitReserved("upgradeError",L)};function l(){m("transport closed")}function w(){m("socket closed")}function k(j){r&&j.name!==r.name&&d()}const P=()=>{r.removeListener("open",c),r.removeListener("error",m),r.removeListener("close",l),this.off("close",w),this.off("upgrading",k)};r.once("open",c),r.once("error",m),r.once("close",l),this.once("close",w),this.once("upgrading",k),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||r.open()},200):r.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const r=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&r.push(e[n]);return r}}let LR=class extends NR{constructor(e,r={}){const n=typeof e=="object"?e:r;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(c=>PR[c]).filter(c=>!!c)),super(e,n)}};function RR(t,e="",r){let n=t;r=r||typeof location<"u"&&location,t==null&&(t=r.protocol+"//"+r.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=r.protocol+t:t=r.host+t),/^(https?|wss?):\/\//.test(t)||(typeof r<"u"?t=r.protocol+"//"+t:t="https://"+t),n=Cv(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const d=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+d+":"+n.port+e,n.href=n.protocol+"://"+d+(r&&r.port===n.port?"":":"+n.port),n}const zR=typeof ArrayBuffer=="function",BR=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,TE=Object.prototype.toString,OR=typeof Blob=="function"||typeof Blob<"u"&&TE.call(Blob)==="[object BlobConstructor]",FR=typeof File=="function"||typeof File<"u"&&TE.call(File)==="[object FileConstructor]";function i0(t){return zR&&(t instanceof ArrayBuffer||BR(t))||OR&&t instanceof Blob||FR&&t instanceof File}function Yp(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(Yp(t[r]))return!0;return!1}if(i0(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Yp(t.toJSON(),!0);for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&Yp(t[r]))return!0;return!1}function $R(t){const e=[],r=t.data,n=t;return n.data=Pv(r,e),n.attachments=e.length,{packet:n,buffers:e}}function Pv(t,e){if(!t)return t;if(i0(t)){const r={_placeholder:!0,num:e.length};return e.push(t),r}else if(Array.isArray(t)){const r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=Pv(t[n],e);return r}else if(typeof t=="object"&&!(t instanceof Date)){const r={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=Pv(t[n],e));return r}return t}function UR(t,e){return t.data=Iv(t.data,e),delete t.attachments,t}function Iv(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]=Iv(t[r],e);else if(typeof t=="object")for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]=Iv(t[r],e));return t}const VR=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],qR=5;var er;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(er||(er={}));class GR{constructor(e){this.replacer=e}encode(e){return(e.type===er.EVENT||e.type===er.ACK)&&Yp(e)?this.encodeAsBinary({type:e.type===er.EVENT?er.BINARY_EVENT:er.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let r=""+e.type;return(e.type===er.BINARY_EVENT||e.type===er.BINARY_ACK)&&(r+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(r+=e.nsp+","),e.id!=null&&(r+=e.id),e.data!=null&&(r+=JSON.stringify(e.data,this.replacer)),r}encodeAsBinary(e){const r=$R(e),n=this.encodeAsString(r.packet),c=r.buffers;return c.unshift(n),c}}function nS(t){return Object.prototype.toString.call(t)==="[object Object]"}class n0 extends hs{constructor(e){super(),this.reviver=e}add(e){let r;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(e);const n=r.type===er.BINARY_EVENT;n||r.type===er.BINARY_ACK?(r.type=n?er.EVENT:er.ACK,this.reconstructor=new WR(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(i0(e)||e.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(e),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let r=0;const n={type:Number(e.charAt(0))};if(er[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===er.BINARY_EVENT||n.type===er.BINARY_ACK){const d=r+1;for(;e.charAt(++r)!=="-"&&r!=e.length;);const m=e.substring(d,r);if(m!=Number(m)||e.charAt(r)!=="-")throw new Error("Illegal attachments");n.attachments=Number(m)}if(e.charAt(r+1)==="/"){const d=r+1;for(;++r&&!(e.charAt(r)===","||r===e.length););n.nsp=e.substring(d,r)}else n.nsp="/";const c=e.charAt(r+1);if(c!==""&&Number(c)==c){const d=r+1;for(;++r;){const m=e.charAt(r);if(m==null||Number(m)!=m){--r;break}if(r===e.length)break}n.id=Number(e.substring(d,r+1))}if(e.charAt(++r)){const d=this.tryParse(e.substr(r));if(n0.isPayloadValid(n.type,d))n.data=d;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,r){switch(e){case er.CONNECT:return nS(r);case er.DISCONNECT:return r===void 0;case er.CONNECT_ERROR:return typeof r=="string"||nS(r);case er.EVENT:case er.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&VR.indexOf(r[0])===-1);case er.ACK:case er.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class WR{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const r=UR(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ZR=Object.freeze(Object.defineProperty({__proto__:null,Decoder:n0,Encoder:GR,get PacketType(){return er},protocol:qR},Symbol.toStringTag,{value:"Module"}));function Un(t,e,r){return t.on(e,r),function(){t.off(e,r)}}const HR=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class EE extends hs{constructor(e,r,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=r,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Un(e,"open",this.onopen.bind(this)),Un(e,"packet",this.onpacket.bind(this)),Un(e,"error",this.onerror.bind(this)),Un(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...r){var n,c,d;if(HR.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(r.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;const m={type:er.EVENT,data:r};if(m.options={},m.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){const P=this.ids++,j=r.pop();this._registerAckCallback(P,j),m.id=P}const l=(c=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||c===void 0?void 0:c.writable,w=this.connected&&!(!((d=this.io.engine)===null||d===void 0)&&d._hasPingExpired());return this.flags.volatile&&!l||(w?(this.notifyOutgoingListeners(m),this.packet(m)):this.sendBuffer.push(m)),this.flags={},this}_registerAckCallback(e,r){var n;const c=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(c===void 0){this.acks[e]=r;return}const d=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===e&&this.sendBuffer.splice(l,1);r.call(this,new Error("operation has timed out"))},c),m=(...l)=>{this.io.clearTimeoutFn(d),r.apply(this,l)};m.withError=!0,this.acks[e]=m}emitWithAck(e,...r){return new Promise((n,c)=>{const d=(m,l)=>m?c(m):n(l);d.withError=!0,r.push(d),this.emit(e,...r)})}_addToQueue(e){let r;typeof e[e.length-1]=="function"&&(r=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((c,...d)=>n!==this._queue[0]?void 0:(c!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(c)):(this._queue.shift(),r&&r(null,...d)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const r=this._queue[0];r.pending&&!e||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:er.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case er.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case er.EVENT:case er.BINARY_EVENT:this.onevent(e);break;case er.ACK:case er.BINARY_ACK:this.onack(e);break;case er.DISCONNECT:this.ondisconnect();break;case er.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const r=e.data||[];e.id!=null&&r.push(this.ack(e.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const n of r)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const r=this;let n=!1;return function(...c){n||(n=!0,r.packet({type:er.ACK,id:e,data:c}))}}onack(e){const r=this.acks[e.id];typeof r=="function"&&(delete this.acks[e.id],r.withError&&e.data.unshift(null),r.apply(this,e.data))}onconnect(e,r){this.id=e,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:er.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const r=this._anyListeners;for(let n=0;n<r.length;n++)if(e===r[n])return r.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const r=this._anyOutgoingListeners;for(let n=0;n<r.length;n++)if(e===r[n])return r.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const r=this._anyOutgoingListeners.slice();for(const n of r)n.apply(this,e.data)}}}function xu(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}xu.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+r:t-r}return Math.min(t,this.max)|0};xu.prototype.reset=function(){this.attempts=0};xu.prototype.setMin=function(t){this.ms=t};xu.prototype.setMax=function(t){this.max=t};xu.prototype.setJitter=function(t){this.jitter=t};class Mv extends hs{constructor(e,r){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(r=e,e=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,ng(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((n=r.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new xu({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=e;const c=r.parser||ZR;this.encoder=new c.Encoder,this.decoder=new c.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var r;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(r=this.backoff)===null||r===void 0||r.setMin(e),this)}randomizationFactor(e){var r;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(r=this.backoff)===null||r===void 0||r.setJitter(e),this)}reconnectionDelayMax(e){var r;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(r=this.backoff)===null||r===void 0||r.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new LR(this.uri,this.opts);const r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const c=Un(r,"open",function(){n.onopen(),e&&e()}),d=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),e?e(l):this.maybeReconnectOnOpen()},m=Un(r,"error",d);if(this._timeout!==!1){const l=this._timeout,w=this.setTimeoutFn(()=>{c(),d(new Error("timeout")),r.close()},l);this.opts.autoUnref&&w.unref(),this.subs.push(()=>{this.clearTimeoutFn(w)})}return this.subs.push(c),this.subs.push(m),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Un(e,"ping",this.onping.bind(this)),Un(e,"data",this.ondata.bind(this)),Un(e,"error",this.onerror.bind(this)),Un(e,"close",this.onclose.bind(this)),Un(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(r){this.onclose("parse error",r)}}ondecoded(e){ig(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,r){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new EE(this,e,r),this.nsps[e]=n),n}_destroy(e){const r=Object.keys(this.nsps);for(const n of r)if(this.nsps[n].active)return;this._close()}_packet(e){const r=this.encoder.encode(e);for(let n=0;n<r.length;n++)this.engine.write(r[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,r){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(c=>{c?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",c)):e.onreconnect()}))},r);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Fh={};function Jp(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const r=RR(t,e.path||"/socket.io"),n=r.source,c=r.id,d=r.path,m=Fh[c]&&d in Fh[c].nsps,l=e.forceNew||e["force new connection"]||e.multiplex===!1||m;let w;return l?w=new Mv(n,e):(Fh[c]||(Fh[c]=new Mv(n,e)),w=Fh[c]),r.query&&!e.query&&(e.query=r.queryKey),w.socket(r.path,e)}Object.assign(Jp,{Manager:Mv,Socket:EE,io:Jp,connect:Jp});class KR{constructor(){Is(this,"socket",null);Is(this,"_isConnected",!1);Is(this,"reconnectAttempts",0);Is(this,"maxReconnectAttempts",10);Is(this,"reconnectDelay",1e3);Is(this,"reconnectTimer",null);Is(this,"heartbeatTimer",null);Is(this,"isReconnecting",!1)}connect(e=vu.api.websocketUrl){return new Promise((r,n)=>{if(this.isReconnecting){console.log("🔄 Already attempting to reconnect...");return}this.isReconnecting=!0,setTimeout(()=>{try{this.socket=Jp(e,{transports:["websocket","polling"],timeout:3e4,reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay,reconnectionDelayMax:5e3,forceNew:!0,upgrade:!0,rememberUpgrade:!0,autoConnect:!0}),this.socket.on("connect",()=>{var c;console.log("✅ WebSocket connected"),this._isConnected=!0,this.isReconnecting=!1,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.startHeartbeat(),(c=this.socket)==null||c.emit("student:connect"),r()}),this.socket.on("disconnect",c=>{console.log("❌ WebSocket disconnected:",c),this._isConnected=!1,this.stopHeartbeat(),(c==="io server disconnect"||c==="transport close")&&this.handleReconnection()}),this.socket.on("connect_error",c=>{console.error("❌ WebSocket connection error:",c),this.isReconnecting=!1,this.reconnectAttempts++,this.reconnectAttempts>=this.maxReconnectAttempts?n(new Error("Failed to connect to WebSocket server")):this.handleReconnection()}),this.socket.on("error",c=>{console.error("❌ WebSocket error:",c)}),this.socket.on("reconnect",c=>{var d;console.log(`🔄 WebSocket reconnected after ${c} attempts`),this._isConnected=!0,this.isReconnecting=!1,this.reconnectAttempts=0,(d=this.socket)==null||d.emit("student:connect")}),this.socket.on("reconnect_error",c=>{console.error("❌ WebSocket reconnection error:",c)}),this.socket.on("reconnect_failed",()=>{console.error("❌ WebSocket reconnection failed"),this.isReconnecting=!1,n(new Error("Failed to reconnect to WebSocket server"))})}catch(c){console.error("❌ Failed to create WebSocket connection:",c),this.isReconnecting=!1,n(c)}},500)})}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this._isConnected=!1),this.stopHeartbeat(),this.isReconnecting=!1}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=setInterval(()=>{this.socket&&this._isConnected&&(this.socket.emit("ping"),console.log("💓 Heartbeat sent"))},3e4)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}handleReconnection(){if(this.isReconnecting)return;this.isReconnecting=!0,console.log("🔄 Attempting to reconnect..."),this.reconnectTimer&&clearTimeout(this.reconnectTimer);const e=Math.min(1e3*Math.pow(2,this.reconnectAttempts),1e4);this.reconnectTimer=setTimeout(()=>{this.connect().catch(r=>{console.error("❌ Reconnection failed:",r),this.isReconnecting=!1})},e)}onBusLocationUpdate(e){var r;console.log("🎧 Setting up bus:locationUpdate listener"),(r=this.socket)==null||r.on("bus:locationUpdate",n=>{console.log("📡 Received bus:locationUpdate event:",n),e(n)})}onDriverConnected(e){var r;(r=this.socket)==null||r.on("driver:connected",e)}onDriverDisconnected(e){var r;(r=this.socket)==null||r.on("driver:disconnected",e)}onStudentConnected(e){var r;(r=this.socket)==null||r.on("student:connected",e)}onBusArriving(e){var r;(r=this.socket)==null||r.on("bus:arriving",e)}isConnected(){return this._isConnected}getConnectionStatus(){return this._isConnected}authenticateAsDriver(e){this.socket&&this.isConnected()?(this.socket.emit("driver:authenticate",{token:e}),this.socket.once("driver:authenticated",r=>{console.log("✅ Driver: Authentication successful:",r)}),this.socket.once("error",r=>{console.error("❌ Driver: Authentication failed:",r)})):console.error("❌ Driver: Cannot authenticate - socket not connected")}off(e){var r;(r=this.socket)==null||r.off(e)}}const $t=new KR;var CE={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(Ji,function(){var r,n,c;function d(l,w){if(!r)r=w;else if(!n)n=w;else{var k="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",P={};r(P),c=w(P),typeof window<"u"&&(c.workerUrl=window.URL.createObjectURL(new Blob([k],{type:"text/javascript"})))}}d(["exports"],function(l){function w(a,s,o,h){return new(o||(o=Promise))(function(p,x){function b(M){try{C(h.next(M))}catch(N){x(N)}}function S(M){try{C(h.throw(M))}catch(N){x(N)}}function C(M){var N;M.done?p(M.value):(N=M.value,N instanceof o?N:new o(function(B){B(N)})).then(b,S)}C((h=h.apply(a,s||[])).next())})}function k(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}typeof SuppressedError=="function"&&SuppressedError;var P=j;function j(a,s){this.x=a,this.y=s}j.prototype={clone:function(){return new j(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,s){return this.clone()._rotateAround(a,s)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var s=a.x-this.x,o=a.y-this.y;return s*s+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,s){return Math.atan2(this.x*s-this.y*a,this.x*a+this.y*s)},_matMult:function(a){var s=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=s,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var s=Math.cos(a),o=Math.sin(a),h=o*this.x+s*this.y;return this.x=s*this.x-o*this.y,this.y=h,this},_rotateAround:function(a,s){var o=Math.cos(a),h=Math.sin(a),p=s.y+h*(this.x-s.x)+o*(this.y-s.y);return this.x=s.x+o*(this.x-s.x)-h*(this.y-s.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},j.convert=function(a){return a instanceof j?a:Array.isArray(a)?new j(a[0],a[1]):a};var L=k(P),Z=Y;function Y(a,s,o,h){this.cx=3*a,this.bx=3*(o-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(h-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=s,this.p2x=o,this.p2y=h}Y.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,s){if(s===void 0&&(s=1e-6),a<0)return 0;if(a>1)return 1;for(var o=a,h=0;h<8;h++){var p=this.sampleCurveX(o)-a;if(Math.abs(p)<s)return o;var x=this.sampleCurveDerivativeX(o);if(Math.abs(x)<1e-6)break;o-=p/x}var b=0,S=1;for(o=a,h=0;h<20&&(p=this.sampleCurveX(o),!(Math.abs(p-a)<s));h++)a>p?b=o:S=o,o=.5*(S-b)+b;return o},solve:function(a,s){return this.sampleCurveY(this.solveCurveX(a,s))}};var ce=k(Z);let de,G;function H(){return de==null&&(de=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),de}function W(){if(G==null&&(G=!1,H())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let h=0;h<5*5;h++){const p=4*h;s.fillStyle=`rgb(${p},${p+1},${p+2})`,s.fillRect(h%5,Math.floor(h/5),1,1)}const o=s.getImageData(0,0,5,5).data;for(let h=0;h<5*5*4;h++)if(h%4!=3&&o[h]!==h){G=!0;break}}}return G||!1}function ue(a,s,o,h){const p=new ce(a,s,o,h);return function(x){return p.solve(x)}}const me=ue(.25,.1,.25,1);function be(a,s,o){return Math.min(o,Math.max(s,a))}function Ce(a,s,o){const h=o-s,p=((a-s)%h+h)%h+s;return p===s?o:p}function Te(a,...s){for(const o of s)for(const h in o)a[h]=o[h];return a}let rt=1;function Ue(a,s,o){const h={};for(const p in a)h[p]=s.call(o||this,a[p],p,a);return h}function St(a,s,o){const h={};for(const p in a)s.call(o||this,a[p],p,a)&&(h[p]=a[p]);return h}function Oe(a){return Array.isArray(a)?a.map(Oe):typeof a=="object"&&a?Ue(a,Oe):a}const it={};function qe(a){it[a]||(typeof console<"u"&&console.warn(a),it[a]=!0)}function Et(a,s,o){return(o.y-a.y)*(s.x-a.x)>(s.y-a.y)*(o.x-a.x)}function ir(a){let s=0;for(let o,h,p=0,x=a.length,b=x-1;p<x;b=p++)o=a[p],h=a[b],s+=(h.x-o.x)*(o.y+h.y);return s}function vt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Be=null;function st(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ct(a,s,o,h,p){return w(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(a,{timestamp:0});try{const b=x==null?void 0:x.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const S=b.startsWith("BGR"),C=new Uint8ClampedArray(h*p*4);if(yield x.copyTo(C,function(M,N,B,F,U){const q=4*Math.max(-N,0),J=(Math.max(0,B)-B)*F*4+q,ne=4*F,le=Math.max(0,N),ve=Math.max(0,B);return{rect:{x:le,y:ve,width:Math.min(M.width,N+F)-le,height:Math.min(M.height,B+U)-ve},layout:[{offset:J,stride:ne}]}}(a,s,o,h,p)),S)for(let M=0;M<C.length;M+=4){const N=C[M];C[M]=C[M+2],C[M+2]=N}return C}finally{x.close()}})}let Nt,Ye,we,tt;const kt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const s=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(a,s=0){return this.getImageCanvasContext(a).getImageData(-s,-s,a.width+2*s,a.height+2*s)},getImageCanvasContext(a){const s=window.document.createElement("canvas"),o=s.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return s.width=a.width,s.height=a.height,o.drawImage(a,0,0,a.width,a.height),o},resolveURL:a=>(we||(we=document.createElement("a")),we.href=a,we.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(tt==null&&(tt=matchMedia("(prefers-reduced-motion: reduce)")),tt.matches)}},Ht={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class yt extends Error{constructor(s,o,h,p){super(`AJAXError: ${o} (${s}): ${h}`),this.status=s,this.statusText=o,this.url=h,this.body=p}}const _t=vt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,ur=a=>Ht.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))];function Ds(a,s){const o=new AbortController,h=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:_t(),signal:o.signal});let p=!1,x=!1;return a.type==="json"&&h.headers.set("Accept","application/json"),x||fetch(h).then(b=>b.ok?(S=>{(a.type==="arrayBuffer"||a.type==="image"?S.arrayBuffer():a.type==="json"?S.json():S.text()).then(C=>{x||(p=!0,s(null,C,S.headers.get("Cache-Control"),S.headers.get("Expires")))}).catch(C=>{x||s(new Error(C.message))})})(b):b.blob().then(S=>s(new yt(b.status,b.statusText,a.url,S)))).catch(b=>{b.code!==20&&s(new Error(b.message))}),{cancel:()=>{x=!0,p||o.abort()}}}const It=function(a,s){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(vt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s);if(!vt())return(ur(a.url)||Ds)(a,s)}if(!(/^file:/.test(o=a.url)||/^file:/.test(_t())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Ds(a,s);if(vt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,s,void 0,!0)}var o;return function(h,p){const x=new XMLHttpRequest;x.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(x.responseType="arraybuffer");for(const b in h.headers)x.setRequestHeader(b,h.headers[b]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let b=x.response;if(h.type==="json")try{b=JSON.parse(x.response)}catch(S){return p(S)}p(null,b,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else{const b=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new yt(x.status,x.statusText,h.url,b))}},x.send(h.body),{cancel:()=>x.abort()}}(a,s)},qr=function(a,s){return It(Te(a,{type:"arrayBuffer"}),s)};function Fi(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const s=new URL(a),o=window.location;return s.protocol===o.protocol&&s.host===o.host}function kn(a,s,o){o[a]&&o[a].indexOf(s)!==-1||(o[a]=o[a]||[],o[a].push(s))}function bi(a,s,o){if(o&&o[a]){const h=o[a].indexOf(s);h!==-1&&o[a].splice(h,1)}}class rn{constructor(s,o={}){Te(this,o),this.type=s}}class os extends rn{constructor(s,o={}){super("error",Te({error:s},o))}}class sn{on(s,o){return this._listeners=this._listeners||{},kn(s,o,this._listeners),this}off(s,o){return bi(s,o,this._listeners),bi(s,o,this._oneTimeListeners),this}once(s,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},kn(s,o,this._oneTimeListeners),this):new Promise(h=>this.once(s,h))}fire(s,o){typeof s=="string"&&(s=new rn(s,o||{}));const h=s.type;if(this.listens(h)){s.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const S of p)S.call(this,s);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const S of x)bi(h,S,this._oneTimeListeners),S.call(this,s);const b=this._eventedParent;b&&(Te(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(s))}else s instanceof os&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,o){return this._eventedParent=s,this._eventedParentData=o,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const fs=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ls(a,s){const o={};for(const h in a)h!=="ref"&&(o[h]=a[h]);return fs.forEach(h=>{h in s&&(o[h]=s[h])}),o}function nr(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(let o=0;o<a.length;o++)if(!nr(a[o],s[o]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(const o in a)if(!nr(a[o],s[o]))return!1;return!0}return a===s}const Wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function wi(a,s,o){o.push({command:Wt.addSource,args:[a,s[a]]})}function Zn(a,s,o){s.push({command:Wt.removeSource,args:[a]}),o[a]=!0}function $i(a,s,o,h){Zn(a,o,h),wi(a,s,o)}function ma(a,s,o){let h;for(h in a[o])if(Object.prototype.hasOwnProperty.call(a[o],h)&&h!=="data"&&!nr(a[o][h],s[o][h]))return!1;for(h in s[o])if(Object.prototype.hasOwnProperty.call(s[o],h)&&h!=="data"&&!nr(a[o][h],s[o][h]))return!1;return!0}function Hn(a,s,o,h,p,x){let b;for(b in s=s||{},a=a||{})Object.prototype.hasOwnProperty.call(a,b)&&(nr(a[b],s[b])||o.push({command:x,args:[h,b,s[b],p]}));for(b in s)Object.prototype.hasOwnProperty.call(s,b)&&!Object.prototype.hasOwnProperty.call(a,b)&&(nr(a[b],s[b])||o.push({command:x,args:[h,b,s[b],p]}))}function Ui(a){return a.id}function Tn(a,s){return a[s.id]=s,a}class Ve{constructor(s,o,h,p){this.message=(s?`${s}: `:"")+h,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function si(a,...s){for(const o of s)for(const h in o)a[h]=o[h];return a}class pr extends Error{constructor(s,o){super(o),this.message=o,this.key=s}}class En{constructor(s,o=[]){this.parent=s,this.bindings={};for(const[h,p]of o)this.bindings[h]=p}concat(s){return new En(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Vi={kind:"null"},Ge={kind:"number"},Mt={kind:"string"},Tt={kind:"boolean"},ps={kind:"color"},Si={kind:"object"},Pt={kind:"value"},qi={kind:"collator"},se={kind:"formatted"},I={kind:"padding"},O={kind:"resolvedImage"},V={kind:"variableAnchorOffsetCollection"};function K(a,s){return{kind:"array",itemType:a,N:s}}function te(a){if(a.kind==="array"){const s=te(a.itemType);return typeof a.N=="number"?`array<${s}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${s}>`}return a.kind}const pe=[Vi,Ge,Mt,Tt,ps,se,Si,K(Pt),I,O,V];function he(a,s){if(s.kind==="error")return null;if(a.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!he(a.itemType,s.itemType))&&(typeof a.N!="number"||a.N===s.N))return null}else{if(a.kind===s.kind)return null;if(a.kind==="value"){for(const o of pe)if(!he(o,s))return null}}return`Expected ${te(a)} but found ${te(s)} instead.`}function oe(a,s){return s.some(o=>o.kind===a.kind)}function ge(a,s){return s.some(o=>o==="null"?a===null:o==="array"?Array.isArray(a):o==="object"?a&&!Array.isArray(a)&&typeof a=="object":o===typeof a)}function Ie(a,s){return a.kind==="array"&&s.kind==="array"?a.itemType.kind===s.itemType.kind&&typeof a.N=="number":a.kind===s.kind}const Me=.96422,Ne=.82521,pt=4/29,wt=6/29,ot=3*wt*wt,gt=wt*wt*wt,At=Math.PI/180,rr=180/Math.PI;function lr(a){return(a%=360)<0&&(a+=360),a}function Zt([a,s,o,h]){let p,x;const b=ks((.2225045*(a=Gt(a))+.7168786*(s=Gt(s))+.0606169*(o=Gt(o)))/1);a===s&&s===o?p=x=b:(p=ks((.4360747*a+.3850649*s+.1430804*o)/Me),x=ks((.0139322*a+.0971045*s+.7141733*o)/Ne));const S=116*b-16;return[S<0?0:S,500*(p-b),200*(b-x),h]}function Gt(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ks(a){return a>gt?Math.pow(a,1/3):a/ot+pt}function hr([a,s,o,h]){let p=(a+16)/116,x=isNaN(s)?p:p+s/500,b=isNaN(o)?p:p-o/200;return p=1*ms(p),x=Me*ms(x),b=Ne*ms(b),[Gr(3.1338561*x-1.6168667*p-.4906146*b),Gr(-.9787684*x+1.9161415*p+.033454*b),Gr(.0719453*x-.2289914*p+1.4052427*b),h]}function Gr(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function ms(a){return a>wt?a*a*a:ot*(a-pt)}function ki(a){return parseInt(a.padEnd(2,a),16)/255}function ef(a,s){return Wa(s?a/100:a,0,1)}function Wa(a,s,o){return Math.min(Math.max(s,a),o)}function Za(a){return!a.some(Number.isNaN)}const hg={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ar{constructor(s,o,h,p=1,x=!0){this.r=s,this.g=o,this.b=h,this.a=p,x||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[s,o,h,p]))}static parse(s){if(s instanceof ar)return s;if(typeof s!="string")return;const o=function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=hg[h];if(p){const[b,S,C]=p;return[b/255,S/255,C/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const b=h.length<6?1:2;let S=1;return[ki(h.slice(S,S+=b)),ki(h.slice(S,S+=b)),ki(h.slice(S,S+=b)),ki(h.slice(S,S+b)||"ff")]}if(h.startsWith("rgb")){const b=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[S,C,M,N,B,F,U,q,J,ne,le,ve]=b,fe=[N||" ",U||" ",ne].join("");if(fe==="  "||fe==="  /"||fe===",,"||fe===",,,"){const xe=[M,F,J].join(""),ke=xe==="%%%"?100:xe===""?255:0;if(ke){const De=[Wa(+C/ke,0,1),Wa(+B/ke,0,1),Wa(+q/ke,0,1),le?ef(+le,ve):1];if(Za(De))return De}}return}}const x=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,S,C,M,N,B,F,U,q]=x,J=[C||" ",N||" ",F].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const ne=[+S,Wa(+M,0,100),Wa(+B,0,100),U?ef(+U,q):1];if(Za(ne))return function([le,ve,fe,xe]){function ke(De){const et=(De+le/30)%12,ct=ve*Math.min(fe,1-fe);return fe-ct*Math.max(-1,Math.min(et-3,9-et,1))}return le=lr(le),ve/=100,fe/=100,[ke(0),ke(8),ke(4),xe]}(ne)}}}(s);return o?new ar(...o,!1):void 0}get rgb(){const{r:s,g:o,b:h,a:p}=this,x=p||1/0;return this.overwriteGetter("rgb",[s/x,o/x,h/x,p])}get hcl(){return this.overwriteGetter("hcl",function(s){const[o,h,p,x]=Zt(s),b=Math.sqrt(h*h+p*p);return[Math.round(1e4*b)?lr(Math.atan2(p,h)*rr):NaN,b,o,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Zt(this.rgb))}overwriteGetter(s,o){return Object.defineProperty(this,s,{value:o}),o}toString(){const[s,o,h,p]=this.rgb;return`rgba(${[s,o,h].map(x=>Math.round(255*x)).join(",")},${p})`}}ar.black=new ar(0,0,0,1),ar.white=new ar(1,1,1,1),ar.transparent=new ar(0,0,0,0),ar.red=new ar(1,0,0,1);class ku{constructor(s,o,h){this.sensitivity=s?o?"variant":"case":o?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,o){return this.collator.compare(s,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bl{constructor(s,o,h,p,x){this.text=s,this.image=o,this.scale=h,this.fontStack=p,this.textColor=x}}class Ts{constructor(s){this.sections=s}static fromString(s){return new Ts([new Bl(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Ts?s:Ts.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class ii{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ii)return s;if(typeof s=="number")return new ii([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const o of s)if(typeof o!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new ii(s)}}toString(){return JSON.stringify(this.values)}}const dg=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ti{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Ti)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let o=0;o<s.length;o+=2){const h=s[o],p=s[o+1];if(typeof h!="string"||!dg.has(h)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new Ti(s)}}toString(){return JSON.stringify(this.values)}}class gs{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new gs({name:s,available:!1}):null}}function Ol(a,s,o,h){return typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof o=="number"&&o>=0&&o<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[a,s,o,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[a,s,o,h]:[a,s,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ha(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ar||a instanceof ku||a instanceof Ts||a instanceof ii||a instanceof Ti||a instanceof gs)return!0;if(Array.isArray(a)){for(const s of a)if(!Ha(s))return!1;return!0}if(typeof a=="object"){for(const s in a)if(!Ha(a[s]))return!1;return!0}return!1}function xr(a){if(a===null)return Vi;if(typeof a=="string")return Mt;if(typeof a=="boolean")return Tt;if(typeof a=="number")return Ge;if(a instanceof ar)return ps;if(a instanceof ku)return qi;if(a instanceof Ts)return se;if(a instanceof ii)return I;if(a instanceof Ti)return V;if(a instanceof gs)return O;if(Array.isArray(a)){const s=a.length;let o;for(const h of a){const p=xr(h);if(o){if(o===p)continue;o=Pt;break}o=p}return K(o||Pt,s)}return Si}function Yt(a){const s=typeof a;return a===null?"":s==="string"||s==="number"||s==="boolean"?String(a):a instanceof ar||a instanceof Ts||a instanceof ii||a instanceof Ti||a instanceof gs?a.toString():JSON.stringify(a)}class ga{constructor(s,o){this.type=s,this.value=o}static parse(s,o){if(s.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Ha(s[1]))return o.error("invalid value");const h=s[1];let p=xr(h);const x=o.expectedType;return p.kind!=="array"||p.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(p=x),new ga(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Er{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Fl={string:Mt,number:Ge,boolean:Tt,object:Si};class Ei{constructor(s,o){this.type=s,this.args=o}static parse(s,o){if(s.length<2)return o.error("Expected at least one argument.");let h,p=1;const x=s[0];if(x==="array"){let S,C;if(s.length>2){const M=s[1];if(typeof M!="string"||!(M in Fl)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);S=Fl[M],p++}else S=Pt;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=s[2],p++}h=K(S,C)}else{if(!Fl[x])throw new Error(`Types doesn't contain name = ${x}`);h=Fl[x]}const b=[];for(;p<s.length;p++){const S=o.parse(s[p],p,Pt);if(!S)return null;b.push(S)}return new Ei(h,b)}evaluate(s){for(let o=0;o<this.args.length;o++){const h=this.args[o].evaluate(s);if(!he(this.type,xr(h)))return h;if(o===this.args.length-1)throw new Er(`Expected value to be of type ${te(this.type)}, but found ${te(xr(h))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Tu={"to-boolean":Tt,"to-color":ps,"to-number":Ge,"to-string":Mt};class Kn{constructor(s,o){this.type=s,this.args=o}static parse(s,o){if(s.length<2)return o.error("Expected at least one argument.");const h=s[0];if(!Tu[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&s.length!==2)return o.error("Expected one argument.");const p=Tu[h],x=[];for(let b=1;b<s.length;b++){const S=o.parse(s[b],b,Pt);if(!S)return null;x.push(S)}return new Kn(p,x)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let o,h;for(const p of this.args){if(o=p.evaluate(s),h=null,o instanceof ar)return o;if(typeof o=="string"){const x=s.parseColor(o);if(x)return x}else if(Array.isArray(o)&&(h=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Ol(o[0],o[1],o[2],o[3]),!h))return new ar(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Er(h||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const h of this.args){o=h.evaluate(s);const p=ii.parse(o);if(p)return p}throw new Er(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const h of this.args){o=h.evaluate(s);const p=Ti.parse(o);if(p)return p}throw new Er(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const h of this.args){if(o=h.evaluate(s),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new Er(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Ts.fromString(Yt(this.args[0].evaluate(s)));case"resolvedImage":return gs.fromString(Yt(this.args[0].evaluate(s)));default:return Yt(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const tf=["Unknown","Point","LineString","Polygon"];class Eu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?tf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let o=this._parseColorCache[s];return o||(o=this._parseColorCache[s]=ar.parse(s)),o}}class $l{constructor(s,o,h=[],p,x=new En,b=[]){this.registry=s,this.path=h,this.key=h.map(S=>`[${S}]`).join(""),this.scope=x,this.errors=b,this.expectedType=p,this._isConstant=o}parse(s,o,h,p,x={}){return o?this.concat(o,h,p)._parse(s,x):this._parse(s,x)}_parse(s,o){function h(p,x,b){return b==="assert"?new Ei(x,[p]):b==="coerce"?new Kn(x,[p]):p}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=s[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[p];if(x){let b=x.parse(s,this);if(!b)return null;if(this.expectedType){const S=this.expectedType,C=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||C.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(S.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(S.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(S,C))return null}else b=h(b,S,o.typeAnnotation||"coerce");else b=h(b,S,o.typeAnnotation||"coerce");else b=h(b,S,o.typeAnnotation||"coerce");else b=h(b,S,o.typeAnnotation||"assert")}if(!(b instanceof ga)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const S=new Eu;try{b=new ga(b.type,b.evaluate(S))}catch(C){return this.error(C.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,o,h){const p=typeof s=="number"?this.path.concat(s):this.path,x=h?this.scope.concat(h):this.scope;return new $l(this.registry,this._isConstant,p,o||null,x,this.errors)}error(s,...o){const h=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new pr(h,s))}checkSubtype(s,o){const h=he(s,o);return h&&this.error(h),h}}class Ul{constructor(s,o,h){this.type=qi,this.locale=h,this.caseSensitive=s,this.diacriticSensitive=o}static parse(s,o){if(s.length!==2)return o.error("Expected one argument.");const h=s[1];if(typeof h!="object"||Array.isArray(h))return o.error("Collator options argument must be an object.");const p=o.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Tt);if(!p)return null;const x=o.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Tt);if(!x)return null;let b=null;return h.locale&&(b=o.parse(h.locale,1,Mt),!b)?null:new Ul(p,x,b)}evaluate(s){return new ku(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const Xn=8192;function Cu(a,s){a[0]=Math.min(a[0],s[0]),a[1]=Math.min(a[1],s[1]),a[2]=Math.max(a[2],s[0]),a[3]=Math.max(a[3],s[1])}function qo(a,s){return!(a[0]<=s[0]||a[2]>=s[2]||a[1]<=s[1]||a[3]>=s[3])}function rf(a,s){const o=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,s.z);return[Math.round(o*p*Xn),Math.round(h*p*Xn)]}function fg(a,s,o){const h=a[0]-s[0],p=a[1]-s[1],x=a[0]-o[0],b=a[1]-o[1];return h*b-x*p==0&&h*x<=0&&p*b<=0}function Au(a,s){let o=!1;for(let b=0,S=s.length;b<S;b++){const C=s[b];for(let M=0,N=C.length;M<N-1;M++){if(fg(a,C[M],C[M+1]))return!1;(p=C[M])[1]>(h=a)[1]!=(x=C[M+1])[1]>h[1]&&h[0]<(x[0]-p[0])*(h[1]-p[1])/(x[1]-p[1])+p[0]&&(o=!o)}}var h,p,x;return o}function Pu(a,s){for(let o=0;o<s.length;o++)if(Au(a,s[o]))return!0;return!1}function sf(a,s,o,h){const p=h[0]-o[0],x=h[1]-o[1],b=(a[0]-o[0])*x-p*(a[1]-o[1]),S=(s[0]-o[0])*x-p*(s[1]-o[1]);return b>0&&S<0||b<0&&S>0}function pg(a,s,o){for(const M of o)for(let N=0;N<M.length-1;++N)if((S=[(b=M[N+1])[0]-(x=M[N])[0],b[1]-x[1]])[0]*(C=[(p=s)[0]-(h=a)[0],p[1]-h[1]])[1]-S[1]*C[0]!=0&&sf(h,p,x,b)&&sf(x,b,h,p))return!0;var h,p,x,b,S,C;return!1}function nf(a,s){for(let o=0;o<a.length;++o)if(!Au(a[o],s))return!1;for(let o=0;o<a.length-1;++o)if(pg(a[o],a[o+1],s))return!1;return!0}function af(a,s){for(let o=0;o<s.length;o++)if(nf(a,s[o]))return!0;return!1}function Vl(a,s,o){const h=[];for(let p=0;p<a.length;p++){const x=[];for(let b=0;b<a[p].length;b++){const S=rf(a[p][b],o);Cu(s,S),x.push(S)}h.push(x)}return h}function of(a,s,o){const h=[];for(let p=0;p<a.length;p++){const x=Vl(a[p],s,o);h.push(x)}return h}function lf(a,s,o,h){if(a[0]<o[0]||a[0]>o[2]){const p=.5*h;let x=a[0]-o[0]>p?-h:o[0]-a[0]>p?h:0;x===0&&(x=a[0]-o[2]>p?-h:o[2]-a[0]>p?h:0),a[0]+=x}Cu(s,a)}function Iu(a,s,o,h){const p=Math.pow(2,h.z)*Xn,x=[h.x*Xn,h.y*Xn],b=[];for(const S of a)for(const C of S){const M=[C.x+x[0],C.y+x[1]];lf(M,s,o,p),b.push(M)}return b}function Mu(a,s,o,h){const p=Math.pow(2,h.z)*Xn,x=[h.x*Xn,h.y*Xn],b=[];for(const C of a){const M=[];for(const N of C){const B=[N.x+x[0],N.y+x[1]];Cu(s,B),M.push(B)}b.push(M)}if(s[2]-s[0]<=p/2){(S=s)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const C of b)for(const M of C)lf(M,s,o,p)}var S;return b}class ya{constructor(s,o){this.type=Tt,this.geojson=s,this.geometries=o}static parse(s,o){if(s.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Ha(s[1])){const h=s[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const x=h.features[p].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new ya(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ya(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new ya(h,h)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(o,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(h.type==="Polygon"){const S=Vl(h.coordinates,x,b),C=Iu(o.geometry(),p,x,b);if(!qo(p,x))return!1;for(const M of C)if(!Au(M,S))return!1}if(h.type==="MultiPolygon"){const S=of(h.coordinates,x,b),C=Iu(o.geometry(),p,x,b);if(!qo(p,x))return!1;for(const M of C)if(!Pu(M,S))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(o,h){const p=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(h.type==="Polygon"){const S=Vl(h.coordinates,x,b),C=Mu(o.geometry(),p,x,b);if(!qo(p,x))return!1;for(const M of C)if(!nf(M,S))return!1}if(h.type==="MultiPolygon"){const S=of(h.coordinates,x,b),C=Mu(o.geometry(),p,x,b);if(!qo(p,x))return!1;for(const M of C)if(!af(M,S))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class ql{constructor(s,o){this.type=o.type,this.name=s,this.boundExpression=o}static parse(s,o){if(s.length!==2||typeof s[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const h=s[1];return o.scope.has(h)?new ql(h,o.scope.get(h)):o.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Ci{constructor(s,o,h,p){this.name=s,this.type=o,this._evaluate=h,this.args=p}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,o){const h=s[0],p=Ci.definitions[h];if(!p)return o.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,S=b.filter(([M])=>!Array.isArray(M)||M.length===s.length-1);let C=null;for(const[M,N]of S){C=new $l(o.registry,Gl,o.path,null,o.scope);const B=[];let F=!1;for(let U=1;U<s.length;U++){const q=s[U],J=Array.isArray(M)?M[U-1]:M.type,ne=C.parse(q,1+B.length,J);if(!ne){F=!0;break}B.push(ne)}if(!F)if(Array.isArray(M)&&M.length!==B.length)C.error(`Expected ${M.length} arguments, but found ${B.length} instead.`);else{for(let U=0;U<B.length;U++){const q=Array.isArray(M)?M[U]:M.type,J=B[U];C.concat(U+1).checkSubtype(q,J.type)}if(C.errors.length===0)return new Ci(h,x,N,B)}}if(S.length===1)o.errors.push(...C.errors);else{const M=(S.length?S:b).map(([B])=>{return F=B,Array.isArray(F)?`(${F.map(te).join(", ")})`:`(${te(F.type)}...)`;var F}).join(" | "),N=[];for(let B=1;B<s.length;B++){const F=o.parse(s[B],1+N.length);if(!F)return null;N.push(te(F.type))}o.error(`Expected arguments of type ${M}, but found (${N.join(", ")}) instead.`)}return null}static register(s,o){Ci.definitions=o;for(const h in o)s[h]=Ci}}function Gl(a){if(a instanceof ql)return Gl(a.boundExpression);if(a instanceof Ci&&a.name==="error"||a instanceof Ul||a instanceof ya)return!1;const s=a instanceof Kn||a instanceof Ei;let o=!0;return a.eachChild(h=>{o=s?o&&Gl(h):o&&h instanceof ga}),!!o&&Wl(a)&&Zl(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wl(a){if(a instanceof Ci&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof ya)return!1;let s=!0;return a.eachChild(o=>{s&&!Wl(o)&&(s=!1)}),s}function Go(a){if(a instanceof Ci&&a.name==="feature-state")return!1;let s=!0;return a.eachChild(o=>{s&&!Go(o)&&(s=!1)}),s}function Zl(a,s){if(a instanceof Ci&&s.indexOf(a.name)>=0)return!1;let o=!0;return a.eachChild(h=>{o&&!Zl(h,s)&&(o=!1)}),o}function Ka(a,s){const o=a.length-1;let h,p,x=0,b=o,S=0;for(;x<=b;)if(S=Math.floor((x+b)/2),h=a[S],p=a[S+1],h<=s){if(S===o||s<p)return S;x=S+1}else{if(!(h>s))throw new Er("Input is not a number.");b=S-1}return 0}class Yn{constructor(s,o,h){this.type=s,this.input=o,this.labels=[],this.outputs=[];for(const[p,x]of h)this.labels.push(p),this.outputs.push(x)}static parse(s,o){if(s.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return o.error("Expected an even number of arguments.");const h=o.parse(s[1],1,Ge);if(!h)return null;const p=[];let x=null;o.expectedType&&o.expectedType.kind!=="value"&&(x=o.expectedType);for(let b=1;b<s.length;b+=2){const S=b===1?-1/0:s[b],C=s[b+1],M=b,N=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const B=o.parse(C,N,x);if(!B)return null;x=x||B.type,p.push([S,B])}return new Yn(x,h,p)}evaluate(s){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(s);const p=this.input.evaluate(s);if(p<=o[0])return h[0].evaluate(s);const x=o.length;return p>=o[x-1]?h[x-1].evaluate(s):h[Ka(o,p)].evaluate(s)}eachChild(s){s(this.input);for(const o of this.outputs)s(o)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Vt(a,s,o){return a+o*(s-a)}function Hl(a,s,o){return a.map((h,p)=>Vt(h,s[p],o))}const ni={number:Vt,color:function(a,s,o,h="rgb"){switch(h){case"rgb":{const[p,x,b,S]=Hl(a.rgb,s.rgb,o);return new ar(p,x,b,S,!1)}case"hcl":{const[p,x,b,S]=a.hcl,[C,M,N,B]=s.hcl;let F,U;if(isNaN(p)||isNaN(C))isNaN(p)?isNaN(C)?F=NaN:(F=C,b!==1&&b!==0||(U=M)):(F=p,N!==1&&N!==0||(U=x));else{let ve=C-p;C>p&&ve>180?ve-=360:C<p&&p-C>180&&(ve+=360),F=p+o*ve}const[q,J,ne,le]=function([ve,fe,xe,ke]){return ve=isNaN(ve)?0:ve*At,hr([xe,Math.cos(ve)*fe,Math.sin(ve)*fe,ke])}([F,U??Vt(x,M,o),Vt(b,N,o),Vt(S,B,o)]);return new ar(q,J,ne,le,!1)}case"lab":{const[p,x,b,S]=hr(Hl(a.lab,s.lab,o));return new ar(p,x,b,S,!1)}}},array:Hl,padding:function(a,s,o){return new ii(Hl(a.values,s.values,o))},variableAnchorOffsetCollection:function(a,s,o){const h=a.values,p=s.values;if(h.length!==p.length)throw new Er(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${s.toString()}`);const x=[];for(let b=0;b<h.length;b+=2){if(h[b]!==p[b])throw new Er(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${h[b]}, to[${b}]: ${p[b]}`);x.push(h[b]);const[S,C]=h[b+1],[M,N]=p[b+1];x.push([Vt(S,M,o),Vt(C,N,o)])}return new Ti(x)}};class ai{constructor(s,o,h,p,x){this.type=s,this.operator=o,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[b,S]of x)this.labels.push(b),this.outputs.push(S)}static interpolationFactor(s,o,h,p){let x=0;if(s.name==="exponential")x=ju(o,s.base,h,p);else if(s.name==="linear")x=ju(o,1,h,p);else if(s.name==="cubic-bezier"){const b=s.controlPoints;x=new ce(b[0],b[1],b[2],b[3]).solve(ju(o,1,h,p))}return x}static parse(s,o){let[h,p,x,...b]=s;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some(N=>typeof N!="number"||N<0||N>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(s.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(x=o.parse(x,2,Ge),!x)return null;const S=[];let C=null;h==="interpolate-hcl"||h==="interpolate-lab"?C=ps:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType);for(let M=0;M<b.length;M+=2){const N=b[M],B=b[M+1],F=M+3,U=M+4;if(typeof N!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(S.length&&S[S.length-1][0]>=N)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const q=o.parse(B,U,C);if(!q)return null;C=C||q.type,S.push([N,q])}return Ie(C,Ge)||Ie(C,ps)||Ie(C,I)||Ie(C,V)||Ie(C,K(Ge))?new ai(C,h,p,x,S):o.error(`Type ${te(C)} is not interpolatable.`)}evaluate(s){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(s);const p=this.input.evaluate(s);if(p<=o[0])return h[0].evaluate(s);const x=o.length;if(p>=o[x-1])return h[x-1].evaluate(s);const b=Ka(o,p),S=ai.interpolationFactor(this.interpolation,p,o[b],o[b+1]),C=h[b].evaluate(s),M=h[b+1].evaluate(s);switch(this.operator){case"interpolate":return ni[this.type.kind](C,M,S);case"interpolate-hcl":return ni.color(C,M,S,"hcl");case"interpolate-lab":return ni.color(C,M,S,"lab")}}eachChild(s){s(this.input);for(const o of this.outputs)s(o)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function ju(a,s,o,h){const p=h-o,x=a-o;return p===0?0:s===1?x/p:(Math.pow(s,x)-1)/(Math.pow(s,p)-1)}class Kl{constructor(s,o){this.type=s,this.args=o}static parse(s,o){if(s.length<2)return o.error("Expectected at least one argument.");let h=null;const p=o.expectedType;p&&p.kind!=="value"&&(h=p);const x=[];for(const S of s.slice(1)){const C=o.parse(S,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!C)return null;h=h||C.type,x.push(C)}if(!h)throw new Error("No output type");const b=p&&x.some(S=>he(p,S.type));return new Kl(b?Pt:h,x)}evaluate(s){let o,h=null,p=0;for(const x of this.args)if(p++,h=x.evaluate(s),h&&h instanceof gs&&!h.available&&(o||(o=h.name),h=null,p===this.args.length&&(h=o)),h!==null)break;return h}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Xl{constructor(s,o){this.type=o.type,this.bindings=[].concat(s),this.result=o}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const o of this.bindings)s(o[1]);s(this.result)}static parse(s,o){if(s.length<4)return o.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const h=[];for(let x=1;x<s.length-1;x+=2){const b=s[x];if(typeof b!="string")return o.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return o.error("Variable names must contain only alphanumeric characters or '_'.",x);const S=o.parse(s[x+1],x+1);if(!S)return null;h.push([b,S])}const p=o.parse(s[s.length-1],s.length-1,o.expectedType,h);return p?new Xl(h,p):null}outputDefined(){return this.result.outputDefined()}}class Du{constructor(s,o,h){this.type=s,this.index=o,this.input=h}static parse(s,o){if(s.length!==3)return o.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=o.parse(s[1],1,Ge),p=o.parse(s[2],2,K(o.expectedType||Pt));return h&&p?new Du(p.type.itemType,h,p):null}evaluate(s){const o=this.index.evaluate(s),h=this.input.evaluate(s);if(o<0)throw new Er(`Array index out of bounds: ${o} < 0.`);if(o>=h.length)throw new Er(`Array index out of bounds: ${o} > ${h.length-1}.`);if(o!==Math.floor(o))throw new Er(`Array index must be an integer, but found ${o} instead.`);return h[o]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Nu{constructor(s,o){this.type=Tt,this.needle=s,this.haystack=o}static parse(s,o){if(s.length!==3)return o.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const h=o.parse(s[1],1,Pt),p=o.parse(s[2],2,Pt);return h&&p?oe(h.type,[Tt,Mt,Ge,Vi,Pt])?new Nu(h,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(h.type)} instead`):null}evaluate(s){const o=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!h)return!1;if(!ge(o,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${te(xr(o))} instead.`);if(!ge(h,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${te(xr(h))} instead.`);return h.indexOf(o)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Yl{constructor(s,o,h){this.type=Ge,this.needle=s,this.haystack=o,this.fromIndex=h}static parse(s,o){if(s.length<=2||s.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const h=o.parse(s[1],1,Pt),p=o.parse(s[2],2,Pt);if(!h||!p)return null;if(!oe(h.type,[Tt,Mt,Ge,Vi,Pt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(h.type)} instead`);if(s.length===4){const x=o.parse(s[3],3,Ge);return x?new Yl(h,p,x):null}return new Yl(h,p)}evaluate(s){const o=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!ge(o,["boolean","string","number","null"]))throw new Er(`Expected first argument to be of type boolean, string, number or null, but found ${te(xr(o))} instead.`);if(!ge(h,["string","array"]))throw new Er(`Expected second argument to be of type array or string, but found ${te(xr(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(s);return h.indexOf(o,p)}return h.indexOf(o)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Lu{constructor(s,o,h,p,x,b){this.inputType=s,this.type=o,this.input=h,this.cases=p,this.outputs=x,this.otherwise=b}static parse(s,o){if(s.length<5)return o.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return o.error("Expected an even number of arguments.");let h,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const x={},b=[];for(let M=2;M<s.length-1;M+=2){let N=s[M];const B=s[M+1];Array.isArray(N)||(N=[N]);const F=o.concat(M);if(N.length===0)return F.error("Expected at least one branch label.");for(const q of N){if(typeof q!="number"&&typeof q!="string")return F.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return F.error("Numeric branch labels must be integer values.");if(h){if(F.checkSubtype(h,xr(q)))return null}else h=xr(q);if(x[String(q)]!==void 0)return F.error("Branch labels must be unique.");x[String(q)]=b.length}const U=o.parse(B,M,p);if(!U)return null;p=p||U.type,b.push(U)}const S=o.parse(s[1],1,Pt);if(!S)return null;const C=o.parse(s[s.length-1],s.length-1,p);return C?S.type.kind!=="value"&&o.concat(1).checkSubtype(h,S.type)?null:new Lu(h,p,S,x,b,C):null}evaluate(s){const o=this.input.evaluate(s);return(xr(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Ru{constructor(s,o,h){this.type=s,this.branches=o,this.otherwise=h}static parse(s,o){if(s.length<4)return o.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return o.error("Expected an odd number of arguments.");let h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const p=[];for(let b=1;b<s.length-1;b+=2){const S=o.parse(s[b],b,Tt);if(!S)return null;const C=o.parse(s[b+1],b+1,h);if(!C)return null;p.push([S,C]),h=h||C.type}const x=o.parse(s[s.length-1],s.length-1,h);if(!x)return null;if(!h)throw new Error("Can't infer output type");return new Ru(h,p,x)}evaluate(s){for(const[o,h]of this.branches)if(o.evaluate(s))return h.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[o,h]of this.branches)s(o),s(h);s(this.otherwise)}outputDefined(){return this.branches.every(([s,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class Jl{constructor(s,o,h,p){this.type=s,this.input=o,this.beginIndex=h,this.endIndex=p}static parse(s,o){if(s.length<=2||s.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const h=o.parse(s[1],1,Pt),p=o.parse(s[2],2,Ge);if(!h||!p)return null;if(!oe(h.type,[K(Pt),Mt,Pt]))return o.error(`Expected first argument to be of type array or string, but found ${te(h.type)} instead`);if(s.length===4){const x=o.parse(s[3],3,Ge);return x?new Jl(h.type,h,p,x):null}return new Jl(h.type,h,p)}evaluate(s){const o=this.input.evaluate(s),h=this.beginIndex.evaluate(s);if(!ge(o,["string","array"]))throw new Er(`Expected first argument to be of type array or string, but found ${te(xr(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(s);return o.slice(h,p)}return o.slice(h)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function cf(a,s){return a==="=="||a==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function uf(a,s,o,h){return h.compare(s,o)===0}function Xa(a,s,o){const h=a!=="=="&&a!=="!=";return class AE{constructor(x,b,S){this.type=Tt,this.lhs=x,this.rhs=b,this.collator=S,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const S=x[0];let C=b.parse(x[1],1,Pt);if(!C)return null;if(!cf(S,C.type))return b.concat(1).error(`"${S}" comparisons are not supported for type '${te(C.type)}'.`);let M=b.parse(x[2],2,Pt);if(!M)return null;if(!cf(S,M.type))return b.concat(2).error(`"${S}" comparisons are not supported for type '${te(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${te(C.type)}' and '${te(M.type)}'.`);h&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new Ei(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new Ei(C.type,[M])));let N=null;if(x.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(N=b.parse(x[3],3,qi),!N)return null}return new AE(C,M,N)}evaluate(x){const b=this.lhs.evaluate(x),S=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const C=xr(b),M=xr(S);if(C.kind!==M.kind||C.kind!=="string"&&C.kind!=="number")throw new Er(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=xr(b),M=xr(S);if(C.kind!=="string"||M.kind!=="string")return s(x,b,S)}return this.collator?o(x,b,S,this.collator.evaluate(x)):s(x,b,S)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const mg=Xa("==",function(a,s,o){return s===o},uf),gg=Xa("!=",function(a,s,o){return s!==o},function(a,s,o,h){return!uf(0,s,o,h)}),yg=Xa("<",function(a,s,o){return s<o},function(a,s,o,h){return h.compare(s,o)<0}),_g=Xa(">",function(a,s,o){return s>o},function(a,s,o,h){return h.compare(s,o)>0}),vg=Xa("<=",function(a,s,o){return s<=o},function(a,s,o,h){return h.compare(s,o)<=0}),xg=Xa(">=",function(a,s,o){return s>=o},function(a,s,o,h){return h.compare(s,o)>=0});class zu{constructor(s,o,h,p,x){this.type=Mt,this.number=s,this.locale=o,this.currency=h,this.minFractionDigits=p,this.maxFractionDigits=x}static parse(s,o){if(s.length!==3)return o.error("Expected two arguments.");const h=o.parse(s[1],1,Ge);if(!h)return null;const p=s[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let x=null;if(p.locale&&(x=o.parse(p.locale,1,Mt),!x))return null;let b=null;if(p.currency&&(b=o.parse(p.currency,1,Mt),!b))return null;let S=null;if(p["min-fraction-digits"]&&(S=o.parse(p["min-fraction-digits"],1,Ge),!S))return null;let C=null;return p["max-fraction-digits"]&&(C=o.parse(p["max-fraction-digits"],1,Ge),!C)?null:new zu(h,x,b,S,C)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Ql{constructor(s){this.type=se,this.sections=s}static parse(s,o){if(s.length<2)return o.error("Expected at least one argument.");const h=s[1];if(!Array.isArray(h)&&typeof h=="object")return o.error("First argument must be an image or text section.");const p=[];let x=!1;for(let b=1;b<=s.length-1;++b){const S=s[b];if(x&&typeof S=="object"&&!Array.isArray(S)){x=!1;let C=null;if(S["font-scale"]&&(C=o.parse(S["font-scale"],1,Ge),!C))return null;let M=null;if(S["text-font"]&&(M=o.parse(S["text-font"],1,K(Mt)),!M))return null;let N=null;if(S["text-color"]&&(N=o.parse(S["text-color"],1,ps),!N))return null;const B=p[p.length-1];B.scale=C,B.font=M,B.textColor=N}else{const C=o.parse(s[b],1,Pt);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new Ql(p)}evaluate(s){return new Ts(this.sections.map(o=>{const h=o.content.evaluate(s);return xr(h)===O?new Bl("",h,null,null,null):new Bl(Yt(h),null,o.scale?o.scale.evaluate(s):null,o.font?o.font.evaluate(s).join(","):null,o.textColor?o.textColor.evaluate(s):null)}))}eachChild(s){for(const o of this.sections)s(o.content),o.scale&&s(o.scale),o.font&&s(o.font),o.textColor&&s(o.textColor)}outputDefined(){return!1}}class Bu{constructor(s){this.type=O,this.input=s}static parse(s,o){if(s.length!==2)return o.error("Expected two arguments.");const h=o.parse(s[1],1,Mt);return h?new Bu(h):o.error("No image name provided.")}evaluate(s){const o=this.input.evaluate(s),h=gs.fromString(o);return h&&s.availableImages&&(h.available=s.availableImages.indexOf(o)>-1),h}eachChild(s){s(this.input)}outputDefined(){return!1}}class Ou{constructor(s){this.type=Ge,this.input=s}static parse(s,o){if(s.length!==2)return o.error(`Expected 1 argument, but found ${s.length-1} instead.`);const h=o.parse(s[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${te(h.type)} instead.`):new Ou(h):null}evaluate(s){const o=this.input.evaluate(s);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Er(`Expected value to be of type string or array, but found ${te(xr(o))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Ya={"==":mg,"!=":gg,">":_g,"<":yg,">=":xg,"<=":vg,array:Ei,at:Du,boolean:Ei,case:Ru,coalesce:Kl,collator:Ul,format:Ql,image:Bu,in:Nu,"index-of":Yl,interpolate:ai,"interpolate-hcl":ai,"interpolate-lab":ai,length:Ou,let:Xl,literal:ga,match:Lu,number:Ei,"number-format":zu,object:Ei,slice:Jl,step:Yn,string:Ei,"to-boolean":Kn,"to-color":Kn,"to-number":Kn,"to-string":Kn,var:ql,within:ya};function hf(a,[s,o,h,p]){s=s.evaluate(a),o=o.evaluate(a),h=h.evaluate(a);const x=p?p.evaluate(a):1,b=Ol(s,o,h,x);if(b)throw new Er(b);return new ar(s/255,o/255,h/255,x,!1)}function df(a,s){return a in s}function Fu(a,s){const o=s[a];return o===void 0?null:o}function _a(a){return{type:a}}function ff(a){return{result:"success",value:a}}function Jn(a){return{result:"error",value:a}}function Ja(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function pf(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function $u(a){return!!a.expression&&a.expression.interpolated}function Jt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function br(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function bg(a){return a}function qt(a,s){const o=s.type==="color",h=a.stops&&typeof a.stops[0][0]=="object",p=h||!(h||a.property!==void 0),x=a.type||($u(s)?"exponential":"interval");if(o||s.type==="padding"){const N=o?ar.parse:ii.parse;(a=si({},a)).stops&&(a.stops=a.stops.map(B=>[B[0],N(B[1])])),a.default=N(a.default?a.default:s.default)}if(a.colorSpace&&(b=a.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var b;let S,C,M;if(x==="exponential")S=Wo;else if(x==="interval")S=_r;else if(x==="categorical"){S=wr,C=Object.create(null);for(const N of a.stops)C[N[0]]=N[1];M=typeof a.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);S=mf}if(h){const N={},B=[];for(let q=0;q<a.stops.length;q++){const J=a.stops[q],ne=J[0].zoom;N[ne]===void 0&&(N[ne]={zoom:ne,type:a.type,property:a.property,default:a.default,stops:[]},B.push(ne)),N[ne].stops.push([J[0].value,J[1]])}const F=[];for(const q of B)F.push([N[q].zoom,qt(N[q],s)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:ai.interpolationFactor.bind(void 0,U),zoomStops:F.map(q=>q[0]),evaluate:({zoom:q},J)=>Wo({stops:F,base:a.base},s,q).evaluate(q,J)}}if(p){const N=x==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:ai.interpolationFactor.bind(void 0,N),zoomStops:a.stops.map(B=>B[0]),evaluate:({zoom:B})=>S(a,s,B,C,M)}}return{kind:"source",evaluate(N,B){const F=B&&B.properties?B.properties[a.property]:void 0;return F===void 0?va(a.default,s.default):S(a,s,F,C,M)}}}function va(a,s,o){return a!==void 0?a:s!==void 0?s:o!==void 0?o:void 0}function wr(a,s,o,h,p){return va(typeof o===p?h[o]:void 0,a.default,s.default)}function _r(a,s,o){if(Jt(o)!=="number")return va(a.default,s.default);const h=a.stops.length;if(h===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[h-1][0])return a.stops[h-1][1];const p=Ka(a.stops.map(x=>x[0]),o);return a.stops[p][1]}function Wo(a,s,o){const h=a.base!==void 0?a.base:1;if(Jt(o)!=="number")return va(a.default,s.default);const p=a.stops.length;if(p===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[p-1][0])return a.stops[p-1][1];const x=Ka(a.stops.map(N=>N[0]),o),b=function(N,B,F,U){const q=U-F,J=N-F;return q===0?0:B===1?J/q:(Math.pow(B,J)-1)/(Math.pow(B,q)-1)}(o,h,a.stops[x][0],a.stops[x+1][0]),S=a.stops[x][1],C=a.stops[x+1][1],M=ni[s.type]||bg;return typeof S.evaluate=="function"?{evaluate(...N){const B=S.evaluate.apply(void 0,N),F=C.evaluate.apply(void 0,N);if(B!==void 0&&F!==void 0)return M(B,F,b,a.colorSpace)}}:M(S,C,b,a.colorSpace)}function mf(a,s,o){switch(s.type){case"color":o=ar.parse(o);break;case"formatted":o=Ts.fromString(o.toString());break;case"resolvedImage":o=gs.fromString(o.toString());break;case"padding":o=ii.parse(o);break;default:Jt(o)===s.type||s.type==="enum"&&s.values[o]||(o=void 0)}return va(o,a.default,s.default)}Ci.register(Ya,{error:[{kind:"error"},[Mt],(a,[s])=>{throw new Er(s.evaluate(a))}],typeof:[Mt,[Pt],(a,[s])=>te(xr(s.evaluate(a)))],"to-rgba":[K(Ge,4),[ps],(a,[s])=>{const[o,h,p,x]=s.evaluate(a).rgb;return[255*o,255*h,255*p,x]}],rgb:[ps,[Ge,Ge,Ge],hf],rgba:[ps,[Ge,Ge,Ge,Ge],hf],has:{type:Tt,overloads:[[[Mt],(a,[s])=>df(s.evaluate(a),a.properties())],[[Mt,Si],(a,[s,o])=>df(s.evaluate(a),o.evaluate(a))]]},get:{type:Pt,overloads:[[[Mt],(a,[s])=>Fu(s.evaluate(a),a.properties())],[[Mt,Si],(a,[s,o])=>Fu(s.evaluate(a),o.evaluate(a))]]},"feature-state":[Pt,[Mt],(a,[s])=>Fu(s.evaluate(a),a.featureState||{})],properties:[Si,[],a=>a.properties()],"geometry-type":[Mt,[],a=>a.geometryType()],id:[Pt,[],a=>a.id()],zoom:[Ge,[],a=>a.globals.zoom],"heatmap-density":[Ge,[],a=>a.globals.heatmapDensity||0],"line-progress":[Ge,[],a=>a.globals.lineProgress||0],accumulated:[Pt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Ge,_a(Ge),(a,s)=>{let o=0;for(const h of s)o+=h.evaluate(a);return o}],"*":[Ge,_a(Ge),(a,s)=>{let o=1;for(const h of s)o*=h.evaluate(a);return o}],"-":{type:Ge,overloads:[[[Ge,Ge],(a,[s,o])=>s.evaluate(a)-o.evaluate(a)],[[Ge],(a,[s])=>-s.evaluate(a)]]},"/":[Ge,[Ge,Ge],(a,[s,o])=>s.evaluate(a)/o.evaluate(a)],"%":[Ge,[Ge,Ge],(a,[s,o])=>s.evaluate(a)%o.evaluate(a)],ln2:[Ge,[],()=>Math.LN2],pi:[Ge,[],()=>Math.PI],e:[Ge,[],()=>Math.E],"^":[Ge,[Ge,Ge],(a,[s,o])=>Math.pow(s.evaluate(a),o.evaluate(a))],sqrt:[Ge,[Ge],(a,[s])=>Math.sqrt(s.evaluate(a))],log10:[Ge,[Ge],(a,[s])=>Math.log(s.evaluate(a))/Math.LN10],ln:[Ge,[Ge],(a,[s])=>Math.log(s.evaluate(a))],log2:[Ge,[Ge],(a,[s])=>Math.log(s.evaluate(a))/Math.LN2],sin:[Ge,[Ge],(a,[s])=>Math.sin(s.evaluate(a))],cos:[Ge,[Ge],(a,[s])=>Math.cos(s.evaluate(a))],tan:[Ge,[Ge],(a,[s])=>Math.tan(s.evaluate(a))],asin:[Ge,[Ge],(a,[s])=>Math.asin(s.evaluate(a))],acos:[Ge,[Ge],(a,[s])=>Math.acos(s.evaluate(a))],atan:[Ge,[Ge],(a,[s])=>Math.atan(s.evaluate(a))],min:[Ge,_a(Ge),(a,s)=>Math.min(...s.map(o=>o.evaluate(a)))],max:[Ge,_a(Ge),(a,s)=>Math.max(...s.map(o=>o.evaluate(a)))],abs:[Ge,[Ge],(a,[s])=>Math.abs(s.evaluate(a))],round:[Ge,[Ge],(a,[s])=>{const o=s.evaluate(a);return o<0?-Math.round(-o):Math.round(o)}],floor:[Ge,[Ge],(a,[s])=>Math.floor(s.evaluate(a))],ceil:[Ge,[Ge],(a,[s])=>Math.ceil(s.evaluate(a))],"filter-==":[Tt,[Mt,Pt],(a,[s,o])=>a.properties()[s.value]===o.value],"filter-id-==":[Tt,[Pt],(a,[s])=>a.id()===s.value],"filter-type-==":[Tt,[Mt],(a,[s])=>a.geometryType()===s.value],"filter-<":[Tt,[Mt,Pt],(a,[s,o])=>{const h=a.properties()[s.value],p=o.value;return typeof h==typeof p&&h<p}],"filter-id-<":[Tt,[Pt],(a,[s])=>{const o=a.id(),h=s.value;return typeof o==typeof h&&o<h}],"filter->":[Tt,[Mt,Pt],(a,[s,o])=>{const h=a.properties()[s.value],p=o.value;return typeof h==typeof p&&h>p}],"filter-id->":[Tt,[Pt],(a,[s])=>{const o=a.id(),h=s.value;return typeof o==typeof h&&o>h}],"filter-<=":[Tt,[Mt,Pt],(a,[s,o])=>{const h=a.properties()[s.value],p=o.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[Tt,[Pt],(a,[s])=>{const o=a.id(),h=s.value;return typeof o==typeof h&&o<=h}],"filter->=":[Tt,[Mt,Pt],(a,[s,o])=>{const h=a.properties()[s.value],p=o.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[Tt,[Pt],(a,[s])=>{const o=a.id(),h=s.value;return typeof o==typeof h&&o>=h}],"filter-has":[Tt,[Pt],(a,[s])=>s.value in a.properties()],"filter-has-id":[Tt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Tt,[K(Mt)],(a,[s])=>s.value.indexOf(a.geometryType())>=0],"filter-id-in":[Tt,[K(Pt)],(a,[s])=>s.value.indexOf(a.id())>=0],"filter-in-small":[Tt,[Mt,K(Pt)],(a,[s,o])=>o.value.indexOf(a.properties()[s.value])>=0],"filter-in-large":[Tt,[Mt,K(Pt)],(a,[s,o])=>function(h,p,x,b){for(;x<=b;){const S=x+b>>1;if(p[S]===h)return!0;p[S]>h?b=S-1:x=S+1}return!1}(a.properties()[s.value],o.value,0,o.value.length-1)],all:{type:Tt,overloads:[[[Tt,Tt],(a,[s,o])=>s.evaluate(a)&&o.evaluate(a)],[_a(Tt),(a,s)=>{for(const o of s)if(!o.evaluate(a))return!1;return!0}]]},any:{type:Tt,overloads:[[[Tt,Tt],(a,[s,o])=>s.evaluate(a)||o.evaluate(a)],[_a(Tt),(a,s)=>{for(const o of s)if(o.evaluate(a))return!0;return!1}]]},"!":[Tt,[Tt],(a,[s])=>!s.evaluate(a)],"is-supported-script":[Tt,[Mt],(a,[s])=>{const o=a.globals&&a.globals.isSupportedScript;return!o||o(s.evaluate(a))}],upcase:[Mt,[Mt],(a,[s])=>s.evaluate(a).toUpperCase()],downcase:[Mt,[Mt],(a,[s])=>s.evaluate(a).toLowerCase()],concat:[Mt,_a(Pt),(a,s)=>s.map(o=>Yt(o.evaluate(a))).join("")],"resolved-locale":[Mt,[qi],(a,[s])=>s.evaluate(a).resolvedLocale()]});class Uu{constructor(s,o){var h;this.expression=s,this._warningHistory={},this._evaluator=new Eu,this._defaultValue=o?(h=o).type==="color"&&br(h.default)?new ar(0,0,0,0):h.type==="color"?ar.parse(h.default)||null:h.type==="padding"?ii.parse(h.default)||null:h.type==="variableAnchorOffsetCollection"?Ti.parse(h.default)||null:h.default===void 0?null:h.default:null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(s,o,h,p,x,b){return this._evaluator.globals=s,this._evaluator.feature=o,this._evaluator.featureState=h,this._evaluator.canonical=p,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(s,o,h,p,x,b){this._evaluator.globals=s,this._evaluator.feature=o||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Er(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function ec(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ya}function tc(a,s){const o=new $l(Ya,Gl,[],s?function(p){const x={color:ps,string:Mt,number:Ge,enum:Mt,boolean:Tt,formatted:se,padding:I,resolvedImage:O,variableAnchorOffsetCollection:V};return p.type==="array"?K(x[p.value]||Pt,p.length):x[p.type]}(s):void 0),h=o.parse(a,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?ff(new Uu(h,s)):Jn(o.errors)}class Vu{constructor(s,o){this.kind=s,this._styleExpression=o,this.isStateDependent=s!=="constant"&&!Go(o.expression)}evaluateWithoutErrorHandling(s,o,h,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(s,o,h,p,x,b)}evaluate(s,o,h,p,x,b){return this._styleExpression.evaluate(s,o,h,p,x,b)}}class rc{constructor(s,o,h,p){this.kind=s,this.zoomStops=h,this._styleExpression=o,this.isStateDependent=s!=="camera"&&!Go(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(s,o,h,p,x,b){return this._styleExpression.evaluateWithoutErrorHandling(s,o,h,p,x,b)}evaluate(s,o,h,p,x,b){return this._styleExpression.evaluate(s,o,h,p,x,b)}interpolationFactor(s,o,h){return this.interpolationType?ai.interpolationFactor(this.interpolationType,s,o,h):0}}function qu(a,s){const o=tc(a,s);if(o.result==="error")return o;const h=o.value.expression,p=Wl(h);if(!p&&!Ja(s))return Jn([new pr("","data expressions not supported")]);const x=Zl(h,["zoom"]);if(!x&&!pf(s))return Jn([new pr("","zoom expressions not supported")]);const b=Ho(h);return b||x?b instanceof pr?Jn([b]):b instanceof ai&&!$u(s)?Jn([new pr("",'"interpolate" expressions cannot be used with this property')]):ff(b?new rc(p?"camera":"composite",o.value,b.labels,b instanceof ai?b.interpolation:void 0):new Vu(p?"constant":"source",o.value)):Jn([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zo{constructor(s,o){this._parameters=s,this._specification=o,si(this,qt(this._parameters,this._specification))}static deserialize(s){return new Zo(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Ho(a){let s=null;if(a instanceof Xl)s=Ho(a.result);else if(a instanceof Kl){for(const o of a.args)if(s=Ho(o),s)break}else(a instanceof Yn||a instanceof ai)&&a.input instanceof Ci&&a.input.name==="zoom"&&(s=a);return s instanceof pr||a.eachChild(o=>{const h=Ho(o);h instanceof pr?s=h:!s&&h?s=new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&h&&s!==h&&(s=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Ko(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const s of a.slice(1))if(!Ko(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const wg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gu(a){if(a==null)return{filter:()=>!0,needGeometry:!1};Ko(a)||(a=sc(a));const s=tc(a,wg);if(s.result==="error")throw new Error(s.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,h,p)=>s.value.evaluate(o,h,{},p),needGeometry:gf(a)}}function Sg(a,s){return a<s?-1:a>s?1:0}function gf(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let s=1;s<a.length;s++)if(gf(a[s]))return!0;return!1}function sc(a){if(!a)return!0;const s=a[0];return a.length<=1?s!=="any":s==="=="?Wu(a[1],a[2],"=="):s==="!="?Xo(Wu(a[1],a[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Wu(a[1],a[2],s):s==="any"?(o=a.slice(1),["any"].concat(o.map(sc))):s==="all"?["all"].concat(a.slice(1).map(sc)):s==="none"?["all"].concat(a.slice(1).map(sc).map(Xo)):s==="in"?yf(a[1],a.slice(2)):s==="!in"?Xo(yf(a[1],a.slice(2))):s==="has"?_f(a[1]):s==="!has"?Xo(_f(a[1])):s!=="within"||a;var o}function Wu(a,s,o){switch(a){case"$type":return[`filter-type-${o}`,s];case"$id":return[`filter-id-${o}`,s];default:return[`filter-${o}`,a,s]}}function yf(a,s){if(s.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(o=>typeof o!=typeof s[0])?["filter-in-large",a,["literal",s.sort(Sg)]]:["filter-in-small",a,["literal",s]]}}function _f(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Xo(a){return["!",a]}function ic(a){const s=typeof a;if(s==="number"||s==="boolean"||s==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let p="[";for(const x of a)p+=`${ic(x)},`;return`${p}]`}const o=Object.keys(a).sort();let h="{";for(let p=0;p<o.length;p++)h+=`${JSON.stringify(o[p])}:${ic(a[o[p]])},`;return`${h}}`}function nc(a){let s="";for(const o of fs)s+=`/${ic(a[o])}`;return s}function vf(a){const s=a.value;return s?[new Ve(a.key,s,"constants have been deprecated as of v8")]:[]}function Cr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function xa(a){if(Array.isArray(a))return a.map(xa);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const s={};for(const o in a)s[o]=xa(a[o]);return s}return Cr(a)}function qs(a){const s=a.key,o=a.value,h=a.valueSpec||{},p=a.objectElementValidators||{},x=a.style,b=a.styleSpec,S=a.validateSpec;let C=[];const M=Jt(o);if(M!=="object")return[new Ve(s,o,`object expected, ${M} found`)];for(const N in o){const B=N.split(".")[0],F=h[B]||h["*"];let U;if(p[B])U=p[B];else if(h[B])U=S;else if(p["*"])U=p["*"];else{if(!h["*"]){C.push(new Ve(s,o[N],`unknown property "${N}"`));continue}U=S}C=C.concat(U({key:(s&&`${s}.`)+N,value:o[N],valueSpec:F,style:x,styleSpec:b,object:o,objectKey:N,validateSpec:S},o))}for(const N in h)p[N]||h[N].required&&h[N].default===void 0&&o[N]===void 0&&C.push(new Ve(s,o,`missing required property "${N}"`));return C}function Qa(a){const s=a.value,o=a.valueSpec,h=a.style,p=a.styleSpec,x=a.key,b=a.arrayElementValidator||a.validateSpec;if(Jt(s)!=="array")return[new Ve(x,s,`array expected, ${Jt(s)} found`)];if(o.length&&s.length!==o.length)return[new Ve(x,s,`array length ${o.length} expected, length ${s.length} found`)];if(o["min-length"]&&s.length<o["min-length"])return[new Ve(x,s,`array length at least ${o["min-length"]} expected, length ${s.length} found`)];let S={type:o.value,values:o.values};p.$version<7&&(S.function=o.function),Jt(o.value)==="object"&&(S=o.value);let C=[];for(let M=0;M<s.length;M++)C=C.concat(b({array:s,arrayIndex:M,value:s[M],valueSpec:S,validateSpec:a.validateSpec,style:h,styleSpec:p,key:`${x}[${M}]`}));return C}function Yo(a){const s=a.key,o=a.value,h=a.valueSpec;let p=Jt(o);return p==="number"&&o!=o&&(p="NaN"),p!=="number"?[new Ve(s,o,`number expected, ${p} found`)]:"minimum"in h&&o<h.minimum?[new Ve(s,o,`${o} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&o>h.maximum?[new Ve(s,o,`${o} is greater than the maximum value ${h.maximum}`)]:[]}function ac(a){const s=a.valueSpec,o=Cr(a.value.type);let h,p,x,b={};const S=o!=="categorical"&&a.value.property===void 0,C=!S,M=Jt(a.value.stops)==="array"&&Jt(a.value.stops[0])==="array"&&Jt(a.value.stops[0][0])==="object",N=qs({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(U){if(o==="identity")return[new Ve(U.key,U.value,'identity function may not have a "stops" property')];let q=[];const J=U.value;return q=q.concat(Qa({key:U.key,value:J,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:B})),Jt(J)==="array"&&J.length===0&&q.push(new Ve(U.key,J,"array must have at least one stop")),q},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:s,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return o==="identity"&&S&&N.push(new Ve(a.key,a.value,'missing required property "property"')),o==="identity"||a.value.stops||N.push(new Ve(a.key,a.value,'missing required property "stops"')),o==="exponential"&&a.valueSpec.expression&&!$u(a.valueSpec)&&N.push(new Ve(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(C&&!Ja(a.valueSpec)?N.push(new Ve(a.key,a.value,"property functions not supported")):S&&!pf(a.valueSpec)&&N.push(new Ve(a.key,a.value,"zoom functions not supported"))),o!=="categorical"&&!M||a.value.property!==void 0||N.push(new Ve(a.key,a.value,'"property" property is required')),N;function B(U){let q=[];const J=U.value,ne=U.key;if(Jt(J)!=="array")return[new Ve(ne,J,`array expected, ${Jt(J)} found`)];if(J.length!==2)return[new Ve(ne,J,`array length 2 expected, length ${J.length} found`)];if(M){if(Jt(J[0])!=="object")return[new Ve(ne,J,`object expected, ${Jt(J[0])} found`)];if(J[0].zoom===void 0)return[new Ve(ne,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new Ve(ne,J,"object stop key must have value")];if(x&&x>Cr(J[0].zoom))return[new Ve(ne,J[0].zoom,"stop zoom values must appear in ascending order")];Cr(J[0].zoom)!==x&&(x=Cr(J[0].zoom),p=void 0,b={}),q=q.concat(qs({key:`${ne}[0]`,value:J[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Yo,value:F}}))}else q=q.concat(F({key:`${ne}[0]`,value:J[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},J));return ec(xa(J[1]))?q.concat([new Ve(`${ne}[1]`,J[1],"expressions are not allowed in function stops.")]):q.concat(U.validateSpec({key:`${ne}[1]`,value:J[1],valueSpec:s,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function F(U,q){const J=Jt(U.value),ne=Cr(U.value),le=U.value!==null?U.value:q;if(h){if(J!==h)return[new Ve(U.key,le,`${J} stop domain type must match previous stop domain type ${h}`)]}else h=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new Ve(U.key,le,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&o!=="categorical"){let ve=`number expected, ${J} found`;return Ja(s)&&o===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(U.key,le,ve)]}return o!=="categorical"||J!=="number"||isFinite(ne)&&Math.floor(ne)===ne?o!=="categorical"&&J==="number"&&p!==void 0&&ne<p?[new Ve(U.key,le,"stop domain values must appear in ascending order")]:(p=ne,o==="categorical"&&ne in b?[new Ve(U.key,le,"stop domain values must be unique")]:(b[ne]=!0,[])):[new Ve(U.key,le,`integer expected, found ${ne}`)]}}function ba(a){const s=(a.expressionContext==="property"?qu:tc)(xa(a.value),a.valueSpec);if(s.result==="error")return s.value.map(h=>new Ve(`${a.key}${h.key}`,a.value,h.message));const o=s.value.expression||s.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!o.outputDefined())return[new Ve(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Go(o))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Go(o))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Zl(o,["zoom","feature-state"]))return[new Ve(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Wl(o))return[new Ve(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jo(a){const s=a.key,o=a.value,h=a.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(Cr(o))===-1&&p.push(new Ve(s,o,`expected one of [${h.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(h.values).indexOf(Cr(o))===-1&&p.push(new Ve(s,o,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function eo(a){return Ko(xa(a.value))?ba(si({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):xf(a)}function xf(a){const s=a.value,o=a.key;if(Jt(s)!=="array")return[new Ve(o,s,`array expected, ${Jt(s)} found`)];const h=a.styleSpec;let p,x=[];if(s.length<1)return[new Ve(o,s,"filter array must have at least 1 element")];switch(x=x.concat(Jo({key:`${o}[0]`,value:s[0],valueSpec:h.filter_operator,style:a.style,styleSpec:a.styleSpec})),Cr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Cr(s[1])==="$type"&&x.push(new Ve(o,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new Ve(o,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(p=Jt(s[1]),p!=="string"&&x.push(new Ve(`${o}[1]`,s[1],`string expected, ${p} found`)));for(let b=2;b<s.length;b++)p=Jt(s[b]),Cr(s[1])==="$type"?x=x.concat(Jo({key:`${o}[${b}]`,value:s[b],valueSpec:h.geometry_type,style:a.style,styleSpec:a.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&x.push(new Ve(`${o}[${b}]`,s[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<s.length;b++)x=x.concat(xf({key:`${o}[${b}]`,value:s[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=Jt(s[1]),s.length!==2?x.push(new Ve(o,s,`filter array for "${s[0]}" operator must have 2 elements`)):p!=="string"&&x.push(new Ve(`${o}[1]`,s[1],`string expected, ${p} found`));break;case"within":p=Jt(s[1]),s.length!==2?x.push(new Ve(o,s,`filter array for "${s[0]}" operator must have 2 elements`)):p!=="object"&&x.push(new Ve(`${o}[1]`,s[1],`object expected, ${p} found`))}return x}function bf(a,s){const o=a.key,h=a.validateSpec,p=a.style,x=a.styleSpec,b=a.value,S=a.objectKey,C=x[`${s}_${a.layerType}`];if(!C)return[];const M=S.match(/^(.*)-transition$/);if(s==="paint"&&M&&C[M[1]]&&C[M[1]].transition)return h({key:o,value:b,valueSpec:x.transition,style:p,styleSpec:x});const N=a.valueSpec||C[S];if(!N)return[new Ve(o,b,`unknown property "${S}"`)];let B;if(Jt(b)==="string"&&Ja(N)&&!N.tokens&&(B=/^{([^}]+)}$/.exec(b)))return[new Ve(o,b,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const F=[];return a.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&F.push(new Ve(o,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&br(xa(b))&&Cr(b.type)==="identity"&&F.push(new Ve(o,b,'"text-font" does not support identity functions'))),F.concat(h({key:a.key,value:b,valueSpec:N,style:p,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:S}))}function wf(a){return bf(a,"paint")}function Sf(a){return bf(a,"layout")}function kf(a){let s=[];const o=a.value,h=a.key,p=a.style,x=a.styleSpec;o.type||o.ref||s.push(new Ve(h,o,'either "type" or "ref" is required'));let b=Cr(o.type);const S=Cr(o.ref);if(o.id){const C=Cr(o.id);for(let M=0;M<a.arrayIndex;M++){const N=p.layers[M];Cr(N.id)===C&&s.push(new Ve(h,o.id,`duplicate layer id "${o.id}", previously used at line ${N.id.__line__}`))}}if("ref"in o){let C;["type","source","source-layer","filter","layout"].forEach(M=>{M in o&&s.push(new Ve(h,o[M],`"${M}" is prohibited for ref layers`))}),p.layers.forEach(M=>{Cr(M.id)===S&&(C=M)}),C?C.ref?s.push(new Ve(h,o.ref,"ref cannot reference another ref layer")):b=Cr(C.type):s.push(new Ve(h,o.ref,`ref layer "${S}" not found`))}else if(b!=="background")if(o.source){const C=p.sources&&p.sources[o.source],M=C&&Cr(C.type);C?M==="vector"&&b==="raster"?s.push(new Ve(h,o.source,`layer "${o.id}" requires a raster source`)):M!=="raster-dem"&&b==="hillshade"?s.push(new Ve(h,o.source,`layer "${o.id}" requires a raster-dem source`)):M==="raster"&&b!=="raster"?s.push(new Ve(h,o.source,`layer "${o.id}" requires a vector source`)):M!=="vector"||o["source-layer"]?M==="raster-dem"&&b!=="hillshade"?s.push(new Ve(h,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!o.paint||!o.paint["line-gradient"]||M==="geojson"&&C.lineMetrics||s.push(new Ve(h,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new Ve(h,o,`layer "${o.id}" must specify a "source-layer"`)):s.push(new Ve(h,o.source,`source "${o.source}" not found`))}else s.push(new Ve(h,o,'missing required property "source"'));return s=s.concat(qs({key:h,value:o,valueSpec:x.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${h}.type`,value:o.type,valueSpec:x.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:o,objectKey:"type"}),filter:eo,layout:C=>qs({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":M=>Sf(si({layerType:b},M))}}),paint:C=>qs({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":M=>wf(si({layerType:b},M))}})}})),s}function nn(a){const s=a.value,o=a.key,h=Jt(s);return h!=="string"?[new Ve(o,s,`string expected, ${h} found`)]:[]}const Qo={promoteId:function({key:a,value:s}){if(Jt(s)==="string")return nn({key:a,value:s});{const o=[];for(const h in s)o.push(...nn({key:`${a}.${h}`,value:s[h]}));return o}}};function oi(a){const s=a.value,o=a.key,h=a.styleSpec,p=a.style,x=a.validateSpec;if(!s.type)return[new Ve(o,s,'"type" is required')];const b=Cr(s.type);let S;switch(b){case"vector":case"raster":return S=qs({key:o,value:s,valueSpec:h[`source_${b.replace("-","_")}`],style:a.style,styleSpec:h,objectElementValidators:Qo,validateSpec:x}),S;case"raster-dem":return S=function(C){var M;const N=(M=C.sourceName)!==null&&M!==void 0?M:"",B=C.value,F=C.styleSpec,U=F.source_raster_dem,q=C.style;let J=[];const ne=Jt(B);if(B===void 0)return J;if(ne!=="object")return J.push(new Ve("source_raster_dem",B,`object expected, ${ne} found`)),J;const le=Cr(B.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],fe=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const xe in B)!le&&ve.includes(xe)?J.push(new Ve(xe,B[xe],`In "${N}": "${xe}" is only valid when "encoding" is set to "custom". ${fe} encoding found`)):U[xe]?J=J.concat(C.validateSpec({key:xe,value:B[xe],valueSpec:U[xe],validateSpec:C.validateSpec,style:q,styleSpec:F})):J.push(new Ve(xe,B[xe],`unknown property "${xe}"`));return J}({sourceName:o,value:s,style:a.style,styleSpec:h,validateSpec:x}),S;case"geojson":if(S=qs({key:o,value:s,valueSpec:h.source_geojson,style:p,styleSpec:h,validateSpec:x,objectElementValidators:Qo}),s.cluster)for(const C in s.clusterProperties){const[M,N]=s.clusterProperties[C],B=typeof M=="string"?[M,["accumulated"],["get",C]]:M;S.push(...ba({key:`${o}.${C}.map`,value:N,expressionContext:"cluster-map"})),S.push(...ba({key:`${o}.${C}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return qs({key:o,value:s,valueSpec:h.source_video,style:p,validateSpec:x,styleSpec:h});case"image":return qs({key:o,value:s,valueSpec:h.source_image,style:p,validateSpec:x,styleSpec:h});case"canvas":return[new Ve(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jo({key:`${o}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function el(a){const s=a.value,o=a.styleSpec,h=o.light,p=a.style;let x=[];const b=Jt(s);if(s===void 0)return x;if(b!=="object")return x=x.concat([new Ve("light",s,`object expected, ${b} found`)]),x;for(const S in s){const C=S.match(/^(.*)-transition$/);x=x.concat(C&&h[C[1]]&&h[C[1]].transition?a.validateSpec({key:S,value:s[S],valueSpec:o.transition,validateSpec:a.validateSpec,style:p,styleSpec:o}):h[S]?a.validateSpec({key:S,value:s[S],valueSpec:h[S],validateSpec:a.validateSpec,style:p,styleSpec:o}):[new Ve(S,s[S],`unknown property "${S}"`)])}return x}function Tf(a){const s=a.value,o=a.styleSpec,h=o.terrain,p=a.style;let x=[];const b=Jt(s);if(s===void 0)return x;if(b!=="object")return x=x.concat([new Ve("terrain",s,`object expected, ${b} found`)]),x;for(const S in s)x=x.concat(h[S]?a.validateSpec({key:S,value:s[S],valueSpec:h[S],validateSpec:a.validateSpec,style:p,styleSpec:o}):[new Ve(S,s[S],`unknown property "${S}"`)]);return x}function Ef(a){let s=[];const o=a.value,h=a.key;if(Array.isArray(o)){const p=[],x=[];for(const b in o)o[b].id&&p.includes(o[b].id)&&s.push(new Ve(h,o,`all the sprites' ids must be unique, but ${o[b].id} is duplicated`)),p.push(o[b].id),o[b].url&&x.includes(o[b].url)&&s.push(new Ve(h,o,`all the sprites' URLs must be unique, but ${o[b].url} is duplicated`)),x.push(o[b].url),s=s.concat(qs({key:`${h}[${b}]`,value:o[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return s}return nn({key:h,value:o})}const Cf={"*":()=>[],array:Qa,boolean:function(a){const s=a.value,o=a.key,h=Jt(s);return h!=="boolean"?[new Ve(o,s,`boolean expected, ${h} found`)]:[]},number:Yo,color:function(a){const s=a.key,o=a.value,h=Jt(o);return h!=="string"?[new Ve(s,o,`color expected, ${h} found`)]:ar.parse(String(o))?[]:[new Ve(s,o,`color expected, "${o}" found`)]},constants:vf,enum:Jo,filter:eo,function:ac,layer:kf,object:qs,source:oi,light:el,terrain:Tf,string:nn,formatted:function(a){return nn(a).length===0?[]:ba(a)},resolvedImage:function(a){return nn(a).length===0?[]:ba(a)},padding:function(a){const s=a.key,o=a.value;if(Jt(o)==="array"){if(o.length<1||o.length>4)return[new Ve(s,o,`padding requires 1 to 4 values; ${o.length} values found`)];const h={type:"number"};let p=[];for(let x=0;x<o.length;x++)p=p.concat(a.validateSpec({key:`${s}[${x}]`,value:o[x],validateSpec:a.validateSpec,valueSpec:h}));return p}return Yo({key:s,value:o,valueSpec:{}})},variableAnchorOffsetCollection:function(a){const s=a.key,o=a.value,h=Jt(o),p=a.styleSpec;if(h!=="array"||o.length<1||o.length%2!=0)return[new Ve(s,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let b=0;b<o.length;b+=2)x=x.concat(Jo({key:`${s}[${b}]`,value:o[b],valueSpec:p.layout_symbol["text-anchor"]})),x=x.concat(Qa({key:`${s}[${b+1}]`,value:o[b+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:p}));return x},sprite:Ef};function Qn(a){const s=a.value,o=a.valueSpec,h=a.styleSpec;return a.validateSpec=Qn,o.expression&&br(Cr(s))?ac(a):o.expression&&ec(xa(s))?ba(a):o.type&&Cf[o.type]?Cf[o.type](a):qs(si({},a,{valueSpec:o.type?h[o.type]:o}))}function Af(a){const s=a.value,o=a.key,h=nn(a);return h.length||(s.indexOf("{fontstack}")===-1&&h.push(new Ve(o,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&h.push(new Ve(o,s,'"glyphs" url must include a "{range}" token'))),h}function Ai(a,s=Pe){let o=[];return o=o.concat(Qn({key:"",value:a,valueSpec:s.$root,styleSpec:s,style:a,validateSpec:Qn,objectElementValidators:{glyphs:Af,"*":()=>[]}})),a.constants&&(o=o.concat(vf({key:"constants",value:a.constants}))),oc(o)}function Cn(a){return function(s){return a({...s,validateSpec:Qn})}}function oc(a){return[].concat(a).sort((s,o)=>s.line-o.line)}function An(a){return function(...s){return oc(a.apply(this,s))}}Ai.source=An(Cn(oi)),Ai.sprite=An(Cn(Ef)),Ai.glyphs=An(Cn(Af)),Ai.light=An(Cn(el)),Ai.terrain=An(Cn(Tf)),Ai.layer=An(Cn(kf)),Ai.filter=An(Cn(eo)),Ai.paintProperty=An(Cn(wf)),Ai.layoutProperty=An(Cn(Sf));const Pn=Ai,kg=Pn.light,Zu=Pn.paintProperty,Pf=Pn.layoutProperty;function lc(a,s){let o=!1;if(s&&s.length)for(const h of s)a.fire(new os(new Error(h.message))),o=!0;return o}class to{constructor(s,o,h){const p=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const b=new Int32Array(this.arrayBuffer);s=b[0],this.d=(o=b[1])+2*(h=b[2]);for(let C=0;C<this.d*this.d;C++){const M=b[3+C],N=b[3+C+1];p.push(M===N?null:b.subarray(M,N))}const S=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],S),this.bboxes=b.subarray(S),this.insert=this._insertReadonly}else{this.d=o+2*h;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=s,this.padding=h,this.scale=o/s,this.uid=0;const x=h/o*s;this.min=-x,this.max=s+x}insert(s,o,h,p,x){this._forEachCell(o,h,p,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,o,h,p,x,b){this.cells[x].push(b)}query(s,o,h,p,x){const b=this.min,S=this.max;if(s<=b&&o<=b&&S<=h&&S<=p&&!x)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(s,o,h,p,this._queryCell,C,{},x),C}}_queryCell(s,o,h,p,x,b,S,C){const M=this.cells[x];if(M!==null){const N=this.keys,B=this.bboxes;for(let F=0;F<M.length;F++){const U=M[F];if(S[U]===void 0){const q=4*U;(C?C(B[q+0],B[q+1],B[q+2],B[q+3]):s<=B[q+2]&&o<=B[q+3]&&h>=B[q+0]&&p>=B[q+1])?(S[U]=!0,b.push(N[U])):S[U]=!1}}}}_forEachCell(s,o,h,p,x,b,S,C){const M=this._convertToCellCoord(s),N=this._convertToCellCoord(o),B=this._convertToCellCoord(h),F=this._convertToCellCoord(p);for(let U=M;U<=B;U++)for(let q=N;q<=F;q++){const J=this.d*q+U;if((!C||C(this._convertFromCellCoord(U),this._convertFromCellCoord(q),this._convertFromCellCoord(U+1),this._convertFromCellCoord(q+1)))&&x.call(this,s,o,h,p,J,b,S,C))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,o=3+this.cells.length+1+1;let h=0;for(let b=0;b<this.cells.length;b++)h+=this.cells[b].length;const p=new Int32Array(o+h+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let x=o;for(let b=0;b<s.length;b++){const S=s[b];p[3+b]=x,p.set(S,x),x+=S.length}return p[3+s.length]=x,p.set(this.keys,x),x+=this.keys.length,p[3+s.length+1]=x,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer}static serialize(s,o){const h=s.toArrayBuffer();return o&&o.push(h),{buffer:h}}static deserialize(s){return new to(s.buffer)}}const In={};function nt(a,s,o={}){if(In[a])throw new Error(`${a} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:a,writeable:!1}),In[a]={klass:s,omit:o.omit||[],shallow:o.shallow||[]}}nt("Object",Object),nt("TransferableGridIndex",to),nt("Color",ar),nt("Error",Error),nt("AJAXError",yt),nt("ResolvedImage",gs),nt("StylePropertyFunction",Zo),nt("StyleExpression",Uu,{omit:["_evaluator"]}),nt("ZoomDependentExpression",rc),nt("ZoomConstantExpression",Vu),nt("CompoundExpression",Ci,{omit:["_evaluate"]});for(const a in Ya)Ya[a]._classRegistryKey||nt(`Expression_${a}`,Ya[a]);function cc(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function ea(a,s){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if(cc(a)||st(a))return s&&s.push(a),a;if(ArrayBuffer.isView(a)){const o=a;return s&&s.push(o.buffer),o}if(a instanceof ImageData)return s&&s.push(a.data.buffer),a;if(Array.isArray(a)){const o=[];for(const h of a)o.push(ea(h,s));return o}if(typeof a=="object"){const o=a.constructor,h=o._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!In[h])throw new Error(`${h} is not registered.`);const p=o.serialize?o.serialize(a,s):{};if(o.serialize){if(s&&p===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in a){if(!a.hasOwnProperty(x)||In[h].omit.indexOf(x)>=0)continue;const b=a[x];p[x]=In[h].shallow.indexOf(x)>=0?b:ea(b,s)}a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof a)}function ro(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||cc(a)||st(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(ro);if(typeof a=="object"){const s=a.$name||"Object";if(!In[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:o}=In[s];if(!o)throw new Error(`can't deserialize unregistered class ${s}`);if(o.deserialize)return o.deserialize(a);const h=Object.create(o.prototype);for(const p of Object.keys(a)){if(p==="$name")continue;const x=a[p];h[p]=In[s].shallow.indexOf(p)>=0?x:ro(x)}return h}throw new Error("can't deserialize object of type "+typeof a)}class If{constructor(){this.first=!0}update(s,o){const h=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=o),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=h,!0))}}const Qe={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Hu(a){for(const s of a)if(Xu(s.charCodeAt(0)))return!0;return!1}function Ku(a){for(const s of a)if(!Tg(s.charCodeAt(0)))return!1;return!0}function Tg(a){return!(Qe.Arabic(a)||Qe["Arabic Supplement"](a)||Qe["Arabic Extended-A"](a)||Qe["Arabic Presentation Forms-A"](a)||Qe["Arabic Presentation Forms-B"](a))}function Xu(a){return!(a!==746&&a!==747&&(a<4352||!(Qe["Bopomofo Extended"](a)||Qe.Bopomofo(a)||Qe["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Qe["CJK Compatibility Ideographs"](a)||Qe["CJK Compatibility"](a)||Qe["CJK Radicals Supplement"](a)||Qe["CJK Strokes"](a)||!(!Qe["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Qe["CJK Unified Ideographs Extension A"](a)||Qe["CJK Unified Ideographs"](a)||Qe["Enclosed CJK Letters and Months"](a)||Qe["Hangul Compatibility Jamo"](a)||Qe["Hangul Jamo Extended-A"](a)||Qe["Hangul Jamo Extended-B"](a)||Qe["Hangul Jamo"](a)||Qe["Hangul Syllables"](a)||Qe.Hiragana(a)||Qe["Ideographic Description Characters"](a)||Qe.Kanbun(a)||Qe["Kangxi Radicals"](a)||Qe["Katakana Phonetic Extensions"](a)||Qe.Katakana(a)&&a!==12540||!(!Qe["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Qe["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Qe["Unified Canadian Aboriginal Syllabics"](a)||Qe["Unified Canadian Aboriginal Syllabics Extended"](a)||Qe["Vertical Forms"](a)||Qe["Yijing Hexagram Symbols"](a)||Qe["Yi Syllables"](a)||Qe["Yi Radicals"](a))))}function Mf(a){return!(Xu(a)||function(s){return!!(Qe["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Qe["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Qe["Letterlike Symbols"](s)||Qe["Number Forms"](s)||Qe["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Qe["Control Pictures"](s)&&s!==9251||Qe["Optical Character Recognition"](s)||Qe["Enclosed Alphanumerics"](s)||Qe["Geometric Shapes"](s)||Qe["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Qe["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Qe["CJK Symbols and Punctuation"](s)||Qe.Katakana(s)||Qe["Private Use Area"](s)||Qe["CJK Compatibility Forms"](s)||Qe["Small Form Variants"](s)||Qe["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(a))}function jf(a){return a>=1424&&a<=2303||Qe["Arabic Presentation Forms-A"](a)||Qe["Arabic Presentation Forms-B"](a)}function Df(a,s){return!(!s&&jf(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Qe.Khmer(a))}function Eg(a){for(const s of a)if(jf(s.charCodeAt(0)))return!0;return!1}const Yu="deferred",Ju="loading",Qu="loaded";let eh=null,Gs="unavailable",ta=null;const tl=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Gs="error"),eh&&eh(a)};function th(){rl.fire(new rn("pluginStateChange",{pluginStatus:Gs,pluginURL:ta}))}const rl=new sn,rh=function(){return Gs},Nf=function(){if(Gs!==Yu||!ta)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gs=Ju,th(),ta&&qr({url:ta},a=>{a?tl(a):(Gs=Qu,th())})},li={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gs===Qu||li.applyArabicShaping!=null,isLoading:()=>Gs===Ju,setState(a){if(!vt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Gs=a.pluginStatus,ta=a.pluginURL},isParsed(){if(!vt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return li.applyArabicShaping!=null&&li.processBidirectionalText!=null&&li.processStyledBidirectionalText!=null},getPluginURL(){if(!vt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ta}};class mr{constructor(s,o){this.zoom=s,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new If,this.transition={})}isSupportedScript(s){return function(o,h){for(const p of o)if(!Df(p.charCodeAt(0),h))return!1;return!0}(s,li.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,o=s-Math.floor(s),h=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*o}}}class uc{constructor(s,o){this.property=s,this.value=o,this.expression=function(h,p){if(br(h))return new Zo(h,p);if(ec(h)){const x=qu(h,p);if(x.result==="error")throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=h;return p.type==="color"&&typeof h=="string"?x=ar.parse(h):p.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(h)&&(x=Ti.parse(h)):x=ii.parse(h),{kind:"constant",evaluate:()=>x}}}(o===void 0?s.specification.default:o,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,o,h){return this.property.possiblyEvaluate(this,s,o,h)}}class sh{constructor(s){this.property=s,this.value=new uc(s,void 0)}transitioned(s,o){return new Rf(this.property,this.value,o,Te({},s.transition,this.transition),s.now)}untransitioned(){return new Rf(this.property,this.value,null,{},0)}}class Lf{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Oe(this._values[s].value.value)}setValue(s,o){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new sh(this._values[s].property)),this._values[s].value=new uc(this._values[s].property,o===null?void 0:Oe(o))}getTransition(s){return Oe(this._values[s].transition)}setTransition(s,o){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new sh(this._values[s].property)),this._values[s].transition=Oe(o)||void 0}serialize(){const s={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(s[o]=h);const p=this.getTransition(o);p!==void 0&&(s[`${o}-transition`]=p)}return s}transitioned(s,o){const h=new zf(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(s,o._values[p]);return h}untransitioned(){const s=new zf(this._properties);for(const o of Object.keys(this._values))s._values[o]=this._values[o].untransitioned();return s}}class Rf{constructor(s,o,h,p,x){this.property=s,this.value=o,this.begin=x+p.delay||0,this.end=this.begin+p.duration||0,s.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(s,o,h){const p=s.now||0,x=this.value.possiblyEvaluate(s,o,h),b=this.prior;if(b){if(p>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(p<this.begin)return b.possiblyEvaluate(s,o,h);{const S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(s,o,h),x,function(C){if(C<=0)return 0;if(C>=1)return 1;const M=C*C,N=M*C;return 4*(C<.5?N:3*(C-M)+N-.75)}(S))}}return x}}class zf{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,o,h){const p=new hc(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(s,o,h);return p}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Cg{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Oe(this._values[s].value)}setValue(s,o){this._values[s]=new uc(this._values[s].property,o===null?void 0:Oe(o))}serialize(){const s={};for(const o of Object.keys(this._values)){const h=this.getValue(o);h!==void 0&&(s[o]=h)}return s}possiblyEvaluate(s,o,h){const p=new hc(this._properties);for(const x of Object.keys(this._values))p._values[x]=this._values[x].possiblyEvaluate(s,o,h);return p}}class Ns{constructor(s,o,h){this.property=s,this.value=o,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,o,h,p){return this.property.evaluate(this.value,this.parameters,s,o,h,p)}}class hc{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class dt{constructor(s){this.specification=s}possiblyEvaluate(s,o){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(o)}interpolate(s,o,h){const p=ni[this.specification.type];return p?p(s,o,h):s}}class xt{constructor(s,o){this.specification=s,this.overrides=o}possiblyEvaluate(s,o,h,p){return new Ns(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(o,null,{},h,p)}:s.expression,o)}interpolate(s,o,h){if(s.value.kind!=="constant"||o.value.kind!=="constant")return s;if(s.value.value===void 0||o.value.value===void 0)return new Ns(this,{kind:"constant",value:void 0},s.parameters);const p=ni[this.specification.type];if(p){const x=p(s.value.value,o.value.value,h);return new Ns(this,{kind:"constant",value:x},s.parameters)}return s}evaluate(s,o,h,p,x,b){return s.kind==="constant"?s.value:s.evaluate(o,h,p,x,b)}}class sl extends xt{possiblyEvaluate(s,o,h,p){if(s.value===void 0)return new Ns(this,{kind:"constant",value:void 0},o);if(s.expression.kind==="constant"){const x=s.expression.evaluate(o,null,{},h,p),b=s.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,S=this._calculate(b,b,b,o);return new Ns(this,{kind:"constant",value:S},o)}if(s.expression.kind==="camera"){const x=this._calculate(s.expression.evaluate({zoom:o.zoom-1}),s.expression.evaluate({zoom:o.zoom}),s.expression.evaluate({zoom:o.zoom+1}),o);return new Ns(this,{kind:"constant",value:x},o)}return new Ns(this,s.expression,o)}evaluate(s,o,h,p,x,b){if(s.kind==="source"){const S=s.evaluate(o,h,p,x,b);return this._calculate(S,S,S,o)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(o.zoom)-1},h,p),s.evaluate({zoom:Math.floor(o.zoom)},h,p),s.evaluate({zoom:Math.floor(o.zoom)+1},h,p),o):s.value}_calculate(s,o,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:s,to:o}:{from:h,to:o}}interpolate(s){return s}}class ih{constructor(s){this.specification=s}possiblyEvaluate(s,o,h,p){if(s.value!==void 0){if(s.expression.kind==="constant"){const x=s.expression.evaluate(o,null,{},h,p);return this._calculate(x,x,x,o)}return this._calculate(s.expression.evaluate(new mr(Math.floor(o.zoom-1),o)),s.expression.evaluate(new mr(Math.floor(o.zoom),o)),s.expression.evaluate(new mr(Math.floor(o.zoom+1),o)),o)}}_calculate(s,o,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:s,to:o}:{from:h,to:o}}interpolate(s){return s}}class nh{constructor(s){this.specification=s}possiblyEvaluate(s,o,h,p){return!!s.expression.evaluate(o,null,{},h,p)}interpolate(){return!1}}class Rr{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in s){const h=s[o];h.specification.overridable&&this.overridableProperties.push(o);const p=this.defaultPropertyValues[o]=new uc(h,void 0),x=this.defaultTransitionablePropertyValues[o]=new sh(h);this.defaultTransitioningPropertyValues[o]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}}}nt("DataDrivenProperty",xt),nt("DataConstantProperty",dt),nt("CrossFadedDataDrivenProperty",sl),nt("CrossFadedProperty",ih),nt("ColorRampProperty",nh);const ah="-transition";class Pi extends sn{constructor(s,o){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),o.layout&&(this._unevaluatedLayout=new Cg(o.layout)),o.paint)){this._transitionablePaint=new Lf(o.paint);for(const h in s.paint)this.setPaintProperty(h,s.paint[h],{validate:!1});for(const h in s.layout)this.setLayoutProperty(h,s.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hc(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,o,h={}){o!=null&&this._validate(Pf,`layers.${this.id}.layout.${s}`,s,o,h)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,o):this.visibility=o)}getPaintProperty(s){return s.endsWith(ah)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,o,h={}){if(o!=null&&this._validate(Zu,`layers.${this.id}.paint.${s}`,s,o,h))return!1;if(s.endsWith(ah))return this._transitionablePaint.setTransition(s.slice(0,-11),o||void 0),!1;{const p=this._transitionablePaint._values[s],x=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),S=p.value;this._transitionablePaint.setValue(s,o),this._handleSpecialPaintPropertyUpdate(s);const C=this._transitionablePaint._values[s].value;return C.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(s,S,C)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,o,h){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,o){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,o)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),St(s,(o,h)=>!(o===void 0||h==="layout"&&!Object.keys(o).length||h==="paint"&&!Object.keys(o).length))}_validate(s,o,h,p,x={}){return(!x||x.validate!==!1)&&lc(this,s.call(Pn,{key:o,layerType:this.type,objectKey:h,value:p,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const o=this.paint.get(s);if(o instanceof Ns&&Ja(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Bf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wa{constructor(s,o){this._structArray=s,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ar{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,o){return s._trim(),o&&(s.isTransferred=!0,o.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const o=Object.create(this.prototype);return o.arrayBuffer=s.arrayBuffer,o.length=s.length,o.capacity=s.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Sr(a,s=1){let o=0,h=0;return{members:a.map(p=>{const x=Bf[p.type].BYTES_PER_ELEMENT,b=o=so(o,Math.max(s,x)),S=p.components||1;return h=Math.max(h,x),o+=x*S,{name:p.name,type:p.type,components:S,offset:b}}),size:so(o,Math.max(h,s)),alignment:s}}function so(a,s){return Math.ceil(a/s)*s}class il extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,o){const h=this.length;return this.resize(h+1),this.emplace(h,s,o)}emplace(s,o,h){const p=2*s;return this.int16[p+0]=o,this.int16[p+1]=h,s}}il.prototype.bytesPerElement=4,nt("StructArrayLayout2i4",il);class nl extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,o,h)}emplace(s,o,h,p){const x=3*s;return this.int16[x+0]=o,this.int16[x+1]=h,this.int16[x+2]=p,s}}nl.prototype.bytesPerElement=6,nt("StructArrayLayout3i6",nl);class Sa extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,o,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,s,o,h,p)}emplace(s,o,h,p,x){const b=4*s;return this.int16[b+0]=o,this.int16[b+1]=h,this.int16[b+2]=p,this.int16[b+3]=x,s}}Sa.prototype.bytesPerElement=8,nt("StructArrayLayout4i8",Sa);class oh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,s,o,h,p,x,b)}emplace(s,o,h,p,x,b,S){const C=6*s;return this.int16[C+0]=o,this.int16[C+1]=h,this.int16[C+2]=p,this.int16[C+3]=x,this.int16[C+4]=b,this.int16[C+5]=S,s}}oh.prototype.bytesPerElement=12,nt("StructArrayLayout2i4i12",oh);class lh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,s,o,h,p,x,b)}emplace(s,o,h,p,x,b,S){const C=4*s,M=8*s;return this.int16[C+0]=o,this.int16[C+1]=h,this.uint8[M+4]=p,this.uint8[M+5]=x,this.uint8[M+6]=b,this.uint8[M+7]=S,s}}lh.prototype.bytesPerElement=8,nt("StructArrayLayout2i4ub8",lh);class io extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,o){const h=this.length;return this.resize(h+1),this.emplace(h,s,o)}emplace(s,o,h){const p=2*s;return this.float32[p+0]=o,this.float32[p+1]=h,s}}io.prototype.bytesPerElement=8,nt("StructArrayLayout2f8",io);class ch extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b,S,C,M,N){const B=this.length;return this.resize(B+1),this.emplace(B,s,o,h,p,x,b,S,C,M,N)}emplace(s,o,h,p,x,b,S,C,M,N,B){const F=10*s;return this.uint16[F+0]=o,this.uint16[F+1]=h,this.uint16[F+2]=p,this.uint16[F+3]=x,this.uint16[F+4]=b,this.uint16[F+5]=S,this.uint16[F+6]=C,this.uint16[F+7]=M,this.uint16[F+8]=N,this.uint16[F+9]=B,s}}ch.prototype.bytesPerElement=20,nt("StructArrayLayout10ui20",ch);class uh extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b,S,C,M,N,B,F){const U=this.length;return this.resize(U+1),this.emplace(U,s,o,h,p,x,b,S,C,M,N,B,F)}emplace(s,o,h,p,x,b,S,C,M,N,B,F,U){const q=12*s;return this.int16[q+0]=o,this.int16[q+1]=h,this.int16[q+2]=p,this.int16[q+3]=x,this.uint16[q+4]=b,this.uint16[q+5]=S,this.uint16[q+6]=C,this.uint16[q+7]=M,this.int16[q+8]=N,this.int16[q+9]=B,this.int16[q+10]=F,this.int16[q+11]=U,s}}uh.prototype.bytesPerElement=24,nt("StructArrayLayout4i4ui4i24",uh);class Qt extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,o,h)}emplace(s,o,h,p){const x=3*s;return this.float32[x+0]=o,this.float32[x+1]=h,this.float32[x+2]=p,s}}Qt.prototype.bytesPerElement=12,nt("StructArrayLayout3f12",Qt);class y extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const o=this.length;return this.resize(o+1),this.emplace(o,s)}emplace(s,o){return this.uint32[1*s+0]=o,s}}y.prototype.bytesPerElement=4,nt("StructArrayLayout1ul4",y);class i extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b,S,C,M){const N=this.length;return this.resize(N+1),this.emplace(N,s,o,h,p,x,b,S,C,M)}emplace(s,o,h,p,x,b,S,C,M,N){const B=10*s,F=5*s;return this.int16[B+0]=o,this.int16[B+1]=h,this.int16[B+2]=p,this.int16[B+3]=x,this.int16[B+4]=b,this.int16[B+5]=S,this.uint32[F+3]=C,this.uint16[B+8]=M,this.uint16[B+9]=N,s}}i.prototype.bytesPerElement=20,nt("StructArrayLayout6i1ul2ui20",i);class u extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,s,o,h,p,x,b)}emplace(s,o,h,p,x,b,S){const C=6*s;return this.int16[C+0]=o,this.int16[C+1]=h,this.int16[C+2]=p,this.int16[C+3]=x,this.int16[C+4]=b,this.int16[C+5]=S,s}}u.prototype.bytesPerElement=12,nt("StructArrayLayout2i2i2i12",u);class f extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x){const b=this.length;return this.resize(b+1),this.emplace(b,s,o,h,p,x)}emplace(s,o,h,p,x,b){const S=4*s,C=8*s;return this.float32[S+0]=o,this.float32[S+1]=h,this.float32[S+2]=p,this.int16[C+6]=x,this.int16[C+7]=b,s}}f.prototype.bytesPerElement=16,nt("StructArrayLayout2f1f2i16",f);class g extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,o,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,s,o,h,p)}emplace(s,o,h,p,x){const b=12*s,S=3*s;return this.uint8[b+0]=o,this.uint8[b+1]=h,this.float32[S+1]=p,this.float32[S+2]=x,s}}g.prototype.bytesPerElement=12,nt("StructArrayLayout2ub2f12",g);class _ extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,o,h)}emplace(s,o,h,p){const x=3*s;return this.uint16[x+0]=o,this.uint16[x+1]=h,this.uint16[x+2]=p,s}}_.prototype.bytesPerElement=6,nt("StructArrayLayout3ui6",_);class T extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b,S,C,M,N,B,F,U,q,J,ne,le){const ve=this.length;return this.resize(ve+1),this.emplace(ve,s,o,h,p,x,b,S,C,M,N,B,F,U,q,J,ne,le)}emplace(s,o,h,p,x,b,S,C,M,N,B,F,U,q,J,ne,le,ve){const fe=24*s,xe=12*s,ke=48*s;return this.int16[fe+0]=o,this.int16[fe+1]=h,this.uint16[fe+2]=p,this.uint16[fe+3]=x,this.uint32[xe+2]=b,this.uint32[xe+3]=S,this.uint32[xe+4]=C,this.uint16[fe+10]=M,this.uint16[fe+11]=N,this.uint16[fe+12]=B,this.float32[xe+7]=F,this.float32[xe+8]=U,this.uint8[ke+36]=q,this.uint8[ke+37]=J,this.uint8[ke+38]=ne,this.uint32[xe+10]=le,this.int16[fe+22]=ve,s}}T.prototype.bytesPerElement=48,nt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",T);class E extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,o,h,p,x,b,S,C,M,N,B,F,U,q,J,ne,le,ve,fe,xe,ke,De,et,ct,Je,Xe,We,at){const He=this.length;return this.resize(He+1),this.emplace(He,s,o,h,p,x,b,S,C,M,N,B,F,U,q,J,ne,le,ve,fe,xe,ke,De,et,ct,Je,Xe,We,at)}emplace(s,o,h,p,x,b,S,C,M,N,B,F,U,q,J,ne,le,ve,fe,xe,ke,De,et,ct,Je,Xe,We,at,He){const ze=32*s,mt=16*s;return this.int16[ze+0]=o,this.int16[ze+1]=h,this.int16[ze+2]=p,this.int16[ze+3]=x,this.int16[ze+4]=b,this.int16[ze+5]=S,this.int16[ze+6]=C,this.int16[ze+7]=M,this.uint16[ze+8]=N,this.uint16[ze+9]=B,this.uint16[ze+10]=F,this.uint16[ze+11]=U,this.uint16[ze+12]=q,this.uint16[ze+13]=J,this.uint16[ze+14]=ne,this.uint16[ze+15]=le,this.uint16[ze+16]=ve,this.uint16[ze+17]=fe,this.uint16[ze+18]=xe,this.uint16[ze+19]=ke,this.uint16[ze+20]=De,this.uint16[ze+21]=et,this.uint16[ze+22]=ct,this.uint32[mt+12]=Je,this.float32[mt+13]=Xe,this.float32[mt+14]=We,this.uint16[ze+30]=at,this.uint16[ze+31]=He,s}}E.prototype.bytesPerElement=64,nt("StructArrayLayout8i15ui1ul2f2ui64",E);class A extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const o=this.length;return this.resize(o+1),this.emplace(o,s)}emplace(s,o){return this.float32[1*s+0]=o,s}}A.prototype.bytesPerElement=4,nt("StructArrayLayout1f4",A);class D extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,o,h)}emplace(s,o,h,p){const x=3*s;return this.uint16[6*s+0]=o,this.float32[x+1]=h,this.float32[x+2]=p,s}}D.prototype.bytesPerElement=12,nt("StructArrayLayout1ui2f12",D);class R extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,s,o,h)}emplace(s,o,h,p){const x=4*s;return this.uint32[2*s+0]=o,this.uint16[x+2]=h,this.uint16[x+3]=p,s}}R.prototype.bytesPerElement=8,nt("StructArrayLayout1ul2ui8",R);class z extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,o){const h=this.length;return this.resize(h+1),this.emplace(h,s,o)}emplace(s,o,h){const p=2*s;return this.uint16[p+0]=o,this.uint16[p+1]=h,s}}z.prototype.bytesPerElement=4,nt("StructArrayLayout2ui4",z);class $ extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const o=this.length;return this.resize(o+1),this.emplace(o,s)}emplace(s,o){return this.uint16[1*s+0]=o,s}}$.prototype.bytesPerElement=2,nt("StructArrayLayout1ui2",$);class ee extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,o,h,p){const x=this.length;return this.resize(x+1),this.emplace(x,s,o,h,p)}emplace(s,o,h,p,x){const b=4*s;return this.float32[b+0]=o,this.float32[b+1]=h,this.float32[b+2]=p,this.float32[b+3]=x,s}}ee.prototype.bytesPerElement=16,nt("StructArrayLayout4f16",ee);class Q extends wa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new L(this.anchorPointX,this.anchorPointY)}}Q.prototype.size=20;class ie extends i{get(s){return new Q(this,s)}}nt("CollisionBoxArray",ie);class X extends wa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}X.prototype.size=48;class ye extends T{get(s){return new X(this,s)}}nt("PlacedSymbolArray",ye);class Se extends wa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Se.prototype.size=64;class ae extends E{get(s){return new Se(this,s)}}nt("SymbolInstanceArray",ae);class _e extends A{getoffsetX(s){return this.float32[1*s+0]}}nt("GlyphOffsetArray",_e);class Ee extends nl{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}nt("SymbolLineVertexArray",Ee);class Ae extends wa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ae.prototype.size=12;class je extends D{get(s){return new Ae(this,s)}}nt("TextAnchorOffsetArray",je);class Re extends wa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Re.prototype.size=8;class Le extends R{get(s){return new Re(this,s)}}nt("FeatureIndexArray",Le);class $e extends il{}class lt extends il{}class Bt extends il{}class Ke extends oh{}class bt extends lh{}class ut extends io{}class or extends ch{}class zt extends uh{}class Dt extends Qt{}class Ot extends y{}class Mr extends u{}class dr extends g{}class ys extends _{}class Yr extends z{}const zr=Sr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ci}=zr;class gr{constructor(s=[]){this.segments=s}prepareSegment(s,o,h,p){let x=this.segments[this.segments.length-1];return s>gr.MAX_VERTEX_ARRAY_LENGTH&&qe(`Max vertices per segment is ${gr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!x||x.vertexLength+s>gr.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==p)&&(x={vertexOffset:o.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},p!==void 0&&(x.sortKey=p),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const s of this.segments)for(const o in s.vaos)s.vaos[o].destroy()}static simpleSegment(s,o,h,p){return new gr([{vertexOffset:s,primitiveOffset:o,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function an(a,s){return 256*(a=be(Math.floor(a),0,255))+be(Math.floor(s),0,255)}gr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nt("SegmentVector",gr);const on=Sr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ra={exports:{}},ka={exports:{}};ka.exports=function(a,s){var o,h,p,x,b,S,C,M;for(h=a.length-(o=3&a.length),p=s,b=3432918353,S=461845907,M=0;M<h;)C=255&a.charCodeAt(M)|(255&a.charCodeAt(++M))<<8|(255&a.charCodeAt(++M))<<16|(255&a.charCodeAt(++M))<<24,++M,p=27492+(65535&(x=5*(65535&(p=(p^=C=(65535&(C=(C=(65535&C)*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(C=0,o){case 3:C^=(255&a.charCodeAt(M+2))<<16;case 2:C^=(255&a.charCodeAt(M+1))<<8;case 1:p^=C=(65535&(C=(C=(65535&(C^=255&a.charCodeAt(M)))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295}return p^=a.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var no=ka.exports,Es={exports:{}};Es.exports=function(a,s){for(var o,h=a.length,p=s^h,x=0;h>=4;)o=1540483477*(65535&(o=255&a.charCodeAt(x)|(255&a.charCodeAt(++x))<<8|(255&a.charCodeAt(++x))<<16|(255&a.charCodeAt(++x))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:p^=(255&a.charCodeAt(x+2))<<16;case 2:p^=(255&a.charCodeAt(x+1))<<8;case 1:p=1540483477*(65535&(p^=255&a.charCodeAt(x)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var _s=no,Ls=Es.exports;ra.exports=_s,ra.exports.murmur3=_s,ra.exports.murmur2=Ls;var Ta=k(ra.exports);class jr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,o,h,p){this.ids.push(Jr(s)),this.positions.push(o,h,p)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=Jr(s);let h=0,p=this.ids.length-1;for(;h<p;){const b=h+p>>1;this.ids[b]>=o?p=b:h=b+1}const x=[];for(;this.ids[h]===o;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(s,o){const h=new Float64Array(s.ids),p=new Uint32Array(s.positions);return Ws(h,p,0,h.length-1),o&&o.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(s){const o=new jr;return o.ids=s.ids,o.positions=s.positions,o.indexed=!0,o}}function Jr(a){const s=+a;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:Ta(String(a))}function Ws(a,s,o,h){for(;o<h;){const p=a[o+h>>1];let x=o-1,b=h+1;for(;;){do x++;while(a[x]<p);do b--;while(a[b]>p);if(x>=b)break;Dr(a,x,b),Dr(s,3*x,3*b),Dr(s,3*x+1,3*b+1),Dr(s,3*x+2,3*b+2)}b-o<h-b?(Ws(a,s,o,b),o=b+1):(Ws(a,s,b+1,h),h=b)}}function Dr(a,s,o){const h=a[s];a[s]=a[o],a[o]=h}nt("FeaturePositionMap",jr);class Ea{constructor(s,o){this.gl=s.gl,this.location=o}}class dc extends Ea{constructor(s,o){super(s,o),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Of extends Ea{constructor(s,o){super(s,o),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Ff extends Ea{constructor(s,o){super(s,o),this.current=ar.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const Ag=new Float32Array(16);function hh(a){return[an(255*a.r,255*a.g),an(255*a.b,255*a.a)]}class ln{constructor(s,o,h){this.value=s,this.uniformNames=o.map(p=>`u_${p}`),this.type=h}setUniform(s,o,h){s.set(h.constantOr(this.value))}getBinding(s,o,h){return this.type==="color"?new Ff(s,o):new dc(s,o)}}class Ca{constructor(s,o){this.uniformNames=o.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=s.tlbr}setUniform(s,o,h,p){const x=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&s.set(x)}getBinding(s,o,h){return h.substr(0,9)==="u_pattern"?new Of(s,o):new dc(s,o)}}class cn{constructor(s,o,h,p){this.expression=s,this.type=h,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(s,o,h,p,x){const b=this.paintVertexArray.length,S=this.expression.evaluate(new mr(0),o,{},p,[],x);this.paintVertexArray.resize(s),this._setPaintValue(b,s,S)}updatePaintArray(s,o,h,p){const x=this.expression.evaluate({zoom:0},h,p);this._setPaintValue(s,o,x)}_setPaintValue(s,o,h){if(this.type==="color"){const p=hh(h);for(let x=s;x<o;x++)this.paintVertexArray.emplace(x,p[0],p[1])}else{for(let p=s;p<o;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ii{constructor(s,o,h,p,x,b){this.expression=s,this.uniformNames=o.map(S=>`u_${S}_t`),this.type=h,this.useIntegerZoom=p,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=o.map(S=>({name:`a_${S}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(s,o,h,p,x){const b=this.expression.evaluate(new mr(this.zoom),o,{},p,[],x),S=this.expression.evaluate(new mr(this.zoom+1),o,{},p,[],x),C=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(C,s,b,S)}updatePaintArray(s,o,h,p){const x=this.expression.evaluate({zoom:this.zoom},h,p),b=this.expression.evaluate({zoom:this.zoom+1},h,p);this._setPaintValue(s,o,x,b)}_setPaintValue(s,o,h,p){if(this.type==="color"){const x=hh(h),b=hh(p);for(let S=s;S<o;S++)this.paintVertexArray.emplace(S,x[0],x[1],b[0],b[1])}else{for(let x=s;x<o;x++)this.paintVertexArray.emplace(x,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,o){const h=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=be(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);s.set(p)}getBinding(s,o,h){return new dc(s,o)}}class un{constructor(s,o,h,p,x,b){this.expression=s,this.type=o,this.useIntegerZoom=h,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(s,o,h){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(p,s,o.patterns&&o.patterns[this.layerId],h)}updatePaintArray(s,o,h,p,x){this._setPaintValues(s,o,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(s,o,h,p){if(!p||!h)return;const{min:x,mid:b,max:S}=h,C=p[x],M=p[b],N=p[S];if(C&&M&&N)for(let B=s;B<o;B++)this.zoomInPaintVertexArray.emplace(B,M.tl[0],M.tl[1],M.br[0],M.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],M.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,M.tl[0],M.tl[1],M.br[0],M.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],M.pixelRatio,N.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,on.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,on.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class dh{constructor(s,o,h){this.binders={},this._buffers=[];const p=[];for(const x in s.paint._values){if(!h(x))continue;const b=s.paint.get(x);if(!(b instanceof Ns&&Ja(b.property.specification)))continue;const S=cA(x,s.type),C=b.value,M=b.property.specification.type,N=b.property.useIntegerZoom,B=b.property.specification["property-type"],F=B==="cross-faded"||B==="cross-faded-data-driven";if(C.kind==="constant")this.binders[x]=F?new Ca(C.value,S):new ln(C.value,S,M),p.push(`/u_${x}`);else if(C.kind==="source"||F){const U=F0(x,M,"source");this.binders[x]=F?new un(C,M,N,o,U,s.id):new cn(C,S,M,U),p.push(`/a_${x}`)}else{const U=F0(x,M,"composite");this.binders[x]=new Ii(C,S,M,N,o,U),p.push(`/z_${x}`)}}this.cacheKey=p.sort().join("")}getMaxValue(s){const o=this.binders[s];return o instanceof cn||o instanceof Ii?o.maxValue:0}populatePaintArrays(s,o,h,p,x){for(const b in this.binders){const S=this.binders[b];(S instanceof cn||S instanceof Ii||S instanceof un)&&S.populatePaintArray(s,o,h,p,x)}}setConstantPatternPositions(s,o){for(const h in this.binders){const p=this.binders[h];p instanceof Ca&&p.setConstantPatternPositions(s,o)}}updatePaintArrays(s,o,h,p,x){let b=!1;for(const S in s){const C=o.getPositions(S);for(const M of C){const N=h.feature(M.index);for(const B in this.binders){const F=this.binders[B];if((F instanceof cn||F instanceof Ii||F instanceof un)&&F.expression.isStateDependent===!0){const U=p.paint.get(B);F.expression=U.value,F.updatePaintArray(M.start,M.end,N,s[S],x),b=!0}}}}return b}defines(){const s=[];for(const o in this.binders){const h=this.binders[o];(h instanceof ln||h instanceof Ca)&&s.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return s}getBinderAttributes(){const s=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof cn||h instanceof Ii)for(let p=0;p<h.paintVertexAttributes.length;p++)s.push(h.paintVertexAttributes[p].name);else if(h instanceof un)for(let p=0;p<on.members.length;p++)s.push(on.members[p].name)}return s}getBinderUniforms(){const s=[];for(const o in this.binders){const h=this.binders[o];if(h instanceof ln||h instanceof Ca||h instanceof Ii)for(const p of h.uniformNames)s.push(p)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,o){const h=[];for(const p in this.binders){const x=this.binders[p];if(x instanceof ln||x instanceof Ca||x instanceof Ii){for(const b of x.uniformNames)if(o[b]){const S=x.getBinding(s,o[b],b);h.push({name:b,property:p,binding:S})}}}return h}setUniforms(s,o,h,p){for(const{name:x,property:b,binding:S}of o)this.binders[b].setUniform(S,p,h.get(b),x)}updatePaintBuffers(s){this._buffers=[];for(const o in this.binders){const h=this.binders[o];if(s&&h instanceof un){const p=s.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(h instanceof cn||h instanceof Ii)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(s){for(const o in this.binders){const h=this.binders[o];(h instanceof cn||h instanceof Ii||h instanceof un)&&h.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const o=this.binders[s];(o instanceof cn||o instanceof Ii||o instanceof un)&&o.destroy()}}}class Mn{constructor(s,o,h=()=>!0){this.programConfigurations={};for(const p of s)this.programConfigurations[p.id]=new dh(p,o,h);this.needsUpload=!1,this._featureMap=new jr,this._bufferOffset=0}populatePaintArrays(s,o,h,p,x,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(s,o,p,x,b);o.id!==void 0&&this._featureMap.add(o.id,h,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,o,h,p){for(const x of h)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(s,this._featureMap,o,x,p)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function cA(a,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${s}-`,"").replace(/-/g,"_")]}function F0(a,s,o){const h={color:{source:io,composite:ee},number:{source:A,composite:io}},p=function(x){return{"line-pattern":{source:or,composite:or},"fill-pattern":{source:or,composite:or},"fill-extrusion-pattern":{source:or,composite:or}}[x]}(a);return p&&p[o]||h[s][o]}nt("ConstantBinder",ln),nt("CrossFadedConstantBinder",Ca),nt("SourceExpressionBinder",cn),nt("CrossFadedCompositeBinder",un),nt("CompositeExpressionBinder",Ii),nt("ProgramConfiguration",dh,{omit:["_buffers"]}),nt("ProgramConfigurationSet",Mn);const Wr=8192,Pg=Math.pow(2,14)-1,$0=-Pg-1;function al(a){const s=Wr/a.extent,o=a.loadGeometry();for(let h=0;h<o.length;h++){const p=o[h];for(let x=0;x<p.length;x++){const b=p[x],S=Math.round(b.x*s),C=Math.round(b.y*s);b.x=be(S,$0,Pg),b.y=be(C,$0,Pg),(S<b.x||S>b.x+1||C<b.y||C>b.y+1)&&qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function ol(a,s){return{type:a.type,id:a.id,properties:a.properties,geometry:s?al(a):[]}}function $f(a,s,o,h,p){a.emplaceBack(2*s+(h+1)/2,2*o+(p+1)/2)}class Ig{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(o=>o.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new lt,this.indexArray=new ys,this.segments=new gr,this.programConfigurations=new Mn(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(s,o,h){const p=this.layers[0],x=[];let b=null,S=!1;p.type==="circle"&&(b=p.layout.get("circle-sort-key"),S=!b.isConstant());for(const{feature:C,id:M,index:N,sourceLayerIndex:B}of s){const F=this.layers[0]._featureFilter.needGeometry,U=ol(C,F);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),U,h))continue;const q=S?b.evaluate(U,{},h):void 0,J={id:M,properties:C.properties,type:C.type,sourceLayerIndex:B,index:N,geometry:F?U.geometry:al(C),patterns:{},sortKey:q};x.push(J)}S&&x.sort((C,M)=>C.sortKey-M.sortKey);for(const C of x){const{geometry:M,index:N,sourceLayerIndex:B}=C,F=s[N].feature;this.addFeature(C,M,N,h),o.featureIndex.insert(F,M,N,B,this.index)}}update(s,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,o,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ci),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,o,h,p){for(const x of o)for(const b of x){const S=b.x,C=b.y;if(S<0||S>=Wr||C<0||C>=Wr)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),N=M.vertexLength;$f(this.layoutVertexArray,S,C,-1,-1),$f(this.layoutVertexArray,S,C,1,-1),$f(this.layoutVertexArray,S,C,1,1),$f(this.layoutVertexArray,S,C,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{},p)}}function U0(a,s){for(let o=0;o<a.length;o++)if(fc(s,a[o]))return!0;for(let o=0;o<s.length;o++)if(fc(a,s[o]))return!0;return!!Mg(a,s)}function uA(a,s,o){return!!fc(a,s)||!!jg(s,a,o)}function V0(a,s){if(a.length===1)return G0(s,a[0]);for(let o=0;o<s.length;o++){const h=s[o];for(let p=0;p<h.length;p++)if(fc(a,h[p]))return!0}for(let o=0;o<a.length;o++)if(G0(s,a[o]))return!0;for(let o=0;o<s.length;o++)if(Mg(a,s[o]))return!0;return!1}function hA(a,s,o){if(a.length>1){if(Mg(a,s))return!0;for(let h=0;h<s.length;h++)if(jg(s[h],a,o))return!0}for(let h=0;h<a.length;h++)if(jg(a[h],s,o))return!0;return!1}function Mg(a,s){if(a.length===0||s.length===0)return!1;for(let o=0;o<a.length-1;o++){const h=a[o],p=a[o+1];for(let x=0;x<s.length-1;x++)if(dA(h,p,s[x],s[x+1]))return!0}return!1}function dA(a,s,o,h){return Et(a,o,h)!==Et(s,o,h)&&Et(a,s,o)!==Et(a,s,h)}function jg(a,s,o){const h=o*o;if(s.length===1)return a.distSqr(s[0])<h;for(let p=1;p<s.length;p++)if(q0(a,s[p-1],s[p])<h)return!0;return!1}function q0(a,s,o){const h=s.distSqr(o);if(h===0)return a.distSqr(s);const p=((a.x-s.x)*(o.x-s.x)+(a.y-s.y)*(o.y-s.y))/h;return a.distSqr(p<0?s:p>1?o:o.sub(s)._mult(p)._add(s))}function G0(a,s){let o,h,p,x=!1;for(let b=0;b<a.length;b++){o=a[b];for(let S=0,C=o.length-1;S<o.length;C=S++)h=o[S],p=o[C],h.y>s.y!=p.y>s.y&&s.x<(p.x-h.x)*(s.y-h.y)/(p.y-h.y)+h.x&&(x=!x)}return x}function fc(a,s){let o=!1;for(let h=0,p=a.length-1;h<a.length;p=h++){const x=a[h],b=a[p];x.y>s.y!=b.y>s.y&&s.x<(b.x-x.x)*(s.y-x.y)/(b.y-x.y)+x.x&&(o=!o)}return o}function fA(a,s,o){const h=o[0],p=o[2];if(a.x<h.x&&s.x<h.x||a.x>p.x&&s.x>p.x||a.y<h.y&&s.y<h.y||a.y>p.y&&s.y>p.y)return!1;const x=Et(a,s,o[0]);return x!==Et(a,s,o[1])||x!==Et(a,s,o[2])||x!==Et(a,s,o[3])}function fh(a,s,o){const h=s.paint.get(a).value;return h.kind==="constant"?h.value:o.programConfigurations.get(s.id).getMaxValue(a)}function Uf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Vf(a,s,o,h,p){if(!s[0]&&!s[1])return a;const x=L.convert(s)._mult(p);o==="viewport"&&x._rotate(-h);const b=[];for(let S=0;S<a.length;S++)b.push(a[S].sub(x));return b}let W0,Z0;nt("CircleBucket",Ig,{omit:["layers"]});var pA={get paint(){return Z0=Z0||new Rr({"circle-radius":new xt(Pe.paint_circle["circle-radius"]),"circle-color":new xt(Pe.paint_circle["circle-color"]),"circle-blur":new xt(Pe.paint_circle["circle-blur"]),"circle-opacity":new xt(Pe.paint_circle["circle-opacity"]),"circle-translate":new dt(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xt(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return W0=W0||new Rr({"circle-sort-key":new xt(Pe.layout_circle["circle-sort-key"])})}},Zs=1e-6,pc=typeof Float32Array<"u"?Float32Array:Array;function Dg(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function H0(a,s,o){var h=s[0],p=s[1],x=s[2],b=s[3],S=s[4],C=s[5],M=s[6],N=s[7],B=s[8],F=s[9],U=s[10],q=s[11],J=s[12],ne=s[13],le=s[14],ve=s[15],fe=o[0],xe=o[1],ke=o[2],De=o[3];return a[0]=fe*h+xe*S+ke*B+De*J,a[1]=fe*p+xe*C+ke*F+De*ne,a[2]=fe*x+xe*M+ke*U+De*le,a[3]=fe*b+xe*N+ke*q+De*ve,a[4]=(fe=o[4])*h+(xe=o[5])*S+(ke=o[6])*B+(De=o[7])*J,a[5]=fe*p+xe*C+ke*F+De*ne,a[6]=fe*x+xe*M+ke*U+De*le,a[7]=fe*b+xe*N+ke*q+De*ve,a[8]=(fe=o[8])*h+(xe=o[9])*S+(ke=o[10])*B+(De=o[11])*J,a[9]=fe*p+xe*C+ke*F+De*ne,a[10]=fe*x+xe*M+ke*U+De*le,a[11]=fe*b+xe*N+ke*q+De*ve,a[12]=(fe=o[12])*h+(xe=o[13])*S+(ke=o[14])*B+(De=o[15])*J,a[13]=fe*p+xe*C+ke*F+De*ne,a[14]=fe*x+xe*M+ke*U+De*le,a[15]=fe*b+xe*N+ke*q+De*ve,a}Math.hypot||(Math.hypot=function(){for(var a=0,s=arguments.length;s--;)a+=arguments[s]*arguments[s];return Math.sqrt(a)});var ph,mA=H0;function qf(a,s,o){var h=s[0],p=s[1],x=s[2],b=s[3];return a[0]=o[0]*h+o[4]*p+o[8]*x+o[12]*b,a[1]=o[1]*h+o[5]*p+o[9]*x+o[13]*b,a[2]=o[2]*h+o[6]*p+o[10]*x+o[14]*b,a[3]=o[3]*h+o[7]*p+o[11]*x+o[15]*b,a}ph=new pc(4),pc!=Float32Array&&(ph[0]=0,ph[1]=0,ph[2]=0,ph[3]=0);class gA extends Pi{constructor(s){super(s,pA)}createBucket(s){return new Ig(s)}queryRadius(s){const o=s;return fh("circle-radius",this,o)+fh("circle-stroke-width",this,o)+Uf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,o,h,p,x,b,S,C){const M=Vf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,S),N=this.paint.get("circle-radius").evaluate(o,h)+this.paint.get("circle-stroke-width").evaluate(o,h),B=this.paint.get("circle-pitch-alignment")==="map",F=B?M:function(q,J){return q.map(ne=>K0(ne,J))}(M,C),U=B?N*S:N;for(const q of p)for(const J of q){const ne=B?J:K0(J,C);let le=U;const ve=qf([],[J.x,J.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=ve[3]/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=b.cameraToCenterDistance/ve[3]),uA(F,ne,le))return!0}return!1}}function K0(a,s){const o=qf([],[a.x,a.y,0,1],s);return new L(o[0]/o[3],o[1]/o[3])}class X0 extends Ig{}let Y0;nt("HeatmapBucket",X0,{omit:["layers"]});var yA={get paint(){return Y0=Y0||new Rr({"heatmap-radius":new xt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nh(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(Pe.paint_heatmap["heatmap-opacity"])})}};function Ng(a,{width:s,height:o},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==s*o*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${s*o*h}`)}else p=new Uint8Array(s*o*h);return a.width=s,a.height=o,a.data=p,a}function J0(a,{width:s,height:o},h){if(s===a.width&&o===a.height)return;const p=Ng({},{width:s,height:o},h);Lg(a,p,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,s),height:Math.min(a.height,o)},h),a.width=s,a.height=o,a.data=p.data}function Lg(a,s,o,h,p,x){if(p.width===0||p.height===0)return s;if(p.width>a.width||p.height>a.height||o.x>a.width-p.width||o.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>s.width||p.height>s.height||h.x>s.width-p.width||h.y>s.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,S=s.data;if(b===S)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<p.height;C++){const M=((o.y+C)*a.width+o.x)*x,N=((h.y+C)*s.width+h.x)*x;for(let B=0;B<p.width*x;B++)S[N+B]=b[M+B]}return s}class mh{constructor(s,o){Ng(this,s,1,o)}resize(s){J0(this,s,1)}clone(){return new mh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,o,h,p,x){Lg(s,o,h,p,x,1)}}class Gi{constructor(s,o){Ng(this,s,4,o)}resize(s){J0(this,s,4)}replace(s,o){o?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Gi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,o,h,p,x){Lg(s,o,h,p,x,4)}}function Q0(a){const s={},o=a.resolution||256,h=a.clips?a.clips.length:1,p=a.image||new Gi({width:o,height:h});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const x=(b,S,C)=>{s[a.evaluationKey]=C;const M=a.expression.evaluate(s);p.data[b+S+0]=Math.floor(255*M.r/M.a),p.data[b+S+1]=Math.floor(255*M.g/M.a),p.data[b+S+2]=Math.floor(255*M.b/M.a),p.data[b+S+3]=Math.floor(255*M.a)};if(a.clips)for(let b=0,S=0;b<h;++b,S+=4*o)for(let C=0,M=0;C<o;C++,M+=4){const N=C/(o-1),{start:B,end:F}=a.clips[b];x(S,M,B*(1-N)+F*N)}else for(let b=0,S=0;b<o;b++,S+=4)x(0,S,b/(o-1));return p}nt("AlphaImage",mh),nt("RGBAImage",Gi);class _A extends Pi{createBucket(s){return new X0(s)}constructor(s){super(s,yA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Q0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let eb;var vA={get paint(){return eb=eb||new Rr({"hillshade-illumination-direction":new dt(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dt(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(Pe.paint_hillshade["hillshade-accent-color"])})}};class xA extends Pi{constructor(s){super(s,vA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const bA=Sr([{name:"a_pos",components:2,type:"Int16"}],4),{members:wA}=bA;var Rg={exports:{}};function Gf(a,s,o){o=o||2;var h,p,x,b,S,C,M,N=s&&s.length,B=N?s[0]*o:a.length,F=tb(a,0,B,o,!0),U=[];if(!F||F.next===F.prev)return U;if(N&&(F=function(J,ne,le,ve){var fe,xe,ke,De=[];for(fe=0,xe=ne.length;fe<xe;fe++)(ke=tb(J,ne[fe]*ve,fe<xe-1?ne[fe+1]*ve:J.length,ve,!1))===ke.next&&(ke.steiner=!0),De.push(IA(ke));for(De.sort(CA),fe=0;fe<De.length;fe++)le=AA(De[fe],le);return le}(a,s,F,o)),a.length>80*o){h=x=a[0],p=b=a[1];for(var q=o;q<B;q+=o)(S=a[q])<h&&(h=S),(C=a[q+1])<p&&(p=C),S>x&&(x=S),C>b&&(b=C);M=(M=Math.max(x-h,b-p))!==0?32767/M:0}return gh(F,U,o,h,p,M,0),U}function tb(a,s,o,h,p){var x,b;if(p===Og(a,s,o,h)>0)for(x=s;x<o;x+=h)b=ib(x,a[x],a[x+1],b);else for(x=o-h;x>=s;x-=h)b=ib(x,a[x],a[x+1],b);return b&&Wf(b,b.next)&&(_h(b),b=b.next),b}function ll(a,s){if(!a)return a;s||(s=a);var o,h=a;do if(o=!1,h.steiner||!Wf(h,h.next)&&Br(h.prev,h,h.next)!==0)h=h.next;else{if(_h(h),(h=s=h.prev)===h.next)break;o=!0}while(o||h!==s);return s}function gh(a,s,o,h,p,x,b){if(a){!b&&x&&function(N,B,F,U){var q=N;do q.z===0&&(q.z=zg(q.x,q.y,B,F,U)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==N);q.prevZ.nextZ=null,q.prevZ=null,function(J){var ne,le,ve,fe,xe,ke,De,et,ct=1;do{for(le=J,J=null,xe=null,ke=0;le;){for(ke++,ve=le,De=0,ne=0;ne<ct&&(De++,ve=ve.nextZ);ne++);for(et=ct;De>0||et>0&&ve;)De!==0&&(et===0||!ve||le.z<=ve.z)?(fe=le,le=le.nextZ,De--):(fe=ve,ve=ve.nextZ,et--),xe?xe.nextZ=fe:J=fe,fe.prevZ=xe,xe=fe;le=ve}xe.nextZ=null,ct*=2}while(ke>1)}(q)}(a,h,p,x);for(var S,C,M=a;a.prev!==a.next;)if(S=a.prev,C=a.next,x?kA(a,h,p,x):SA(a))s.push(S.i/o|0),s.push(a.i/o|0),s.push(C.i/o|0),_h(a),a=C.next,M=C.next;else if((a=C)===M){b?b===1?gh(a=TA(ll(a),s,o),s,o,h,p,x,2):b===2&&EA(a,s,o,h,p,x):gh(ll(a),s,o,h,p,x,1);break}}}function SA(a){var s=a.prev,o=a,h=a.next;if(Br(s,o,h)>=0)return!1;for(var p=s.x,x=o.x,b=h.x,S=s.y,C=o.y,M=h.y,N=p<x?p<b?p:b:x<b?x:b,B=S<C?S<M?S:M:C<M?C:M,F=p>x?p>b?p:b:x>b?x:b,U=S>C?S>M?S:M:C>M?C:M,q=h.next;q!==s;){if(q.x>=N&&q.x<=F&&q.y>=B&&q.y<=U&&mc(p,S,x,C,b,M,q.x,q.y)&&Br(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function kA(a,s,o,h){var p=a.prev,x=a,b=a.next;if(Br(p,x,b)>=0)return!1;for(var S=p.x,C=x.x,M=b.x,N=p.y,B=x.y,F=b.y,U=S<C?S<M?S:M:C<M?C:M,q=N<B?N<F?N:F:B<F?B:F,J=S>C?S>M?S:M:C>M?C:M,ne=N>B?N>F?N:F:B>F?B:F,le=zg(U,q,s,o,h),ve=zg(J,ne,s,o,h),fe=a.prevZ,xe=a.nextZ;fe&&fe.z>=le&&xe&&xe.z<=ve;){if(fe.x>=U&&fe.x<=J&&fe.y>=q&&fe.y<=ne&&fe!==p&&fe!==b&&mc(S,N,C,B,M,F,fe.x,fe.y)&&Br(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,xe.x>=U&&xe.x<=J&&xe.y>=q&&xe.y<=ne&&xe!==p&&xe!==b&&mc(S,N,C,B,M,F,xe.x,xe.y)&&Br(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;fe&&fe.z>=le;){if(fe.x>=U&&fe.x<=J&&fe.y>=q&&fe.y<=ne&&fe!==p&&fe!==b&&mc(S,N,C,B,M,F,fe.x,fe.y)&&Br(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;xe&&xe.z<=ve;){if(xe.x>=U&&xe.x<=J&&xe.y>=q&&xe.y<=ne&&xe!==p&&xe!==b&&mc(S,N,C,B,M,F,xe.x,xe.y)&&Br(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function TA(a,s,o){var h=a;do{var p=h.prev,x=h.next.next;!Wf(p,x)&&rb(p,h,h.next,x)&&yh(p,x)&&yh(x,p)&&(s.push(p.i/o|0),s.push(h.i/o|0),s.push(x.i/o|0),_h(h),_h(h.next),h=a=x),h=h.next}while(h!==a);return ll(h)}function EA(a,s,o,h,p,x){var b=a;do{for(var S=b.next.next;S!==b.prev;){if(b.i!==S.i&&MA(b,S)){var C=sb(b,S);return b=ll(b,b.next),C=ll(C,C.next),gh(b,s,o,h,p,x,0),void gh(C,s,o,h,p,x,0)}S=S.next}b=b.next}while(b!==a)}function CA(a,s){return a.x-s.x}function AA(a,s){var o=function(p,x){var b,S=x,C=p.x,M=p.y,N=-1/0;do{if(M<=S.y&&M>=S.next.y&&S.next.y!==S.y){var B=S.x+(M-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(B<=C&&B>N&&(N=B,b=S.x<S.next.x?S:S.next,B===C))return b}S=S.next}while(S!==x);if(!b)return null;var F,U=b,q=b.x,J=b.y,ne=1/0;S=b;do C>=S.x&&S.x>=q&&C!==S.x&&mc(M<J?C:N,M,q,J,M<J?N:C,M,S.x,S.y)&&(F=Math.abs(M-S.y)/(C-S.x),yh(S,p)&&(F<ne||F===ne&&(S.x>b.x||S.x===b.x&&PA(b,S)))&&(b=S,ne=F)),S=S.next;while(S!==U);return b}(a,s);if(!o)return s;var h=sb(o,a);return ll(h,h.next),ll(o,o.next)}function PA(a,s){return Br(a.prev,a,s.prev)<0&&Br(s.next,a,a.next)<0}function zg(a,s,o,h,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-o)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-h)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function IA(a){var s=a,o=a;do(s.x<o.x||s.x===o.x&&s.y<o.y)&&(o=s),s=s.next;while(s!==a);return o}function mc(a,s,o,h,p,x,b,S){return(p-b)*(s-S)>=(a-b)*(x-S)&&(a-b)*(h-S)>=(o-b)*(s-S)&&(o-b)*(x-S)>=(p-b)*(h-S)}function MA(a,s){return a.next.i!==s.i&&a.prev.i!==s.i&&!function(o,h){var p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==h.i&&p.next.i!==h.i&&rb(p,p.next,o,h))return!0;p=p.next}while(p!==o);return!1}(a,s)&&(yh(a,s)&&yh(s,a)&&function(o,h){var p=o,x=!1,b=(o.x+h.x)/2,S=(o.y+h.y)/2;do p.y>S!=p.next.y>S&&p.next.y!==p.y&&b<(p.next.x-p.x)*(S-p.y)/(p.next.y-p.y)+p.x&&(x=!x),p=p.next;while(p!==o);return x}(a,s)&&(Br(a.prev,a,s.prev)||Br(a,s.prev,s))||Wf(a,s)&&Br(a.prev,a,a.next)>0&&Br(s.prev,s,s.next)>0)}function Br(a,s,o){return(s.y-a.y)*(o.x-s.x)-(s.x-a.x)*(o.y-s.y)}function Wf(a,s){return a.x===s.x&&a.y===s.y}function rb(a,s,o,h){var p=Hf(Br(a,s,o)),x=Hf(Br(a,s,h)),b=Hf(Br(o,h,a)),S=Hf(Br(o,h,s));return p!==x&&b!==S||!(p!==0||!Zf(a,o,s))||!(x!==0||!Zf(a,h,s))||!(b!==0||!Zf(o,a,h))||!(S!==0||!Zf(o,s,h))}function Zf(a,s,o){return s.x<=Math.max(a.x,o.x)&&s.x>=Math.min(a.x,o.x)&&s.y<=Math.max(a.y,o.y)&&s.y>=Math.min(a.y,o.y)}function Hf(a){return a>0?1:a<0?-1:0}function yh(a,s){return Br(a.prev,a,a.next)<0?Br(a,s,a.next)>=0&&Br(a,a.prev,s)>=0:Br(a,s,a.prev)<0||Br(a,a.next,s)<0}function sb(a,s){var o=new Bg(a.i,a.x,a.y),h=new Bg(s.i,s.x,s.y),p=a.next,x=s.prev;return a.next=s,s.prev=a,o.next=p,p.prev=o,h.next=o,o.prev=h,x.next=h,h.prev=x,h}function ib(a,s,o,h){var p=new Bg(a,s,o);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function _h(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Bg(a,s,o){this.i=a,this.x=s,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Og(a,s,o,h){for(var p=0,x=s,b=o-h;x<o;x+=h)p+=(a[b]-a[x])*(a[x+1]+a[b+1]),b=x;return p}Rg.exports=Gf,Rg.exports.default=Gf,Gf.deviation=function(a,s,o,h){var p=s&&s.length,x=Math.abs(Og(a,0,p?s[0]*o:a.length,o));if(p)for(var b=0,S=s.length;b<S;b++)x-=Math.abs(Og(a,s[b]*o,b<S-1?s[b+1]*o:a.length,o));var C=0;for(b=0;b<h.length;b+=3){var M=h[b]*o,N=h[b+1]*o,B=h[b+2]*o;C+=Math.abs((a[M]-a[B])*(a[N+1]-a[M+1])-(a[M]-a[N])*(a[B+1]-a[M+1]))}return x===0&&C===0?0:Math.abs((C-x)/x)},Gf.flatten=function(a){for(var s=a[0][0].length,o={vertices:[],holes:[],dimensions:s},h=0,p=0;p<a.length;p++){for(var x=0;x<a[p].length;x++)for(var b=0;b<s;b++)o.vertices.push(a[p][x][b]);p>0&&o.holes.push(h+=a[p-1].length)}return o};var nb=k(Rg.exports);function jA(a,s,o,h,p){ab(a,s,o,h||a.length-1,p||DA)}function ab(a,s,o,h,p){for(;h>o;){if(h-o>600){var x=h-o+1,b=s-o+1,S=Math.log(x),C=.5*Math.exp(2*S/3),M=.5*Math.sqrt(S*C*(x-C)/x)*(b-x/2<0?-1:1);ab(a,s,Math.max(o,Math.floor(s-b*C/x+M)),Math.min(h,Math.floor(s+(x-b)*C/x+M)),p)}var N=a[s],B=o,F=h;for(vh(a,o,s),p(a[h],N)>0&&vh(a,o,h);B<F;){for(vh(a,B,F),B++,F--;p(a[B],N)<0;)B++;for(;p(a[F],N)>0;)F--}p(a[o],N)===0?vh(a,o,F):vh(a,++F,h),F<=s&&(o=F+1),s<=F&&(h=F-1)}}function vh(a,s,o){var h=a[s];a[s]=a[o],a[o]=h}function DA(a,s){return a<s?-1:a>s?1:0}function Fg(a,s){const o=a.length;if(o<=1)return[a];const h=[];let p,x;for(let b=0;b<o;b++){const S=ir(a[b]);S!==0&&(a[b].area=Math.abs(S),x===void 0&&(x=S<0),x===S<0?(p&&h.push(p),p=[a[b]]):p.push(a[b]))}if(p&&h.push(p),s>1)for(let b=0;b<h.length;b++)h[b].length<=s||(jA(h[b],s,1,h[b].length-1,NA),h[b]=h[b].slice(0,s));return h}function NA(a,s){return s.area-a.area}function $g(a,s,o){const h=o.patternDependencies;let p=!1;for(const x of s){const b=x.paint.get(`${a}-pattern`);b.isConstant()||(p=!0);const S=b.constantOr(null);S&&(p=!0,h[S.to]=!0,h[S.from]=!0)}return p}function Ug(a,s,o,h,p){const x=p.patternDependencies;for(const b of s){const S=b.paint.get(`${a}-pattern`).value;if(S.kind!=="constant"){let C=S.evaluate({zoom:h-1},o,{},p.availableImages),M=S.evaluate({zoom:h},o,{},p.availableImages),N=S.evaluate({zoom:h+1},o,{},p.availableImages);C=C&&C.name?C.name:C,M=M&&M.name?M.name:M,N=N&&N.name?N.name:N,x[C]=!0,x[M]=!0,x[N]=!0,o.patterns[b.id]={min:C,mid:M,max:N}}}return o}class Vg{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(o=>o.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bt,this.indexArray=new ys,this.indexArray2=new Yr,this.programConfigurations=new Mn(s.layers,s.zoom),this.segments=new gr,this.segments2=new gr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(s,o,h){this.hasPattern=$g("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),x=!p.isConstant(),b=[];for(const{feature:S,id:C,index:M,sourceLayerIndex:N}of s){const B=this.layers[0]._featureFilter.needGeometry,F=ol(S,B);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),F,h))continue;const U=x?p.evaluate(F,{},h,o.availableImages):void 0,q={id:C,properties:S.properties,type:S.type,sourceLayerIndex:N,index:M,geometry:B?F.geometry:al(S),patterns:{},sortKey:U};b.push(q)}x&&b.sort((S,C)=>S.sortKey-C.sortKey);for(const S of b){const{geometry:C,index:M,sourceLayerIndex:N}=S;if(this.hasPattern){const B=Ug("fill",this.layers,S,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(S,C,M,h,{});o.featureIndex.insert(s[M].feature,C,M,N,this.index)}}update(s,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,o,this.stateDependentLayers,h)}addFeatures(s,o,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,wA),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,o,h,p,x){for(const b of Fg(o,500)){let S=0;for(const U of b)S+=U.length;const C=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),M=C.vertexLength,N=[],B=[];for(const U of b){if(U.length===0)continue;U!==b[0]&&B.push(N.length/2);const q=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),J=q.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(J+U.length-1,J),N.push(U[0].x),N.push(U[0].y);for(let ne=1;ne<U.length;ne++)this.layoutVertexArray.emplaceBack(U[ne].x,U[ne].y),this.indexArray2.emplaceBack(J+ne-1,J+ne),N.push(U[ne].x),N.push(U[ne].y);q.vertexLength+=U.length,q.primitiveLength+=U.length}const F=nb(N,B);for(let U=0;U<F.length;U+=3)this.indexArray.emplaceBack(M+F[U],M+F[U+1],M+F[U+2]);C.vertexLength+=S,C.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,x,p)}}let ob,lb;nt("FillBucket",Vg,{omit:["layers","patternFeatures"]});var LA={get paint(){return lb=lb||new Rr({"fill-antialias":new dt(Pe.paint_fill["fill-antialias"]),"fill-opacity":new xt(Pe.paint_fill["fill-opacity"]),"fill-color":new xt(Pe.paint_fill["fill-color"]),"fill-outline-color":new xt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new dt(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new sl(Pe.paint_fill["fill-pattern"])})},get layout(){return ob=ob||new Rr({"fill-sort-key":new xt(Pe.layout_fill["fill-sort-key"])})}};class RA extends Pi{constructor(s){super(s,LA)}recalculate(s,o){super.recalculate(s,o);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Vg(s)}queryRadius(){return Uf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,o,h,p,x,b,S){return V0(Vf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,S),p)}isTileClipped(){return!0}}const zA=Sr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),BA=Sr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:OA}=zA;var ao={},FA=P,cb=gc;function gc(a,s,o,h,p){this.properties={},this.extent=o,this.type=0,this._pbf=a,this._geometry=-1,this._keys=h,this._values=p,a.readFields($A,this,s)}function $A(a,s,o){a==1?s.id=o.readVarint():a==2?function(h,p){for(var x=h.readVarint()+h.pos;h.pos<x;){var b=p._keys[h.readVarint()],S=p._values[h.readVarint()];p.properties[b]=S}}(o,s):a==3?s.type=o.readVarint():a==4&&(s._geometry=o.pos)}function UA(a){for(var s,o,h=0,p=0,x=a.length,b=x-1;p<x;b=p++)h+=((o=a[b]).x-(s=a[p]).x)*(s.y+o.y);return h}gc.types=["Unknown","Point","LineString","Polygon"],gc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var s,o=a.readVarint()+a.pos,h=1,p=0,x=0,b=0,S=[];a.pos<o;){if(p<=0){var C=a.readVarint();h=7&C,p=C>>3}if(p--,h===1||h===2)x+=a.readSVarint(),b+=a.readSVarint(),h===1&&(s&&S.push(s),s=[]),s.push(new FA(x,b));else{if(h!==7)throw new Error("unknown command "+h);s&&s.push(s[0].clone())}}return s&&S.push(s),S},gc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var s=a.readVarint()+a.pos,o=1,h=0,p=0,x=0,b=1/0,S=-1/0,C=1/0,M=-1/0;a.pos<s;){if(h<=0){var N=a.readVarint();o=7&N,h=N>>3}if(h--,o===1||o===2)(p+=a.readSVarint())<b&&(b=p),p>S&&(S=p),(x+=a.readSVarint())<C&&(C=x),x>M&&(M=x);else if(o!==7)throw new Error("unknown command "+o)}return[b,C,S,M]},gc.prototype.toGeoJSON=function(a,s,o){var h,p,x=this.extent*Math.pow(2,o),b=this.extent*a,S=this.extent*s,C=this.loadGeometry(),M=gc.types[this.type];function N(U){for(var q=0;q<U.length;q++){var J=U[q];U[q]=[360*(J.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+S)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(h=0;h<C.length;h++)B[h]=C[h][0];N(C=B);break;case 2:for(h=0;h<C.length;h++)N(C[h]);break;case 3:for(C=function(U){var q=U.length;if(q<=1)return[U];for(var J,ne,le=[],ve=0;ve<q;ve++){var fe=UA(U[ve]);fe!==0&&(ne===void 0&&(ne=fe<0),ne===fe<0?(J&&le.push(J),J=[U[ve]]):J.push(U[ve]))}return J&&le.push(J),le}(C),h=0;h<C.length;h++)for(p=0;p<C[h].length;p++)N(C[h][p])}C.length===1?C=C[0]:M="Multi"+M;var F={type:"Feature",geometry:{type:M,coordinates:C},properties:this.properties};return"id"in this&&(F.id=this.id),F};var VA=cb,ub=hb;function hb(a,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(qA,this,s),this.length=this._features.length}function qA(a,s,o){a===15?s.version=o.readVarint():a===1?s.name=o.readString():a===5?s.extent=o.readVarint():a===2?s._features.push(o.pos):a===3?s._keys.push(o.readString()):a===4&&s._values.push(function(h){for(var p=null,x=h.readVarint()+h.pos;h.pos<x;){var b=h.readVarint()>>3;p=b===1?h.readString():b===2?h.readFloat():b===3?h.readDouble():b===4?h.readVarint64():b===5?h.readVarint():b===6?h.readSVarint():b===7?h.readBoolean():null}return p}(o))}hb.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var s=this._pbf.readVarint()+this._pbf.pos;return new VA(this._pbf,s,this.extent,this._keys,this._values)};var GA=ub;function WA(a,s,o){if(a===3){var h=new GA(o,o.readVarint()+o.pos);h.length&&(s[h.name]=h)}}ao.VectorTile=function(a,s){this.layers=a.readFields(WA,{},s)},ao.VectorTileFeature=cb,ao.VectorTileLayer=ub;const ZA=ao.VectorTileFeature.types,qg=Math.pow(2,13);function xh(a,s,o,h,p,x,b,S){a.emplaceBack(s,o,2*Math.floor(h*qg)+b,p*qg*2,x*qg*2,Math.round(S))}class Gg{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(o=>o.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.centroidVertexArray=new $e,this.indexArray=new ys,this.programConfigurations=new Mn(s.layers,s.zoom),this.segments=new gr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(s,o,h){this.features=[],this.hasPattern=$g("fill-extrusion",this.layers,o);for(const{feature:p,id:x,index:b,sourceLayerIndex:S}of s){const C=this.layers[0]._featureFilter.needGeometry,M=ol(p,C);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),M,h))continue;const N={id:x,sourceLayerIndex:S,index:b,geometry:C?M.geometry:al(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Ug("fill-extrusion",this.layers,N,this.zoom,o)):this.addFeature(N,N.geometry,b,h,{}),o.featureIndex.insert(p,N.geometry,b,S,this.index,!0)}}addFeatures(s,o,h){for(const p of this.features){const{geometry:x}=p;this.addFeature(p,x,p.index,o,h)}}update(s,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,o,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,OA),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,BA.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,o,h,p,x){const b={x:0,y:0,vertexCount:0};for(const S of Fg(o,500)){let C=0;for(const q of S)C+=q.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const q of S){if(q.length===0||KA(q))continue;let J=0;for(let ne=0;ne<q.length;ne++){const le=q[ne];if(ne>=1){const ve=q[ne-1];if(!HA(le,ve)){M.vertexLength+4>gr.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const fe=le.sub(ve)._perp()._unit(),xe=ve.dist(le);J+xe>32768&&(J=0),xh(this.layoutVertexArray,le.x,le.y,fe.x,fe.y,0,0,J),xh(this.layoutVertexArray,le.x,le.y,fe.x,fe.y,0,1,J),b.x+=2*le.x,b.y+=2*le.y,b.vertexCount+=2,J+=xe,xh(this.layoutVertexArray,ve.x,ve.y,fe.x,fe.y,0,0,J),xh(this.layoutVertexArray,ve.x,ve.y,fe.x,fe.y,0,1,J),b.x+=2*ve.x,b.y+=2*ve.y,b.vertexCount+=2;const ke=M.vertexLength;this.indexArray.emplaceBack(ke,ke+2,ke+1),this.indexArray.emplaceBack(ke+1,ke+2,ke+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+C>gr.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),ZA[s.type]!=="Polygon")continue;const N=[],B=[],F=M.vertexLength;for(const q of S)if(q.length!==0){q!==S[0]&&B.push(N.length/2);for(let J=0;J<q.length;J++){const ne=q[J];xh(this.layoutVertexArray,ne.x,ne.y,0,0,1,1,0),b.x+=ne.x,b.y+=ne.y,b.vertexCount+=1,N.push(ne.x),N.push(ne.y)}}const U=nb(N,B);for(let q=0;q<U.length;q+=3)this.indexArray.emplaceBack(F+U[q],F+U[q+2],F+U[q+1]);M.primitiveLength+=U.length/3,M.vertexLength+=C}for(let S=0;S<b.vertexCount;S++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,x,p)}}function HA(a,s){return a.x===s.x&&(a.x<0||a.x>Wr)||a.y===s.y&&(a.y<0||a.y>Wr)}function KA(a){return a.every(s=>s.x<0)||a.every(s=>s.x>Wr)||a.every(s=>s.y<0)||a.every(s=>s.y>Wr)}let db;nt("FillExtrusionBucket",Gg,{omit:["layers","features"]});var XA={get paint(){return db=db||new Rr({"fill-extrusion-opacity":new dt(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sl(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class YA extends Pi{constructor(s){super(s,XA)}createBucket(s){return new Gg(s)}queryRadius(){return Uf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,o,h,p,x,b,S,C){const M=Vf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,S),N=this.paint.get("fill-extrusion-height").evaluate(o,h),B=this.paint.get("fill-extrusion-base").evaluate(o,h),F=function(q,J,ne,le){const ve=[];for(const fe of q){const xe=[fe.x,fe.y,0,1];qf(xe,xe,J),ve.push(new L(xe[0]/xe[3],xe[1]/xe[3]))}return ve}(M,C),U=function(q,J,ne,le){const ve=[],fe=[],xe=le[8]*J,ke=le[9]*J,De=le[10]*J,et=le[11]*J,ct=le[8]*ne,Je=le[9]*ne,Xe=le[10]*ne,We=le[11]*ne;for(const at of q){const He=[],ze=[];for(const mt of at){const ht=mt.x,Lt=mt.y,yr=le[0]*ht+le[4]*Lt+le[12],vr=le[1]*ht+le[5]*Lt+le[13],es=le[2]*ht+le[6]*Lt+le[14],Mi=le[3]*ht+le[7]*Lt+le[15],Hs=es+De,Zr=Mi+et,vs=yr+ct,As=vr+Je,Ks=es+Xe,Xs=Mi+We,ts=new L((yr+xe)/Zr,(vr+ke)/Zr);ts.z=Hs/Zr,He.push(ts);const rs=new L(vs/Xs,As/Xs);rs.z=Ks/Xs,ze.push(rs)}ve.push(He),fe.push(ze)}return[ve,fe]}(p,B,N,C);return function(q,J,ne){let le=1/0;V0(ne,J)&&(le=fb(ne,J[0]));for(let ve=0;ve<J.length;ve++){const fe=J[ve],xe=q[ve];for(let ke=0;ke<fe.length-1;ke++){const De=fe[ke],et=[De,fe[ke+1],xe[ke+1],xe[ke],De];U0(ne,et)&&(le=Math.min(le,fb(ne,et)))}}return le!==1/0&&le}(U[0],U[1],F)}}function bh(a,s){return a.x*s.x+a.y*s.y}function fb(a,s){if(a.length===1){let o=0;const h=s[o++];let p;for(;!p||h.equals(p);)if(p=s[o++],!p)return 1/0;for(;o<s.length;o++){const x=s[o],b=a[0],S=p.sub(h),C=x.sub(h),M=b.sub(h),N=bh(S,S),B=bh(S,C),F=bh(C,C),U=bh(M,S),q=bh(M,C),J=N*F-B*B,ne=(F*U-B*q)/J,le=(N*q-B*U)/J,ve=h.z*(1-ne-le)+p.z*ne+x.z*le;if(isFinite(ve))return ve}return 1/0}{let o=1/0;for(const h of s)o=Math.min(o,h.z);return o}}const JA=Sr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:QA}=JA,eP=Sr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tP}=eP,rP=ao.VectorTileFeature.types,sP=Math.cos(Math.PI/180*37.5),pb=Math.pow(2,14)/.5;class Wg{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(o=>o.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new bt,this.layoutVertexArray2=new ut,this.indexArray=new ys,this.programConfigurations=new Mn(s.layers,s.zoom),this.segments=new gr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(s,o,h){this.hasPattern=$g("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),x=!p.isConstant(),b=[];for(const{feature:S,id:C,index:M,sourceLayerIndex:N}of s){const B=this.layers[0]._featureFilter.needGeometry,F=ol(S,B);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),F,h))continue;const U=x?p.evaluate(F,{},h):void 0,q={id:C,properties:S.properties,type:S.type,sourceLayerIndex:N,index:M,geometry:B?F.geometry:al(S),patterns:{},sortKey:U};b.push(q)}x&&b.sort((S,C)=>S.sortKey-C.sortKey);for(const S of b){const{geometry:C,index:M,sourceLayerIndex:N}=S;if(this.hasPattern){const B=Ug("line",this.layers,S,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(S,C,M,h,{});o.featureIndex.insert(s[M].feature,C,M,N,this.index)}}update(s,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,o,this.stateDependentLayers,h)}addFeatures(s,o,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,tP)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,QA),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,o,h,p,x){const b=this.layers[0].layout,S=b.get("line-join").evaluate(s,{}),C=b.get("line-cap"),M=b.get("line-miter-limit"),N=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const B of o)this.addLine(B,s,S,C,M,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,x,p)}addLine(s,o,h,p,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<s.length-1;le++)this.totalDistance+=s[le].dist(s[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=rP[o.type]==="Polygon";let C=s.length;for(;C>=2&&s[C-1].equals(s[C-2]);)C--;let M=0;for(;M<C-1&&s[M].equals(s[M+1]);)M++;if(C<(S?3:2))return;h==="bevel"&&(x=1.05);const N=this.overscaling<=16?15*Wr/(512*this.overscaling):0,B=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let F,U,q,J,ne;this.e1=this.e2=-1,S&&(F=s[C-2],ne=s[M].sub(F)._unit()._perp());for(let le=M;le<C;le++){if(q=le===C-1?S?s[M+1]:void 0:s[le+1],q&&s[le].equals(q))continue;ne&&(J=ne),F&&(U=F),F=s[le],ne=q?q.sub(F)._unit()._perp():J,J=J||ne;let ve=J.add(ne);ve.x===0&&ve.y===0||ve._unit();const fe=J.x*ne.x+J.y*ne.y,xe=ve.x*ne.x+ve.y*ne.y,ke=xe!==0?1/xe:1/0,De=2*Math.sqrt(2-2*xe),et=xe<sP&&U&&q,ct=J.x*ne.y-J.y*ne.x>0;if(et&&le>M){const We=F.dist(U);if(We>2*N){const at=F.sub(F.sub(U)._mult(N/We)._round());this.updateDistance(U,at),this.addCurrentVertex(at,J,0,0,B),U=at}}const Je=U&&q;let Xe=Je?h:S?"butt":p;if(Je&&Xe==="round"&&(ke<b?Xe="miter":ke<=2&&(Xe="fakeround")),Xe==="miter"&&ke>x&&(Xe="bevel"),Xe==="bevel"&&(ke>2&&(Xe="flipbevel"),ke<x&&(Xe="miter")),U&&this.updateDistance(U,F),Xe==="miter")ve._mult(ke),this.addCurrentVertex(F,ve,0,0,B);else if(Xe==="flipbevel"){if(ke>100)ve=ne.mult(-1);else{const We=ke*J.add(ne).mag()/J.sub(ne).mag();ve._perp()._mult(We*(ct?-1:1))}this.addCurrentVertex(F,ve,0,0,B),this.addCurrentVertex(F,ve.mult(-1),0,0,B)}else if(Xe==="bevel"||Xe==="fakeround"){const We=-Math.sqrt(ke*ke-1),at=ct?We:0,He=ct?0:We;if(U&&this.addCurrentVertex(F,J,at,He,B),Xe==="fakeround"){const ze=Math.round(180*De/Math.PI/20);for(let mt=1;mt<ze;mt++){let ht=mt/ze;if(ht!==.5){const yr=ht-.5;ht+=ht*yr*(ht-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*yr*yr+(.848013+fe*(.215638*fe-1.06021)))}const Lt=ne.sub(J)._mult(ht)._add(J)._unit()._mult(ct?-1:1);this.addHalfVertex(F,Lt.x,Lt.y,!1,ct,0,B)}}q&&this.addCurrentVertex(F,ne,-at,-He,B)}else if(Xe==="butt")this.addCurrentVertex(F,ve,0,0,B);else if(Xe==="square"){const We=U?1:-1;this.addCurrentVertex(F,ve,We,We,B)}else Xe==="round"&&(U&&(this.addCurrentVertex(F,J,0,0,B),this.addCurrentVertex(F,J,1,1,B,!0)),q&&(this.addCurrentVertex(F,ne,-1,-1,B,!0),this.addCurrentVertex(F,ne,0,0,B)));if(et&&le<C-1){const We=F.dist(q);if(We>2*N){const at=F.add(q.sub(F)._mult(N/We)._round());this.updateDistance(F,at),this.addCurrentVertex(at,ne,0,0,B),F=at}}}}addCurrentVertex(s,o,h,p,x,b=!1){const S=o.y*p-o.x,C=-o.y-o.x*p;this.addHalfVertex(s,o.x+o.y*h,o.y-o.x*h,b,!1,h,x),this.addHalfVertex(s,S,C,b,!0,-p,x),this.distance>pb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,o,h,p,x,b))}addHalfVertex({x:s,y:o},h,p,x,b,S,C){const M=.5*(this.lineClips?this.scaledDistance*(pb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(x?1:0),(o<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(S===0?0:S<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),C.primitiveLength++),b?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,o){this.distance+=s.dist(o),this.updateScaledDistance()}}let mb,gb;nt("LineBucket",Wg,{omit:["layers","patternFeatures"]});var yb={get paint(){return gb=gb||new Rr({"line-opacity":new xt(Pe.paint_line["line-opacity"]),"line-color":new xt(Pe.paint_line["line-color"]),"line-translate":new dt(Pe.paint_line["line-translate"]),"line-translate-anchor":new dt(Pe.paint_line["line-translate-anchor"]),"line-width":new xt(Pe.paint_line["line-width"]),"line-gap-width":new xt(Pe.paint_line["line-gap-width"]),"line-offset":new xt(Pe.paint_line["line-offset"]),"line-blur":new xt(Pe.paint_line["line-blur"]),"line-dasharray":new ih(Pe.paint_line["line-dasharray"]),"line-pattern":new sl(Pe.paint_line["line-pattern"]),"line-gradient":new nh(Pe.paint_line["line-gradient"])})},get layout(){return mb=mb||new Rr({"line-cap":new dt(Pe.layout_line["line-cap"]),"line-join":new xt(Pe.layout_line["line-join"]),"line-miter-limit":new dt(Pe.layout_line["line-miter-limit"]),"line-round-limit":new dt(Pe.layout_line["line-round-limit"]),"line-sort-key":new xt(Pe.layout_line["line-sort-key"])})}};class iP extends xt{possiblyEvaluate(s,o){return o=new mr(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(s,o)}evaluate(s,o,h,p){return o=Te({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(s,o,h,p)}}let Kf;class nP extends Pi{constructor(s){super(s,yb),this.gradientVersion=0,Kf||(Kf=new iP(yb.paint.properties["line-width"].specification),Kf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(h){return h._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof Yn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,o){super.recalculate(s,o),this.paint._values["line-floorwidth"]=Kf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Wg(s)}queryRadius(s){const o=s,h=_b(fh("line-width",this,o),fh("line-gap-width",this,o)),p=fh("line-offset",this,o);return h/2+Math.abs(p)+Uf(this.paint.get("line-translate"))}queryIntersectsFeature(s,o,h,p,x,b,S){const C=Vf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,S),M=S/2*_b(this.paint.get("line-width").evaluate(o,h),this.paint.get("line-gap-width").evaluate(o,h)),N=this.paint.get("line-offset").evaluate(o,h);return N&&(p=function(B,F){const U=[];for(let q=0;q<B.length;q++){const J=B[q],ne=[];for(let le=0;le<J.length;le++){const ve=J[le-1],fe=J[le],xe=J[le+1],ke=le===0?new L(0,0):fe.sub(ve)._unit()._perp(),De=le===J.length-1?new L(0,0):xe.sub(fe)._unit()._perp(),et=ke._add(De)._unit(),ct=et.x*De.x+et.y*De.y;ct!==0&&et._mult(1/ct),ne.push(et._mult(F)._add(fe))}U.push(ne)}return U}(p,N*S)),function(B,F,U){for(let q=0;q<F.length;q++){const J=F[q];if(B.length>=3){for(let ne=0;ne<J.length;ne++)if(fc(B,J[ne]))return!0}if(hA(B,J,U))return!0}return!1}(C,p,M)}isTileClipped(){return!0}}function _b(a,s){return s>0?s+2*a:a}const aP=Sr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oP=Sr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Sr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lP=Sr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Sr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vb=Sr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cP=Sr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function uP(a,s,o){return a.sections.forEach(h=>{h.text=function(p,x,b){const S=x.layout.get("text-transform").evaluate(b,{});return S==="uppercase"?p=p.toLocaleUpperCase():S==="lowercase"&&(p=p.toLocaleLowerCase()),li.applyArabicShaping&&(p=li.applyArabicShaping(p)),p}(h.text,s,o)}),a}Sr([{name:"triangle",components:3,type:"Uint16"}]),Sr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Sr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Sr([{type:"Float32",name:"offsetX"}]),Sr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Sr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const wh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Qr=24,xb=cr,bb=function(a,s,o,h,p){var x,b,S=8*p-h-1,C=(1<<S)-1,M=C>>1,N=-7,B=p-1,F=-1,U=a[s+B];for(B+=F,x=U&(1<<-N)-1,U>>=-N,N+=S;N>0;x=256*x+a[s+B],B+=F,N-=8);for(b=x&(1<<-N)-1,x>>=-N,N+=h;N>0;b=256*b+a[s+B],B+=F,N-=8);if(x===0)x=1-M;else{if(x===C)return b?NaN:1/0*(U?-1:1);b+=Math.pow(2,h),x-=M}return(U?-1:1)*b*Math.pow(2,x-h)},wb=function(a,s,o,h,p,x){var b,S,C,M=8*x-p-1,N=(1<<M)-1,B=N>>1,F=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=0,q=1,J=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(S=isNaN(s)?1:0,b=N):(b=Math.floor(Math.log(s)/Math.LN2),s*(C=Math.pow(2,-b))<1&&(b--,C*=2),(s+=b+B>=1?F/C:F*Math.pow(2,1-B))*C>=2&&(b++,C/=2),b+B>=N?(S=0,b=N):b+B>=1?(S=(s*C-1)*Math.pow(2,p),b+=B):(S=s*Math.pow(2,B-1)*Math.pow(2,p),b=0));p>=8;a[o+U]=255&S,U+=q,S/=256,p-=8);for(b=b<<p|S,M+=p;M>0;a[o+U]=255&b,U+=q,b/=256,M-=8);a[o+U-q]|=128*J};function cr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}cr.Varint=0,cr.Fixed64=1,cr.Bytes=2,cr.Fixed32=5;var Zg=4294967296,Sb=1/Zg,kb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Aa(a){return a.type===cr.Bytes?a.readVarint()+a.pos:a.pos+1}function yc(a,s,o){return o?4294967296*s+(a>>>0):4294967296*(s>>>0)+(a>>>0)}function Tb(a,s,o){var h=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));o.realloc(h);for(var p=o.pos-1;p>=a;p--)o.buf[p+h]=o.buf[p]}function hP(a,s){for(var o=0;o<a.length;o++)s.writeVarint(a[o])}function dP(a,s){for(var o=0;o<a.length;o++)s.writeSVarint(a[o])}function fP(a,s){for(var o=0;o<a.length;o++)s.writeFloat(a[o])}function pP(a,s){for(var o=0;o<a.length;o++)s.writeDouble(a[o])}function mP(a,s){for(var o=0;o<a.length;o++)s.writeBoolean(a[o])}function gP(a,s){for(var o=0;o<a.length;o++)s.writeFixed32(a[o])}function yP(a,s){for(var o=0;o<a.length;o++)s.writeSFixed32(a[o])}function _P(a,s){for(var o=0;o<a.length;o++)s.writeFixed64(a[o])}function vP(a,s){for(var o=0;o<a.length;o++)s.writeSFixed64(a[o])}function Xf(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+16777216*a[s+3]}function _c(a,s,o){a[o]=s,a[o+1]=s>>>8,a[o+2]=s>>>16,a[o+3]=s>>>24}function Eb(a,s){return(a[s]|a[s+1]<<8|a[s+2]<<16)+(a[s+3]<<24)}cr.prototype={destroy:function(){this.buf=null},readFields:function(a,s,o){for(o=o||this.length;this.pos<o;){var h=this.readVarint(),p=h>>3,x=this.pos;this.type=7&h,a(p,s,this),this.pos===x&&this.skip(h)}return s},readMessage:function(a,s){return this.readFields(a,s,this.readVarint()+this.pos)},readFixed32:function(){var a=Xf(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Eb(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Xf(this.buf,this.pos)+Xf(this.buf,this.pos+4)*Zg;return this.pos+=8,a},readSFixed64:function(){var a=Xf(this.buf,this.pos)+Eb(this.buf,this.pos+4)*Zg;return this.pos+=8,a},readFloat:function(){var a=bb(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=bb(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var s,o,h=this.buf;return s=127&(o=h[this.pos++]),o<128?s:(s|=(127&(o=h[this.pos++]))<<7,o<128?s:(s|=(127&(o=h[this.pos++]))<<14,o<128?s:(s|=(127&(o=h[this.pos++]))<<21,o<128?s:function(p,x,b){var S,C,M=b.buf;if(S=(112&(C=M[b.pos++]))>>4,C<128||(S|=(127&(C=M[b.pos++]))<<3,C<128)||(S|=(127&(C=M[b.pos++]))<<10,C<128)||(S|=(127&(C=M[b.pos++]))<<17,C<128)||(S|=(127&(C=M[b.pos++]))<<24,C<128)||(S|=(1&(C=M[b.pos++]))<<31,C<128))return yc(p,S,x);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(o=h[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,s=this.pos;return this.pos=a,a-s>=12&&kb?function(o,h,p){return kb.decode(o.subarray(h,p))}(this.buf,s,a):function(o,h,p){for(var x="",b=h;b<p;){var S,C,M,N=o[b],B=null,F=N>239?4:N>223?3:N>191?2:1;if(b+F>p)break;F===1?N<128&&(B=N):F===2?(192&(S=o[b+1]))==128&&(B=(31&N)<<6|63&S)<=127&&(B=null):F===3?(C=o[b+2],(192&(S=o[b+1]))==128&&(192&C)==128&&((B=(15&N)<<12|(63&S)<<6|63&C)<=2047||B>=55296&&B<=57343)&&(B=null)):F===4&&(C=o[b+2],M=o[b+3],(192&(S=o[b+1]))==128&&(192&C)==128&&(192&M)==128&&((B=(15&N)<<18|(63&S)<<12|(63&C)<<6|63&M)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,F=1):B>65535&&(B-=65536,x+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),x+=String.fromCharCode(B),b+=F}return x}(this.buf,s,a)},readBytes:function(){var a=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,a);return this.pos=a,s},readPackedVarint:function(a,s){if(this.type!==cr.Bytes)return a.push(this.readVarint(s));var o=Aa(this);for(a=a||[];this.pos<o;)a.push(this.readVarint(s));return a},readPackedSVarint:function(a){if(this.type!==cr.Bytes)return a.push(this.readSVarint());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==cr.Bytes)return a.push(this.readBoolean());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==cr.Bytes)return a.push(this.readFloat());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==cr.Bytes)return a.push(this.readDouble());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==cr.Bytes)return a.push(this.readFixed32());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==cr.Bytes)return a.push(this.readSFixed32());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==cr.Bytes)return a.push(this.readFixed64());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==cr.Bytes)return a.push(this.readSFixed64());var s=Aa(this);for(a=a||[];this.pos<s;)a.push(this.readSFixed64());return a},skip:function(a){var s=7&a;if(s===cr.Varint)for(;this.buf[this.pos++]>127;);else if(s===cr.Bytes)this.pos=this.readVarint()+this.pos;else if(s===cr.Fixed32)this.pos+=4;else{if(s!==cr.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(a,s){this.writeVarint(a<<3|s)},realloc:function(a){for(var s=this.length||16;s<this.pos+a;)s*=2;if(s!==this.length){var o=new Uint8Array(s);o.set(this.buf),this.buf=o,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),_c(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),_c(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),_c(this.buf,-1&a,this.pos),_c(this.buf,Math.floor(a*Sb),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),_c(this.buf,-1&a,this.pos),_c(this.buf,Math.floor(a*Sb),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(s,o){var h,p;if(s>=0?(h=s%4294967296|0,p=s/4294967296|0):(p=~(-s/4294967296),4294967295^(h=~(-s%4294967296))?h=h+1|0:(h=0,p=p+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(x,b,S){S.buf[S.pos++]=127&x|128,x>>>=7,S.buf[S.pos++]=127&x|128,x>>>=7,S.buf[S.pos++]=127&x|128,x>>>=7,S.buf[S.pos++]=127&x|128,S.buf[S.pos]=127&(x>>>=7)}(h,0,o),function(x,b){var S=(7&x)<<4;b.buf[b.pos++]|=S|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(p,o)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var s=this.pos;this.pos=function(h,p,x){for(var b,S,C=0;C<p.length;C++){if((b=p.charCodeAt(C))>55295&&b<57344){if(!S){b>56319||C+1===p.length?(h[x++]=239,h[x++]=191,h[x++]=189):S=b;continue}if(b<56320){h[x++]=239,h[x++]=191,h[x++]=189,S=b;continue}b=S-55296<<10|b-56320|65536,S=null}else S&&(h[x++]=239,h[x++]=191,h[x++]=189,S=null);b<128?h[x++]=b:(b<2048?h[x++]=b>>6|192:(b<65536?h[x++]=b>>12|224:(h[x++]=b>>18|240,h[x++]=b>>12&63|128),h[x++]=b>>6&63|128),h[x++]=63&b|128)}return x}(this.buf,a,this.pos);var o=this.pos-s;o>=128&&Tb(s,o,this),this.pos=s-1,this.writeVarint(o),this.pos+=o},writeFloat:function(a){this.realloc(4),wb(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),wb(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var s=a.length;this.writeVarint(s),this.realloc(s);for(var o=0;o<s;o++)this.buf[this.pos++]=a[o]},writeRawMessage:function(a,s){this.pos++;var o=this.pos;a(s,this);var h=this.pos-o;h>=128&&Tb(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h},writeMessage:function(a,s,o){this.writeTag(a,cr.Bytes),this.writeRawMessage(s,o)},writePackedVarint:function(a,s){s.length&&this.writeMessage(a,hP,s)},writePackedSVarint:function(a,s){s.length&&this.writeMessage(a,dP,s)},writePackedBoolean:function(a,s){s.length&&this.writeMessage(a,mP,s)},writePackedFloat:function(a,s){s.length&&this.writeMessage(a,fP,s)},writePackedDouble:function(a,s){s.length&&this.writeMessage(a,pP,s)},writePackedFixed32:function(a,s){s.length&&this.writeMessage(a,gP,s)},writePackedSFixed32:function(a,s){s.length&&this.writeMessage(a,yP,s)},writePackedFixed64:function(a,s){s.length&&this.writeMessage(a,_P,s)},writePackedSFixed64:function(a,s){s.length&&this.writeMessage(a,vP,s)},writeBytesField:function(a,s){this.writeTag(a,cr.Bytes),this.writeBytes(s)},writeFixed32Field:function(a,s){this.writeTag(a,cr.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(a,s){this.writeTag(a,cr.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(a,s){this.writeTag(a,cr.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(a,s){this.writeTag(a,cr.Fixed64),this.writeSFixed64(s)},writeVarintField:function(a,s){this.writeTag(a,cr.Varint),this.writeVarint(s)},writeSVarintField:function(a,s){this.writeTag(a,cr.Varint),this.writeSVarint(s)},writeStringField:function(a,s){this.writeTag(a,cr.Bytes),this.writeString(s)},writeFloatField:function(a,s){this.writeTag(a,cr.Fixed32),this.writeFloat(s)},writeDoubleField:function(a,s){this.writeTag(a,cr.Fixed64),this.writeDouble(s)},writeBooleanField:function(a,s){this.writeVarintField(a,!!s)}};var Hg=k(xb);const Kg=3;function xP(a,s,o){a===1&&o.readMessage(bP,s)}function bP(a,s,o){if(a===3){const{id:h,bitmap:p,width:x,height:b,left:S,top:C,advance:M}=o.readMessage(wP,{});s.push({id:h,bitmap:new mh({width:x+2*Kg,height:b+2*Kg},p),metrics:{width:x,height:b,left:S,top:C,advance:M}})}}function wP(a,s,o){a===1?s.id=o.readVarint():a===2?s.bitmap=o.readBytes():a===3?s.width=o.readVarint():a===4?s.height=o.readVarint():a===5?s.left=o.readSVarint():a===6?s.top=o.readSVarint():a===7&&(s.advance=o.readVarint())}const Cb=Kg;function Ab(a){let s=0,o=0;for(const b of a)s+=b.w*b.h,o=Math.max(o,b.w);a.sort((b,S)=>S.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),o),h:1/0}];let p=0,x=0;for(const b of a)for(let S=h.length-1;S>=0;S--){const C=h[S];if(!(b.w>C.w||b.h>C.h)){if(b.x=C.x,b.y=C.y,x=Math.max(x,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===C.w&&b.h===C.h){const M=h.pop();S<h.length&&(h[S]=M)}else b.h===C.h?(C.x+=b.w,C.w-=b.w):b.w===C.w?(C.y+=b.h,C.h-=b.h):(h.push({x:C.x+b.w,y:C.y,w:C.w-b.w,h:b.h}),C.y+=b.h,C.h-=b.h);break}}return{w:p,h:x,fill:s/(p*x)||0}}const ui=1;class Xg{constructor(s,{pixelRatio:o,version:h,stretchX:p,stretchY:x,content:b}){this.paddedRect=s,this.pixelRatio=o,this.stretchX=p,this.stretchY=x,this.content=b,this.version=h}get tl(){return[this.paddedRect.x+ui,this.paddedRect.y+ui]}get br(){return[this.paddedRect.x+this.paddedRect.w-ui,this.paddedRect.y+this.paddedRect.h-ui]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ui)/this.pixelRatio,(this.paddedRect.h-2*ui)/this.pixelRatio]}}class Pb{constructor(s,o){const h={},p={};this.haveRenderCallbacks=[];const x=[];this.addImages(s,h,x),this.addImages(o,p,x);const{w:b,h:S}=Ab(x),C=new Gi({width:b||1,height:S||1});for(const M in s){const N=s[M],B=h[M].paddedRect;Gi.copy(N.data,C,{x:0,y:0},{x:B.x+ui,y:B.y+ui},N.data)}for(const M in o){const N=o[M],B=p[M].paddedRect,F=B.x+ui,U=B.y+ui,q=N.data.width,J=N.data.height;Gi.copy(N.data,C,{x:0,y:0},{x:F,y:U},N.data),Gi.copy(N.data,C,{x:0,y:J-1},{x:F,y:U-1},{width:q,height:1}),Gi.copy(N.data,C,{x:0,y:0},{x:F,y:U+J},{width:q,height:1}),Gi.copy(N.data,C,{x:q-1,y:0},{x:F-1,y:U},{width:1,height:J}),Gi.copy(N.data,C,{x:0,y:0},{x:F+q,y:U},{width:1,height:J})}this.image=C,this.iconPositions=h,this.patternPositions=p}addImages(s,o,h){for(const p in s){const x=s[p],b={x:0,y:0,w:x.data.width+2*ui,h:x.data.height+2*ui};h.push(b),o[p]=new Xg(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(s,o){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in s.updatedImages)this.patchUpdatedImage(this.iconPositions[h],s.getImage(h),o),this.patchUpdatedImage(this.patternPositions[h],s.getImage(h),o)}patchUpdatedImage(s,o,h){if(!s||!o||s.version===o.version)return;s.version=o.version;const[p,x]=s.tl;h.update(o.data,void 0,{x:p,y:x})}}var oo;nt("ImagePosition",Xg),nt("ImageAtlas",Pb),l.ai=void 0,(oo=l.ai||(l.ai={}))[oo.none=0]="none",oo[oo.horizontal=1]="horizontal",oo[oo.vertical=2]="vertical",oo[oo.horizontalOnly=3]="horizontalOnly";const Sh=-17;class kh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,o){const h=new kh;return h.scale=s||1,h.fontStack=o,h}static forImage(s){const o=new kh;return o.imageName=s,o}}class vc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,o){const h=new vc;for(let p=0;p<s.sections.length;p++){const x=s.sections[p];x.image?h.addImageSection(x):h.addTextSection(x,o)}return h}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let o="";for(let h=0;h<s.length;h++){const p=s.charCodeAt(h+1)||null,x=s.charCodeAt(h-1)||null;o+=p&&Mf(p)&&!wh[s[h+1]]||x&&Mf(x)&&!wh[s[h-1]]||!wh[s[h]]?s[h]:wh[s[h]]}return o}(this.text)}trim(){let s=0;for(let h=0;h<this.text.length&&Jf[this.text.charCodeAt(h)];h++)s++;let o=this.text.length;for(let h=this.text.length-1;h>=0&&h>=s&&Jf[this.text.charCodeAt(h)];h--)o--;this.text=this.text.substring(s,o),this.sectionIndex=this.sectionIndex.slice(s,o)}substring(s,o){const h=new vc;return h.text=this.text.substring(s,o),h.sectionIndex=this.sectionIndex.slice(s,o),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,o)=>Math.max(s,this.sections[o].scale),0)}addTextSection(s,o){this.text+=s.text,this.sections.push(kh.forText(s.scale,s.fontStack||o));const h=this.sections.length-1;for(let p=0;p<s.text.length;++p)this.sectionIndex.push(h)}addImageSection(s){const o=s.image?s.image.name:"";if(o.length===0)return void qe("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(kh.forImage(o)),this.sectionIndex.push(this.sections.length-1)):qe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yf(a,s,o,h,p,x,b,S,C,M,N,B,F,U,q,J){const ne=vc.fromFeature(a,p);let le;B===l.ai.vertical&&ne.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:fe}=li;if(ve&&ne.sections.length===1){le=[];const De=ve(ne.toString(),Yg(ne,M,x,s,h,U,q));for(const et of De){const ct=new vc;ct.text=et,ct.sections=ne.sections;for(let Je=0;Je<et.length;Je++)ct.sectionIndex.push(0);le.push(ct)}}else if(fe){le=[];const De=fe(ne.text,ne.sectionIndex,Yg(ne,M,x,s,h,U,q));for(const et of De){const ct=new vc;ct.text=et[0],ct.sectionIndex=et[1],ct.sections=ne.sections,le.push(ct)}}else le=function(De,et){const ct=[],Je=De.text;let Xe=0;for(const We of et)ct.push(De.substring(Xe,We)),Xe=We;return Xe<Je.length&&ct.push(De.substring(Xe,Je.length)),ct}(ne,Yg(ne,M,x,s,h,U,q));const xe=[],ke={positionedLines:xe,text:ne.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(De,et,ct,Je,Xe,We,at,He,ze,mt,ht,Lt){let yr=0,vr=Sh,es=0,Mi=0;const Hs=He==="right"?1:He==="left"?0:.5;let Zr=0;for(const ts of Xe){ts.trim();const rs=ts.getMaxScale(),Rs=(rs-1)*Qr,Ys={positionedGlyphs:[],lineOffset:0};De.positionedLines[Zr]=Ys;const zs=Ys.positionedGlyphs;let hi=0;if(!ts.length()){vr+=We,++Zr;continue}for(let ss=0;ss<ts.length();ss++){const Ut=ts.getSection(ss),Bs=ts.getSectionIndex(ss),Ps=ts.getCharCode(ss);let is=0,hn=null,jn=null,Dn=null,Pa=Qr;const dn=!(ze===l.ai.horizontal||!ht&&!Xu(Ps)||ht&&(Jf[Ps]||(vs=Ps,Qe.Arabic(vs)||Qe["Arabic Supplement"](vs)||Qe["Arabic Extended-A"](vs)||Qe["Arabic Presentation Forms-A"](vs)||Qe["Arabic Presentation Forms-B"](vs))));if(Ut.imageName){const Zi=Je[Ut.imageName];if(!Zi)continue;Dn=Ut.imageName,De.iconsInText=De.iconsInText||!0,jn=Zi.paddedRect;const fi=Zi.displaySize;Ut.scale=Ut.scale*Qr/Lt,hn={width:fi[0],height:fi[1],left:ui,top:-Cb,advance:dn?fi[1]:fi[0]},is=Rs+(Qr-fi[1]*Ut.scale),Pa=hn.advance;const Ia=dn?fi[0]*Ut.scale-Qr*rs:fi[1]*Ut.scale-Qr*rs;Ia>0&&Ia>hi&&(hi=Ia)}else{const Zi=ct[Ut.fontStack],fi=Zi&&Zi[Ps];if(fi&&fi.rect)jn=fi.rect,hn=fi.metrics;else{const Ia=et[Ut.fontStack],Ph=Ia&&Ia[Ps];if(!Ph)continue;hn=Ph.metrics}is=(rs-Ut.scale)*Qr}dn?(De.verticalizable=!0,zs.push({glyph:Ps,imageName:Dn,x:yr,y:vr+is,vertical:dn,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Bs,metrics:hn,rect:jn}),yr+=Pa*Ut.scale+mt):(zs.push({glyph:Ps,imageName:Dn,x:yr,y:vr+is,vertical:dn,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Bs,metrics:hn,rect:jn}),yr+=hn.advance*Ut.scale+mt)}zs.length!==0&&(es=Math.max(yr-mt,es),TP(zs,0,zs.length-1,Hs,hi)),yr=0;const di=We*rs+hi;Ys.lineOffset=Math.max(hi,Rs),vr+=di,Mi=Math.max(di,Mi),++Zr}var vs;const As=vr-Sh,{horizontalAlign:Ks,verticalAlign:Xs}=Jg(at);(function(ts,rs,Rs,Ys,zs,hi,di,ss,Ut){const Bs=(rs-Rs)*zs;let Ps=0;Ps=hi!==di?-ss*Ys-Sh:(-Ys*Ut+.5)*di;for(const is of ts)for(const hn of is.positionedGlyphs)hn.x+=Bs,hn.y+=Ps})(De.positionedLines,Hs,Ks,Xs,es,Mi,We,As,Xe.length),De.top+=-Xs*As,De.bottom=De.top+As,De.left+=-Ks*es,De.right=De.left+es}(ke,s,o,h,le,b,S,C,B,M,F,J),!function(De){for(const et of De)if(et.positionedGlyphs.length!==0)return!1;return!0}(xe)&&ke}const Jf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},SP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ib(a,s,o,h,p,x){if(s.imageName){const b=h[s.imageName];return b?b.displaySize[0]*s.scale*Qr/x+p:0}{const b=o[s.fontStack],S=b&&b[a];return S?S.metrics.advance*s.scale+p:0}}function Mb(a,s,o,h){const p=Math.pow(a-s,2);return h?a<s?p/2:2*p:p+Math.abs(o)*o}function kP(a,s,o){let h=0;return a===10&&(h-=1e4),o&&(h+=150),a!==40&&a!==65288||(h+=50),s!==41&&s!==65289||(h+=50),h}function jb(a,s,o,h,p,x){let b=null,S=Mb(s,o,p,x);for(const C of h){const M=Mb(s-C.x,o,p,x)+C.badness;M<=S&&(b=C,S=M)}return{index:a,x:s,priorBreak:b,badness:S}}function Db(a){return a?Db(a.priorBreak).concat(a.index):[]}function Yg(a,s,o,h,p,x,b){if(x!=="point")return[];if(!a)return[];const S=[],C=function(F,U,q,J,ne,le){let ve=0;for(let fe=0;fe<F.length();fe++){const xe=F.getSection(fe);ve+=Ib(F.getCharCode(fe),xe,J,ne,U,le)}return ve/Math.max(1,Math.ceil(ve/q))}(a,s,o,h,p,b),M=a.text.indexOf("​")>=0;let N=0;for(let F=0;F<a.length();F++){const U=a.getSection(F),q=a.getCharCode(F);if(Jf[q]||(N+=Ib(q,U,h,p,s,b)),F<a.length()-1){const J=!((B=q)<11904||!(Qe["Bopomofo Extended"](B)||Qe.Bopomofo(B)||Qe["CJK Compatibility Forms"](B)||Qe["CJK Compatibility Ideographs"](B)||Qe["CJK Compatibility"](B)||Qe["CJK Radicals Supplement"](B)||Qe["CJK Strokes"](B)||Qe["CJK Symbols and Punctuation"](B)||Qe["CJK Unified Ideographs Extension A"](B)||Qe["CJK Unified Ideographs"](B)||Qe["Enclosed CJK Letters and Months"](B)||Qe["Halfwidth and Fullwidth Forms"](B)||Qe.Hiragana(B)||Qe["Ideographic Description Characters"](B)||Qe["Kangxi Radicals"](B)||Qe["Katakana Phonetic Extensions"](B)||Qe.Katakana(B)||Qe["Vertical Forms"](B)||Qe["Yi Radicals"](B)||Qe["Yi Syllables"](B)));(SP[q]||J||U.imageName)&&S.push(jb(F+1,N,C,S,kP(q,a.getCharCode(F+1),J&&M),!1))}}var B;return Db(jb(a.length(),N,C,S,0,!0))}function Jg(a){let s=.5,o=.5;switch(a){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:s,verticalAlign:o}}function TP(a,s,o,h,p){if(!h&&!p)return;const x=a[o],b=(a[o].x+x.metrics.advance*x.scale)*h;for(let S=s;S<=o;S++)a[S].x-=b,a[S].y+=p}function EP(a,s,o){const{horizontalAlign:h,verticalAlign:p}=Jg(o),x=s[0]-a.displaySize[0]*h,b=s[1]-a.displaySize[1]*p;return{image:a,top:b,bottom:b+a.displaySize[1],left:x,right:x+a.displaySize[0]}}function Nb(a,s,o,h,p,x){const b=a.image;let S;if(b.content){const ne=b.content,le=b.pixelRatio||1;S=[ne[0]/le,ne[1]/le,b.displaySize[0]-ne[2]/le,b.displaySize[1]-ne[3]/le]}const C=s.left*x,M=s.right*x;let N,B,F,U;o==="width"||o==="both"?(U=p[0]+C-h[3],B=p[0]+M+h[1]):(U=p[0]+(C+M-b.displaySize[0])/2,B=U+b.displaySize[0]);const q=s.top*x,J=s.bottom*x;return o==="height"||o==="both"?(N=p[1]+q-h[0],F=p[1]+J+h[2]):(N=p[1]+(q+J-b.displaySize[1])/2,F=N+b.displaySize[1]),{image:b,top:N,right:B,bottom:F,left:U,collisionPadding:S}}const Th=255,sa=128,lo=Th*sa;function Lb(a,s){const{expression:o}=s;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new mr(a+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=o;let x=0;for(;x<h.length&&h[x]<=a;)x++;x=Math.max(0,x-1);let b=x;for(;b<h.length&&h[b]<a+1;)b++;b=Math.min(h.length-1,b);const S=h[x],C=h[b];return o.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:S,maxZoom:C,minSize:o.evaluate(new mr(S)),maxSize:o.evaluate(new mr(C)),interpolationType:p}}}function Qg(a,s,o){let h="never";const p=a.get(s);return p?h=p:a.get(o)&&(h="always"),h}const CP=ao.VectorTileFeature.types,AP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qf(a,s,o,h,p,x,b,S,C,M,N,B,F){const U=S?Math.min(lo,Math.round(S[0])):0,q=S?Math.min(lo,Math.round(S[1])):0;a.emplaceBack(s,o,Math.round(32*h),Math.round(32*p),x,b,(U<<1)+(C?1:0),q,16*M,16*N,256*B,256*F)}function ey(a,s,o){a.emplaceBack(s.x,s.y,o),a.emplaceBack(s.x,s.y,o),a.emplaceBack(s.x,s.y,o),a.emplaceBack(s.x,s.y,o)}function PP(a){for(const s of a.sections)if(Eg(s.text))return!0;return!1}class ty{constructor(s){this.layoutVertexArray=new zt,this.indexArray=new ys,this.programConfigurations=s,this.segments=new gr,this.dynamicLayoutVertexArray=new Dt,this.opacityVertexArray=new Ot,this.hasVisibleVertices=!1,this.placedSymbolArray=new ye}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,o,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,aP.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,oP.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,AP,!0),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}nt("SymbolBuffers",ty);class ry{constructor(s,o,h){this.layoutVertexArray=new s,this.layoutAttributes=o,this.indexArray=new h,this.segments=new gr,this.collisionVertexArray=new dr}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,lP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}nt("CollisionBuffers",ry);class xc{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(b=>b.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Dg([]),this.placementViewportMatrix=Dg([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Lb(this.zoom,o["text-size"]),this.iconSizeData=Lb(this.zoom,o["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=Qg(h,"text-overlap","text-allow-overlap")!=="never"||Qg(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(b=>l.ai[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=s.sourceID}createArrays(){this.text=new ty(new Mn(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new ty(new Mn(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new _e,this.lineVertexArray=new Ee,this.symbolInstances=new ae,this.textAnchorOffsets=new je}calculateGlyphDependencies(s,o,h,p,x){for(let b=0;b<s.length;b++)if(o[s.charCodeAt(b)]=!0,(h||p)&&x){const S=wh[s.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}}populate(s,o,h){const p=this.layers[0],x=p.layout,b=x.get("text-font"),S=x.get("text-field"),C=x.get("icon-image"),M=(S.value.kind!=="constant"||S.value.value instanceof Ts&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),N=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,B=x.get("symbol-sort-key");if(this.features=[],!M&&!N)return;const F=o.iconDependencies,U=o.glyphDependencies,q=o.availableImages,J=new mr(this.zoom);for(const{feature:ne,id:le,index:ve,sourceLayerIndex:fe}of s){const xe=p._featureFilter.needGeometry,ke=ol(ne,xe);if(!p._featureFilter.filter(J,ke,h))continue;let De,et;if(xe||(ke.geometry=al(ne)),M){const Je=p.getValueAndResolveTokens("text-field",ke,h,q),Xe=Ts.factory(Je);PP(Xe)&&(this.hasRTLText=!0),(!this.hasRTLText||rh()==="unavailable"||this.hasRTLText&&li.isParsed())&&(De=uP(Xe,p,ke))}if(N){const Je=p.getValueAndResolveTokens("icon-image",ke,h,q);et=Je instanceof gs?Je:gs.fromString(Je)}if(!De&&!et)continue;const ct=this.sortFeaturesByKey?B.evaluate(ke,{},h):void 0;if(this.features.push({id:le,text:De,icon:et,index:ve,sourceLayerIndex:fe,geometry:ke.geometry,properties:ne.properties,type:CP[ne.type],sortKey:ct}),et&&(F[et.name]=!0),De){const Je=b.evaluate(ke,{},h).join(","),Xe=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(const We of De.sections)if(We.image)F[We.image.name]=!0;else{const at=Hu(De.toString()),He=We.fontStack||Je,ze=U[He]=U[He]||{};this.calculateGlyphDependencies(We.text,ze,Xe,this.allowVerticalPlacement,at)}}}x.get("symbol-placement")==="line"&&(this.features=function(ne){const le={},ve={},fe=[];let xe=0;function ke(Je){fe.push(ne[Je]),xe++}function De(Je,Xe,We){const at=ve[Je];return delete ve[Je],ve[Xe]=at,fe[at].geometry[0].pop(),fe[at].geometry[0]=fe[at].geometry[0].concat(We[0]),at}function et(Je,Xe,We){const at=le[Xe];return delete le[Xe],le[Je]=at,fe[at].geometry[0].shift(),fe[at].geometry[0]=We[0].concat(fe[at].geometry[0]),at}function ct(Je,Xe,We){const at=We?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Je}:${at.x}:${at.y}`}for(let Je=0;Je<ne.length;Je++){const Xe=ne[Je],We=Xe.geometry,at=Xe.text?Xe.text.toString():null;if(!at){ke(Je);continue}const He=ct(at,We),ze=ct(at,We,!0);if(He in ve&&ze in le&&ve[He]!==le[ze]){const mt=et(He,ze,We),ht=De(He,ze,fe[mt].geometry);delete le[He],delete ve[ze],ve[ct(at,fe[ht].geometry,!0)]=ht,fe[mt].geometry=null}else He in ve?De(He,ze,We):ze in le?et(He,ze,We):(ke(Je),le[He]=xe-1,ve[ze]=xe-1)}return fe.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,le)=>ne.sortKey-le.sortKey)}update(s,o,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,o,this.layers,h),this.icon.programConfigurations.updatePaintArrays(s,o,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,o){const h=this.lineVertexArray.length;if(s.segment!==void 0){let p=s.dist(o[s.segment+1]),x=s.dist(o[s.segment]);const b={};for(let S=s.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(let S=s.segment||0;S>=0;S--)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:x},S>0&&(x+=o[S-1].dist(o[S]));for(let S=0;S<o.length;S++){const C=b[S];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(s,o,h,p,x,b,S,C,M,N,B,F){const U=s.indexArray,q=s.layoutVertexArray,J=s.segments.prepareSegment(4*o.length,q,U,this.canOverlap?b.sortKey:void 0),ne=this.glyphOffsetArray.length,le=J.vertexLength,ve=this.allowVerticalPlacement&&S===l.ai.vertical?Math.PI/2:0,fe=b.text&&b.text.sections;for(let xe=0;xe<o.length;xe++){const{tl:ke,tr:De,bl:et,br:ct,tex:Je,pixelOffsetTL:Xe,pixelOffsetBR:We,minFontScaleX:at,minFontScaleY:He,glyphOffset:ze,isSDF:mt,sectionIndex:ht}=o[xe],Lt=J.vertexLength,yr=ze[1];Qf(q,C.x,C.y,ke.x,yr+ke.y,Je.x,Je.y,h,mt,Xe.x,Xe.y,at,He),Qf(q,C.x,C.y,De.x,yr+De.y,Je.x+Je.w,Je.y,h,mt,We.x,Xe.y,at,He),Qf(q,C.x,C.y,et.x,yr+et.y,Je.x,Je.y+Je.h,h,mt,Xe.x,We.y,at,He),Qf(q,C.x,C.y,ct.x,yr+ct.y,Je.x+Je.w,Je.y+Je.h,h,mt,We.x,We.y,at,He),ey(s.dynamicLayoutVertexArray,C,ve),U.emplaceBack(Lt,Lt+1,Lt+2),U.emplaceBack(Lt+1,Lt+2,Lt+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),xe!==o.length-1&&ht===o[xe+1].sectionIndex||s.programConfigurations.populatePaintArrays(q.length,b,b.index,{},F,fe&&fe[ht])}s.placedSymbolArray.emplaceBack(C.x,C.y,ne,this.glyphOffsetArray.length-ne,le,M,N,C.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],S,0,!1,0,B)}_addCollisionDebugVertex(s,o,h,p,x,b){return o.emplaceBack(0,0),s.emplaceBack(h.x,h.y,p,x,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(s,o,h,p,x,b,S){const C=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),M=C.vertexLength,N=x.layoutVertexArray,B=x.collisionVertexArray,F=S.anchorX,U=S.anchorY;this._addCollisionDebugVertex(N,B,b,F,U,new L(s,o)),this._addCollisionDebugVertex(N,B,b,F,U,new L(h,o)),this._addCollisionDebugVertex(N,B,b,F,U,new L(h,p)),this._addCollisionDebugVertex(N,B,b,F,U,new L(s,p)),C.vertexLength+=4;const q=x.indexArray;q.emplaceBack(M,M+1),q.emplaceBack(M+1,M+2),q.emplaceBack(M+2,M+3),q.emplaceBack(M+3,M),C.primitiveLength+=4}addDebugCollisionBoxes(s,o,h,p){for(let x=s;x<o;x++){const b=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ry(Mr,vb.members,Yr),this.iconCollisionBox=new ry(Mr,vb.members,Yr);for(let s=0;s<this.symbolInstances.length;s++){const o=this.symbolInstances.get(s);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(s,o,h,p,x,b,S,C,M){const N={};for(let B=o;B<h;B++){const F=s.get(B);N.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},N.textFeatureIndex=F.featureIndex;break}for(let B=p;B<x;B++){const F=s.get(B);N.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},N.verticalTextFeatureIndex=F.featureIndex;break}for(let B=b;B<S;B++){const F=s.get(B);N.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},N.iconFeatureIndex=F.featureIndex;break}for(let B=C;B<M;B++){const F=s.get(B);N.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},N.verticalIconFeatureIndex=F.featureIndex;break}return N}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,o){const h=s.placedSymbolArray.get(o),p=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<p;x+=4)s.indexArray.emplaceBack(x,x+1,x+2),s.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(s),h=Math.cos(s),p=[],x=[],b=[];for(let S=0;S<this.symbolInstances.length;++S){b.push(S);const C=this.symbolInstances.get(S);p.push(0|Math.round(o*C.anchorX+h*C.anchorY)),x.push(C.featureIndex)}return b.sort((S,C)=>p[S]-p[C]||x[C]-x[S]),b}addToSortKeyRanges(s,o){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===o?h.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const h=this.symbolInstances.get(o);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((p,x,b)=>{p>=0&&b.indexOf(p)===x&&this.addIndicesForPlacedSymbol(this.text,p)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Rb,zb;nt("SymbolBucket",xc,{omit:["layers","collisionBoxArray","features","compareText"]}),xc.MAX_GLYPHS=65535,xc.addDynamicAttributes=ey;var sy={get paint(){return zb=zb||new Rr({"icon-opacity":new xt(Pe.paint_symbol["icon-opacity"]),"icon-color":new xt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new xt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new xt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new xt(Pe.paint_symbol["text-opacity"]),"text-color":new xt(Pe.paint_symbol["text-color"],{runtimeType:ps,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new xt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new xt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new xt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new dt(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new dt(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return Rb=Rb||new Rr({"symbol-placement":new dt(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dt(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dt(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dt(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new xt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new dt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new xt(Pe.layout_symbol["icon-image"]),"icon-rotate":new xt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new xt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new xt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new xt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new xt(Pe.layout_symbol["text-field"]),"text-font":new xt(Pe.layout_symbol["text-font"]),"text-size":new xt(Pe.layout_symbol["text-size"]),"text-max-width":new xt(Pe.layout_symbol["text-max-width"]),"text-line-height":new dt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new xt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new xt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new xt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xt(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new dt(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new xt(Pe.layout_symbol["text-rotate"]),"text-padding":new dt(Pe.layout_symbol["text-padding"]),"text-keep-upright":new dt(Pe.layout_symbol["text-keep-upright"]),"text-transform":new xt(Pe.layout_symbol["text-transform"]),"text-offset":new xt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new dt(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new dt(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new dt(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new dt(Pe.layout_symbol["text-optional"])})}};class Bb{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:Vi,this.defaultValue=s}evaluate(s){if(s.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(s.formattedSection))return o.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nt("FormatSectionOverride",Bb,{omit:["defaultValue"]});class ep extends Pi{constructor(s){super(s,sy)}recalculate(s,o){if(super.recalculate(s,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const x of h)p.indexOf(x)<0&&p.push(x);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,o,h,p){const x=this.layout.get(s).evaluate(o,{},h,p),b=this._unevaluatedLayout._values[s];return b.isDataDriven()||ec(b.value)||!x?x:function(S,C){return C.replace(/{([^{}]+)}/g,(M,N)=>S&&N in S?String(S[N]):"")}(o.properties,x)}createBucket(s){return new xc(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of sy.paint.overridableProperties){if(!ep.hasPaintOverride(this.layout,s))continue;const o=this.paint.get(s),h=new Bb(o),p=new Uu(h,o.property.specification);let x=null;x=o.value.kind==="constant"||o.value.kind==="source"?new Vu("source",p):new rc("composite",p,o.value.zoomStops),this.paint._values[s]=new Ns(o.property,x,o.parameters)}}_handleOverridablePaintPropertyUpdate(s,o,h){return!(!this.layout||o.isDataDriven()||h.isDataDriven())&&ep.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,o){const h=s.get("text-field"),p=sy.paint.properties[o];let x=!1;const b=S=>{for(const C of S)if(p.overrides&&p.overrides.hasOverride(C))return void(x=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Ts)b(h.value.value.sections);else if(h.value.kind==="source"){const S=M=>{x||(M instanceof ga&&xr(M.value)===se?b(M.value.sections):M instanceof Ql?b(M.sections):M.eachChild(S))},C=h.value;C._styleExpression&&S(C._styleExpression.expression)}return x}}let Ob;var IP={get paint(){return Ob=Ob||new Rr({"background-color":new dt(Pe.paint_background["background-color"]),"background-pattern":new ih(Pe.paint_background["background-pattern"]),"background-opacity":new dt(Pe.paint_background["background-opacity"])})}};class MP extends Pi{constructor(s){super(s,IP)}}let Fb;var jP={get paint(){return Fb=Fb||new Rr({"raster-opacity":new dt(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new dt(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(Pe.paint_raster["raster-saturation"]),"raster-contrast":new dt(Pe.paint_raster["raster-contrast"]),"raster-resampling":new dt(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(Pe.paint_raster["raster-fade-duration"])})}};class DP extends Pi{constructor(s){super(s,jP)}}class NP extends Pi{constructor(s){super(s,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class LP{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const iy=63710088e-1;class co{constructor(s,o){if(isNaN(s)||isNaN(o))throw new Error(`Invalid LngLat object: (${s}, ${o})`);if(this.lng=+s,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new co(Ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const o=Math.PI/180,h=this.lat*o,p=s.lat*o,x=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((s.lng-this.lng)*o);return iy*Math.acos(Math.min(x,1))}static convert(s){if(s instanceof co)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new co(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new co(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const $b=2*Math.PI*iy;function Ub(a){return $b*Math.cos(a*Math.PI/180)}function Vb(a){return(180+a)/360}function qb(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Gb(a,s){return a/Ub(s)}function Wb(a){return 360*a-180}function ny(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class tp{constructor(s,o,h=0){this.x=+s,this.y=+o,this.z=+h}static fromLngLat(s,o=0){const h=co.convert(s);return new tp(Vb(h.lng),qb(h.lat),Gb(o,h.lat))}toLngLat(){return new co(Wb(this.x),ny(this.y))}toAltitude(){return this.z*Ub(ny(this.y))}meterInMercatorCoordinateUnits(){return 1/$b*(s=ny(this.y),1/Math.cos(s*Math.PI/180));var s}}function Zb(a,s,o){var h=2*Math.PI*6378137/256/Math.pow(2,o);return[a*h-2*Math.PI*6378137/2,s*h-2*Math.PI*6378137/2]}class ay{constructor(s,o,h){if(s<0||s>25||h<0||h>=Math.pow(2,s)||o<0||o>=Math.pow(2,s))throw new Error(`x=${o}, y=${h}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=o,this.y=h,this.key=Eh(0,s,s,o,h)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,o,h){const p=(b=this.y,S=this.z,C=Zb(256*(x=this.x),256*(b=Math.pow(2,S)-b-1),S),M=Zb(256*(x+1),256*(b+1),S),C[0]+","+C[1]+","+M[0]+","+M[1]);var x,b,S,C,M;const N=function(B,F,U){let q,J="";for(let ne=B;ne>0;ne--)q=1<<ne-1,J+=(F&q?1:0)+(U&q?2:0);return J}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,p)}isChildOf(s){const o=this.z-s.z;return o>0&&s.x===this.x>>o&&s.y===this.y>>o}getTilePoint(s){const o=Math.pow(2,this.z);return new L((s.x*o-this.x)*Wr,(s.y*o-this.y)*Wr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hb{constructor(s,o){this.wrap=s,this.canonical=o,this.key=Eh(s,o.z,o.z,o.x,o.y)}}class Wi{constructor(s,o,h,p,x){if(s<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${h}`);this.overscaledZ=s,this.wrap=o,this.canonical=new ay(h,+p,+x),this.key=Eh(o,s,h,p,x)}clone(){return new Wi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-s;return s>this.canonical.z?new Wi(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wi(s,this.wrap,s,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(s,o){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-s;return s>this.canonical.z?Eh(this.wrap*+o,s,this.canonical.z,this.canonical.x,this.canonical.y):Eh(this.wrap*+o,s,s,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const o=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>o&&s.canonical.y===this.canonical.y>>o}children(s){if(this.overscaledZ>=s)return[new Wi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new Wi(o,this.wrap,o,h,p),new Wi(o,this.wrap,o,h+1,p),new Wi(o,this.wrap,o,h,p+1),new Wi(o,this.wrap,o,h+1,p+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Wi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Wi(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new tp(s.x-this.wrap,s.y))}}function Eh(a,s,o,h,p){(a*=2)<0&&(a=-1*a-1);const x=1<<o;return(x*x*a+x*p+h).toString(36)+o.toString(36)+s.toString(36)}nt("CanonicalTileID",ay),nt("OverscaledTileID",Wi,{omit:["posMatrix"]});class Kb{constructor(s,o,h,p=1,x=1,b=1,S=0){if(this.uid=s,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void qe(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const C=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=x,this.blueFactor=b,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<C;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(C,M)]=this.data[this._idx(C-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,C)]=this.data[this._idx(M,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<C;M++)for(let N=0;N<C;N++){const B=this.get(M,N);B>this.max&&(this.max=B),B<this.min&&(this.min=B)}}get(s,o){const h=new Uint8Array(this.data.buffer),p=4*this._idx(s,o);return this.unpack(h[p],h[p+1],h[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,o){if(s<-1||s>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(s+1)}unpack(s,o,h){return s*this.redFactor+o*this.greenFactor+h*this.blueFactor-this.baseShift}getPixels(){return new Gi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,o,h){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,x=o*this.dim+this.dim,b=h*this.dim,S=h*this.dim+this.dim;switch(o){case-1:p=x-1;break;case 1:x=p+1}switch(h){case-1:b=S-1;break;case 1:S=b+1}const C=-o*this.dim,M=-h*this.dim;for(let N=b;N<S;N++)for(let B=p;B<x;B++)this.data[this._idx(B,N)]=s.data[this._idx(B+C,N+M)]}}nt("DEMData",Kb);class Xb{constructor(s){this._stringToNumber={},this._numberToString=[];for(let o=0;o<s.length;o++){const h=s[o];this._stringToNumber[h]=o,this._numberToString[o]=h}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class Yb{constructor(s,o,h,p,x){this.type="Feature",this._vectorTileFeature=s,s._z=o,s._x=h,s._y=p,this.properties=s.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(s[o]=this[o]);return s}}class Jb{constructor(s,o){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new to(Wr,16,0),this.grid3D=new to(Wr,16,0),this.featureIndexArray=new Le,this.promoteId=o}insert(s,o,h,p,x,b){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,x);const C=b?this.grid3D:this.grid;for(let M=0;M<o.length;M++){const N=o[M],B=[1/0,1/0,-1/0,-1/0];for(let F=0;F<N.length;F++){const U=N[F];B[0]=Math.min(B[0],U.x),B[1]=Math.min(B[1],U.y),B[2]=Math.max(B[2],U.x),B[3]=Math.max(B[3],U.y)}B[0]<Wr&&B[1]<Wr&&B[2]>=0&&B[3]>=0&&C.insert(S,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ao.VectorTile(new Hg(this.rawTileData)).layers,this.sourceLayerCoder=new Xb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,o,h,p){this.loadVTLayers();const x=s.params||{},b=Wr/s.tileSize/s.scale,S=Gu(x.filter),C=s.queryGeometry,M=s.queryPadding*b,N=ew(C),B=this.grid.query(N.minX-M,N.minY-M,N.maxX+M,N.maxY+M),F=ew(s.cameraQueryGeometry),U=this.grid3D.query(F.minX-M,F.minY-M,F.maxX+M,F.maxY+M,(ne,le,ve,fe)=>function(xe,ke,De,et,ct){for(const Xe of xe)if(ke<=Xe.x&&De<=Xe.y&&et>=Xe.x&&ct>=Xe.y)return!0;const Je=[new L(ke,De),new L(ke,ct),new L(et,ct),new L(et,De)];if(xe.length>2){for(const Xe of Je)if(fc(xe,Xe))return!0}for(let Xe=0;Xe<xe.length-1;Xe++)if(fA(xe[Xe],xe[Xe+1],Je))return!0;return!1}(s.cameraQueryGeometry,ne-M,le-M,ve+M,fe+M));for(const ne of U)B.push(ne);B.sort(RP);const q={};let J;for(let ne=0;ne<B.length;ne++){const le=B[ne];if(le===J)continue;J=le;const ve=this.featureIndexArray.get(le);let fe=null;this.loadMatchingFeature(q,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,S,x.layers,x.availableImages,o,h,p,(xe,ke,De)=>(fe||(fe=al(xe)),ke.queryIntersectsFeature(C,xe,De,fe,this.z,s.transform,b,s.pixelPosMatrix)))}return q}loadMatchingFeature(s,o,h,p,x,b,S,C,M,N,B){const F=this.bucketLayerIDs[o];if(b&&!function(ne,le){for(let ve=0;ve<ne.length;ve++)if(le.indexOf(ne[ve])>=0)return!0;return!1}(b,F))return;const U=this.sourceLayerCoder.decode(h),q=this.vtLayers[U].feature(p);if(x.needGeometry){const ne=ol(q,!0);if(!x.filter(new mr(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!x.filter(new mr(this.tileID.overscaledZ),q))return;const J=this.getId(q,U);for(let ne=0;ne<F.length;ne++){const le=F[ne];if(b&&b.indexOf(le)<0)continue;const ve=C[le];if(!ve)continue;let fe={};J&&N&&(fe=N.getState(ve.sourceLayer||"_geojsonTileLayer",J));const xe=Te({},M[le]);xe.paint=Qb(xe.paint,ve.paint,q,fe,S),xe.layout=Qb(xe.layout,ve.layout,q,fe,S);const ke=!B||B(q,ve,fe);if(!ke)continue;const De=new Yb(q,this.z,this.x,this.y,J);De.layer=xe;let et=s[le];et===void 0&&(et=s[le]=[]),et.push({featureIndex:p,feature:De,intersectionZ:ke})}}lookupSymbolFeatures(s,o,h,p,x,b,S,C){const M={};this.loadVTLayers();const N=Gu(x);for(const B of s)this.loadMatchingFeature(M,h,p,B,N,b,S,C,o);return M}hasLayer(s){for(const o of this.bucketLayerIDs)for(const h of o)if(s===h)return!0;return!1}getId(s,o){let h=s.id;return this.promoteId&&(h=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof h=="boolean"&&(h=Number(h))),h}}function Qb(a,s,o,h,p){return Ue(a,(x,b)=>{const S=s instanceof hc?s.get(b):null;return S&&S.evaluate?S.evaluate(o,h,p):S})}function ew(a){let s=1/0,o=1/0,h=-1/0,p=-1/0;for(const x of a)s=Math.min(s,x.x),o=Math.min(o,x.y),h=Math.max(h,x.x),p=Math.max(p,x.y);return{minX:s,minY:o,maxX:h,maxY:p}}function RP(a,s){return s-a}function tw(a,s,o,h,p){const x=[];for(let b=0;b<a.length;b++){const S=a[b];let C;for(let M=0;M<S.length-1;M++){let N=S[M],B=S[M+1];N.x<s&&B.x<s||(N.x<s?N=new L(s,N.y+(s-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x<s&&(B=new L(s,N.y+(s-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y<o&&B.y<o||(N.y<o?N=new L(N.x+(o-N.y)/(B.y-N.y)*(B.x-N.x),o)._round():B.y<o&&(B=new L(N.x+(o-N.y)/(B.y-N.y)*(B.x-N.x),o)._round()),N.x>=h&&B.x>=h||(N.x>=h?N=new L(h,N.y+(h-N.x)/(B.x-N.x)*(B.y-N.y))._round():B.x>=h&&(B=new L(h,N.y+(h-N.x)/(B.x-N.x)*(B.y-N.y))._round()),N.y>=p&&B.y>=p||(N.y>=p?N=new L(N.x+(p-N.y)/(B.y-N.y)*(B.x-N.x),p)._round():B.y>=p&&(B=new L(N.x+(p-N.y)/(B.y-N.y)*(B.x-N.x),p)._round()),C&&N.equals(C[C.length-1])||(C=[N],x.push(C)),C.push(B)))))}}return x}nt("FeatureIndex",Jb,{omit:["rawTileData","sourceLayerCoder"]});class uo extends L{constructor(s,o,h,p){super(s,o),this.angle=h,p!==void 0&&(this.segment=p)}clone(){return new uo(this.x,this.y,this.angle,this.segment)}}function rw(a,s,o,h,p){if(s.segment===void 0||o===0)return!0;let x=s,b=s.segment+1,S=0;for(;S>-o/2;){if(b--,b<0)return!1;S-=a[b].dist(x),x=a[b]}S+=a[b].dist(a[b+1]),b++;const C=[];let M=0;for(;S<o/2;){const N=a[b],B=a[b+1];if(!B)return!1;let F=a[b-1].angleTo(N)-N.angleTo(B);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:S,angleDelta:F}),M+=F;S-C[0].distance>h;)M-=C.shift().angleDelta;if(M>p)return!1;b++,S+=N.dist(B)}return!0}function sw(a){let s=0;for(let o=0;o<a.length-1;o++)s+=a[o].dist(a[o+1]);return s}function iw(a,s,o){return a?.6*s*o:0}function nw(a,s){return Math.max(a?a.right-a.left:0,s?s.right-s.left:0)}function zP(a,s,o,h,p,x){const b=iw(o,p,x),S=nw(o,h)*x;let C=0;const M=sw(a)/2;for(let N=0;N<a.length-1;N++){const B=a[N],F=a[N+1],U=B.dist(F);if(C+U>M){const q=(M-C)/U,J=ni.number(B.x,F.x,q),ne=ni.number(B.y,F.y,q),le=new uo(J,ne,F.angleTo(B),N);return le._round(),!b||rw(a,le,S,b,s)?le:void 0}C+=U}}function BP(a,s,o,h,p,x,b,S,C){const M=iw(h,x,b),N=nw(h,p),B=N*b,F=a[0].x===0||a[0].x===C||a[0].y===0||a[0].y===C;return s-B<s/4&&(s=B+s/4),aw(a,F?s/2*S%s:(N/2+2*x)*b*S%s,s,M,o,B,F,!1,C)}function aw(a,s,o,h,p,x,b,S,C){const M=x/2,N=sw(a);let B=0,F=s-o,U=[];for(let q=0;q<a.length-1;q++){const J=a[q],ne=a[q+1],le=J.dist(ne),ve=ne.angleTo(J);for(;F+o<B+le;){F+=o;const fe=(F-B)/le,xe=ni.number(J.x,ne.x,fe),ke=ni.number(J.y,ne.y,fe);if(xe>=0&&xe<C&&ke>=0&&ke<C&&F-M>=0&&F+M<=N){const De=new uo(xe,ke,ve,q);De._round(),h&&!rw(a,De,x,h,p)||U.push(De)}}B+=le}return S||U.length||b||(U=aw(a,B/2,o,h,p,x,b,!0,C)),U}nt("Anchor",uo);const bc=ui;function ow(a,s,o,h){const p=[],x=a.image,b=x.pixelRatio,S=x.paddedRect.w-2*bc,C=x.paddedRect.h-2*bc,M=a.right-a.left,N=a.bottom-a.top,B=x.stretchX||[[0,S]],F=x.stretchY||[[0,C]],U=(We,at)=>We+at[1]-at[0],q=B.reduce(U,0),J=F.reduce(U,0),ne=S-q,le=C-J;let ve=0,fe=q,xe=0,ke=J,De=0,et=ne,ct=0,Je=le;if(x.content&&h){const We=x.content;ve=rp(B,0,We[0]),xe=rp(F,0,We[1]),fe=rp(B,We[0],We[2]),ke=rp(F,We[1],We[3]),De=We[0]-ve,ct=We[1]-xe,et=We[2]-We[0]-fe,Je=We[3]-We[1]-ke}const Xe=(We,at,He,ze)=>{const mt=sp(We.stretch-ve,fe,M,a.left),ht=ip(We.fixed-De,et,We.stretch,q),Lt=sp(at.stretch-xe,ke,N,a.top),yr=ip(at.fixed-ct,Je,at.stretch,J),vr=sp(He.stretch-ve,fe,M,a.left),es=ip(He.fixed-De,et,He.stretch,q),Mi=sp(ze.stretch-xe,ke,N,a.top),Hs=ip(ze.fixed-ct,Je,ze.stretch,J),Zr=new L(mt,Lt),vs=new L(vr,Lt),As=new L(vr,Mi),Ks=new L(mt,Mi),Xs=new L(ht/b,yr/b),ts=new L(es/b,Hs/b),rs=s*Math.PI/180;if(rs){const zs=Math.sin(rs),hi=Math.cos(rs),di=[hi,-zs,zs,hi];Zr._matMult(di),vs._matMult(di),Ks._matMult(di),As._matMult(di)}const Rs=We.stretch+We.fixed,Ys=at.stretch+at.fixed;return{tl:Zr,tr:vs,bl:Ks,br:As,tex:{x:x.paddedRect.x+bc+Rs,y:x.paddedRect.y+bc+Ys,w:He.stretch+He.fixed-Rs,h:ze.stretch+ze.fixed-Ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xs,pixelOffsetBR:ts,minFontScaleX:et/b/M,minFontScaleY:Je/b/N,isSDF:o}};if(h&&(x.stretchX||x.stretchY)){const We=lw(B,ne,q),at=lw(F,le,J);for(let He=0;He<We.length-1;He++){const ze=We[He],mt=We[He+1];for(let ht=0;ht<at.length-1;ht++)p.push(Xe(ze,at[ht],mt,at[ht+1]))}}else p.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:C+1}));return p}function rp(a,s,o){let h=0;for(const p of a)h+=Math.max(s,Math.min(o,p[1]))-Math.max(s,Math.min(o,p[0]));return h}function lw(a,s,o){const h=[{fixed:-bc,stretch:0}];for(const[p,x]of a){const b=h[h.length-1];h.push({fixed:p-b.stretch,stretch:b.stretch}),h.push({fixed:p-b.stretch,stretch:b.stretch+(x-p)})}return h.push({fixed:s+bc,stretch:o}),h}function sp(a,s,o,h){return a/s*o+h}function ip(a,s,o,h){return a-s*o/h}class np{constructor(s,o,h,p,x,b,S,C,M,N){if(this.boxStartIndex=s.length,M){let B=b.top,F=b.bottom;const U=b.collisionPadding;U&&(B-=U[1],F+=U[3]);let q=F-B;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{let B=b.top*S-C[0],F=b.bottom*S+C[2],U=b.left*S-C[3],q=b.right*S+C[1];const J=b.collisionPadding;if(J&&(U-=J[0]*S,B-=J[1]*S,q+=J[2]*S,F+=J[3]*S),N){const ne=new L(U,B),le=new L(q,B),ve=new L(U,F),fe=new L(q,F),xe=N*Math.PI/180;ne._rotate(xe),le._rotate(xe),ve._rotate(xe),fe._rotate(xe),U=Math.min(ne.x,le.x,ve.x,fe.x),q=Math.max(ne.x,le.x,ve.x,fe.x),B=Math.min(ne.y,le.y,ve.y,fe.y),F=Math.max(ne.y,le.y,ve.y,fe.y)}s.emplaceBack(o.x,o.y,U,B,q,F,h,p,x)}this.boxEndIndex=s.length}}class OP{constructor(s=[],o=FP){if(this.data=s,this.length=this.data.length,this.compare=o,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:o,compare:h}=this,p=o[s];for(;s>0;){const x=s-1>>1,b=o[x];if(h(p,b)>=0)break;o[s]=b,s=x}o[s]=p}_down(s){const{data:o,compare:h}=this,p=this.length>>1,x=o[s];for(;s<p;){let b=1+(s<<1),S=o[b];const C=b+1;if(C<this.length&&h(o[C],S)<0&&(b=C,S=o[C]),h(S,x)>=0)break;o[s]=S,s=b}o[s]=x}}function FP(a,s){return a<s?-1:a>s?1:0}function $P(a,s=1,o=!1){let h=1/0,p=1/0,x=-1/0,b=-1/0;const S=a[0];for(let U=0;U<S.length;U++){const q=S[U];(!U||q.x<h)&&(h=q.x),(!U||q.y<p)&&(p=q.y),(!U||q.x>x)&&(x=q.x),(!U||q.y>b)&&(b=q.y)}const C=Math.min(x-h,b-p);let M=C/2;const N=new OP([],UP);if(C===0)return new L(h,p);for(let U=h;U<x;U+=C)for(let q=p;q<b;q+=C)N.push(new wc(U+M,q+M,M,a));let B=function(U){let q=0,J=0,ne=0;const le=U[0];for(let ve=0,fe=le.length,xe=fe-1;ve<fe;xe=ve++){const ke=le[ve],De=le[xe],et=ke.x*De.y-De.x*ke.y;J+=(ke.x+De.x)*et,ne+=(ke.y+De.y)*et,q+=3*et}return new wc(J/q,ne/q,0,U)}(a),F=N.length;for(;N.length;){const U=N.pop();(U.d>B.d||!B.d)&&(B=U,o&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,F)),U.max-B.d<=s||(M=U.h/2,N.push(new wc(U.p.x-M,U.p.y-M,M,a)),N.push(new wc(U.p.x+M,U.p.y-M,M,a)),N.push(new wc(U.p.x-M,U.p.y+M,M,a)),N.push(new wc(U.p.x+M,U.p.y+M,M,a)),F+=4)}return o&&(console.log(`num probes: ${F}`),console.log(`best distance: ${B.d}`)),B.p}function UP(a,s){return s.max-a.max}function wc(a,s,o,h){this.p=new L(a,s),this.h=o,this.d=function(p,x){let b=!1,S=1/0;for(let C=0;C<x.length;C++){const M=x[C];for(let N=0,B=M.length,F=B-1;N<B;F=N++){const U=M[N],q=M[F];U.y>p.y!=q.y>p.y&&p.x<(q.x-U.x)*(p.y-U.y)/(q.y-U.y)+U.x&&(b=!b),S=Math.min(S,q0(p,U,q))}}return(b?1:-1)*Math.sqrt(S)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Cs;l.aq=void 0,(Cs=l.aq||(l.aq={}))[Cs.center=1]="center",Cs[Cs.left=2]="left",Cs[Cs.right=3]="right",Cs[Cs.top=4]="top",Cs[Cs.bottom=5]="bottom",Cs[Cs["top-left"]=6]="top-left",Cs[Cs["top-right"]=7]="top-right",Cs[Cs["bottom-left"]=8]="bottom-left",Cs[Cs["bottom-right"]=9]="bottom-right";const ho=7,oy=Number.POSITIVE_INFINITY;function cw(a,s){return s[1]!==oy?function(o,h,p){let x=0,b=0;switch(h=Math.abs(h),p=Math.abs(p),o){case"top-right":case"top-left":case"top":b=p-ho;break;case"bottom-right":case"bottom-left":case"bottom":b=-p+ho}switch(o){case"top-right":case"bottom-right":case"right":x=-h;break;case"top-left":case"bottom-left":case"left":x=h}return[x,b]}(a,s[0],s[1]):function(o,h){let p=0,x=0;h<0&&(h=0);const b=h/Math.SQRT2;switch(o){case"top-right":case"top-left":x=b-ho;break;case"bottom-right":case"bottom-left":x=-b+ho;break;case"bottom":x=-h+ho;break;case"top":x=h-ho}switch(o){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=h;break;case"right":p=-h}return[p,x]}(a,s[0])}function uw(a,s,o){var h;const p=a.layout,x=(h=p.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(s,{},o);if(x){const S=x.values,C=[];for(let M=0;M<S.length;M+=2){const N=C[M]=S[M],B=S[M+1].map(F=>F*Qr);N.startsWith("top")?B[1]-=ho:N.startsWith("bottom")&&(B[1]+=ho),C[M+1]=B}return new Ti(C)}const b=p.get("text-variable-anchor");if(b){let S;S=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(s,{},o)*Qr,oy]:p.get("text-offset").evaluate(s,{},o).map(M=>M*Qr);const C=[];for(const M of b)C.push(M,cw(M,S));return new Ti(C)}return null}function ly(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function VP(a,s,o,h,p,x,b,S,C,M,N){let B=x.textMaxSize.evaluate(s,{});B===void 0&&(B=b);const F=a.layers[0].layout,U=F.get("icon-offset").evaluate(s,{},N),q=dw(o.horizontal),J=b/24,ne=a.tilePixelRatio*J,le=a.tilePixelRatio*B/24,ve=a.tilePixelRatio*S,fe=a.tilePixelRatio*F.get("symbol-spacing"),xe=F.get("text-padding")*a.tilePixelRatio,ke=function(ze,mt,ht,Lt=1){const yr=ze.get("icon-padding").evaluate(mt,{},ht),vr=yr&&yr.values;return[vr[0]*Lt,vr[1]*Lt,vr[2]*Lt,vr[3]*Lt]}(F,s,N,a.tilePixelRatio),De=F.get("text-max-angle")/180*Math.PI,et=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",ct=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Je=F.get("symbol-placement"),Xe=fe/2,We=F.get("icon-text-fit");let at;h&&We!=="none"&&(a.allowVerticalPlacement&&o.vertical&&(at=Nb(h,o.vertical,We,F.get("icon-text-fit-padding"),U,J)),q&&(h=Nb(h,q,We,F.get("icon-text-fit-padding"),U,J)));const He=(ze,mt)=>{mt.x<0||mt.x>=Wr||mt.y<0||mt.y>=Wr||function(ht,Lt,yr,vr,es,Mi,Hs,Zr,vs,As,Ks,Xs,ts,rs,Rs,Ys,zs,hi,di,ss,Ut,Bs,Ps,is,hn){const jn=ht.addToLineVertexArray(Lt,yr);let Dn,Pa,dn,Zi,fi=0,Ia=0,Ph=0,gw=0,gy=-1,yy=-1;const Ma={};let yw=Ta("");if(ht.allowVerticalPlacement&&vr.vertical){const Os=Zr.layout.get("text-rotate").evaluate(Ut,{},is)+90;dn=new np(vs,Lt,As,Ks,Xs,vr.vertical,ts,rs,Rs,Os),Hs&&(Zi=new np(vs,Lt,As,Ks,Xs,Hs,zs,hi,Rs,Os))}if(es){const Os=Zr.layout.get("icon-rotate").evaluate(Ut,{}),Hi=Zr.layout.get("icon-text-fit")!=="none",cl=ow(es,Os,Ps,Hi),Ln=Hs?ow(Hs,Os,Ps,Hi):void 0;Pa=new np(vs,Lt,As,Ks,Xs,es,zs,hi,!1,Os),fi=4*cl.length;const ul=ht.iconSizeData;let ia=null;ul.kind==="source"?(ia=[sa*Zr.layout.get("icon-size").evaluate(Ut,{})],ia[0]>lo&&qe(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Th}. Reduce your "icon-size".`)):ul.kind==="composite"&&(ia=[sa*Bs.compositeIconSizes[0].evaluate(Ut,{},is),sa*Bs.compositeIconSizes[1].evaluate(Ut,{},is)],(ia[0]>lo||ia[1]>lo)&&qe(`${ht.layerIds[0]}: Value for "icon-size" is >= ${Th}. Reduce your "icon-size".`)),ht.addSymbols(ht.icon,cl,ia,ss,di,Ut,l.ai.none,Lt,jn.lineStartIndex,jn.lineLength,-1,is),gy=ht.icon.placedSymbolArray.length-1,Ln&&(Ia=4*Ln.length,ht.addSymbols(ht.icon,Ln,ia,ss,di,Ut,l.ai.vertical,Lt,jn.lineStartIndex,jn.lineLength,-1,is),yy=ht.icon.placedSymbolArray.length-1)}const _w=Object.keys(vr.horizontal);for(const Os of _w){const Hi=vr.horizontal[Os];if(!Dn){yw=Ta(Hi.text);const Ln=Zr.layout.get("text-rotate").evaluate(Ut,{},is);Dn=new np(vs,Lt,As,Ks,Xs,Hi,ts,rs,Rs,Ln)}const cl=Hi.positionedLines.length===1;if(Ph+=hw(ht,Lt,Hi,Mi,Zr,Rs,Ut,Ys,jn,vr.vertical?l.ai.horizontal:l.ai.horizontalOnly,cl?_w:[Os],Ma,gy,Bs,is),cl)break}vr.vertical&&(gw+=hw(ht,Lt,vr.vertical,Mi,Zr,Rs,Ut,Ys,jn,l.ai.vertical,["vertical"],Ma,yy,Bs,is));const WP=Dn?Dn.boxStartIndex:ht.collisionBoxArray.length,ZP=Dn?Dn.boxEndIndex:ht.collisionBoxArray.length,HP=dn?dn.boxStartIndex:ht.collisionBoxArray.length,KP=dn?dn.boxEndIndex:ht.collisionBoxArray.length,XP=Pa?Pa.boxStartIndex:ht.collisionBoxArray.length,YP=Pa?Pa.boxEndIndex:ht.collisionBoxArray.length,JP=Zi?Zi.boxStartIndex:ht.collisionBoxArray.length,QP=Zi?Zi.boxEndIndex:ht.collisionBoxArray.length;let Nn=-1;const op=(Os,Hi)=>Os&&Os.circleDiameter?Math.max(Os.circleDiameter,Hi):Hi;Nn=op(Dn,Nn),Nn=op(dn,Nn),Nn=op(Pa,Nn),Nn=op(Zi,Nn);const vw=Nn>-1?1:0;vw&&(Nn*=hn/Qr),ht.glyphOffsetArray.length>=xc.MAX_GLYPHS&&qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ut.sortKey!==void 0&&ht.addToSortKeyRanges(ht.symbolInstances.length,Ut.sortKey);const eI=uw(Zr,Ut,is),[tI,rI]=function(Os,Hi){const cl=Os.length,Ln=Hi==null?void 0:Hi.values;if((Ln==null?void 0:Ln.length)>0)for(let ul=0;ul<Ln.length;ul+=2){const ia=Ln[ul+1];Os.emplaceBack(l.aq[Ln[ul]],ia[0],ia[1])}return[cl,Os.length]}(ht.textAnchorOffsets,eI);ht.symbolInstances.emplaceBack(Lt.x,Lt.y,Ma.right>=0?Ma.right:-1,Ma.center>=0?Ma.center:-1,Ma.left>=0?Ma.left:-1,Ma.vertical||-1,gy,yy,yw,WP,ZP,HP,KP,XP,YP,JP,QP,As,Ph,gw,fi,Ia,vw,0,ts,Nn,tI,rI)}(a,mt,ze,o,h,p,at,a.layers[0],a.collisionBoxArray,s.index,s.sourceLayerIndex,a.index,ne,[xe,xe,xe,xe],et,C,ve,ke,ct,U,s,x,M,N,b)};if(Je==="line")for(const ze of tw(s.geometry,0,0,Wr,Wr)){const mt=BP(ze,fe,De,o.vertical||q,h,24,le,a.overscaling,Wr);for(const ht of mt)q&&qP(a,q.text,Xe,ht)||He(ze,ht)}else if(Je==="line-center"){for(const ze of s.geometry)if(ze.length>1){const mt=zP(ze,De,o.vertical||q,h,24,le);mt&&He(ze,mt)}}else if(s.type==="Polygon")for(const ze of Fg(s.geometry,0)){const mt=$P(ze,16);He(ze[0],new uo(mt.x,mt.y,0))}else if(s.type==="LineString")for(const ze of s.geometry)He(ze,new uo(ze[0].x,ze[0].y,0));else if(s.type==="Point")for(const ze of s.geometry)for(const mt of ze)He([mt],new uo(mt.x,mt.y,0))}function hw(a,s,o,h,p,x,b,S,C,M,N,B,F,U,q){const J=function(ve,fe,xe,ke,De,et,ct,Je){const Xe=ke.layout.get("text-rotate").evaluate(et,{})*Math.PI/180,We=[];for(const at of fe.positionedLines)for(const He of at.positionedGlyphs){if(!He.rect)continue;const ze=He.rect||{};let mt=Cb+1,ht=!0,Lt=1,yr=0;const vr=(De||Je)&&He.vertical,es=He.metrics.advance*He.scale/2;if(Je&&fe.verticalizable&&(yr=at.lineOffset/2-(He.imageName?-(Qr-He.metrics.width*He.scale)/2:(He.scale-1)*Qr)),He.imageName){const ss=ct[He.imageName];ht=ss.sdf,Lt=ss.pixelRatio,mt=ui/Lt}const Mi=De?[He.x+es,He.y]:[0,0];let Hs=De?[0,0]:[He.x+es+xe[0],He.y+xe[1]-yr],Zr=[0,0];vr&&(Zr=Hs,Hs=[0,0]);const vs=He.metrics.isDoubleResolution?2:1,As=(He.metrics.left-mt)*He.scale-es+Hs[0],Ks=(-He.metrics.top-mt)*He.scale+Hs[1],Xs=As+ze.w/vs*He.scale/Lt,ts=Ks+ze.h/vs*He.scale/Lt,rs=new L(As,Ks),Rs=new L(Xs,Ks),Ys=new L(As,ts),zs=new L(Xs,ts);if(vr){const ss=new L(-es,es-Sh),Ut=-Math.PI/2,Bs=Qr/2-es,Ps=new L(5-Sh-Bs,-(He.imageName?Bs:0)),is=new L(...Zr);rs._rotateAround(Ut,ss)._add(Ps)._add(is),Rs._rotateAround(Ut,ss)._add(Ps)._add(is),Ys._rotateAround(Ut,ss)._add(Ps)._add(is),zs._rotateAround(Ut,ss)._add(Ps)._add(is)}if(Xe){const ss=Math.sin(Xe),Ut=Math.cos(Xe),Bs=[Ut,-ss,ss,Ut];rs._matMult(Bs),Rs._matMult(Bs),Ys._matMult(Bs),zs._matMult(Bs)}const hi=new L(0,0),di=new L(0,0);We.push({tl:rs,tr:Rs,bl:Ys,br:zs,tex:ze,writingMode:fe.writingMode,glyphOffset:Mi,sectionIndex:He.sectionIndex,isSDF:ht,pixelOffsetTL:hi,pixelOffsetBR:di,minFontScaleX:0,minFontScaleY:0})}return We}(0,o,S,p,x,b,h,a.allowVerticalPlacement),ne=a.textSizeData;let le=null;ne.kind==="source"?(le=[sa*p.layout.get("text-size").evaluate(b,{})],le[0]>lo&&qe(`${a.layerIds[0]}: Value for "text-size" is >= ${Th}. Reduce your "text-size".`)):ne.kind==="composite"&&(le=[sa*U.compositeTextSizes[0].evaluate(b,{},q),sa*U.compositeTextSizes[1].evaluate(b,{},q)],(le[0]>lo||le[1]>lo)&&qe(`${a.layerIds[0]}: Value for "text-size" is >= ${Th}. Reduce your "text-size".`)),a.addSymbols(a.text,J,le,S,x,b,M,s,C.lineStartIndex,C.lineLength,F,q);for(const ve of N)B[ve]=a.text.placedSymbolArray.length-1;return 4*J.length}function dw(a){for(const s in a)return a[s];return null}function qP(a,s,o,h){const p=a.compareText;if(s in p){const x=p[s];for(let b=x.length-1;b>=0;b--)if(h.dist(x[b])<o)return!0}else p[s]=[];return p[s].push(h),!1}const fw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class cy{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,h]=new Uint8Array(s,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const x=fw[15&h];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(s,2,1),[S]=new Uint32Array(s,4,1);return new cy(S,b,x,s)}constructor(s,o=64,h=Float64Array,p){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=h,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const x=fw.indexOf(this.ArrayType),b=2*s*this.ArrayType.BYTES_PER_ELEMENT,S=s*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-S%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+S+C,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+b+S+C),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+S+C,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=s)}add(s,o){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=s,this.coords[this._pos++]=o,h}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return uy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,o,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:S}=this,C=[0,x.length-1,0],M=[];for(;C.length;){const N=C.pop()||0,B=C.pop()||0,F=C.pop()||0;if(B-F<=S){for(let ne=F;ne<=B;ne++){const le=b[2*ne],ve=b[2*ne+1];le>=s&&le<=h&&ve>=o&&ve<=p&&M.push(x[ne])}continue}const U=F+B>>1,q=b[2*U],J=b[2*U+1];q>=s&&q<=h&&J>=o&&J<=p&&M.push(x[U]),(N===0?s<=q:o<=J)&&(C.push(F),C.push(U-1),C.push(1-N)),(N===0?h>=q:p>=J)&&(C.push(U+1),C.push(B),C.push(1-N))}return M}within(s,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:x,nodeSize:b}=this,S=[0,p.length-1,0],C=[],M=h*h;for(;S.length;){const N=S.pop()||0,B=S.pop()||0,F=S.pop()||0;if(B-F<=b){for(let ne=F;ne<=B;ne++)mw(x[2*ne],x[2*ne+1],s,o)<=M&&C.push(p[ne]);continue}const U=F+B>>1,q=x[2*U],J=x[2*U+1];mw(q,J,s,o)<=M&&C.push(p[U]),(N===0?s-h<=q:o-h<=J)&&(S.push(F),S.push(U-1),S.push(1-N)),(N===0?s+h>=q:o+h>=J)&&(S.push(U+1),S.push(B),S.push(1-N))}return C}}function uy(a,s,o,h,p,x){if(p-h<=o)return;const b=h+p>>1;pw(a,s,b,h,p,x),uy(a,s,o,h,b-1,1-x),uy(a,s,o,b+1,p,1-x)}function pw(a,s,o,h,p,x){for(;p>h;){if(p-h>600){const M=p-h+1,N=o-h+1,B=Math.log(M),F=.5*Math.exp(2*B/3),U=.5*Math.sqrt(B*F*(M-F)/M)*(N-M/2<0?-1:1);pw(a,s,o,Math.max(h,Math.floor(o-N*F/M+U)),Math.min(p,Math.floor(o+(M-N)*F/M+U)),x)}const b=s[2*o+x];let S=h,C=p;for(Ch(a,s,h,o),s[2*p+x]>b&&Ch(a,s,h,p);S<C;){for(Ch(a,s,S,C),S++,C--;s[2*S+x]<b;)S++;for(;s[2*C+x]>b;)C--}s[2*h+x]===b?Ch(a,s,h,C):(C++,Ch(a,s,C,p)),C<=o&&(h=C+1),o<=C&&(p=C-1)}}function Ch(a,s,o,h){hy(a,o,h),hy(s,2*o,2*h),hy(s,2*o+1,2*h+1)}function hy(a,s,o){const h=a[s];a[s]=a[o],a[o]=h}function mw(a,s,o,h){const p=a-o,x=s-h;return p*p+x*x}var dy;l.bh=void 0,(dy=l.bh||(l.bh={})).create="create",dy.load="load",dy.fullLoad="fullLoad";let ap=null,Ah=[];const fy=1e3/60,py="loadTime",my="fullLoadTime",GP={mark(a){performance.mark(a)},frame(a){const s=a;ap!=null&&Ah.push(s-ap),ap=s},clearMetrics(){ap=null,Ah=[],performance.clearMeasures(py),performance.clearMeasures(my);for(const a in l.bh)performance.clearMarks(l.bh[a])},getPerformanceMetrics(){performance.measure(py,l.bh.create,l.bh.load),performance.measure(my,l.bh.create,l.bh.fullLoad);const a=performance.getEntriesByName(py)[0].duration,s=performance.getEntriesByName(my)[0].duration,o=Ah.length,h=1/(Ah.reduce((x,b)=>x+b,0)/o/1e3),p=Ah.filter(x=>x>fy).reduce((x,b)=>x+(b-fy)/fy,0);return{loadTime:a,fullLoadTime:s,fps:h,percentDroppedFrames:p/(o+p)*100,totalFrames:o}}};l.$=function(a,s,o){var h,p,x,b,S,C,M,N,B,F,U,q,J=o[0],ne=o[1],le=o[2];return s===a?(a[12]=s[0]*J+s[4]*ne+s[8]*le+s[12],a[13]=s[1]*J+s[5]*ne+s[9]*le+s[13],a[14]=s[2]*J+s[6]*ne+s[10]*le+s[14],a[15]=s[3]*J+s[7]*ne+s[11]*le+s[15]):(p=s[1],x=s[2],b=s[3],S=s[4],C=s[5],M=s[6],N=s[7],B=s[8],F=s[9],U=s[10],q=s[11],a[0]=h=s[0],a[1]=p,a[2]=x,a[3]=b,a[4]=S,a[5]=C,a[6]=M,a[7]=N,a[8]=B,a[9]=F,a[10]=U,a[11]=q,a[12]=h*J+S*ne+B*le+s[12],a[13]=p*J+C*ne+F*le+s[13],a[14]=x*J+M*ne+U*le+s[14],a[15]=b*J+N*ne+q*le+s[15]),a},l.A=pc,l.B=ni,l.C=class{constructor(a,s,o){this.receive=h=>{const p=h.data,x=p.id;if(x&&(!p.targetMapId||this.mapId===p.targetMapId))if(p.type==="<cancel>"){delete this.tasks[x];const b=this.cancelCallbacks[x];delete this.cancelCallbacks[x],b&&b()}else vt()||p.mustQueue?(this.tasks[x]=p,this.taskQueue.push(x),this.invoker.trigger()):this.processTask(x,p)},this.process=()=>{if(!this.taskQueue.length)return;const h=this.taskQueue.shift(),p=this.tasks[h];delete this.tasks[h],this.taskQueue.length&&this.invoker.trigger(),p&&this.processTask(h,p)},this.target=a,this.parent=s,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new LP(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=vt()?a:window}send(a,s,o,h,p=!1){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[x]=o);const b=[],S={id:x,type:a,hasCallback:!!o,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:ea(s,b)};return this.target.postMessage(S,{transfer:b}),{cancel:()=>{o&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}processTask(a,s){if(s.type==="<response>"){const o=this.callbacks[a];delete this.callbacks[a],o&&(s.error?o(ro(s.error)):o(null,ro(s.data)))}else{let o=!1;const h=[],p=s.hasCallback?(S,C)=>{o=!0,delete this.cancelCallbacks[a];const M={id:a,type:"<response>",sourceMapId:this.mapId,error:S?ea(S):null,data:ea(C,h)};this.target.postMessage(M,{transfer:h})}:S=>{o=!0};let x=null;const b=ro(s.data);if(this.parent[s.type])x=this.parent[s.type](s.sourceMapId,b,p);else if("getWorkerSource"in this.parent){const S=s.type.split(".");x=this.parent.getWorkerSource(s.sourceMapId,S[0],b.source)[S[1]](b,p)}else p(new Error(`Could not find function ${s.type}`));!o&&x&&x.cancel&&(this.cancelCallbacks[a]=x.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=dt,l.E=sn,l.F=function(a,s){const o={};for(let h=0;h<s.length;h++){const p=s[h];p in a&&(o[p]=a[p])}return o},l.G=Vb,l.H=qb,l.I=Xg,l.J=H,l.K=W,l.L=co,l.M=Ct,l.N=Wr,l.O=Wi,l.P=L,l.Q=Sr,l.R=Gi,l.S=gr,l.T=Lf,l.U=tp,l.V=class extends Sa{},l.W=ay,l.X=function(a,s){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){s(null,o)};for(let h=0;h<a.length;h++){const p=window.document.createElement("source");Fi(a[h])||(o.crossOrigin="Anonymous"),p.src=a[h],o.appendChild(p)}return{cancel:()=>{}}},l.Y=Ve,l.Z=function(){var a=new pc(16);return pc!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l._=w,l.a=st,l.a$=class extends ${},l.a0=function(a,s,o){var h=o[0],p=o[1],x=o[2];return a[0]=s[0]*h,a[1]=s[1]*h,a[2]=s[2]*h,a[3]=s[3]*h,a[4]=s[4]*p,a[5]=s[5]*p,a[6]=s[6]*p,a[7]=s[7]*p,a[8]=s[8]*x,a[9]=s[9]*x,a[10]=s[10]*x,a[11]=s[11]*x,a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},l.a1=H0,l.a2=function(){return rt++},l.a3=ie,l.a4=xc,l.a5=function(){li.isLoading()||li.isLoaded()||rh()!=="deferred"||Nf()},l.a6=Gu,l.a7=ol,l.a8=mr,l.a9=Yb,l.aA=tl,l.aB=function(a){a=a.slice();const s=Object.create(null);for(let o=0;o<a.length;o++)s[a[o].id]=a[o];for(let o=0;o<a.length;o++)"ref"in a[o]&&(a[o]=ls(a[o],s[a[o].ref]));return a},l.aC=function(a){if(a.type==="custom")return new NP(a);switch(a.type){case"background":return new MP(a);case"circle":return new gA(a);case"fill":return new RA(a);case"fill-extrusion":return new YA(a);case"heatmap":return new _A(a);case"hillshade":return new xA(a);case"line":return new nP(a);case"raster":return new DP(a);case"symbol":return new ep(a)}},l.aD=Oe,l.aE=function(a,s){if(!a)return[{command:Wt.setStyle,args:[s]}];let o=[];try{if(!nr(a.version,s.version))return[{command:Wt.setStyle,args:[s]}];nr(a.center,s.center)||o.push({command:Wt.setCenter,args:[s.center]}),nr(a.zoom,s.zoom)||o.push({command:Wt.setZoom,args:[s.zoom]}),nr(a.bearing,s.bearing)||o.push({command:Wt.setBearing,args:[s.bearing]}),nr(a.pitch,s.pitch)||o.push({command:Wt.setPitch,args:[s.pitch]}),nr(a.sprite,s.sprite)||o.push({command:Wt.setSprite,args:[s.sprite]}),nr(a.glyphs,s.glyphs)||o.push({command:Wt.setGlyphs,args:[s.glyphs]}),nr(a.transition,s.transition)||o.push({command:Wt.setTransition,args:[s.transition]}),nr(a.light,s.light)||o.push({command:Wt.setLight,args:[s.light]});const h={},p=[];(function(b,S,C,M){let N;for(N in S=S||{},b=b||{})Object.prototype.hasOwnProperty.call(b,N)&&(Object.prototype.hasOwnProperty.call(S,N)||Zn(N,C,M));for(N in S)Object.prototype.hasOwnProperty.call(S,N)&&(Object.prototype.hasOwnProperty.call(b,N)?nr(b[N],S[N])||(b[N].type==="geojson"&&S[N].type==="geojson"&&ma(b,S,N)?C.push({command:Wt.setGeoJSONSourceData,args:[N,S[N].data]}):$i(N,S,C,M)):wi(N,S,C))})(a.sources,s.sources,p,h);const x=[];a.layers&&a.layers.forEach(b=>{h[b.source]?o.push({command:Wt.removeLayer,args:[b.id]}):x.push(b)}),o=o.concat(p),function(b,S,C){S=S||[];const M=(b=b||[]).map(Ui),N=S.map(Ui),B=b.reduce(Tn,{}),F=S.reduce(Tn,{}),U=M.slice(),q=Object.create(null);let J,ne,le,ve,fe,xe,ke;for(J=0,ne=0;J<M.length;J++)le=M[J],Object.prototype.hasOwnProperty.call(F,le)?ne++:(C.push({command:Wt.removeLayer,args:[le]}),U.splice(U.indexOf(le,ne),1));for(J=0,ne=0;J<N.length;J++)le=N[N.length-1-J],U[U.length-1-J]!==le&&(Object.prototype.hasOwnProperty.call(B,le)?(C.push({command:Wt.removeLayer,args:[le]}),U.splice(U.lastIndexOf(le,U.length-ne),1)):ne++,xe=U[U.length-J],C.push({command:Wt.addLayer,args:[F[le],xe]}),U.splice(U.length-J,0,le),q[le]=!0);for(J=0;J<N.length;J++)if(le=N[J],ve=B[le],fe=F[le],!q[le]&&!nr(ve,fe))if(nr(ve.source,fe.source)&&nr(ve["source-layer"],fe["source-layer"])&&nr(ve.type,fe.type)){for(ke in Hn(ve.layout,fe.layout,C,le,null,Wt.setLayoutProperty),Hn(ve.paint,fe.paint,C,le,null,Wt.setPaintProperty),nr(ve.filter,fe.filter)||C.push({command:Wt.setFilter,args:[le,fe.filter]}),nr(ve.minzoom,fe.minzoom)&&nr(ve.maxzoom,fe.maxzoom)||C.push({command:Wt.setLayerZoomRange,args:[le,fe.minzoom,fe.maxzoom]}),ve)Object.prototype.hasOwnProperty.call(ve,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Hn(ve[ke],fe[ke],C,le,ke.slice(6),Wt.setPaintProperty):nr(ve[ke],fe[ke])||C.push({command:Wt.setLayerProperty,args:[le,ke,fe[ke]]}));for(ke in fe)Object.prototype.hasOwnProperty.call(fe,ke)&&!Object.prototype.hasOwnProperty.call(ve,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Hn(ve[ke],fe[ke],C,le,ke.slice(6),Wt.setPaintProperty):nr(ve[ke],fe[ke])||C.push({command:Wt.setLayerProperty,args:[le,ke,fe[ke]]}))}else C.push({command:Wt.removeLayer,args:[le]}),xe=U[U.lastIndexOf(le)+1],C.push({command:Wt.addLayer,args:[fe,xe]})}(x,s.layers,o)}catch(h){console.warn("Unable to compute style diff:",h),o=[{command:Wt.setStyle,args:[s]}]}return o},l.aF=function(a){const s=[],o=a.id;return o===void 0&&s.push({message:`layers.${o}: missing required property "id"`}),a.render===void 0&&s.push({message:`layers.${o}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&s.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),s},l.aG=function a(s,o){if(Array.isArray(s)){if(!Array.isArray(o)||s.length!==o.length)return!1;for(let h=0;h<s.length;h++)if(!a(s[h],o[h]))return!1;return!0}if(typeof s=="object"&&s!==null&&o!==null){if(typeof o!="object"||Object.keys(s).length!==Object.keys(o).length)return!1;for(const h in s)if(!a(s[h],o[h]))return!1;return!0}return s===o},l.aH=Ue,l.aI=St,l.aJ=rl,l.aK=function(a){return a({pluginStatus:Gs,pluginURL:ta}),rl.on("pluginStateChange",a),a},l.aL=class extends Ea{constructor(a,s){super(a,s),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.aM=dc,l.aN=class extends Ea{constructor(a,s){super(a,s),this.current=Ag}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let s=1;s<16;s++)if(a[s]!==this.current[s]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.aO=Of,l.aP=class extends Ea{constructor(a,s){super(a,s),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.aQ=class extends Ea{constructor(a,s){super(a,s),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.aR=Ff,l.aS=function(a,s,o,h,p,x,b){var S=1/(s-o),C=1/(h-p),M=1/(x-b);return a[0]=-2*S,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*C,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(s+o)*S,a[13]=(p+h)*C,a[14]=(b+x)*M,a[15]=1,a},l.aT=ar,l.aU=mA,l.aV=class extends f{},l.aW=cP,l.aX=class extends _{},l.aY=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.aZ=Q0,l.a_=$e,l.aa=function(a){const s={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,h,p,x)=>{const b=p||x;return s[h]=!b||b.toLowerCase(),""}),s["max-age"]){const o=parseInt(s["max-age"],10);isNaN(o)?delete s["max-age"]:s["max-age"]=o}return s},l.ab=function(a,s){const o=[];for(const h in a)h in s||o.push(h);return o},l.ac=function(a){if(Be==null){const s=a.navigator?a.navigator.userAgent:null;Be=!!a.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Be},l.ad=be,l.ae=function(a,s,o){var h=Math.sin(o),p=Math.cos(o),x=s[0],b=s[1],S=s[2],C=s[3],M=s[4],N=s[5],B=s[6],F=s[7];return s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[0]=x*p+M*h,a[1]=b*p+N*h,a[2]=S*p+B*h,a[3]=C*p+F*h,a[4]=M*p-x*h,a[5]=N*p-b*h,a[6]=B*p-S*h,a[7]=F*p-C*h,a},l.af=function(a){var s=new pc(16);return s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[8]=a[8],s[9]=a[9],s[10]=a[10],s[11]=a[11],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15],s},l.ag=qf,l.ah=function(a,s){let o=0,h=0;if(a.kind==="constant")h=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:p,minZoom:x,maxZoom:b}=a,S=p?be(ai.interpolationFactor(p,s,x,b),0,1):0;a.kind==="camera"?h=ni.number(a.minSize,a.maxSize,S):o=S}return{uSizeT:o,uSize:h}},l.aj=function(a,{uSize:s,uSizeT:o},{lowerSize:h,upperSize:p}){return a.kind==="source"?h/sa:a.kind==="composite"?ni.number(h/sa,p/sa,o):s},l.ak=ey,l.al=function(a,s,o,h){const p=s.y-a.y,x=s.x-a.x,b=h.y-o.y,S=h.x-o.x,C=b*x-S*p;if(C===0)return null;const M=(S*(a.y-o.y)-b*(a.x-o.x))/C;return new L(a.x+M*x,a.y+M*p)},l.am=tw,l.an=U0,l.ao=Dg,l.ap=Qr,l.ar=Qg,l.as=function(a,s){var o=s[0],h=s[1],p=s[2],x=s[3],b=s[4],S=s[5],C=s[6],M=s[7],N=s[8],B=s[9],F=s[10],U=s[11],q=s[12],J=s[13],ne=s[14],le=s[15],ve=o*S-h*b,fe=o*C-p*b,xe=o*M-x*b,ke=h*C-p*S,De=h*M-x*S,et=p*M-x*C,ct=N*J-B*q,Je=N*ne-F*q,Xe=N*le-U*q,We=B*ne-F*J,at=B*le-U*J,He=F*le-U*ne,ze=ve*He-fe*at+xe*We+ke*Xe-De*Je+et*ct;return ze?(a[0]=(S*He-C*at+M*We)*(ze=1/ze),a[1]=(p*at-h*He-x*We)*ze,a[2]=(J*et-ne*De+le*ke)*ze,a[3]=(F*De-B*et-U*ke)*ze,a[4]=(C*Xe-b*He-M*Je)*ze,a[5]=(o*He-p*Xe+x*Je)*ze,a[6]=(ne*xe-q*et-le*fe)*ze,a[7]=(N*et-F*xe+U*fe)*ze,a[8]=(b*at-S*Xe+M*ct)*ze,a[9]=(h*Xe-o*at-x*ct)*ze,a[10]=(q*De-J*xe+le*ve)*ze,a[11]=(B*xe-N*De-U*ve)*ze,a[12]=(S*Je-b*We-C*ct)*ze,a[13]=(o*We-h*Je+p*ct)*ze,a[14]=(J*fe-q*ke-ne*ve)*ze,a[15]=(N*ke-B*fe+F*ve)*ze,a):null},l.at=ly,l.au=Jg,l.av=cy,l.aw=function(){const a={},s=Pe.$version;for(const o in Pe.$root){const h=Pe.$root[o];if(h.required){let p=null;p=o==="version"?s:h.type==="array"?[]:{},p!=null&&(a[o]=p)}}return a},l.ax=Wt,l.ay=If,l.az=_t,l.b=function(a,s){const o=new Blob([new Uint8Array(a)],{type:"image/png"});createImageBitmap(o).then(h=>{s(null,h)}).catch(h=>{s(new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=ys,l.b1=function(a,s){var o=a[0],h=a[1],p=a[2],x=a[3],b=a[4],S=a[5],C=a[6],M=a[7],N=a[8],B=a[9],F=a[10],U=a[11],q=a[12],J=a[13],ne=a[14],le=a[15],ve=s[0],fe=s[1],xe=s[2],ke=s[3],De=s[4],et=s[5],ct=s[6],Je=s[7],Xe=s[8],We=s[9],at=s[10],He=s[11],ze=s[12],mt=s[13],ht=s[14],Lt=s[15];return Math.abs(o-ve)<=Zs*Math.max(1,Math.abs(o),Math.abs(ve))&&Math.abs(h-fe)<=Zs*Math.max(1,Math.abs(h),Math.abs(fe))&&Math.abs(p-xe)<=Zs*Math.max(1,Math.abs(p),Math.abs(xe))&&Math.abs(x-ke)<=Zs*Math.max(1,Math.abs(x),Math.abs(ke))&&Math.abs(b-De)<=Zs*Math.max(1,Math.abs(b),Math.abs(De))&&Math.abs(S-et)<=Zs*Math.max(1,Math.abs(S),Math.abs(et))&&Math.abs(C-ct)<=Zs*Math.max(1,Math.abs(C),Math.abs(ct))&&Math.abs(M-Je)<=Zs*Math.max(1,Math.abs(M),Math.abs(Je))&&Math.abs(N-Xe)<=Zs*Math.max(1,Math.abs(N),Math.abs(Xe))&&Math.abs(B-We)<=Zs*Math.max(1,Math.abs(B),Math.abs(We))&&Math.abs(F-at)<=Zs*Math.max(1,Math.abs(F),Math.abs(at))&&Math.abs(U-He)<=Zs*Math.max(1,Math.abs(U),Math.abs(He))&&Math.abs(q-ze)<=Zs*Math.max(1,Math.abs(q),Math.abs(ze))&&Math.abs(J-mt)<=Zs*Math.max(1,Math.abs(J),Math.abs(mt))&&Math.abs(ne-ht)<=Zs*Math.max(1,Math.abs(ne),Math.abs(ht))&&Math.abs(le-Lt)<=Zs*Math.max(1,Math.abs(le),Math.abs(Lt))},l.b2=function(a,s){return a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[4]=s[4],a[5]=s[5],a[6]=s[6],a[7]=s[7],a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15],a},l.b3=function(a,s,o){return a[0]=s[0]*o[0],a[1]=s[1]*o[1],a[2]=s[2]*o[2],a[3]=s[3]*o[3],a},l.b4=function(a,s){return a[0]*s[0]+a[1]*s[1]+a[2]*s[2]+a[3]*s[3]},l.b5=Ce,l.b6=Hb,l.b7=Gb,l.b8=function(a,s,o,h,p){var x,b=1/Math.tan(s/2);return a[0]=b/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,p!=null&&p!==1/0?(a[10]=(p+h)*(x=1/(h-p)),a[14]=2*p*h*x):(a[10]=-1,a[14]=-2*h),a},l.b9=function(a,s,o){var h=Math.sin(o),p=Math.cos(o),x=s[4],b=s[5],S=s[6],C=s[7],M=s[8],N=s[9],B=s[10],F=s[11];return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a[4]=x*p+M*h,a[5]=b*p+N*h,a[6]=S*p+B*h,a[7]=C*p+F*h,a[8]=M*p-x*h,a[9]=N*p-b*h,a[10]=B*p-S*h,a[11]=F*p-C*h,a},l.bA=P,l.bB=xb,l.bC=tc,l.bD=li,l.ba=ue,l.bb=me,l.bc=function(a,s){return a[0]=s[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=s[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=s[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.bd=class extends nl{},l.be=iy,l.bf=Wb,l.bg=GP,l.bi=yt,l.bj=function(a,s,o=!1){if(Gs===Yu||Gs===Ju||Gs===Qu)throw new Error("setRTLTextPlugin cannot be called multiple times.");ta=kt.resolveURL(a),Gs=Yu,eh=s,th(),o||Nf()},l.bk=rh,l.bl=function(a,s){const o={};for(let p=0;p<a.length;p++){const x=s&&s[a[p].id]||nc(a[p]);s&&(s[a[p].id]=x);let b=o[x];b||(b=o[x]=[]),b.push(a[p])}const h=[];for(const p in o)h.push(o[p]);return h},l.bm=nt,l.bn=Xb,l.bo=Jb,l.bp=Pb,l.bq=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Wr/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const s=a.bucket.layers[0],o=s.layout,h=s._unevaluatedLayout._values,p={layoutIconSize:h["icon-size"].possiblyEvaluate(new mr(a.bucket.zoom+1),a.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new mr(a.bucket.zoom+1),a.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new mr(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:N}=a.bucket.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new mr(M),a.canonical),h["text-size"].possiblyEvaluate(new mr(N),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:N}=a.bucket.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new mr(M),a.canonical),h["icon-size"].possiblyEvaluate(new mr(N),a.canonical)]}const x=o.get("text-line-height")*Qr,b=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",S=o.get("text-keep-upright"),C=o.get("text-size");for(const M of a.bucket.features){const N=o.get("text-font").evaluate(M,{},a.canonical).join(","),B=C.evaluate(M,{},a.canonical),F=p.layoutTextSize.evaluate(M,{},a.canonical),U=p.layoutIconSize.evaluate(M,{},a.canonical),q={horizontal:{},vertical:void 0},J=M.text;let ne,le=[0,0];if(J){const xe=J.toString(),ke=o.get("text-letter-spacing").evaluate(M,{},a.canonical)*Qr,De=Ku(xe)?ke:0,et=o.get("text-anchor").evaluate(M,{},a.canonical),ct=uw(s,M,a.canonical);if(!ct){const He=o.get("text-radial-offset").evaluate(M,{},a.canonical);le=He?cw(et,[He*Qr,oy]):o.get("text-offset").evaluate(M,{},a.canonical).map(ze=>ze*Qr)}let Je=b?"center":o.get("text-justify").evaluate(M,{},a.canonical);const Xe=o.get("symbol-placement"),We=Xe==="point"?o.get("text-max-width").evaluate(M,{},a.canonical)*Qr:0,at=()=>{a.bucket.allowVerticalPlacement&&Hu(xe)&&(q.vertical=Yf(J,a.glyphMap,a.glyphPositions,a.imagePositions,N,We,x,et,"left",De,le,l.ai.vertical,!0,Xe,F,B))};if(!b&&ct){const He=new Set;if(Je==="auto")for(let mt=0;mt<ct.values.length;mt+=2)He.add(ly(ct.values[mt]));else He.add(Je);let ze=!1;for(const mt of He)if(!q.horizontal[mt])if(ze)q.horizontal[mt]=q.horizontal[0];else{const ht=Yf(J,a.glyphMap,a.glyphPositions,a.imagePositions,N,We,x,"center",mt,De,le,l.ai.horizontal,!1,Xe,F,B);ht&&(q.horizontal[mt]=ht,ze=ht.positionedLines.length===1)}at()}else{Je==="auto"&&(Je=ly(et));const He=Yf(J,a.glyphMap,a.glyphPositions,a.imagePositions,N,We,x,et,Je,De,le,l.ai.horizontal,!1,Xe,F,B);He&&(q.horizontal[Je]=He),at(),Hu(xe)&&b&&S&&(q.vertical=Yf(J,a.glyphMap,a.glyphPositions,a.imagePositions,N,We,x,et,Je,De,le,l.ai.vertical,!1,Xe,F,B))}}let ve=!1;if(M.icon&&M.icon.name){const xe=a.imageMap[M.icon.name];xe&&(ne=EP(a.imagePositions[M.icon.name],o.get("icon-offset").evaluate(M,{},a.canonical),o.get("icon-anchor").evaluate(M,{},a.canonical)),ve=!!xe.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ve:a.bucket.sdfIcons!==ve&&qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==a.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const fe=dw(q.horizontal)||q.vertical;a.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||ne)&&VP(a.bucket,M,q,ne,a.imageMap,p,F,U,le,ve,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.br=Wg,l.bs=Vg,l.bt=Gg,l.bu=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.bv=Hg,l.bw=ao,l.bx=function(a,s,o,h,p){return w(this,void 0,void 0,function*(){if(W())try{return yield Ct(a,s,o,h,p)}catch{}return function(x,b,S,C,M){const N=x.width,B=x.height;Nt&&Ye||(Nt=new OffscreenCanvas(N,B),Ye=Nt.getContext("2d",{willReadFrequently:!0})),Nt.width=N,Nt.height=B,Ye.drawImage(x,0,0,N,B);const F=Ye.getImageData(b,S,C,M);return Ye.clearRect(0,0,N,B),F.data}(a,s,o,h,p)})},l.by=Kb,l.bz=k,l.c=Ht,l.d=function(a,s){const o=new Image;o.onload=()=>{s(null,o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Fe})},o.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(h):Fe},l.e=Te,l.f=function(a,s){return It(Te(a,{type:"json"}),s)},l.g=ur,l.h=kt,l.i=vt,l.j=os,l.k=rn,l.l=qr,l.m=It,l.n=function(a){return new Hg(a).readFields(xP,[])},l.o=function(a,s,o){if(!a.length)return o(null,[]);let h=a.length;const p=new Array(a.length);let x=null;a.forEach((b,S)=>{s(b,(C,M)=>{C&&(x=C),p[S]=M,--h==0&&o(x,p)})})},l.p=Ab,l.q=mh,l.r=Rr,l.s=Fi,l.t=kg,l.u=Qe,l.v=Pe,l.w=qe,l.x=lc,l.y=Pn,l.z=function([a,s,o]){return s+=90,s*=Math.PI/180,o*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(o),y:a*Math.sin(s)*Math.sin(o),z:a*Math.cos(o)}}}),d(["./shared"],function(l){class w{constructor(I){this.keyCache={},I&&this.replace(I)}replace(I){this._layerConfigs={},this._layers={},this.update(I,[])}update(I,O){for(const K of I){this._layerConfigs[K.id]=K;const te=this._layers[K.id]=l.aC(K);te._featureFilter=l.a6(te.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of O)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const V=l.bl(Object.values(this._layerConfigs),this.keyCache);for(const K of V){const te=K.map(Me=>this._layers[Me.id]),pe=te[0];if(pe.visibility==="none")continue;const he=pe.source||"";let oe=this.familiesBySource[he];oe||(oe=this.familiesBySource[he]={});const ge=pe.sourceLayer||"_geojsonTileLayer";let Ie=oe[ge];Ie||(Ie=oe[ge]=[]),Ie.push(te)}}}class k{constructor(I){const O={},V=[];for(const he in I){const oe=I[he],ge=O[he]={};for(const Ie in oe){const Me=oe[+Ie];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const Ne={x:0,y:0,w:Me.bitmap.width+2,h:Me.bitmap.height+2};V.push(Ne),ge[Ie]={rect:Ne,metrics:Me.metrics}}}const{w:K,h:te}=l.p(V),pe=new l.q({width:K||1,height:te||1});for(const he in I){const oe=I[he];for(const ge in oe){const Ie=oe[+ge];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Me=O[he][ge].rect;l.q.copy(Ie.bitmap,pe,{x:0,y:0},{x:Me.x+1,y:Me.y+1},Ie.bitmap)}}this.image=pe,this.positions=O}}l.bm("GlyphAtlas",k);class P{constructor(I){this.tileID=new l.O(I.tileID.overscaledZ,I.tileID.wrap,I.tileID.canonical.z,I.tileID.canonical.x,I.tileID.canonical.y),this.uid=I.uid,this.zoom=I.zoom,this.pixelRatio=I.pixelRatio,this.tileSize=I.tileSize,this.source=I.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=I.showCollisionBoxes,this.collectResourceTiming=!!I.collectResourceTiming,this.returnDependencies=!!I.returnDependencies,this.promoteId=I.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(I,O,V,K,te){this.status="parsing",this.data=I,this.collisionBoxArray=new l.a3;const pe=new l.bn(Object.keys(I.layers).sort()),he=new l.bo(this.tileID,this.promoteId);he.bucketLayerIDs=[];const oe={},ge={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},Ie=O.familiesBySource[this.source];for(const Zt in Ie){const Gt=I.layers[Zt];if(!Gt)continue;Gt.version===1&&l.w(`Vector tile source "${this.source}" layer "${Zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ks=pe.encode(Zt),hr=[];for(let Gr=0;Gr<Gt.length;Gr++){const ms=Gt.feature(Gr),ki=he.getId(ms,Zt);hr.push({feature:ms,id:ki,index:Gr,sourceLayerIndex:ks})}for(const Gr of Ie[Zt]){const ms=Gr[0];ms.source!==this.source&&l.w(`layer.source = ${ms.source} does not equal this.source = ${this.source}`),ms.minzoom&&this.zoom<Math.floor(ms.minzoom)||ms.maxzoom&&this.zoom>=ms.maxzoom||ms.visibility!=="none"&&(j(Gr,this.zoom,V),(oe[ms.id]=ms.createBucket({index:he.bucketLayerIDs.length,layers:Gr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ks,sourceID:this.source})).populate(hr,ge,this.tileID.canonical),he.bucketLayerIDs.push(Gr.map(ki=>ki.id)))}}let Me,Ne,pt,wt;const ot=l.aH(ge.glyphDependencies,Zt=>Object.keys(Zt).map(Number));this.inFlightDependencies.forEach(Zt=>Zt==null?void 0:Zt.cancel()),this.inFlightDependencies=[];const gt=++this.dependencySentinel;Object.keys(ot).length?this.inFlightDependencies.push(K.send("getGlyphs",{uid:this.uid,stacks:ot,source:this.source,tileID:this.tileID,type:"glyphs"},(Zt,Gt)=>{gt===this.dependencySentinel&&(Me||(Me=Zt,Ne=Gt,lr.call(this)))})):Ne={};const At=Object.keys(ge.iconDependencies);At.length?this.inFlightDependencies.push(K.send("getImages",{icons:At,source:this.source,tileID:this.tileID,type:"icons"},(Zt,Gt)=>{gt===this.dependencySentinel&&(Me||(Me=Zt,pt=Gt,lr.call(this)))})):pt={};const rr=Object.keys(ge.patternDependencies);function lr(){if(Me)return te(Me);if(Ne&&pt&&wt){const Zt=new k(Ne),Gt=new l.bp(pt,wt);for(const ks in oe){const hr=oe[ks];hr instanceof l.a4?(j(hr.layers,this.zoom,V),l.bq({bucket:hr,glyphMap:Ne,glyphPositions:Zt.positions,imageMap:pt,imagePositions:Gt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):hr.hasPattern&&(hr instanceof l.br||hr instanceof l.bs||hr instanceof l.bt)&&(j(hr.layers,this.zoom,V),hr.addFeatures(ge,this.tileID.canonical,Gt.patternPositions))}this.status="done",te(null,{buckets:Object.values(oe).filter(ks=>!ks.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zt.image,imageAtlas:Gt,glyphMap:this.returnDependencies?Ne:null,iconMap:this.returnDependencies?pt:null,glyphPositions:this.returnDependencies?Zt.positions:null})}}rr.length?this.inFlightDependencies.push(K.send("getImages",{icons:rr,source:this.source,tileID:this.tileID,type:"patterns"},(Zt,Gt)=>{gt===this.dependencySentinel&&(Me||(Me=Zt,wt=Gt,lr.call(this)))})):wt={},lr.call(this)}}function j(se,I,O){const V=new l.a8(I);for(const K of se)K.recalculate(V,O)}function L(se,I){const O=l.l(se.request,(V,K,te,pe)=>{if(V)I(V);else if(K)try{const he=new l.bw.VectorTile(new l.bv(K));I(null,{vectorTile:he,rawData:K,cacheControl:te,expires:pe})}catch(he){const oe=new Uint8Array(K);let ge=`Unable to parse the tile at ${se.request.url}, `;ge+=oe[0]===31&&oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.messge}`,I(new Error(ge))}});return()=>{O.cancel(),I()}}class Z{constructor(I,O,V,K){this.actor=I,this.layerIndex=O,this.availableImages=V,this.loadVectorData=K||L,this.fetching={},this.loading={},this.loaded={}}loadTile(I,O){const V=I.uid;this.loading||(this.loading={});const K=!!(I&&I.request&&I.request.collectResourceTiming)&&new l.bu(I.request),te=this.loading[V]=new P(I);te.abort=this.loadVectorData(I,(pe,he)=>{if(delete this.loading[V],pe||!he)return te.status="done",this.loaded[V]=te,O(pe);const oe=he.rawData,ge={};he.expires&&(ge.expires=he.expires),he.cacheControl&&(ge.cacheControl=he.cacheControl);const Ie={};if(K){const Me=K.finish();Me&&(Ie.resourceTiming=JSON.parse(JSON.stringify(Me)))}te.vectorTile=he.vectorTile,te.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(Me,Ne)=>{if(delete this.fetching[V],Me||!Ne)return O(Me);O(null,l.e({rawTileData:oe.slice(0)},Ne,ge,Ie))}),this.loaded=this.loaded||{},this.loaded[V]=te,this.fetching[V]={rawTileData:oe,cacheControl:ge,resourceTiming:Ie}})}reloadTile(I,O){const V=this.loaded,K=I.uid;if(V&&V[K]){const te=V[K];te.showCollisionBoxes=I.showCollisionBoxes,te.status==="parsing"?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(pe,he)=>{if(pe||!he)return O(pe,he);let oe;if(this.fetching[K]){const{rawTileData:ge,cacheControl:Ie,resourceTiming:Me}=this.fetching[K];delete this.fetching[K],oe=l.e({rawTileData:ge.slice(0)},he,Ie,Me)}else oe=he;O(null,oe)}):te.status==="done"&&(te.vectorTile?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,O):O())}}abortTile(I,O){const V=this.loading,K=I.uid;V&&V[K]&&V[K].abort&&(V[K].abort(),delete V[K]),O()}removeTile(I,O){const V=this.loaded,K=I.uid;V&&V[K]&&delete V[K],O()}}class Y{constructor(){this.loaded={}}loadTile(I,O){return l._(this,void 0,void 0,function*(){const{uid:V,encoding:K,rawImageData:te,redFactor:pe,greenFactor:he,blueFactor:oe,baseShift:ge}=I,Ie=te.width+2,Me=te.height+2,Ne=l.a(te)?new l.R({width:Ie,height:Me},yield l.bx(te,-1,-1,Ie,Me)):te,pt=new l.by(V,Ne,K,pe,he,oe,ge);this.loaded=this.loaded||{},this.loaded[V]=pt,O(null,pt)})}removeTile(I){const O=this.loaded,V=I.uid;O&&O[V]&&delete O[V]}}function ce(se,I){if(se.length!==0){de(se[0],I);for(var O=1;O<se.length;O++)de(se[O],!I)}}function de(se,I){for(var O=0,V=0,K=0,te=se.length,pe=te-1;K<te;pe=K++){var he=(se[K][0]-se[pe][0])*(se[pe][1]+se[K][1]),oe=O+he;V+=Math.abs(O)>=Math.abs(he)?O-oe+he:he-oe+O,O=oe}O+V>=0!=!!I&&se.reverse()}var G=l.bz(function se(I,O){var V,K=I&&I.type;if(K==="FeatureCollection")for(V=0;V<I.features.length;V++)se(I.features[V],O);else if(K==="GeometryCollection")for(V=0;V<I.geometries.length;V++)se(I.geometries[V],O);else if(K==="Feature")se(I.geometry,O);else if(K==="Polygon")ce(I.coordinates,O);else if(K==="MultiPolygon")for(V=0;V<I.coordinates.length;V++)ce(I.coordinates[V],O);return I});const H=l.bw.VectorTileFeature.prototype.toGeoJSON;var W={exports:{}},ue=l.bA,me=l.bw.VectorTileFeature,be=Ce;function Ce(se,I){this.options=I||{},this.features=se,this.length=se.length}function Te(se,I){this.id=typeof se.id=="number"?se.id:void 0,this.type=se.type,this.rawGeometry=se.type===1?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=I||4096}Ce.prototype.feature=function(se){return new Te(this.features[se],this.options.extent)},Te.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var I=0;I<se.length;I++){for(var O=se[I],V=[],K=0;K<O.length;K++)V.push(new ue(O[K][0],O[K][1]));this.geometry.push(V)}return this.geometry},Te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,I=1/0,O=-1/0,V=1/0,K=-1/0,te=0;te<se.length;te++)for(var pe=se[te],he=0;he<pe.length;he++){var oe=pe[he];I=Math.min(I,oe.x),O=Math.max(O,oe.x),V=Math.min(V,oe.y),K=Math.max(K,oe.y)}return[I,V,O,K]},Te.prototype.toGeoJSON=me.prototype.toGeoJSON;var rt=l.bB,Ue=be;function St(se){var I=new rt;return function(O,V){for(var K in O.layers)V.writeMessage(3,Oe,O.layers[K])}(se,I),I.finish()}function Oe(se,I){var O;I.writeVarintField(15,se.version||1),I.writeStringField(1,se.name||""),I.writeVarintField(5,se.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<se.length;O++)V.feature=se.feature(O),I.writeMessage(2,it,V);var K=V.keys;for(O=0;O<K.length;O++)I.writeStringField(3,K[O]);var te=V.values;for(O=0;O<te.length;O++)I.writeMessage(4,Be,te[O])}function it(se,I){var O=se.feature;O.id!==void 0&&I.writeVarintField(1,O.id),I.writeMessage(2,qe,se),I.writeVarintField(3,O.type),I.writeMessage(4,vt,O)}function qe(se,I){var O=se.feature,V=se.keys,K=se.values,te=se.keycache,pe=se.valuecache;for(var he in O.properties){var oe=O.properties[he],ge=te[he];if(oe!==null){ge===void 0&&(V.push(he),te[he]=ge=V.length-1),I.writeVarint(ge);var Ie=typeof oe;Ie!=="string"&&Ie!=="boolean"&&Ie!=="number"&&(oe=JSON.stringify(oe));var Me=Ie+":"+oe,Ne=pe[Me];Ne===void 0&&(K.push(oe),pe[Me]=Ne=K.length-1),I.writeVarint(Ne)}}}function Et(se,I){return(I<<3)+(7&se)}function ir(se){return se<<1^se>>31}function vt(se,I){for(var O=se.loadGeometry(),V=se.type,K=0,te=0,pe=O.length,he=0;he<pe;he++){var oe=O[he],ge=1;V===1&&(ge=oe.length),I.writeVarint(Et(1,ge));for(var Ie=V===3?oe.length-1:oe.length,Me=0;Me<Ie;Me++){Me===1&&V!==1&&I.writeVarint(Et(2,Ie-1));var Ne=oe[Me].x-K,pt=oe[Me].y-te;I.writeVarint(ir(Ne)),I.writeVarint(ir(pt)),K+=Ne,te+=pt}V===3&&I.writeVarint(Et(7,1))}}function Be(se,I){var O=typeof se;O==="string"?I.writeStringField(1,se):O==="boolean"?I.writeBooleanField(7,se):O==="number"&&(se%1!=0?I.writeDoubleField(3,se):se<0?I.writeSVarintField(6,se):I.writeVarintField(5,se))}W.exports=St,W.exports.fromVectorTileJs=St,W.exports.fromGeojsonVt=function(se,I){I=I||{};var O={};for(var V in se)O[V]=new Ue(se[V].features,I),O[V].name=V,O[V].version=I.version,O[V].extent=I.extent;return St({layers:O})},W.exports.GeoJSONWrapper=Ue;var st=l.bz(W.exports);const Fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},Ct=Math.fround||(Nt=new Float32Array(1),se=>(Nt[0]=+se,Nt[0]));var Nt;const Ye=3,we=5,tt=6;class kt{constructor(I){this.options=Object.assign(Object.create(Fe),I),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(I){const{log:O,minZoom:V,maxZoom:K}=this.options;O&&console.time("total time");const te=`prepare ${I.length} points`;O&&console.time(te),this.points=I;const pe=[];for(let oe=0;oe<I.length;oe++){const ge=I[oe];if(!ge.geometry)continue;const[Ie,Me]=ge.geometry.coordinates,Ne=Ct(_t(Ie)),pt=Ct(ur(Me));pe.push(Ne,pt,1/0,oe,-1,1),this.options.reduce&&pe.push(0)}let he=this.trees[K+1]=this._createTree(pe);O&&console.timeEnd(te);for(let oe=K;oe>=V;oe--){const ge=+Date.now();he=this.trees[oe]=this._createTree(this._cluster(he,oe)),O&&console.log("z%d: %d clusters in %dms",oe,he.numItems,+Date.now()-ge)}return O&&console.timeEnd("total time"),this}getClusters(I,O){let V=((I[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,I[1]));let te=I[2]===180?180:((I[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,I[3]));if(I[2]-I[0]>=360)V=-180,te=180;else if(V>te){const Me=this.getClusters([V,K,180,pe],O),Ne=this.getClusters([-180,K,te,pe],O);return Me.concat(Ne)}const he=this.trees[this._limitZoom(O)],oe=he.range(_t(V),ur(pe),_t(te),ur(K)),ge=he.data,Ie=[];for(const Me of oe){const Ne=this.stride*Me;Ie.push(ge[Ne+we]>1?Ht(ge,Ne,this.clusterProps):this.points[ge[Ne+Ye]])}return Ie}getChildren(I){const O=this._getOriginId(I),V=this._getOriginZoom(I),K="No cluster with the specified id.",te=this.trees[V];if(!te)throw new Error(K);const pe=te.data;if(O*this.stride>=pe.length)throw new Error(K);const he=this.options.radius/(this.options.extent*Math.pow(2,V-1)),oe=te.within(pe[O*this.stride],pe[O*this.stride+1],he),ge=[];for(const Ie of oe){const Me=Ie*this.stride;pe[Me+4]===I&&ge.push(pe[Me+we]>1?Ht(pe,Me,this.clusterProps):this.points[pe[Me+Ye]])}if(ge.length===0)throw new Error(K);return ge}getLeaves(I,O,V){const K=[];return this._appendLeaves(K,I,O=O||10,V=V||0,0),K}getTile(I,O,V){const K=this.trees[this._limitZoom(I)],te=Math.pow(2,I),{extent:pe,radius:he}=this.options,oe=he/pe,ge=(V-oe)/te,Ie=(V+1+oe)/te,Me={features:[]};return this._addTileFeatures(K.range((O-oe)/te,ge,(O+1+oe)/te,Ie),K.data,O,V,te,Me),O===0&&this._addTileFeatures(K.range(1-oe/te,ge,1,Ie),K.data,te,V,te,Me),O===te-1&&this._addTileFeatures(K.range(0,ge,oe/te,Ie),K.data,-1,V,te,Me),Me.features.length?Me:null}getClusterExpansionZoom(I){let O=this._getOriginZoom(I)-1;for(;O<=this.options.maxZoom;){const V=this.getChildren(I);if(O++,V.length!==1)break;I=V[0].properties.cluster_id}return O}_appendLeaves(I,O,V,K,te){const pe=this.getChildren(O);for(const he of pe){const oe=he.properties;if(oe&&oe.cluster?te+oe.point_count<=K?te+=oe.point_count:te=this._appendLeaves(I,oe.cluster_id,V,K,te):te<K?te++:I.push(he),I.length===V)break}return te}_createTree(I){const O=new l.av(I.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<I.length;V+=this.stride)O.add(I[V],I[V+1]);return O.finish(),O.data=I,O}_addTileFeatures(I,O,V,K,te,pe){for(const he of I){const oe=he*this.stride,ge=O[oe+we]>1;let Ie,Me,Ne;if(ge)Ie=yt(O,oe,this.clusterProps),Me=O[oe],Ne=O[oe+1];else{const ot=this.points[O[oe+Ye]];Ie=ot.properties;const[gt,At]=ot.geometry.coordinates;Me=_t(gt),Ne=ur(At)}const pt={type:1,geometry:[[Math.round(this.options.extent*(Me*te-V)),Math.round(this.options.extent*(Ne*te-K))]],tags:Ie};let wt;wt=ge||this.options.generateId?O[oe+Ye]:this.points[O[oe+Ye]].id,wt!==void 0&&(pt.id=wt),pe.features.push(pt)}}_limitZoom(I){return Math.max(this.options.minZoom,Math.min(Math.floor(+I),this.options.maxZoom+1))}_cluster(I,O){const{radius:V,extent:K,reduce:te,minPoints:pe}=this.options,he=V/(K*Math.pow(2,O)),oe=I.data,ge=[],Ie=this.stride;for(let Me=0;Me<oe.length;Me+=Ie){if(oe[Me+2]<=O)continue;oe[Me+2]=O;const Ne=oe[Me],pt=oe[Me+1],wt=I.within(oe[Me],oe[Me+1],he),ot=oe[Me+we];let gt=ot;for(const At of wt){const rr=At*Ie;oe[rr+2]>O&&(gt+=oe[rr+we])}if(gt>ot&&gt>=pe){let At,rr=Ne*ot,lr=pt*ot,Zt=-1;const Gt=((Me/Ie|0)<<5)+(O+1)+this.points.length;for(const ks of wt){const hr=ks*Ie;if(oe[hr+2]<=O)continue;oe[hr+2]=O;const Gr=oe[hr+we];rr+=oe[hr]*Gr,lr+=oe[hr+1]*Gr,oe[hr+4]=Gt,te&&(At||(At=this._map(oe,Me,!0),Zt=this.clusterProps.length,this.clusterProps.push(At)),te(At,this._map(oe,hr)))}oe[Me+4]=Gt,ge.push(rr/gt,lr/gt,1/0,Gt,-1,gt),te&&ge.push(Zt)}else{for(let At=0;At<Ie;At++)ge.push(oe[Me+At]);if(gt>1)for(const At of wt){const rr=At*Ie;if(!(oe[rr+2]<=O)){oe[rr+2]=O;for(let lr=0;lr<Ie;lr++)ge.push(oe[rr+lr])}}}}return ge}_getOriginId(I){return I-this.points.length>>5}_getOriginZoom(I){return(I-this.points.length)%32}_map(I,O,V){if(I[O+we]>1){const pe=this.clusterProps[I[O+tt]];return V?Object.assign({},pe):pe}const K=this.points[I[O+Ye]].properties,te=this.options.map(K);return V&&te===K?Object.assign({},te):te}}function Ht(se,I,O){return{type:"Feature",id:se[I+Ye],properties:yt(se,I,O),geometry:{type:"Point",coordinates:[(V=se[I],360*(V-.5)),Ds(se[I+1])]}};var V}function yt(se,I,O){const V=se[I+we],K=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,te=se[I+tt],pe=te===-1?{}:Object.assign({},O[te]);return Object.assign(pe,{cluster:!0,cluster_id:se[I+Ye],point_count:V,point_count_abbreviated:K})}function _t(se){return se/360+.5}function ur(se){const I=Math.sin(se*Math.PI/180),O=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return O<0?0:O>1?1:O}function Ds(se){const I=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(I))/Math.PI-90}function It(se,I,O,V){for(var K,te=V,pe=O-I>>1,he=O-I,oe=se[I],ge=se[I+1],Ie=se[O],Me=se[O+1],Ne=I+3;Ne<O;Ne+=3){var pt=qr(se[Ne],se[Ne+1],oe,ge,Ie,Me);if(pt>te)K=Ne,te=pt;else if(pt===te){var wt=Math.abs(Ne-pe);wt<he&&(K=Ne,he=wt)}}te>V&&(K-I>3&&It(se,I,K,V),se[K+2]=te,O-K>3&&It(se,K,O,V))}function qr(se,I,O,V,K,te){var pe=K-O,he=te-V;if(pe!==0||he!==0){var oe=((se-O)*pe+(I-V)*he)/(pe*pe+he*he);oe>1?(O=K,V=te):oe>0&&(O+=pe*oe,V+=he*oe)}return(pe=se-O)*pe+(he=I-V)*he}function Fi(se,I,O,V){var K={id:se===void 0?null:se,type:I,geometry:O,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(te){var pe=te.geometry,he=te.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")kn(te,pe);else if(he==="Polygon"||he==="MultiLineString")for(var oe=0;oe<pe.length;oe++)kn(te,pe[oe]);else if(he==="MultiPolygon")for(oe=0;oe<pe.length;oe++)for(var ge=0;ge<pe[oe].length;ge++)kn(te,pe[oe][ge])}(K),K}function kn(se,I){for(var O=0;O<I.length;O+=3)se.minX=Math.min(se.minX,I[O]),se.minY=Math.min(se.minY,I[O+1]),se.maxX=Math.max(se.maxX,I[O]),se.maxY=Math.max(se.maxY,I[O+1])}function bi(se,I,O,V){if(I.geometry){var K=I.geometry.coordinates,te=I.geometry.type,pe=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),he=[],oe=I.id;if(O.promoteId?oe=I.properties[O.promoteId]:O.generateId&&(oe=V||0),te==="Point")rn(K,he);else if(te==="MultiPoint")for(var ge=0;ge<K.length;ge++)rn(K[ge],he);else if(te==="LineString")os(K,he,pe,!1);else if(te==="MultiLineString"){if(O.lineMetrics){for(ge=0;ge<K.length;ge++)os(K[ge],he=[],pe,!1),se.push(Fi(oe,"LineString",he,I.properties));return}sn(K,he,pe,!1)}else if(te==="Polygon")sn(K,he,pe,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(ge=0;ge<I.geometry.geometries.length;ge++)bi(se,{id:oe,geometry:I.geometry.geometries[ge],properties:I.properties},O,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<K.length;ge++){var Ie=[];sn(K[ge],Ie,pe,!0),he.push(Ie)}}se.push(Fi(oe,te,he,I.properties))}}function rn(se,I){I.push(Pe(se[0])),I.push(fs(se[1])),I.push(0)}function os(se,I,O,V){for(var K,te,pe=0,he=0;he<se.length;he++){var oe=Pe(se[he][0]),ge=fs(se[he][1]);I.push(oe),I.push(ge),I.push(0),he>0&&(pe+=V?(K*ge-oe*te)/2:Math.sqrt(Math.pow(oe-K,2)+Math.pow(ge-te,2))),K=oe,te=ge}var Ie=I.length-3;I[2]=1,It(I,0,Ie,O),I[Ie+2]=1,I.size=Math.abs(pe),I.start=0,I.end=I.size}function sn(se,I,O,V){for(var K=0;K<se.length;K++){var te=[];os(se[K],te,O,V),I.push(te)}}function Pe(se){return se/360+.5}function fs(se){var I=Math.sin(se*Math.PI/180),O=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return O<0?0:O>1?1:O}function ls(se,I,O,V,K,te,pe,he){if(V/=I,te>=(O/=I)&&pe<V)return se;if(pe<O||te>=V)return null;for(var oe=[],ge=0;ge<se.length;ge++){var Ie=se[ge],Me=Ie.geometry,Ne=Ie.type,pt=K===0?Ie.minX:Ie.minY,wt=K===0?Ie.maxX:Ie.maxY;if(pt>=O&&wt<V)oe.push(Ie);else if(!(wt<O||pt>=V)){var ot=[];if(Ne==="Point"||Ne==="MultiPoint")nr(Me,ot,O,V,K);else if(Ne==="LineString")Wt(Me,ot,O,V,K,!1,he.lineMetrics);else if(Ne==="MultiLineString")Zn(Me,ot,O,V,K,!1);else if(Ne==="Polygon")Zn(Me,ot,O,V,K,!0);else if(Ne==="MultiPolygon")for(var gt=0;gt<Me.length;gt++){var At=[];Zn(Me[gt],At,O,V,K,!0),At.length&&ot.push(At)}if(ot.length){if(he.lineMetrics&&Ne==="LineString"){for(gt=0;gt<ot.length;gt++)oe.push(Fi(Ie.id,Ne,ot[gt],Ie.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(ot.length===1?(Ne="LineString",ot=ot[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=ot.length===3?"Point":"MultiPoint"),oe.push(Fi(Ie.id,Ne,ot,Ie.tags))}}}return oe.length?oe:null}function nr(se,I,O,V,K){for(var te=0;te<se.length;te+=3){var pe=se[te+K];pe>=O&&pe<=V&&(I.push(se[te]),I.push(se[te+1]),I.push(se[te+2]))}}function Wt(se,I,O,V,K,te,pe){for(var he,oe,ge=wi(se),Ie=K===0?ma:Hn,Me=se.start,Ne=0;Ne<se.length-3;Ne+=3){var pt=se[Ne],wt=se[Ne+1],ot=se[Ne+2],gt=se[Ne+3],At=se[Ne+4],rr=K===0?pt:wt,lr=K===0?gt:At,Zt=!1;pe&&(he=Math.sqrt(Math.pow(pt-gt,2)+Math.pow(wt-At,2))),rr<O?lr>O&&(oe=Ie(ge,pt,wt,gt,At,O),pe&&(ge.start=Me+he*oe)):rr>V?lr<V&&(oe=Ie(ge,pt,wt,gt,At,V),pe&&(ge.start=Me+he*oe)):$i(ge,pt,wt,ot),lr<O&&rr>=O&&(oe=Ie(ge,pt,wt,gt,At,O),Zt=!0),lr>V&&rr<=V&&(oe=Ie(ge,pt,wt,gt,At,V),Zt=!0),!te&&Zt&&(pe&&(ge.end=Me+he*oe),I.push(ge),ge=wi(se)),pe&&(Me+=he)}var Gt=se.length-3;pt=se[Gt],wt=se[Gt+1],ot=se[Gt+2],(rr=K===0?pt:wt)>=O&&rr<=V&&$i(ge,pt,wt,ot),Gt=ge.length-3,te&&Gt>=3&&(ge[Gt]!==ge[0]||ge[Gt+1]!==ge[1])&&$i(ge,ge[0],ge[1],ge[2]),ge.length&&I.push(ge)}function wi(se){var I=[];return I.size=se.size,I.start=se.start,I.end=se.end,I}function Zn(se,I,O,V,K,te){for(var pe=0;pe<se.length;pe++)Wt(se[pe],I,O,V,K,te,!1)}function $i(se,I,O,V){se.push(I),se.push(O),se.push(V)}function ma(se,I,O,V,K,te){var pe=(te-I)/(V-I);return se.push(te),se.push(O+(K-O)*pe),se.push(1),pe}function Hn(se,I,O,V,K,te){var pe=(te-O)/(K-O);return se.push(I+(V-I)*pe),se.push(te),se.push(1),pe}function Ui(se,I){for(var O=[],V=0;V<se.length;V++){var K,te=se[V],pe=te.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")K=Tn(te.geometry,I);else if(pe==="MultiLineString"||pe==="Polygon"){K=[];for(var he=0;he<te.geometry.length;he++)K.push(Tn(te.geometry[he],I))}else if(pe==="MultiPolygon")for(K=[],he=0;he<te.geometry.length;he++){for(var oe=[],ge=0;ge<te.geometry[he].length;ge++)oe.push(Tn(te.geometry[he][ge],I));K.push(oe)}O.push(Fi(te.id,pe,K,te.tags))}return O}function Tn(se,I){var O=[];O.size=se.size,se.start!==void 0&&(O.start=se.start,O.end=se.end);for(var V=0;V<se.length;V+=3)O.push(se[V]+I,se[V+1],se[V+2]);return O}function Ve(se,I){if(se.transformed)return se;var O,V,K,te=1<<se.z,pe=se.x,he=se.y;for(O=0;O<se.features.length;O++){var oe=se.features[O],ge=oe.geometry,Ie=oe.type;if(oe.geometry=[],Ie===1)for(V=0;V<ge.length;V+=2)oe.geometry.push(si(ge[V],ge[V+1],I,te,pe,he));else for(V=0;V<ge.length;V++){var Me=[];for(K=0;K<ge[V].length;K+=2)Me.push(si(ge[V][K],ge[V][K+1],I,te,pe,he));oe.geometry.push(Me)}}return se.transformed=!0,se}function si(se,I,O,V,K,te){return[Math.round(O*(se*V-K)),Math.round(O*(I*V-te))]}function pr(se,I,O,V,K){for(var te=I===K.maxZoom?0:K.tolerance/((1<<I)*K.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:V,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<se.length;he++){pe.numFeatures++,En(pe,se[he],te,K);var oe=se[he].minX,ge=se[he].minY,Ie=se[he].maxX,Me=se[he].maxY;oe<pe.minX&&(pe.minX=oe),ge<pe.minY&&(pe.minY=ge),Ie>pe.maxX&&(pe.maxX=Ie),Me>pe.maxY&&(pe.maxY=Me)}return pe}function En(se,I,O,V){var K=I.geometry,te=I.type,pe=[];if(te==="Point"||te==="MultiPoint")for(var he=0;he<K.length;he+=3)pe.push(K[he]),pe.push(K[he+1]),se.numPoints++,se.numSimplified++;else if(te==="LineString")Vi(pe,K,se,O,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(he=0;he<K.length;he++)Vi(pe,K[he],se,O,te==="Polygon",he===0);else if(te==="MultiPolygon")for(var oe=0;oe<K.length;oe++){var ge=K[oe];for(he=0;he<ge.length;he++)Vi(pe,ge[he],se,O,!0,he===0)}if(pe.length){var Ie=I.tags||null;if(te==="LineString"&&V.lineMetrics){for(var Me in Ie={},I.tags)Ie[Me]=I.tags[Me];Ie.mapbox_clip_start=K.start/K.size,Ie.mapbox_clip_end=K.end/K.size}var Ne={geometry:pe,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:Ie};I.id!==null&&(Ne.id=I.id),se.features.push(Ne)}}function Vi(se,I,O,V,K,te){var pe=V*V;if(V>0&&I.size<(K?pe:V))O.numPoints+=I.length/3;else{for(var he=[],oe=0;oe<I.length;oe+=3)(V===0||I[oe+2]>pe)&&(O.numSimplified++,he.push(I[oe]),he.push(I[oe+1])),O.numPoints++;K&&function(ge,Ie){for(var Me=0,Ne=0,pt=ge.length,wt=pt-2;Ne<pt;wt=Ne,Ne+=2)Me+=(ge[Ne]-ge[wt])*(ge[Ne+1]+ge[wt+1]);if(Me>0===Ie)for(Ne=0,pt=ge.length;Ne<pt/2;Ne+=2){var ot=ge[Ne],gt=ge[Ne+1];ge[Ne]=ge[pt-2-Ne],ge[Ne+1]=ge[pt-1-Ne],ge[pt-2-Ne]=ot,ge[pt-1-Ne]=gt}}(he,te),se.push(he)}}function Ge(se,I){var O=(I=this.options=function(K,te){for(var pe in te)K[pe]=te[pe];return K}(Object.create(this.options),I)).debug;if(O&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");var V=function(K,te){var pe=[];if(K.type==="FeatureCollection")for(var he=0;he<K.features.length;he++)bi(pe,K.features[he],te,he);else bi(pe,K.type==="Feature"?K:{geometry:K},te);return pe}(se,I);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),V=function(K,te){var pe=te.buffer/te.extent,he=K,oe=ls(K,1,-1-pe,pe,0,-1,2,te),ge=ls(K,1,1-pe,2+pe,0,-1,2,te);return(oe||ge)&&(he=ls(K,1,-pe,1+pe,0,-1,2,te)||[],oe&&(he=Ui(oe,1).concat(he)),ge&&(he=he.concat(Ui(ge,-1)))),he}(V,I),V.length&&this.splitTile(V,0,0,0),O&&(V.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mt(se,I,O){return 32*((1<<se)*O+I)+se}function Tt(se,I){return I?se.properties[I]:se.id}function ps(se,I){if(se==null)return!0;if(se.type==="Feature")return Tt(se,I)!=null;if(se.type==="FeatureCollection"){const O=new Set;for(const V of se.features){const K=Tt(V,I);if(K==null||O.has(K))return!1;O.add(K)}return!0}return!1}function Si(se,I){const O=new Map;if(se!=null)if(se.type==="Feature")O.set(Tt(se,I),se);else for(const V of se.features)O.set(Tt(V,I),V);return O}Ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ge.prototype.splitTile=function(se,I,O,V,K,te,pe){for(var he=[se,I,O,V],oe=this.options,ge=oe.debug;he.length;){V=he.pop(),O=he.pop(),I=he.pop(),se=he.pop();var Ie=1<<I,Me=Mt(I,O,V),Ne=this.tiles[Me];if(!Ne&&(ge>1&&console.time("creation"),Ne=this.tiles[Me]=pr(se,I,O,V,oe),this.tileCoords.push({z:I,x:O,y:V}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,O,V,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var pt="z"+I;this.stats[pt]=(this.stats[pt]||0)+1,this.total++}if(Ne.source=se,K){if(I===oe.maxZoom||I===K)continue;var wt=1<<K-I;if(O!==Math.floor(te/wt)||V!==Math.floor(pe/wt))continue}else if(I===oe.indexMaxZoom||Ne.numPoints<=oe.indexMaxPoints)continue;if(Ne.source=null,se.length!==0){ge>1&&console.time("clipping");var ot,gt,At,rr,lr,Zt,Gt=.5*oe.buffer/oe.extent,ks=.5-Gt,hr=.5+Gt,Gr=1+Gt;ot=gt=At=rr=null,lr=ls(se,Ie,O-Gt,O+hr,0,Ne.minX,Ne.maxX,oe),Zt=ls(se,Ie,O+ks,O+Gr,0,Ne.minX,Ne.maxX,oe),se=null,lr&&(ot=ls(lr,Ie,V-Gt,V+hr,1,Ne.minY,Ne.maxY,oe),gt=ls(lr,Ie,V+ks,V+Gr,1,Ne.minY,Ne.maxY,oe),lr=null),Zt&&(At=ls(Zt,Ie,V-Gt,V+hr,1,Ne.minY,Ne.maxY,oe),rr=ls(Zt,Ie,V+ks,V+Gr,1,Ne.minY,Ne.maxY,oe),Zt=null),ge>1&&console.timeEnd("clipping"),he.push(ot||[],I+1,2*O,2*V),he.push(gt||[],I+1,2*O,2*V+1),he.push(At||[],I+1,2*O+1,2*V),he.push(rr||[],I+1,2*O+1,2*V+1)}}},Ge.prototype.getTile=function(se,I,O){var V=this.options,K=V.extent,te=V.debug;if(se<0||se>24)return null;var pe=1<<se,he=Mt(se,I=(I%pe+pe)%pe,O);if(this.tiles[he])return Ve(this.tiles[he],K);te>1&&console.log("drilling down to z%d-%d-%d",se,I,O);for(var oe,ge=se,Ie=I,Me=O;!oe&&ge>0;)ge--,Ie=Math.floor(Ie/2),Me=Math.floor(Me/2),oe=this.tiles[Mt(ge,Ie,Me)];return oe&&oe.source?(te>1&&console.log("found parent tile z%d-%d-%d",ge,Ie,Me),te>1&&console.time("drilling down"),this.splitTile(oe.source,ge,Ie,Me,se,I,O),te>1&&console.timeEnd("drilling down"),this.tiles[he]?Ve(this.tiles[he],K):null):null};class Pt extends Z{constructor(I,O,V,K){super(I,O,V),this._dataUpdateable=new Map,this.loadGeoJSON=(te,pe)=>{const{promoteId:he}=te;if(te.request)return l.f(te.request,(oe,ge,Ie,Me)=>{this._dataUpdateable=ps(ge,he)?Si(ge,he):void 0,pe(oe,ge,Ie,Me)});if(typeof te.data=="string")try{const oe=JSON.parse(te.data);this._dataUpdateable=ps(oe,he)?Si(oe,he):void 0,pe(null,oe)}catch{pe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}else te.dataDiff?this._dataUpdateable?(function(oe,ge,Ie){var Me,Ne,pt,wt;if(ge.removeAll&&oe.clear(),ge.remove)for(const ot of ge.remove)oe.delete(ot);if(ge.add)for(const ot of ge.add){const gt=Tt(ot,Ie);gt!=null&&oe.set(gt,ot)}if(ge.update)for(const ot of ge.update){let gt=oe.get(ot.id);if(gt==null)continue;const At=!ot.removeAllProperties&&(((Me=ot.removeProperties)===null||Me===void 0?void 0:Me.length)>0||((Ne=ot.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0);if((ot.newGeometry||ot.removeAllProperties||At)&&(gt=Object.assign({},gt),oe.set(ot.id,gt),At&&(gt.properties=Object.assign({},gt.properties))),ot.newGeometry&&(gt.geometry=ot.newGeometry),ot.removeAllProperties)gt.properties={};else if(((pt=ot.removeProperties)===null||pt===void 0?void 0:pt.length)>0)for(const rr of ot.removeProperties)Object.prototype.hasOwnProperty.call(gt.properties,rr)&&delete gt.properties[rr];if(((wt=ot.addOrUpdateProperties)===null||wt===void 0?void 0:wt.length)>0)for(const{key:rr,value:lr}of ot.addOrUpdateProperties)gt.properties[rr]=lr}}(this._dataUpdateable,te.dataDiff,he),pe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):pe(new Error(`Cannot update existing geojson data in ${te.source}`)):pe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,K&&(this.loadGeoJSON=K)}loadGeoJSONTile(I,O){const V=I.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const K=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!K)return O(null,null);const te=new class{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=he.length,this._features=he}feature(he){return new class{constructor(oe){this._feature=oe,this.extent=l.N,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const ge of this._feature.geometry)oe.push([new l.P(ge[0],ge[1])]);return oe}{const oe=[];for(const ge of this._feature.geometry){const Ie=[];for(const Me of ge)Ie.push(new l.P(Me[0],Me[1]));oe.push(Ie)}return oe}}toGeoJSON(oe,ge,Ie){return H.call(this,oe,ge,Ie)}}(this._features[he])}}(K.features);let pe=st(te);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),O(null,{vectorTile:te,rawData:pe.buffer})}loadData(I,O){var V;(V=this._pendingRequest)===null||V===void 0||V.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(I&&I.request&&I.request.collectResourceTiming)&&new l.bu(I.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(I,(te,pe)=>{if(delete this._pendingCallback,delete this._pendingRequest,te||!pe)return O(te);if(typeof pe!="object")return O(new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`));{G(pe,!0);try{if(I.filter){const oe=l.bC(I.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(oe.result==="error")throw new Error(oe.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));pe={type:"FeatureCollection",features:pe.features.filter(Ie=>oe.value.evaluate({zoom:0},Ie))}}this._geoJSONIndex=I.cluster?new kt(function({superclusterOptions:oe,clusterProperties:ge}){if(!ge||!oe)return oe;const Ie={},Me={},Ne={accumulated:null,zoom:0},pt={properties:null},wt=Object.keys(ge);for(const ot of wt){const[gt,At]=ge[ot],rr=l.bC(At),lr=l.bC(typeof gt=="string"?[gt,["accumulated"],["get",ot]]:gt);Ie[ot]=rr.value,Me[ot]=lr.value}return oe.map=ot=>{pt.properties=ot;const gt={};for(const At of wt)gt[At]=Ie[At].evaluate(Ne,pt);return gt},oe.reduce=(ot,gt)=>{pt.properties=gt;for(const At of wt)Ne.accumulated=ot[At],ot[At]=Me[At].evaluate(Ne,pt)},oe}(I)).load(pe.features):function(oe,ge){return new Ge(oe,ge)}(pe,I.geojsonVtOptions)}catch(oe){return O(oe)}this.loaded={};const he={};if(K){const oe=K.finish();oe&&(he.resourceTiming={},he.resourceTiming[I.source]=JSON.parse(JSON.stringify(oe)))}O(null,he)}})}reloadTile(I,O){const V=this.loaded;return V&&V[I.uid]?super.reloadTile(I,O):this.loadTile(I,O)}removeSource(I,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(I,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(I.clusterId))}catch(V){O(V)}}getClusterChildren(I,O){try{O(null,this._geoJSONIndex.getChildren(I.clusterId))}catch(V){O(V)}}getClusterLeaves(I,O){try{O(null,this._geoJSONIndex.getLeaves(I.clusterId,I.limit,I.offset))}catch(V){O(V)}}}class qi{constructor(I){this.self=I,this.actor=new l.C(I,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Z,geojson:Pt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,V)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=V},this.self.registerRTLTextPlugin=O=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=O.applyArabicShaping,l.bD.processBidirectionalText=O.processBidirectionalText,l.bD.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(I,O){this.referrer=O}setImages(I,O,V){this.availableImages[I]=O;for(const K in this.workerSources[I]){const te=this.workerSources[I][K];for(const pe in te)te[pe].availableImages=O}V()}setLayers(I,O,V){this.getLayerIndex(I).replace(O),V()}updateLayers(I,O,V){this.getLayerIndex(I).update(O.layers,O.removedIds),V()}loadTile(I,O,V){this.getWorkerSource(I,O.type,O.source).loadTile(O,V)}loadDEMTile(I,O,V){this.getDEMWorkerSource(I,O.source).loadTile(O,V)}reloadTile(I,O,V){this.getWorkerSource(I,O.type,O.source).reloadTile(O,V)}abortTile(I,O,V){this.getWorkerSource(I,O.type,O.source).abortTile(O,V)}removeTile(I,O,V){this.getWorkerSource(I,O.type,O.source).removeTile(O,V)}removeDEMTile(I,O){this.getDEMWorkerSource(I,O.source).removeTile(O)}removeSource(I,O,V){if(!this.workerSources[I]||!this.workerSources[I][O.type]||!this.workerSources[I][O.type][O.source])return;const K=this.workerSources[I][O.type][O.source];delete this.workerSources[I][O.type][O.source],K.removeSource!==void 0?K.removeSource(O,V):V()}loadWorkerSource(I,O,V){try{this.self.importScripts(O.url),V()}catch(K){V(K.toString())}}syncRTLPluginState(I,O,V){try{l.bD.setState(O);const K=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&K!=null){this.self.importScripts(K);const te=l.bD.isParsed();V(te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),te)}}catch(K){V(K.toString())}}getAvailableImages(I){let O=this.availableImages[I];return O||(O=[]),O}getLayerIndex(I){let O=this.layerIndexes[I];return O||(O=this.layerIndexes[I]=new w),O}getWorkerSource(I,O,V){return this.workerSources[I]||(this.workerSources[I]={}),this.workerSources[I][O]||(this.workerSources[I][O]={}),this.workerSources[I][O][V]||(this.workerSources[I][O][V]=new this.workerSourceTypes[O]({send:(K,te,pe)=>{this.actor.send(K,te,pe,I)}},this.getLayerIndex(I),this.getAvailableImages(I))),this.workerSources[I][O][V]}getDEMWorkerSource(I,O){return this.demWorkerSources[I]||(this.demWorkerSources[I]={}),this.demWorkerSources[I][O]||(this.demWorkerSources[I][O]=new Y),this.demWorkerSources[I][O]}}return l.i()&&(self.worker=new qi(self)),qi}),d(["./shared"],function(l){var w="3.6.2";class k{static testProp(i){if(!k.docStyle)return i[0];for(let u=0;u<i.length;u++)if(i[u]in k.docStyle)return i[u];return i[0]}static create(i,u,f){const g=window.document.createElement(i);return u!==void 0&&(g.className=u),f&&f.appendChild(g),g}static createNS(i,u){return window.document.createElementNS(i,u)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(i,u){i.style[k.transformProp]=u}static addEventListener(i,u,f,g={}){i.addEventListener(u,f,"passive"in g?g:g.capture)}static removeEventListener(i,u,f,g={}){i.removeEventListener(u,f,"passive"in g?g:g.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static mousePos(i,u){const f=i.getBoundingClientRect();return new l.P(u.clientX-f.left-i.clientLeft,u.clientY-f.top-i.clientTop)}static touchPos(i,u){const f=i.getBoundingClientRect(),g=[];for(let _=0;_<u.length;_++)g.push(new l.P(u[_].clientX-f.left-i.clientLeft,u[_].clientY-f.top-i.clientTop));return g}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(y){!Z&&L&&(Y?ce(y):j=y)}};let j,L,Z=!1,Y=!1;function ce(y){const i=y.createTexture();y.bindTexture(y.TEXTURE_2D,i);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,L),y.isContextLost())return;P.supported=!0}catch{}y.deleteTexture(i),Z=!0}var de,G;typeof document<"u"&&(L=document.createElement("img"),L.onload=function(){j&&ce(j),j=null,Y=!0},L.onerror=function(){Z=!0,j=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let i,u,f,g;y.resetRequestQueue=()=>{i=[],u=0,f=0,g={}},y.addThrottleControl=D=>{const R=f++;return g[R]=D,R},y.removeThrottleControl=D=>{delete g[D],E()},y.getImage=(D,R,z=!0)=>{P.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*");const $={requestParameters:D,supportImageRefresh:z,callback:R,cancelled:!1,completed:!1,cancel:()=>{$.completed||$.cancelled||($.cancelled=!0,$.innerRequest&&($.innerRequest.cancel(),u--),E())}};return i.push($),E(),$};const _=D=>{const{requestParameters:R,supportImageRefresh:z,callback:$}=D;return l.e(R,{type:"image"}),(z!==!1||l.i()||l.g(R.url)||R.headers&&!Object.keys(R.headers).reduce((ee,Q)=>ee&&Q==="accept",!0)?l.m:A)(R,(ee,Q,ie,X)=>{T(D,$,ee,Q,ie,X)})},T=(D,R,z,$,ee,Q)=>{z?R(z):$ instanceof HTMLImageElement||l.a($)?R(null,$):$&&((ie,X)=>{typeof createImageBitmap=="function"?l.b(ie,X):l.d(ie,X)})($,(ie,X)=>{ie!=null?R(ie):X!=null&&R(null,X,{cacheControl:ee,expires:Q})}),D.cancelled||(D.completed=!0,u--,E())},E=()=>{const D=(()=>{const R=Object.keys(g);let z=!1;if(R.length>0){for(const $ of R)if(z=g[$](),z)break}return z})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=u;R<D&&i.length>0;R++){const z=i.shift();if(z.cancelled){R--;continue}const $=_(z);u++,z.innerRequest=$}},A=(D,R)=>{const z=new Image,$=D.url;let ee=!1;const Q=D.credentials;return Q&&Q==="include"?z.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!l.s($))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{R(null,z),z.onerror=z.onload=null},z.onerror=()=>{ee||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=$,{cancel:()=>{ee=!0,z.src=""}}}}(de||(de={})),de.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(G||(G={}));class H{constructor(i){this._transformRequestFn=i}transformRequest(i,u){return this._transformRequestFn&&this._transformRequestFn(i,u)||{url:i}}normalizeSpriteURL(i,u,f){const g=function(_){const T=_.match(W);if(!T)throw new Error(`Unable to parse URL "${_}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(i);return g.path+=`${u}${f}`,function(_){const T=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${T}`}(g)}setTransformRequest(i){this._transformRequestFn=i}}const W=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ue(y){var i=new l.A(3);return i[0]=y[0],i[1]=y[1],i[2]=y[2],i}var me,be=function(y,i,u){return y[0]=i[0]-u[0],y[1]=i[1]-u[1],y[2]=i[2]-u[2],y};me=new l.A(3),l.A!=Float32Array&&(me[0]=0,me[1]=0,me[2]=0);var Ce=function(y){var i=y[0],u=y[1];return i*i+u*u};function Te(y){const i=[];if(typeof y=="string")i.push({id:"default",url:y});else if(y&&y.length>0){const u=[];for(const{id:f,url:g}of y){const _=`${f}${g}`;u.indexOf(_)===-1&&(u.push(_),i.push({id:f,url:g}))}}return i}function rt(y,i,u,f,g){if(f)return void y(f);if(g!==Object.values(i).length||g!==Object.values(u).length)return;const _={};for(const T in i){_[T]={};const E=l.h.getImageCanvasContext(u[T]),A=i[T];for(const D in A){const{width:R,height:z,x:$,y:ee,sdf:Q,pixelRatio:ie,stretchX:X,stretchY:ye,content:Se}=A[D];_[T][D]={data:null,pixelRatio:ie,sdf:Q,stretchX:X,stretchY:ye,content:Se,spriteData:{width:R,height:z,x:$,y:ee,context:E}}}}y(null,_)}(function(){var y=new l.A(2);l.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Ue{constructor(i,u,f,g){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(u,g)}update(i,u,f){const{width:g,height:_}=i,T=!(this.size&&this.size[0]===g&&this.size[1]===_||f),{context:E}=this,{gl:A}=E;if(this.useMipmap=!!(u&&u.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!u||u.premultiply!==!1)),T)this.size=[g,_],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.a(i)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,i):A.texImage2D(A.TEXTURE_2D,0,this.format,g,_,0,this.format,A.UNSIGNED_BYTE,i.data);else{const{x:D,y:R}=f||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||l.a(i)?A.texSubImage2D(A.TEXTURE_2D,0,D,R,A.RGBA,A.UNSIGNED_BYTE,i):A.texSubImage2D(A.TEXTURE_2D,0,D,R,g,_,A.RGBA,A.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(i,u,f){const{context:g}=this,{gl:_}=g;_.bindTexture(_.TEXTURE_2D,this.texture),f!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,f||i),this.filter=i),u!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function St(y){const{userImage:i}=y;return!!(i&&i.render&&i.render())&&(y.data.replace(new Uint8Array(i.data.buffer)),!0)}class Oe extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:u,callback:f}of this.requestors)this._notify(u,f);this.requestors=[]}}getImage(i){const u=this.images[i];if(u&&!u.data&&u.spriteData){const f=u.spriteData;u.data=new l.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),u.spriteData=null}return u}addImage(i,u){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,u)&&(this.images[i]=u)}_validate(i,u){let f=!0;const g=u.data||u.spriteData;return this._validateStretch(u.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchX" value`))),f=!1),this._validateStretch(u.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "stretchY" value`))),f=!1),this._validateContent(u.content,u)||(this.fire(new l.j(new Error(`Image "${i}" has invalid "content" value`))),f=!1),f}_validateStretch(i,u){if(!i)return!0;let f=0;for(const g of i){if(g[0]<f||g[1]<g[0]||u<g[1])return!1;f=g[1]}return!0}_validateContent(i,u){if(!i)return!0;if(i.length!==4)return!1;const f=u.spriteData,g=f&&f.width||u.data.width,_=f&&f.height||u.data.height;return!(i[0]<0||g<i[0]||i[1]<0||_<i[1]||i[2]<0||g<i[2]||i[3]<0||_<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,u,f=!0){const g=this.getImage(i);if(f&&(g.data.width!==u.data.width||g.data.height!==u.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=g.version+1,this.images[i]=u,this.updatedImages[i]=!0}removeImage(i){const u=this.images[i];delete this.images[i],delete this.patterns[i],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,u){let f=!0;if(!this.isLoaded())for(const g of i)this.images[g]||(f=!1);this.isLoaded()||f?this._notify(i,u):this.requestors.push({ids:i,callback:u})}_notify(i,u){const f={};for(const g of i){let _=this.getImage(g);_||(this.fire(new l.k("styleimagemissing",{id:g})),_=this.getImage(g)),_?f[g]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:l.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,f)}getPixelSize(){const{width:i,height:u}=this.atlasImage;return{width:i,height:u}}getPattern(i){const u=this.patterns[i],f=this.getImage(i);if(!f)return null;if(u&&u.position.version===f.version)return u.position;if(u)u.position.version=f.version;else{const g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},_=new l.I(g,f);this.patterns[i]={bin:g,position:_}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const u=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ue(i,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const _ in this.patterns)i.push(this.patterns[_].bin);const{w:u,h:f}=l.p(i),g=this.atlasImage;g.resize({width:u||1,height:f||1});for(const _ in this.patterns){const{bin:T}=this.patterns[_],E=T.x+1,A=T.y+1,D=this.getImage(_).data,R=D.width,z=D.height;l.R.copy(D,g,{x:0,y:0},{x:E,y:A},{width:R,height:z}),l.R.copy(D,g,{x:0,y:z-1},{x:E,y:A-1},{width:R,height:1}),l.R.copy(D,g,{x:0,y:0},{x:E,y:A+z},{width:R,height:1}),l.R.copy(D,g,{x:R-1,y:0},{x:E-1,y:A},{width:1,height:z}),l.R.copy(D,g,{x:0,y:0},{x:E+R,y:A},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const u of i){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const f=this.getImage(u);f||l.w(`Image with ID: "${u}" was not found`),St(f)&&this.updateImage(u,f)}}}const it=1e20;function qe(y,i,u,f,g,_,T,E,A){for(let D=i;D<i+f;D++)Et(y,u*_+D,_,g,T,E,A);for(let D=u;D<u+g;D++)Et(y,D*_+i,1,f,T,E,A)}function Et(y,i,u,f,g,_,T){_[0]=0,T[0]=-it,T[1]=it,g[0]=y[i];for(let E=1,A=0,D=0;E<f;E++){g[E]=y[i+E*u];const R=E*E;do{const z=_[A];D=(g[E]-g[z]+R-z*z)/(E-z)/2}while(D<=T[A]&&--A>-1);A++,_[A]=E,T[A]=D,T[A+1]=it}for(let E=0,A=0;E<f;E++){for(;T[A+1]<E;)A++;const D=_[A],R=E-D;y[i+E*u]=g[D]+R*R}}class ir{constructor(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}}setURL(i){this.url=i}getGlyphs(i,u){const f=[];for(const g in i)for(const _ of i[g])f.push({stack:g,id:_});l.o(f,({stack:g,id:_},T)=>{let E=this.entries[g];E||(E=this.entries[g]={glyphs:{},requests:{},ranges:{}});let A=E.glyphs[_];if(A!==void 0)return void T(null,{stack:g,id:_,glyph:A});if(A=this._tinySDF(E,g,_),A)return E.glyphs[_]=A,void T(null,{stack:g,id:_,glyph:A});const D=Math.floor(_/256);if(256*D>65535)return void T(new Error("glyphs > 65535 not supported"));if(E.ranges[D])return void T(null,{stack:g,id:_,glyph:A});if(!this.url)return void T(new Error("glyphsUrl is not set"));let R=E.requests[D];R||(R=E.requests[D]=[],ir.loadGlyphRange(g,D,this.url,this.requestManager,(z,$)=>{if($){for(const ee in $)this._doesCharSupportLocalGlyph(+ee)||(E.glyphs[+ee]=$[+ee]);E.ranges[D]=!0}for(const ee of R)ee(z,$);delete E.requests[D]})),R.push((z,$)=>{z?T(z):$&&T(null,{stack:g,id:_,glyph:$[_]||null})})},(g,_)=>{if(g)u(g);else if(_){const T={};for(const{stack:E,id:A,glyph:D}of _)(T[E]||(T[E]={}))[A]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};u(null,T)}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](i)||l.u["Hangul Syllables"](i)||l.u.Hiragana(i)||l.u.Katakana(i))}_tinySDF(i,u,f){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let _=i.tinySDF;if(!_){let E="400";/bold/i.test(u)?E="900":/medium/i.test(u)?E="500":/light/i.test(u)&&(E="200"),_=i.tinySDF=new ir.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:E})}const T=_.draw(String.fromCharCode(f));return{id:f,bitmap:new l.q({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}ir.loadGlyphRange=function(y,i,u,f,g){const _=256*i,T=_+255,E=f.transformRequest(u.replace("{fontstack}",y).replace("{range}",`${_}-${T}`),G.Glyphs);l.l(E,(A,D)=>{if(A)g(A);else if(D){const R={};for(const z of l.n(D))R[z.id]=z;g(null,R)}})},ir.TinySDF=class{constructor({fontSize:y=24,buffer:i=3,radius:u=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:_="normal",fontStyle:T="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=u;const E=this.size=y+4*i,A=this._createCanvas(E),D=this.ctx=A.getContext("2d",{willReadFrequently:!0});D.font=`${T} ${_} ${y}px ${g}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(y){const i=document.createElement("canvas");return i.width=i.height=y,i}draw(y){const{width:i,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:_}=this.ctx.measureText(y),T=Math.ceil(u),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-g))),A=Math.min(this.size-this.buffer,T+Math.ceil(f)),D=E+2*this.buffer,R=A+2*this.buffer,z=Math.max(D*R,0),$=new Uint8ClampedArray(z),ee={data:$,width:D,height:R,glyphWidth:E,glyphHeight:A,glyphTop:T,glyphLeft:0,glyphAdvance:i};if(E===0||A===0)return ee;const{ctx:Q,buffer:ie,gridInner:X,gridOuter:ye}=this;Q.clearRect(ie,ie,E,A),Q.fillText(y,ie,ie+T);const Se=Q.getImageData(ie,ie,E,A);ye.fill(it,0,z),X.fill(0,0,z);for(let ae=0;ae<A;ae++)for(let _e=0;_e<E;_e++){const Ee=Se.data[4*(ae*E+_e)+3]/255;if(Ee===0)continue;const Ae=(ae+ie)*D+_e+ie;if(Ee===1)ye[Ae]=0,X[Ae]=it;else{const je=.5-Ee;ye[Ae]=je>0?je*je:0,X[Ae]=je<0?je*je:0}}qe(ye,0,0,D,R,D,this.f,this.v,this.z),qe(X,ie,ie,E,A,D,this.f,this.v,this.z);for(let ae=0;ae<z;ae++){const _e=Math.sqrt(ye[ae])-Math.sqrt(X[ae]);$[ae]=Math.round(255-255*(_e/this.radius+this.cutoff))}return ee}};class vt{constructor(){this.specification=l.v.light.position}possiblyEvaluate(i,u){return l.z(i.expression.evaluate(u))}interpolate(i,u,f){return{x:l.B.number(i.x,u.x,f),y:l.B.number(i.y,u.y,f),z:l.B.number(i.z,u.z,f)}}}let Be;class st extends l.E{constructor(i){super(),Be=Be||new l.r({anchor:new l.D(l.v.light.anchor),position:new vt,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Be),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,u={}){if(!this._validate(l.t,i,u))for(const f in i){const g=i[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,f){return(!f||f.validate!==!1)&&l.x(this,i.call(l.y,l.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class Fe{constructor(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,u){const f=i.join(",")+String(u);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(i,u)),this.dashEntry[f]}getDashRanges(i,u,f){const g=[];let _=i.length%2==1?-i[i.length-1]*f:0,T=i[0]*f,E=!0;g.push({left:_,right:T,isDash:E,zeroLength:i[0]===0});let A=i[0];for(let D=1;D<i.length;D++){E=!E;const R=i[D];_=A*f,A+=R,T=A*f,g.push({left:_,right:T,isDash:E,zeroLength:R===0})}return g}addRoundDash(i,u,f){const g=u/2;for(let _=-f;_<=f;_++){const T=this.width*(this.nextRow+f+_);let E=0,A=i[E];for(let D=0;D<this.width;D++){D/A.right>1&&(A=i[++E]);const R=Math.abs(D-A.left),z=Math.abs(D-A.right),$=Math.min(R,z);let ee;const Q=_/f*(g+1);if(A.isDash){const ie=g-Math.abs(Q);ee=Math.sqrt($*$+ie*ie)}else ee=g-Math.sqrt($*$+Q*Q);this.data[T+D]=Math.max(0,Math.min(255,ee+128))}}}addRegularDash(i){for(let E=i.length-1;E>=0;--E){const A=i[E],D=i[E+1];A.zeroLength?i.splice(E,1):D&&D.isDash===A.isDash&&(D.left=A.left,i.splice(E,1))}const u=i[0],f=i[i.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);const g=this.width*this.nextRow;let _=0,T=i[_];for(let E=0;E<this.width;E++){E/T.right>1&&(T=i[++_]);const A=Math.abs(E-T.left),D=Math.abs(E-T.right),R=Math.min(A,D);this.data[g+E]=Math.max(0,Math.min(255,(T.isDash?R:-R)+128))}}addDash(i,u){const f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let _=0;for(let E=0;E<i.length;E++)_+=i[E];if(_!==0){const E=this.width/_,A=this.getDashRanges(i,this.width,E);u?this.addRoundDash(A,E,f):this.addRegularDash(A)}const T={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:_};return this.nextRow+=g,this.dirty=!0,T}bind(i){const u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}class Ct{constructor(i,u,f){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=f;const g=this.workerPool.acquire(f);for(let _=0;_<g.length;_++){const T=new l.C(g[_],u,f);T.name=`Worker ${_}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,u,f){l.o(this.actors,(g,_)=>{g.send(i,u,_)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}}function Nt(y,i,u){const f=function(g,_){if(g)return u(g);if(_){const T=l.F(l.e(_,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(T.vectorLayers=_.vector_layers,T.vectorLayerIds=T.vectorLayers.map(E=>E.id)),u(null,T)}};return y.url?l.f(i.transformRequest(y.url,G.Source),f):l.h.frame(()=>f(null,y))}class Ye{constructor(i,u){i&&(u?this.setSouthWest(i).setNorthEast(u):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof l.L?new l.L(i.lng,i.lat):l.L.convert(i),this}setSouthWest(i){return this._sw=i instanceof l.L?new l.L(i.lng,i.lat):l.L.convert(i),this}extend(i){const u=this._sw,f=this._ne;let g,_;if(i instanceof l.L)g=i,_=i;else{if(!(i instanceof Ye))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Ye.convert(i)):this.extend(l.L.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(l.L.convert(i)):this;if(g=i._sw,_=i._ne,!g||!_)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(_.lng,f.lng),f.lat=Math.max(_.lat,f.lat)):(this._sw=new l.L(g.lng,g.lat),this._ne=new l.L(_.lng,_.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:u,lat:f}=l.L.convert(i);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(i){return i instanceof Ye?i:i&&new Ye(i)}static fromLngLat(i,u=0){const f=360*u/40075017,g=f/Math.cos(Math.PI/180*i.lat);return new Ye(new l.L(i.lng-g,i.lat-f),new l.L(i.lng+g,i.lat+f))}}class we{constructor(i,u,f){this.bounds=Ye.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=f||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const u=Math.pow(2,i.z),f=Math.floor(l.G(this.bounds.getWest())*u),g=Math.floor(l.H(this.bounds.getNorth())*u),_=Math.ceil(l.G(this.bounds.getEast())*u),T=Math.ceil(l.H(this.bounds.getSouth())*u);return i.x>=f&&i.x<_&&i.y>=g&&i.y<T}}class tt extends l.E{constructor(i,u,f,g){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Nt(this._options,this.map._requestManager,(_,T)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),_?this.fire(new l.j(_)):T&&(l.e(this,T),T.bounds&&(this.tileBounds=new we(T.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=i,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(u,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(i,u){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(f,G.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function _(T,E){return delete i.request,i.aborted?u(null):T&&T.status!==404?u(T):(E&&E.resourceTiming&&(i.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&i.setExpiryData(E),i.loadVectorData(E,this.map.painter),u(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}g.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired"?i.state==="loading"?i.reloadCallback=u:i.request=i.actor.send("reloadTile",g,_.bind(this)):(i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",g,_.bind(this)))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id},void 0)}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class kt extends l.E{constructor(i,u,f,g){super(),this.id=i,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},u),l.e(this,l.F(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Nt(this._options,this.map._requestManager,(i,u)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new l.j(i)):u&&(l.e(this,u),u.bounds&&(this.tileBounds=new we(u.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}serialize(){return l.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,u){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.request=de.getImage(this.map._requestManager.transformRequest(f,G.Tile),(g,_,T)=>{if(delete i.request,i.aborted)i.state="unloaded",u(null);else if(g)i.state="errored",u(g);else if(_){this.map._refreshExpiredTiles&&T&&i.setExpiryData(T);const E=this.map.painter.context,A=E.gl;i.texture=this.map.painter.getTileTexture(_.width),i.texture?i.texture.update(_,{useMipmap:!0}):(i.texture=new Ue(E,_,A.RGBA,{useMipmap:!0}),i.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),i.state="loaded",u(null)}},this.map._refreshExpiredTiles)}abortTile(i,u){i.request&&(i.request.cancel(),delete i.request),u()}unloadTile(i,u){i.texture&&this.map.painter.saveTileTexture(i.texture),u()}hasTransition(){return!1}}class Ht extends kt{constructor(i,u,f,g){super(i,u,f,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(i,u){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(f,G.Tile);function _(T,E){T&&(i.state="errored",u(T)),E&&(i.dem=E,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded",u(null))}i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.request=de.getImage(g,(T,E,A)=>l._(this,void 0,void 0,function*(){if(delete i.request,i.aborted)i.state="unloaded",u(null);else if(T)i.state="errored",u(T);else if(E){this.map._refreshExpiredTiles&&i.setExpiryData(A);const D=l.a(E)&&l.J()?E:yield function(z){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){const $=z.width+2,ee=z.height+2;try{return new l.R({width:$,height:ee},yield l.M(z,-1,-1,$,ee))}catch{}}return l.h.getImageData(z,1)})}(E),R={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:D,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};i.actor&&i.state!=="expired"||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",R,_))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(i){const u=i.canonical,f=Math.pow(2,u.z),g=(u.x-1+f)%f,_=u.x===0?i.wrap-1:i.wrap,T=(u.x+1+f)%f,E=u.x+1===f?i.wrap+1:i.wrap,A={};return A[new l.O(i.overscaledZ,_,u.z,g,u.y).key]={backfilled:!1},A[new l.O(i.overscaledZ,E,u.z,T,u.y).key]={backfilled:!1},u.y>0&&(A[new l.O(i.overscaledZ,_,u.z,g,u.y-1).key]={backfilled:!1},A[new l.O(i.overscaledZ,i.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},A[new l.O(i.overscaledZ,E,u.z,T,u.y-1).key]={backfilled:!1}),u.y+1<f&&(A[new l.O(i.overscaledZ,_,u.z,g,u.y+1).key]={backfilled:!1},A[new l.O(i.overscaledZ,i.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},A[new l.O(i.overscaledZ,E,u.z,T,u.y+1).key]={backfilled:!1}),A}unloadTile(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&i.actor.send("removeDEMTile",{uid:i.uid,source:this.id})}}class yt extends l.E{constructor(i,u,f,g){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(g),this._data=u.data,this._options=l.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const _=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*_,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*_,extent:l.N,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:l.N,radius:(u.clusterRadius||50)*_,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},u),this}getClusterChildren(i,u){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},u),this}getClusterLeaves(i,u,f,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:u,offset:f},g),this}_updateWorkerData(i){const u=l.e({},this.workerOptions);i?u.dataDiff=i:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),G.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,u,(f,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let _=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(_=g.resourceTiming[this.id].slice(0)),f)return void this.fire(new l.j(f));const T={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&l.e(T,{resourceTiming:_}),this.fire(new l.k("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(i,u){const f=i.actor?"reloadTile":"loadTile";i.actor=this.actor;const g={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.request=this.actor.send(f,g,(_,T)=>(delete i.request,i.unloadVectorData(),i.aborted?u(null):_?u(_):(i.loadVectorData(T,this.map.painter,f==="reloadTile"),u(null))))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0}unloadTile(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var _t=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ur extends l.E{constructor(i,u,f,g){super(),this.load=(_,T)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=de.getImage(this.map._requestManager.transformRequest(this.url,G.Image),(E,A)=>{this._request=null,this._loaded=!0,E?this.fire(new l.j(E)):A&&(this.image=A,_&&(this.coordinates=_),T&&T(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const _=this.map.painter.context,T=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ue(_,this.image,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let E=!1;for(const A in this.tiles){const D=this.tiles[A];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,E=!0)}E&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=i,this.dispatcher=f,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=u}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(i){this.coordinates=i;const u=i.map(l.U.fromLngLat);this.tileID=function(g){let _=1/0,T=1/0,E=-1/0,A=-1/0;for(const $ of g)_=Math.min(_,$.x),T=Math.min(T,$.y),E=Math.max(E,$.x),A=Math.max(A,$.y);const D=Math.max(E-_,A-T),R=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),z=Math.pow(2,R);return new l.W(R,Math.floor((_+E)/2*z),Math.floor((T+A)/2*z))}(u),this.minzoom=this.maxzoom=this.tileID.z;const f=u.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,l.N,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,l.N),this._boundsArray.emplaceBack(f[2].x,f[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(i,u){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},u(null)):(i.state="errored",u(null))}hasTransition(){return!1}}class Ds extends ur{constructor(i,u,f,g){super(i,u,f,g),this.load=()=>{this._loaded=!1;const _=this.options;this.urls=[];for(const T of _.urls)this.urls.push(this.map._requestManager.transformRequest(T,G.Source).url);l.X(this.urls,(T,E)=>{this._loaded=!0,T?this.fire(new l.j(T)):E&&(this.video=E,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,T=_.gl;this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.texSubImage2D(T.TEXTURE_2D,0,0,0,T.RGBA,T.UNSIGNED_BYTE,this.video)):(this.texture=new Ue(_,this.video,T.RGBA),this.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE));let E=!1;for(const A in this.tiles){const D=this.tiles[A];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,E=!0)}E&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=u}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const u=this.video.seekable;i<u.start(0)||i>u.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class It extends ur{constructor(i,u,f,g){super(i,u,f,g),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const T=this.map.painter.context,E=T.gl;this.boundsBuffer||(this.boundsBuffer=T.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ue(T,this.canvas,E.RGBA,{premultiply:!0});let A=!1;for(const D in this.tiles){const R=this.tiles[D];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,A=!0)}A&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(T=>typeof T!="number"))||this.fire(new l.j(new l.Y(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${i}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${i}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const qr={},Fi=y=>{switch(y){case"geojson":return yt;case"image":return ur;case"raster":return kt;case"raster-dem":return Ht;case"vector":return tt;case"video":return Ds;case"canvas":return It}return qr[y]};function kn(y,i){const u=l.Z();return l.$(u,u,[1,1,0]),l.a0(u,u,[.5*y.width,.5*y.height,1]),l.a1(u,u,y.calculatePosMatrix(i.toUnwrapped()))}function bi(y,i,u,f,g,_){const T=function(z,$,ee){if(z)for(const Q of z){const ie=$[Q];if(ie&&ie.source===ee&&ie.type==="fill-extrusion")return!0}else for(const Q in $){const ie=$[Q];if(ie.source===ee&&ie.type==="fill-extrusion")return!0}return!1}(g&&g.layers,i,y.id),E=_.maxPitchScaleFactor(),A=y.tilesIn(f,E,T);A.sort(rn);const D=[];for(const z of A)D.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(i,u,y._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,g,_,E,kn(y.transform,z.tileID))});const R=function(z){const $={},ee={};for(const Q of z){const ie=Q.queryResults,X=Q.wrappedTileID,ye=ee[X]=ee[X]||{};for(const Se in ie){const ae=ie[Se],_e=ye[Se]=ye[Se]||{},Ee=$[Se]=$[Se]||[];for(const Ae of ae)_e[Ae.featureIndex]||(_e[Ae.featureIndex]=!0,Ee.push(Ae))}}return $}(D);for(const z in R)R[z].forEach($=>{const ee=$.feature,Q=y.getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=Q});return R}function rn(y,i){const u=y.tileID,f=i.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}class os{constructor(i,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=l.a2(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const u=i+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(g,_){const T={};if(!_)return T;for(const E of g){const A=E.layerIds.map(D=>_.getLayer(D)).filter(Boolean);if(A.length!==0){E.layers=A,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(D=>A.filter(R=>R.id===D)[0]));for(const D of A)T[D.id]=E}}return T}(i.buckets,u.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const _=this.buckets[g];if(_ instanceof l.a4){if(this.hasSymbolBuckets=!0,!f)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const _=this.buckets[g];if(_ instanceof l.a4&&_.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(const g in this.buckets){const _=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(g).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(i)}const u=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ue(i,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ue(i,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,u,f,g,_,T,E,A,D,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:_,scale:T,tileSize:this.tileSize,pixelPosMatrix:R,transform:A,params:E,queryPadding:this.queryPadding*D},i,u,f):{}}querySourceFeatures(i,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),_=u&&u.sourceLayer?u.sourceLayer:"",T=g._geojsonTileLayer||g[_];if(!T)return;const E=l.a6(u&&u.filter),{z:A,x:D,y:R}=this.tileID.canonical,z={z:A,x:D,y:R};for(let $=0;$<T.length;$++){const ee=T.feature($);if(E.needGeometry){const X=l.a7(ee,!0);if(!E.filter(new l.a8(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!E.filter(new l.a8(this.tileID.overscaledZ),ee))continue;const Q=f.getId(ee,_),ie=new l.a9(ee,A,D,R,Q);ie.tile=z,i.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const u=this.expirationTime;if(i.cacheControl){const f=l.aa(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(u)if(this.expirationTime<u)g=!0;else{const _=this.expirationTime-u;_?this.expirationTime=f+Math.max(_,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!u.style.hasLayer(g))continue;const _=this.buckets[g],T=_.layers[0].sourceLayer||"_geojsonTileLayer",E=f[T],A=i[T];if(!E||!A||Object.keys(A).length===0)continue;_.update(A,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=u&&u.style&&u.style.getLayer(g);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=l.h.now()+i}setDependencies(i,u){const f={};for(const g of u)f[g]=!0;this.dependencies[i]=f}hasDependency(i,u){for(const f of i){const g=this.dependencies[f];if(g){for(const _ of u)if(g[_])return!0}}return!1}}class sn{constructor(i,u){this.max=i,this.onRemove=u,this.reset()}reset(){for(const i in this.data)for(const u of this.data[i])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(i,u,f){const g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const _={value:u,timeout:void 0};if(f!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},f)),this.data[g].push(_),this.order.push(g),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value}getByKey(i){const u=this.data[i];return u?u[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,u){if(!this.has(i))return this;const f=i.wrapped().key,g=u===void 0?0:this.data[f].indexOf(u),_=this.data[f][g];return this.data[f].splice(g,1),_.timeout&&clearTimeout(_.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(_.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(i){const u=[];for(const f in this.data)for(const g of this.data[f])i(g.value)||u.push(g);for(const f of u)this.remove(f.value.tileID,f)}}class Pe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,u,f){const g=String(u);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][g]=this.stateChanges[i][g]||{},l.e(this.stateChanges[i][g],f),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==g&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][g]===null){this.deletedStates[i][g]={};for(const _ in this.state[i][g])f[_]||(this.deletedStates[i][g][_]=null)}else for(const _ in f)this.deletedStates[i]&&this.deletedStates[i][g]&&this.deletedStates[i][g][_]===null&&delete this.deletedStates[i][g][_]}removeFeatureState(i,u,f){if(this.deletedStates[i]===null)return;const g=String(u);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&u!==void 0)this.deletedStates[i][g]!==null&&(this.deletedStates[i][g]=this.deletedStates[i][g]||{},this.deletedStates[i][g][f]=null);else if(u!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][g])for(f in this.deletedStates[i][g]={},this.stateChanges[i][g])this.deletedStates[i][g][f]=null;else this.deletedStates[i][g]=null;else this.deletedStates[i]=null}getState(i,u){const f=String(u),g=l.e({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][u];if(_===null)return{};for(const T in _)delete g[T]}return g}initializeTileState(i,u){i.setFeatureState(this.state,u)}coalesceChanges(i,u){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const _={};for(const T in this.stateChanges[g])this.state[g][T]||(this.state[g][T]={}),l.e(this.state[g][T],this.stateChanges[g][T]),_[T]=this.state[g][T];f[g]=_}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const _={};if(this.deletedStates[g]===null)for(const T in this.state[g])_[T]={},this.state[g][T]={};else for(const T in this.deletedStates[g]){if(this.deletedStates[g][T]===null)this.state[g][T]={};else for(const E of Object.keys(this.deletedStates[g][T]))delete this.state[g][T][E];_[T]=this.state[g][T]}f[g]=f[g]||{},l.e(f[g],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in i)i[g].setFeatureState(f,u)}}class fs extends l.E{constructor(i,u,f){super(),this.id=i,this.dispatcher=f,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,_,T,E)=>{const A=new(Fi(_.type))(g,_,T,E);if(A.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${A.id}`);return A})(i,u,f,this),this._tiles={},this._cache=new sn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Pe,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const u=this._tiles[i];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,u){return this._source.loadTile(i,u)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){this._source.abortTile&&this._source.abortTile(i,()=>{}),this._source.fire(new l.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(ls).map(i=>i.key)}getRenderableIds(i){const u=[];for(const f in this._tiles)this._isIdRenderable(f,i)&&u.push(this._tiles[f]);return i?u.sort((f,g)=>{const _=f.tileID,T=g.tileID,E=new l.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),A=new l.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-T.overscaledZ||A.y-E.y||A.x-E.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(ls).map(f=>f.key)}hasRenderableParent(i){const u=this.findLoadedParent(i,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(i,u){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(u||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,u){const f=this._tiles[i];f&&(f.state!=="loading"&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,i,u)))}_tileLoaded(i,u,f,g){if(g)return i.state="errored",void(g.status!==404?this._source.fire(new l.j(g,{tile:i})):this.update(this.transform,this.terrain));i.timeAdded=l.h.now(),f==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(u,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const u=this.getRenderableIds();for(let g=0;g<u.length;g++){const _=u[g];if(i.neighboringTiles&&i.neighboringTiles[_]){const T=this.getTileByID(_);f(i,T),f(T,i)}}function f(g,_){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let T=_.tileID.canonical.x-g.tileID.canonical.x;const E=_.tileID.canonical.y-g.tileID.canonical.y,A=Math.pow(2,g.tileID.canonical.z),D=_.tileID.key;T===0&&E===0||Math.abs(E)>1||(Math.abs(T)>1&&(Math.abs(T+A)===1?T+=A:Math.abs(T-A)===1&&(T-=A)),_.dem&&g.dem&&(g.dem.backfillBorder(_.dem,T,E),g.neighboringTiles&&g.neighboringTiles[D]&&(g.neighboringTiles[D].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,u,f,g){for(const _ in this._tiles){let T=this._tiles[_];if(g[_]||!T.hasData()||T.tileID.overscaledZ<=u||T.tileID.overscaledZ>f)continue;let E=T.tileID;for(;T&&T.tileID.overscaledZ>u+1;){const D=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[D.key],T&&T.hasData()&&(E=D)}let A=E;for(;A.overscaledZ>u;)if(A=A.scaledTo(A.overscaledZ-1),i[A.key]){g[E.key]=E;break}}}findLoadedParent(i,u){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=i.overscaledZ-1;f>=u;f--){const g=i.scaledTo(f),_=this._getLoadedTile(g);if(_)return _}}_getLoadedTile(i){const u=this._tiles[i.key];return u&&u.hasData()?u:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const u=Math.ceil(i.width/this._source.tileSize)+1,f=Math.ceil(i.height/this._source.tileSize)+1,g=Math.floor(u*f*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(_)}handleWrapJump(i){const u=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,u){const f={};for(const g in this._tiles){const _=this._tiles[g];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+u),f[_.tileID.key]=_}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(i,u){if(this.transform=i,this.terrain=u,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new l.O(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(f=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(f=f.filter(R=>this._source.hasTile(R)))):f=[];const g=i.coveringZoomLevel(this._source),_=Math.max(g-fs.maxOverzooming,this._source.minzoom),T=Math.max(g+fs.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const z of f)if(z.canonical.z>this._source.minzoom){const $=z.scaledTo(z.canonical.z-1);R[$.key]=$;const ee=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));R[ee.key]=ee}f=f.concat(Object.values(R))}const E=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(f,g);if(nr(this._source.type)){const R={},z={},$=Object.keys(A),ee=l.h.now();for(const Q of $){const ie=A[Q],X=this._tiles[Q];if(!X||X.fadeEndTime!==0&&X.fadeEndTime<=ee)continue;const ye=this.findLoadedParent(ie,_);ye&&(this._addTile(ye.tileID),R[ye.tileID.key]=ye.tileID),z[Q]=ie}this._retainLoadedChildren(z,g,T,A);for(const Q in R)A[Q]||(this._coveredTiles[Q]=!0,A[Q]=R[Q]);if(u){const Q={},ie={};for(const X of f)this._tiles[X.key].hasData()?Q[X.key]=X:ie[X.key]=X;for(const X in ie){const ye=ie[X].children(this._source.maxzoom);this._tiles[ye[0].key]&&this._tiles[ye[1].key]&&this._tiles[ye[2].key]&&this._tiles[ye[3].key]&&(Q[ye[0].key]=A[ye[0].key]=ye[0],Q[ye[1].key]=A[ye[1].key]=ye[1],Q[ye[2].key]=A[ye[2].key]=ye[2],Q[ye[3].key]=A[ye[3].key]=ye[3],delete ie[X])}for(const X in ie){const ye=this.findLoadedParent(ie[X],this._source.minzoom);if(ye){Q[ye.tileID.key]=A[ye.tileID.key]=ye.tileID;for(const Se in Q)Q[Se].isChildOf(ye.tileID)&&delete Q[Se]}}for(const X in this._tiles)Q[X]||(this._coveredTiles[X]=!0)}}for(const R in A)this._tiles[R].clearFadeHold();const D=l.ab(this._tiles,A);for(const R of D){const z=this._tiles[R];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,u){const f={},g={},_=Math.max(u-fs.maxOverzooming,this._source.minzoom),T=Math.max(u+fs.maxUnderzooming,this._source.minzoom),E={};for(const A of i){const D=this._addTile(A);f[A.key]=A,D.hasData()||u<this._source.maxzoom&&(E[A.key]=A)}this._retainLoadedChildren(E,u,T,f);for(const A of i){let D=this._tiles[A.key];if(D.hasData())continue;if(u+1>this._source.maxzoom){const z=A.children(this._source.maxzoom)[0],$=this.getTile(z);if($&&$.hasData()){f[z.key]=z;continue}}else{const z=A.children(this._source.maxzoom);if(f[z[0].key]&&f[z[1].key]&&f[z[2].key]&&f[z[3].key])continue}let R=D.wasRequested();for(let z=A.overscaledZ-1;z>=_;--z){const $=A.scaledTo(z);if(g[$.key])break;if(g[$.key]=!0,D=this.getTile($),!D&&R&&(D=this._addTile($)),D){const ee=D.hasData();if((R||ee)&&(f[$.key]=$),R=D.wasRequested(),ee)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const u=[];let f,g=this._tiles[i].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}u.push(g.key);const _=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(_),f)break;g=_}for(const _ of u)this._loadedParentTiles[_]=f}}_addTile(i){let u=this._tiles[i.key];if(u)return u;u=this._cache.getAndRemove(i),u&&(this._setTileReloadTimer(i.key,u),u.tileID=i,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,u)));const f=u;return u||(u=new os(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(u,this._tileLoaded.bind(this,u,i.key,u.state))),u.uses++,this._tiles[i.key]=u,f||this._source.fire(new l.k("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(i,u){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=u.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const u=this._tiles[i];u&&(u.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,u,f){const g=[],_=this.transform;if(!_)return g;const T=f?_.getCameraQueryGeometry(i):i,E=i.map(Q=>_.pointCoordinate(Q,this.terrain)),A=T.map(Q=>_.pointCoordinate(Q,this.terrain)),D=this.getIds();let R=1/0,z=1/0,$=-1/0,ee=-1/0;for(const Q of A)R=Math.min(R,Q.x),z=Math.min(z,Q.y),$=Math.max($,Q.x),ee=Math.max(ee,Q.y);for(let Q=0;Q<D.length;Q++){const ie=this._tiles[D[Q]];if(ie.holdingForFade())continue;const X=ie.tileID,ye=Math.pow(2,_.zoom-ie.tileID.overscaledZ),Se=u*ie.queryPadding*l.N/ie.tileSize/ye,ae=[X.getTilePoint(new l.U(R,z)),X.getTilePoint(new l.U($,ee))];if(ae[0].x-Se<l.N&&ae[0].y-Se<l.N&&ae[1].x+Se>=0&&ae[1].y+Se>=0){const _e=E.map(Ae=>X.getTilePoint(Ae)),Ee=A.map(Ae=>X.getTilePoint(Ae));g.push({tile:ie,tileID:X,queryGeometry:_e,cameraQueryGeometry:Ee,scale:ye})}}return g}getVisibleCoordinates(i){const u=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of u)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(nr(this._source.type)){const i=l.h.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=i)return!0}return!1}setFeatureState(i,u,f){this._state.updateState(i=i||"_geojsonTileLayer",u,f)}removeFeatureState(i,u,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",u,f)}getFeatureState(i,u){return this._state.getState(i=i||"_geojsonTileLayer",u)}setDependencies(i,u,f){const g=this._tiles[i];g&&g.setDependencies(u,f)}reloadTilesForDependencies(i,u){for(const f in this._tiles)this._tiles[f].hasDependency(i,u)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(i,u))}}function ls(y,i){const u=Math.abs(2*y.wrap)-+(y.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return y.overscaledZ-i.overscaledZ||f-u||i.canonical.y-y.canonical.y||i.canonical.x-y.canonical.x}function nr(y){return y==="raster"||y==="image"||y==="video"}fs.maxOverzooming=10,fs.maxUnderzooming=3;const Wt="mapboxgl_preloaded_worker_pool";class wi{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<wi.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Wt]}numActive(){return Object.keys(this.active).length}}const Zn=Math.floor(l.h.hardwareConcurrency/2);let $i;function ma(){return $i||($i=new wi),$i}wi.workerCount=l.ac(globalThis)?Math.max(Math.min(Zn,3),1):1;class Hn{constructor(i,u){this.reset(i,u)}reset(i,u){this.points=i||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=l.ad(i,0,1);let u=1,f=this._distances[u];const g=i*this.paddedLength+this.padding;for(;f<g&&u<this._distances.length;)f=this._distances[++u];const _=u-1,T=this._distances[_],E=f-T,A=E>0?(g-T)/E:0;return this.points[_].mult(1-A).add(this.points[u].mult(A))}}function Ui(y,i){let u=!0;return y==="always"||y!=="never"&&i!=="never"||(u=!1),u}class Tn{constructor(i,u,f){const g=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/f),this.yCellCount=Math.ceil(u/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)g.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,u,f,g,_){this._forEachCell(u,f,g,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(_)}insertCircle(i,u,f,g){this._forEachCell(u-g,f-g,u+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(f),this.circles.push(g)}_insertBoxCell(i,u,f,g,_,T){this.boxCells[_].push(T)}_insertCircleCell(i,u,f,g,_,T){this.circleCells[_].push(T)}_query(i,u,f,g,_,T,E){if(f<0||i>this.width||g<0||u>this.height)return[];const A=[];if(i<=0&&u<=0&&this.width<=f&&this.height<=g){if(_)return[{key:null,x1:i,y1:u,x2:f,y2:g}];for(let D=0;D<this.boxKeys.length;D++)A.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const R=this.circles[3*D],z=this.circles[3*D+1],$=this.circles[3*D+2];A.push({key:this.circleKeys[D],x1:R-$,y1:z-$,x2:R+$,y2:z+$})}}else this._forEachCell(i,u,f,g,this._queryCell,A,{hitTest:_,overlapMode:T,seenUids:{box:{},circle:{}}},E);return A}query(i,u,f,g){return this._query(i,u,f,g,!1,null)}hitTest(i,u,f,g,_,T){return this._query(i,u,f,g,!0,_,T).length>0}hitTestCircle(i,u,f,g,_){const T=i-f,E=i+f,A=u-f,D=u+f;if(E<0||T>this.width||D<0||A>this.height)return!1;const R=[];return this._forEachCell(T,A,E,D,this._queryCellCircle,R,{hitTest:!0,overlapMode:g,circle:{x:i,y:u,radius:f},seenUids:{box:{},circle:{}}},_),R.length>0}_queryCell(i,u,f,g,_,T,E,A){const{seenUids:D,hitTest:R,overlapMode:z}=E,$=this.boxCells[_];if($!==null){const Q=this.bboxes;for(const ie of $)if(!D.box[ie]){D.box[ie]=!0;const X=4*ie,ye=this.boxKeys[ie];if(i<=Q[X+2]&&u<=Q[X+3]&&f>=Q[X+0]&&g>=Q[X+1]&&(!A||A(ye))&&(!R||!Ui(z,ye.overlapMode))&&(T.push({key:ye,x1:Q[X],y1:Q[X+1],x2:Q[X+2],y2:Q[X+3]}),R))return!0}}const ee=this.circleCells[_];if(ee!==null){const Q=this.circles;for(const ie of ee)if(!D.circle[ie]){D.circle[ie]=!0;const X=3*ie,ye=this.circleKeys[ie];if(this._circleAndRectCollide(Q[X],Q[X+1],Q[X+2],i,u,f,g)&&(!A||A(ye))&&(!R||!Ui(z,ye.overlapMode))){const Se=Q[X],ae=Q[X+1],_e=Q[X+2];if(T.push({key:ye,x1:Se-_e,y1:ae-_e,x2:Se+_e,y2:ae+_e}),R)return!0}}}return!1}_queryCellCircle(i,u,f,g,_,T,E,A){const{circle:D,seenUids:R,overlapMode:z}=E,$=this.boxCells[_];if($!==null){const Q=this.bboxes;for(const ie of $)if(!R.box[ie]){R.box[ie]=!0;const X=4*ie,ye=this.boxKeys[ie];if(this._circleAndRectCollide(D.x,D.y,D.radius,Q[X+0],Q[X+1],Q[X+2],Q[X+3])&&(!A||A(ye))&&!Ui(z,ye.overlapMode))return T.push(!0),!0}}const ee=this.circleCells[_];if(ee!==null){const Q=this.circles;for(const ie of ee)if(!R.circle[ie]){R.circle[ie]=!0;const X=3*ie,ye=this.circleKeys[ie];if(this._circlesCollide(Q[X],Q[X+1],Q[X+2],D.x,D.y,D.radius)&&(!A||A(ye))&&!Ui(z,ye.overlapMode))return T.push(!0),!0}}}_forEachCell(i,u,f,g,_,T,E,A){const D=this._convertToXCellCoord(i),R=this._convertToYCellCoord(u),z=this._convertToXCellCoord(f),$=this._convertToYCellCoord(g);for(let ee=D;ee<=z;ee++)for(let Q=R;Q<=$;Q++)if(_.call(this,i,u,f,g,this.xCellCount*Q+ee,T,E,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,u,f,g,_,T){const E=g-i,A=_-u,D=f+T;return D*D>E*E+A*A}_circleAndRectCollide(i,u,f,g,_,T,E){const A=(T-g)/2,D=Math.abs(i-(g+A));if(D>A+f)return!1;const R=(E-_)/2,z=Math.abs(u-(_+R));if(z>R+f)return!1;if(D<=A||z<=R)return!0;const $=D-A,ee=z-R;return $*$+ee*ee<=f*f}}function Ve(y,i,u,f,g){const _=l.Z();return i?(l.a0(_,_,[1/g,1/g,1]),u||l.ae(_,_,f.angle)):l.a1(_,f.labelPlaneMatrix,y),_}function si(y,i,u,f,g){if(i){const _=l.af(y);return l.a0(_,_,[g,g,1]),u||l.ae(_,_,-f.angle),_}return f.glCoordMatrix}function pr(y,i,u){let f;u?(f=[y.x,y.y,u(y.x,y.y),1],l.ag(f,f,i)):(f=[y.x,y.y,0,1],K(f,f,i));const g=f[3];return{point:new l.P(f[0]/g,f[1]/g),signedDistanceFromCamera:g}}function En(y,i){return .5+y/i*.5}function Vi(y,i){const u=y[0]/y[3],f=y[1]/y[3];return u>=-i[0]&&u<=i[0]&&f>=-i[1]&&f<=i[1]}function Ge(y,i,u,f,g,_,T,E,A,D){const R=f?y.textSizeData:y.iconSizeData,z=l.ah(R,u.transform.zoom),$=[256/u.width*2+1,256/u.height*2+1],ee=f?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ee.clear();const Q=y.lineVertexArray,ie=f?y.text.placedSymbolArray:y.icon.placedSymbolArray,X=u.transform.width/u.transform.height;let ye=!1;for(let Se=0;Se<ie.length;Se++){const ae=ie.get(Se);if(ae.hidden||ae.writingMode===l.ai.vertical&&!ye){V(ae.numGlyphs,ee);continue}let _e;if(ye=!1,D?(_e=[ae.anchorX,ae.anchorY,D(ae.anchorX,ae.anchorY),1],l.ag(_e,_e,i)):(_e=[ae.anchorX,ae.anchorY,0,1],K(_e,_e,i)),!Vi(_e,$)){V(ae.numGlyphs,ee);continue}const Ee=En(u.transform.cameraToCenterDistance,_e[3]),Ae=l.aj(R,z,ae),je=T?Ae/Ee:Ae*Ee,Re=new l.P(ae.anchorX,ae.anchorY),Le=pr(Re,g,D).point,$e={projections:{},offsets:{}},lt=ps(ae,je,!1,E,i,g,_,y.glyphOffsetArray,Q,ee,Le,Re,$e,X,A,D);ye=lt.useVertical,(lt.notEnoughRoom||ye||lt.needsFlipping&&ps(ae,je,!0,E,i,g,_,y.glyphOffsetArray,Q,ee,Le,Re,$e,X,A,D).notEnoughRoom)&&V(ae.numGlyphs,ee)}f?y.text.dynamicLayoutVertexBuffer.updateData(ee):y.icon.dynamicLayoutVertexBuffer.updateData(ee)}function Mt(y,i,u,f,g,_,T,E,A,D,R,z,$){const ee=E.glyphStartIndex+E.numGlyphs,Q=E.lineStartIndex,ie=E.lineStartIndex+E.lineLength,X=i.getoffsetX(E.glyphStartIndex),ye=i.getoffsetX(ee-1),Se=I(y*X,u,f,g,_,T,E.segment,Q,ie,A,D,R,z,$);if(!Se)return null;const ae=I(y*ye,u,f,g,_,T,E.segment,Q,ie,A,D,R,z,$);return ae?{first:Se,last:ae}:null}function Tt(y,i,u,f){return y===l.ai.horizontal&&Math.abs(u.y-i.y)>Math.abs(u.x-i.x)*f?{useVertical:!0}:(y===l.ai.vertical?i.y<u.y:i.x>u.x)?{needsFlipping:!0}:null}function ps(y,i,u,f,g,_,T,E,A,D,R,z,$,ee,Q,ie){const X=i/24,ye=y.lineOffsetX*X,Se=y.lineOffsetY*X;let ae;if(y.numGlyphs>1){const _e=y.glyphStartIndex+y.numGlyphs,Ee=y.lineStartIndex,Ae=y.lineStartIndex+y.lineLength,je=Mt(X,E,ye,Se,u,R,z,y,A,_,$,Q,ie);if(!je)return{notEnoughRoom:!0};const Re=pr(je.first.point,T,ie).point,Le=pr(je.last.point,T,ie).point;if(f&&!u){const $e=Tt(y.writingMode,Re,Le,ee);if($e)return $e}ae=[je.first];for(let $e=y.glyphStartIndex+1;$e<_e-1;$e++)ae.push(I(X*E.getoffsetX($e),ye,Se,u,R,z,y.segment,Ee,Ae,A,_,$,Q,ie));ae.push(je.last)}else{if(f&&!u){const Ee=pr(z,g,ie).point,Ae=y.lineStartIndex+y.segment+1,je=new l.P(A.getx(Ae),A.gety(Ae)),Re=pr(je,g,ie),Le=Re.signedDistanceFromCamera>0?Re.point:Si(z,je,Ee,1,g,ie),$e=Tt(y.writingMode,Ee,Le,ee);if($e)return $e}const _e=I(X*E.getoffsetX(y.glyphStartIndex),ye,Se,u,R,z,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,A,_,$,Q,ie);if(!_e)return{notEnoughRoom:!0};ae=[_e]}for(const _e of ae)l.ak(D,_e.point,_e.angle);return{}}function Si(y,i,u,f,g,_){const T=pr(y.add(y.sub(i)._unit()),g,_).point,E=u.sub(T);return u.add(E._mult(f/E.mag()))}function Pt(y,i){const{projectionCache:u,lineVertexArray:f,labelPlaneMatrix:g,tileAnchorPoint:_,distanceFromAnchor:T,getElevation:E,previousVertex:A,direction:D,absOffsetX:R}=i;if(u.projections[y])return u.projections[y];const z=new l.P(f.getx(y),f.gety(y)),$=pr(z,g,E);if($.signedDistanceFromCamera>0)return u.projections[y]=$.point,$.point;const ee=y-D;return Si(T===0?_:new l.P(f.getx(ee),f.gety(ee)),z,A,R-T+1,g,E)}function qi(y,i,u){return y._unit()._perp()._mult(i*u)}function se(y,i,u,f,g,_,T,E){const{projectionCache:A,direction:D}=E;if(A.offsets[y])return A.offsets[y];const R=u.add(i);if(y+D<f||y+D>=g)return A.offsets[y]=R,R;const z=Pt(y+D,E),$=qi(z.sub(u),T,D),ee=u.add($),Q=z.add($);return A.offsets[y]=l.al(_,R,ee,Q)||R,A.offsets[y]}function I(y,i,u,f,g,_,T,E,A,D,R,z,$,ee){const Q=f?y-i:y+i;let ie=Q>0?1:-1,X=0;f&&(ie*=-1,X=Math.PI),ie<0&&(X+=Math.PI);let ye,Se,ae=ie>0?E+T:E+T+1,_e=g,Ee=g,Ae=0,je=0;const Re=Math.abs(Q),Le=[];let $e;for(;Ae+je<=Re;){if(ae+=ie,ae<E||ae>=A)return null;Ae+=je,Ee=_e,Se=ye;const Ke={projectionCache:z,lineVertexArray:D,labelPlaneMatrix:R,tileAnchorPoint:_,distanceFromAnchor:Ae,getElevation:ee,previousVertex:Ee,direction:ie,absOffsetX:Re};if(_e=Pt(ae,Ke),u===0)Le.push(Ee),$e=_e.sub(Ee);else{let bt;const ut=_e.sub(Ee);bt=ut.mag()===0?qi(Pt(ae+ie,Ke).sub(_e),u,ie):qi(ut,u,ie),Se||(Se=Ee.add(bt)),ye=se(ae,bt,_e,E,A,Se,u,Ke),Le.push(Se),$e=ye.sub(Se)}je=$e.mag()}const lt=$e._mult((Re-Ae)/je)._add(Se||Ee),Bt=X+Math.atan2(_e.y-Ee.y,_e.x-Ee.x);return Le.push(lt),{point:lt,angle:$?Bt:0,path:Le}}const O=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function V(y,i){for(let u=0;u<y;u++){const f=i.length;i.resize(f+4),i.float32.set(O,3*f)}}function K(y,i,u){const f=i[0],g=i[1];return y[0]=u[0]*f+u[4]*g+u[12],y[1]=u[1]*f+u[5]*g+u[13],y[3]=u[3]*f+u[7]*g+u[15],y}const te=100;class pe{constructor(i,u=new Tn(i.width+200,i.height+200,25),f=new Tn(i.width+200,i.height+200,25)){this.transform=i,this.grid=u,this.ignoredGrid=f,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+te,this.screenBottomBoundary=i.height+te,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,u,f,g,_,T){const E=this.projectAndGetPerspectiveRatio(g,i.anchorPointX,i.anchorPointY,T),A=f*E.perspectiveRatio,D=i.x1*A+E.point.x,R=i.y1*A+E.point.y,z=i.x2*A+E.point.x,$=i.y2*A+E.point.y;return!this.isInsideGrid(D,R,z,$)||u!=="always"&&this.grid.hitTest(D,R,z,$,u,_)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[D,R,z,$],offscreen:this.isOffscreen(D,R,z,$)}}placeCollisionCircles(i,u,f,g,_,T,E,A,D,R,z,$,ee,Q){const ie=[],X=new l.P(u.anchorX,u.anchorY),ye=pr(X,T,Q),Se=En(this.transform.cameraToCenterDistance,ye.signedDistanceFromCamera),ae=(R?_/Se:_*Se)/l.ap,_e=pr(X,E,Q).point,Ee=Mt(ae,g,u.lineOffsetX*ae,u.lineOffsetY*ae,!1,_e,X,u,f,E,{projections:{},offsets:{}},!1,Q);let Ae=!1,je=!1,Re=!0;if(Ee){const Le=.5*$*Se+ee,$e=new l.P(-100,-100),lt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Bt=new Hn,Ke=Ee.first,bt=Ee.last;let ut=[];for(let Dt=Ke.path.length-1;Dt>=1;Dt--)ut.push(Ke.path[Dt]);for(let Dt=1;Dt<bt.path.length;Dt++)ut.push(bt.path[Dt]);const or=2.5*Le;if(A){const Dt=ut.map(Ot=>pr(Ot,A,Q));ut=Dt.some(Ot=>Ot.signedDistanceFromCamera<=0)?[]:Dt.map(Ot=>Ot.point)}let zt=[];if(ut.length>0){const Dt=ut[0].clone(),Ot=ut[0].clone();for(let Mr=1;Mr<ut.length;Mr++)Dt.x=Math.min(Dt.x,ut[Mr].x),Dt.y=Math.min(Dt.y,ut[Mr].y),Ot.x=Math.max(Ot.x,ut[Mr].x),Ot.y=Math.max(Ot.y,ut[Mr].y);zt=Dt.x>=$e.x&&Ot.x<=lt.x&&Dt.y>=$e.y&&Ot.y<=lt.y?[ut]:Ot.x<$e.x||Dt.x>lt.x||Ot.y<$e.y||Dt.y>lt.y?[]:l.am([ut],$e.x,$e.y,lt.x,lt.y)}for(const Dt of zt){Bt.reset(Dt,.25*Le);let Ot=0;Ot=Bt.length<=.5*Le?1:Math.ceil(Bt.paddedLength/or)+1;for(let Mr=0;Mr<Ot;Mr++){const dr=Mr/Math.max(Ot-1,1),ys=Bt.lerp(dr),Yr=ys.x+te,zr=ys.y+te;ie.push(Yr,zr,Le,0);const ci=Yr-Le,gr=zr-Le,an=Yr+Le,on=zr+Le;if(Re=Re&&this.isOffscreen(ci,gr,an,on),je=je||this.isInsideGrid(ci,gr,an,on),i!=="always"&&this.grid.hitTestCircle(Yr,zr,Le,i,z)&&(Ae=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!D&&Ae||!je||Se<this.perspectiveRatioCutoff?[]:ie,offscreen:Re,collisionDetected:Ae}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let f=1/0,g=1/0,_=-1/0,T=-1/0;for(const R of i){const z=new l.P(R.x+te,R.y+te);f=Math.min(f,z.x),g=Math.min(g,z.y),_=Math.max(_,z.x),T=Math.max(T,z.y),u.push(z)}const E=this.grid.query(f,g,_,T).concat(this.ignoredGrid.query(f,g,_,T)),A={},D={};for(const R of E){const z=R.key;if(A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]={}),A[z.bucketInstanceId][z.featureIndex])continue;const $=[new l.P(R.x1,R.y1),new l.P(R.x2,R.y1),new l.P(R.x2,R.y2),new l.P(R.x1,R.y2)];l.an(u,$)&&(A[z.bucketInstanceId][z.featureIndex]=!0,D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]=[]),D[z.bucketInstanceId].push(z.featureIndex))}return D}insertCollisionBox(i,u,f,g,_,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:_,collisionGroupID:T,overlapMode:u},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,u,f,g,_,T){const E=f?this.ignoredGrid:this.grid,A={bucketInstanceId:g,featureIndex:_,collisionGroupID:T,overlapMode:u};for(let D=0;D<i.length;D+=4)E.insertCircle(A,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,u,f,g){let _;return g?(_=[u,f,g(u,f),1],l.ag(_,_,i)):(_=[u,f,0,1],K(_,_,i)),{point:new l.P((_[0]/_[3]+1)/2*this.transform.width+te,(-_[1]/_[3]+1)/2*this.transform.height+te),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(i,u,f,g){return f<te||i>=this.screenRightBoundary||g<te||u>this.screenBottomBoundary}isInsideGrid(i,u,f,g){return f>=0&&i<this.gridRightBoundary&&g>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const i=l.ao([]);return l.$(i,i,[-100,-100,0]),i}}function he(y,i,u){return i*(l.N/(y.tileSize*Math.pow(2,u-y.tileID.overscaledZ)))}class oe{constructor(i,u,f,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ge{constructor(i,u,f,g,_){this.text=new oe(i?i.text:null,u,f,_),this.icon=new oe(i?i.icon:null,u,g,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ie{constructor(i,u,f){this.text=i,this.icon=u,this.skipFade=f}}class Me{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class Ne{constructor(i,u,f,g,_){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=_}}class pt{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:f=>f.collisionGroupID===u}}return this.collisionGroups[i]}}function wt(y,i,u,f,g){const{horizontalAlign:_,verticalAlign:T}=l.au(y);return new l.P(-(_-.5)*i+f[0]*g,-(T-.5)*u+f[1]*g)}function ot(y,i,u,f,g,_){const{x1:T,x2:E,y1:A,y2:D,anchorPointX:R,anchorPointY:z}=y,$=new l.P(i,u);return f&&$._rotate(g?_:-_),{x1:T+$.x,y1:A+$.y,x2:E+$.x,y2:D+$.y,anchorPointX:R,anchorPointY:z}}class gt{constructor(i,u,f,g,_){this.transform=i.clone(),this.terrain=u,this.collisionIndex=new pe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new pt(g),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,u,f,g){const _=f.getBucket(u),T=f.latestFeatureIndex;if(!_||!T||u.id!==_.layerIds[0])return;const E=f.collisionBoxArray,A=_.layers[0].layout,D=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),R=f.tileSize/l.N,z=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),$=A.get("text-pitch-alignment")==="map",ee=A.get("text-rotation-alignment")==="map",Q=he(f,1,this.transform.zoom),ie=Ve(z,$,ee,this.transform,Q);let X=null;if($){const Se=si(z,$,ee,this.transform,Q);X=l.a1([],this.transform.labelPlaneMatrix,Se)}this.retainedQueryData[_.bucketInstanceId]=new Ne(_.bucketInstanceId,T,_.sourceLayerIndex,_.index,f.tileID);const ye={bucket:_,layout:A,posMatrix:z,textLabelPlaneMatrix:ie,labelToScreenMatrix:X,scale:D,textPixelRatio:R,holdingForFade:f.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:l.ah(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(g)for(const Se of _.sortKeyRanges){const{sortKey:ae,symbolInstanceStart:_e,symbolInstanceEnd:Ee}=Se;i.push({sortKey:ae,symbolInstanceStart:_e,symbolInstanceEnd:Ee,parameters:ye})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(i,u,f,g,_,T,E,A,D,R,z,$,ee,Q,ie,X){const ye=l.aq[i.textAnchor],Se=[i.textOffset0,i.textOffset1],ae=wt(ye,f,g,Se,_),_e=this.collisionIndex.placeCollisionBox(ot(u,ae.x,ae.y,T,E,this.transform.angle),z,A,D,R.predicate,X);if((!ie||this.collisionIndex.placeCollisionBox(ot(ie,ae.x,ae.y,T,E,this.transform.angle),z,A,D,R.predicate,X).box.length!==0)&&_e.box.length>0){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Se,width:f,height:g,anchor:ye,textBoxScale:_,prevAnchor:Ee},this.markUsedJustification(ee,ye,$,Q),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Q,$),this.placedOrientations[$.crossTileID]=Q),{shift:ae,placedGlyphBoxes:_e}}}placeLayerBucketPart(i,u,f){const{bucket:g,layout:_,posMatrix:T,textLabelPlaneMatrix:E,labelToScreenMatrix:A,textPixelRatio:D,holdingForFade:R,collisionBoxArray:z,partiallyEvaluatedTextSize:$,collisionGroup:ee}=i.parameters,Q=_.get("text-optional"),ie=_.get("icon-optional"),X=l.ar(_,"text-overlap","text-allow-overlap"),ye=X==="always",Se=l.ar(_,"icon-overlap","icon-allow-overlap"),ae=Se==="always",_e=_.get("text-rotation-alignment")==="map",Ee=_.get("text-pitch-alignment")==="map",Ae=_.get("icon-text-fit")!=="none",je=_.get("symbol-z-order")==="viewport-y",Re=ye&&(ae||!g.hasIconData()||ie),Le=ae&&(ye||!g.hasTextData()||Q);!g.collisionArrays&&z&&g.deserializeCollisionBoxes(z);const $e=this.retainedQueryData[g.bucketInstanceId].tileID,lt=this.terrain?(Ke,bt)=>this.terrain.getElevation($e,Ke,bt):null,Bt=(Ke,bt)=>{var ut,or;if(u[Ke.crossTileID])return;if(R)return void(this.placements[Ke.crossTileID]=new Ie(!1,!1,!1));let zt=!1,Dt=!1,Ot=!0,Mr=null,dr={box:null,offscreen:null},ys={box:null},Yr=null,zr=null,ci=null,gr=0,an=0,on=0;bt.textFeatureIndex?gr=bt.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(gr=Ke.featureIndex),bt.verticalTextFeatureIndex&&(an=bt.verticalTextFeatureIndex);const ra=bt.textBox;if(ra){const Es=jr=>{let Jr=l.ai.horizontal;if(g.allowVerticalPlacement&&!jr&&this.prevPlacement){const Ws=this.prevPlacement.placedOrientations[Ke.crossTileID];Ws&&(this.placedOrientations[Ke.crossTileID]=Ws,Jr=Ws,this.markUsedOrientation(g,Jr,Ke))}return Jr},_s=(jr,Jr)=>{if(g.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&bt.verticalTextBox){for(const Ws of g.writingModes)if(Ws===l.ai.vertical?(dr=Jr(),ys=dr):dr=jr(),dr&&dr.box&&dr.box.length)break}else dr=jr()},Ls=Ke.textAnchorOffsetStartIndex,Ta=Ke.textAnchorOffsetEndIndex;if(Ta===Ls){const jr=(Jr,Ws)=>{const Dr=this.collisionIndex.placeCollisionBox(Jr,X,D,T,ee.predicate,lt);return Dr&&Dr.box&&Dr.box.length&&(this.markUsedOrientation(g,Ws,Ke),this.placedOrientations[Ke.crossTileID]=Ws),Dr};_s(()=>jr(ra,l.ai.horizontal),()=>{const Jr=bt.verticalTextBox;return g.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&Jr?jr(Jr,l.ai.vertical):{box:null,offscreen:null}}),Es(dr&&dr.box&&dr.box.length)}else{let jr=l.aq[(or=(ut=this.prevPlacement)===null||ut===void 0?void 0:ut.variableOffsets[Ke.crossTileID])===null||or===void 0?void 0:or.anchor];const Jr=(Dr,Ea,dc)=>{const Of=Dr.x2-Dr.x1,Ff=Dr.y2-Dr.y1,Ag=Ke.textBoxScale,hh=Ae&&Se==="never"?Ea:null;let ln={box:[],offscreen:!1},Ca=X==="never"?1:2,cn="never";jr&&Ca++;for(let Ii=0;Ii<Ca;Ii++){for(let un=Ls;un<Ta;un++){const dh=g.textAnchorOffsets.get(un);if(jr&&dh.textAnchor!==jr)continue;const Mn=this.attemptAnchorPlacement(dh,Dr,Of,Ff,Ag,_e,Ee,D,T,ee,cn,Ke,g,dc,hh,lt);if(Mn&&(ln=Mn.placedGlyphBoxes,ln&&ln.box&&ln.box.length))return zt=!0,Mr=Mn.shift,ln}jr?jr=null:cn=X}return ln};_s(()=>Jr(ra,bt.iconBox,l.ai.horizontal),()=>{const Dr=bt.verticalTextBox;return g.allowVerticalPlacement&&!(dr&&dr.box&&dr.box.length)&&Ke.numVerticalGlyphVertices>0&&Dr?Jr(Dr,bt.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),dr&&(zt=dr.box,Ot=dr.offscreen);const Ws=Es(dr&&dr.box);if(!zt&&this.prevPlacement){const Dr=this.prevPlacement.variableOffsets[Ke.crossTileID];Dr&&(this.variableOffsets[Ke.crossTileID]=Dr,this.markUsedJustification(g,Dr.anchor,Ke,Ws))}}}if(Yr=dr,zt=Yr&&Yr.box&&Yr.box.length>0,Ot=Yr&&Yr.offscreen,Ke.useRuntimeCollisionCircles){const Es=g.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),_s=l.aj(g.textSizeData,$,Es),Ls=_.get("text-padding");zr=this.collisionIndex.placeCollisionCircles(X,Es,g.lineVertexArray,g.glyphOffsetArray,_s,T,E,A,f,Ee,ee.predicate,Ke.collisionCircleDiameter,Ls,lt),zr.circles.length&&zr.collisionDetected&&!f&&l.w("Collisions detected, but collision boxes are not shown"),zt=ye||zr.circles.length>0&&!zr.collisionDetected,Ot=Ot&&zr.offscreen}if(bt.iconFeatureIndex&&(on=bt.iconFeatureIndex),bt.iconBox){const Es=_s=>{const Ls=Ae&&Mr?ot(_s,Mr.x,Mr.y,_e,Ee,this.transform.angle):_s;return this.collisionIndex.placeCollisionBox(Ls,Se,D,T,ee.predicate,lt)};ys&&ys.box&&ys.box.length&&bt.verticalIconBox?(ci=Es(bt.verticalIconBox),Dt=ci.box.length>0):(ci=Es(bt.iconBox),Dt=ci.box.length>0),Ot=Ot&&ci.offscreen}const ka=Q||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,no=ie||Ke.numIconVertices===0;if(ka||no?no?ka||(Dt=Dt&&zt):zt=Dt&&zt:Dt=zt=Dt&&zt,zt&&Yr&&Yr.box&&this.collisionIndex.insertCollisionBox(Yr.box,X,_.get("text-ignore-placement"),g.bucketInstanceId,ys&&ys.box&&an?an:gr,ee.ID),Dt&&ci&&this.collisionIndex.insertCollisionBox(ci.box,Se,_.get("icon-ignore-placement"),g.bucketInstanceId,on,ee.ID),zr&&(zt&&this.collisionIndex.insertCollisionCircles(zr.circles,X,_.get("text-ignore-placement"),g.bucketInstanceId,gr,ee.ID),f)){const Es=g.bucketInstanceId;let _s=this.collisionCircleArrays[Es];_s===void 0&&(_s=this.collisionCircleArrays[Es]=new Me);for(let Ls=0;Ls<zr.circles.length;Ls+=4)_s.circles.push(zr.circles[Ls+0]),_s.circles.push(zr.circles[Ls+1]),_s.circles.push(zr.circles[Ls+2]),_s.circles.push(zr.collisionDetected?1:0)}if(Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new Ie(zt||Re,Dt||Le,Ot||g.justReloaded),u[Ke.crossTileID]=!0};if(je){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=g.getSortedSymbolIndexes(this.transform.angle);for(let bt=Ke.length-1;bt>=0;--bt){const ut=Ke[bt];Bt(g.symbolInstances.get(ut),g.collisionArrays[ut])}}else for(let Ke=i.symbolInstanceStart;Ke<i.symbolInstanceEnd;Ke++)Bt(g.symbolInstances.get(Ke),g.collisionArrays[Ke]);if(f&&g.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[g.bucketInstanceId];l.as(Ke.invProjMatrix,T),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(i,u,f,g){let _;_=g===l.ai.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[l.at(u)];const T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const E of T)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=_>=0&&E!==_?0:f.crossTileID)}markUsedOrientation(i,u,f){const g=u===l.ai.horizontal||u===l.ai.horizontalOnly?u:0,_=u===l.ai.vertical?u:0,T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const E of T)i.text.placedSymbolArray.get(E).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let f=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const g=u?u.symbolFadeChange(i):1,_=u?u.opacities:{},T=u?u.variableOffsets:{},E=u?u.placedOrientations:{};for(const A in this.placements){const D=this.placements[A],R=_[A];R?(this.opacities[A]=new ge(R,g,D.text,D.icon),f=f||D.text!==R.text.placed||D.icon!==R.icon.placed):(this.opacities[A]=new ge(null,g,D.text,D.icon,D.skipFade),f=f||D.text||D.icon)}for(const A in _){const D=_[A];if(!this.opacities[A]){const R=new ge(D,g,!1,!1);R.isHidden()||(this.opacities[A]=R,f=f||D.text.placed||D.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)}updateLayerOpacities(i,u){const f={};for(const g of u){const _=g.getBucket(i);_&&g.latestFeatureIndex&&i.id===_.layerIds[0]&&this.updateBucketOpacities(_,f,g.collisionBoxArray)}}updateBucketOpacities(i,u,f){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const g=i.layers[0],_=g.layout,T=new ge(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),D=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",$=_.get("icon-text-fit")!=="none",ee=new ge(null,0,E&&(A||!i.hasIconData()||_.get("icon-optional")),A&&(E||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&f&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(f);const Q=(ie,X,ye)=>{for(let Se=0;Se<X/4;Se++)ie.opacityVertexArray.emplaceBack(ye);ie.hasVisibleVertices=ie.hasVisibleVertices||ye!==ki};for(let ie=0;ie<i.symbolInstances.length;ie++){const X=i.symbolInstances.get(ie),{numHorizontalGlyphVertices:ye,numVerticalGlyphVertices:Se,crossTileID:ae}=X;let _e=this.opacities[ae];u[ae]?_e=T:_e||(_e=ee,this.opacities[ae]=_e),u[ae]=!0;const Ee=X.numIconVertices>0,Ae=this.placedOrientations[X.crossTileID],je=Ae===l.ai.vertical,Re=Ae===l.ai.horizontal||Ae===l.ai.horizontalOnly;if(ye>0||Se>0){const Le=ms(_e.text);Q(i.text,ye,je?ki:Le),Q(i.text,Se,Re?ki:Le);const $e=_e.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(Ke=>{Ke>=0&&(i.text.placedSymbolArray.get(Ke).hidden=$e||je?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=$e||Re?1:0);const lt=this.variableOffsets[X.crossTileID];lt&&this.markUsedJustification(i,lt.anchor,X,Ae);const Bt=this.placedOrientations[X.crossTileID];Bt&&(this.markUsedJustification(i,"left",X,Bt),this.markUsedOrientation(i,Bt,X))}if(Ee){const Le=ms(_e.icon),$e=!($&&X.verticalPlacedIconSymbolIndex&&je);X.placedIconSymbolIndex>=0&&(Q(i.icon,X.numIconVertices,$e?Le:ki),i.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=_e.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(Q(i.icon,X.numVerticalIconVertices,$e?ki:Le),i.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=_e.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Le=i.collisionArrays[ie];if(Le){let $e=new l.P(0,0);if(Le.textBox||Le.verticalTextBox){let Bt=!0;if(D){const Ke=this.variableOffsets[ae];Ke?($e=wt(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textBoxScale),R&&$e._rotate(z?this.transform.angle:-this.transform.angle)):Bt=!1}Le.textBox&&At(i.textCollisionBox.collisionVertexArray,_e.text.placed,!Bt||je,$e.x,$e.y),Le.verticalTextBox&&At(i.textCollisionBox.collisionVertexArray,_e.text.placed,!Bt||Re,$e.x,$e.y)}const lt=!!(!Re&&Le.verticalIconBox);Le.iconBox&&At(i.iconCollisionBox.collisionVertexArray,_e.icon.placed,lt,$?$e.x:0,$?$e.y:0),Le.verticalIconBox&&At(i.iconCollisionBox.collisionVertexArray,_e.icon.placed,!lt,$?$e.x:0,$?$e.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ie.invProjMatrix,i.placementViewportMatrix=ie.viewportMatrix,i.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,u){const f=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*f>i}setStale(){this.stale=!0}}function At(y,i,u,f,g){y.emplaceBack(i?1:0,u?1:0,f||0,g||0),y.emplaceBack(i?1:0,u?1:0,f||0,g||0),y.emplaceBack(i?1:0,u?1:0,f||0,g||0),y.emplaceBack(i?1:0,u?1:0,f||0,g||0)}const rr=Math.pow(2,25),lr=Math.pow(2,24),Zt=Math.pow(2,17),Gt=Math.pow(2,16),ks=Math.pow(2,9),hr=Math.pow(2,8),Gr=Math.pow(2,1);function ms(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const i=y.placed?1:0,u=Math.floor(127*y.opacity);return u*rr+i*lr+u*Zt+i*Gt+u*ks+i*hr+u*Gr+i}const ki=0;class ef{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,u,f,g,_){const T=this._bucketParts;for(;this._currentTileIndex<i.length;)if(u.getBucketParts(T,g,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,A)=>E.sortKey-A.sortKey));this._currentPartIndex<T.length;)if(u.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,_())return!0;return!1}}class Wa{constructor(i,u,f,g,_,T,E,A){this.placement=new gt(i,u,T,E,A),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,u,f){const g=l.h.now(),_=()=>!this._forceFullPlacement&&l.h.now()-g>2;for(;this._currentPlacementIndex>=0;){const T=u[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=E)&&(!T.maxzoom||T.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new ef(T)),this._inProgressLayer.continuePlacement(f[T.source],this.placement,this._showCollisionBoxes,T,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Za=512/l.N/2;class hg{constructor(i,u,f){this.tileID=i,this.bucketInstanceId=f,this._symbolsByKey={};const g=new Map;for(let _=0;_<u.length;_++){const T=u.get(_),E=T.key,A=g.get(E);A?A.push(T):g.set(E,[T])}for(const[_,T]of g){const E={positions:T.map(A=>({x:Math.floor(A.anchorX*Za),y:Math.floor(A.anchorY*Za)})),crossTileIDs:T.map(A=>A.crossTileID)};if(E.positions.length>128){const A=new l.av(E.positions.length,16,Uint16Array);for(const{x:D,y:R}of E.positions)A.add(D,R);A.finish(),delete E.positions,E.index=A}this._symbolsByKey[_]=E}}getScaledCoordinates(i,u){const{x:f,y:g,z:_}=this.tileID.canonical,{x:T,y:E,z:A}=u.canonical,D=Za/Math.pow(2,A-_),R=(E*l.N+i.anchorY)*D,z=g*l.N*Za;return{x:Math.floor((T*l.N+i.anchorX)*D-f*l.N*Za),y:Math.floor(R-z)}}findMatches(i,u,f){const g=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let _=0;_<i.length;_++){const T=i.get(_);if(T.crossTileID)continue;const E=this._symbolsByKey[T.key];if(!E)continue;const A=this.getScaledCoordinates(T,u);if(E.index){const D=E.index.range(A.x-g,A.y-g,A.x+g,A.y+g).sort();for(const R of D){const z=E.crossTileIDs[R];if(!f[z]){f[z]=!0,T.crossTileID=z;break}}}else if(E.positions)for(let D=0;D<E.positions.length;D++){const R=E.positions[D],z=E.crossTileIDs[D];if(Math.abs(R.x-A.x)<=g&&Math.abs(R.y-A.y)<=g&&!f[z]){f[z]=!0,T.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class ar{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ku{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const u=Math.round((i-this.lng)/360);if(u!==0)for(const f in this.indexes){const g=this.indexes[f],_={};for(const T in g){const E=g[T];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+u),_[E.tileID.key]=E}this.indexes[f]=_}this.lng=i}addBucket(i,u,f){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<u.symbolInstances.length;_++)u.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const g=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const T=this.indexes[_];if(Number(_)>i.overscaledZ)for(const E in T){const A=T[E];A.tileID.isChildOf(i)&&A.findMatches(u.symbolInstances,i,g)}else{const E=T[i.scaledTo(Number(_)).key];E&&E.findMatches(u.symbolInstances,i,g)}}for(let _=0;_<u.symbolInstances.length;_++){const T=u.symbolInstances.get(_);T.crossTileID||(T.crossTileID=f.generate(),g[T.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new hg(i,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(i,u){for(const f of u.getCrossTileIDsLists())for(const g of f)delete this.usedCrossTileIDs[i][g]}removeStaleBuckets(i){let u=!1;for(const f in this.indexes){const g=this.indexes[f];for(const _ in g)i[g[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[_]),delete g[_],u=!0)}return u}}class Bl{constructor(){this.layerIndexes={},this.crossTileIDs=new ar,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,u,f){let g=this.layerIndexes[i.id];g===void 0&&(g=this.layerIndexes[i.id]=new ku);let _=!1;const T={};g.handleWrapJump(f);for(const E of u){const A=E.getBucket(i);A&&i.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(E.tileID,A,this.crossTileIDs)&&(_=!0),T[A.bucketInstanceId]=!0)}return g.removeStaleBuckets(T)&&(_=!0),_}pruneUnusedLayers(i){const u={};i.forEach(f=>{u[f]=!0});for(const f in this.layerIndexes)u[f]||delete this.layerIndexes[f]}}const Ts=(y,i)=>l.x(y,i&&i.filter(u=>u.identifier!=="source.canvas")),ii=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),dg=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),Ti=l.aw();class gs extends l.E{constructor(i,u={}){super(),this.map=i,this.dispatcher=new Ct(ma(),this,i._getMapId()),this.imageManager=new Oe,this.imageManager.setEventedParent(this),this.glyphManager=new ir(i._requestManager,u.localIdeographFontFamily),this.lineAtlas=new Fe(256,512),this.crossTileSymbolIndex=new Bl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());const f=this;this._rtlTextPluginCallback=gs.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(_,T)=>{if(l.aA(_),T&&T.every(E=>E))for(const E in f.sourceCaches){const A=f.sourceCaches[E].getSource().type;A!=="vector"&&A!=="geojson"||f.sourceCaches[E].reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const _=this.sourceCaches[g.sourceId];if(!_)return;const T=_.getSource();if(T&&T.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===T.id&&this._validateLayer(A)}})}loadURL(i,u={},f){this.fire(new l.k("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const g=this.map._requestManager.transformRequest(i,G.Style);this._request=l.f(g,(_,T)=>{this._request=null,_?this.fire(new l.j(_)):T&&this._load(T,u,f)})}loadJSON(i,u={},f){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,u.validate=u.validate!==!1,this._load(i,u,f)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Ti,{validate:!1})}_load(i,u,f){var g;const _=u.transformStyle?u.transformStyle(f,i):i;if(!u.validate||!Ts(this,l.y(_))){this._loaded=!0,this.stylesheet=_;for(const T in _.sources)this.addSource(T,_.sources[T],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new st(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const i=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",i),this._order=i.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of i){const f=l.aC(u);f.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=f}}_loadSprite(i,u=!1,f=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(g,_,T,E){const A=Te(g),D=A.length,R=T>1?"@2x":"",z={},$={},ee={};for(const{id:Q,url:ie}of A){const X=_.transformRequest(_.normalizeSpriteURL(ie,R,".json"),G.SpriteJSON),ye=`${Q}_${X.url}`;z[ye]=l.f(X,(_e,Ee)=>{delete z[ye],$[Q]=Ee,rt(E,$,ee,_e,D)});const Se=_.transformRequest(_.normalizeSpriteURL(ie,R,".png"),G.SpriteImage),ae=`${Q}_${Se.url}`;z[ae]=de.getImage(Se,(_e,Ee)=>{delete z[ae],ee[Q]=Ee,rt(E,$,ee,_e,D)})}return{cancel(){for(const Q of Object.values(z))Q.cancel()}}}(i,this.map._requestManager,this.map.getPixelRatio(),(g,_)=>{if(this._spriteRequest=null,g)this.fire(new l.j(g));else if(_)for(const T in _){this._spritesImagesIds[T]=[];const E=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(A=>!(A in _)):[];for(const A of E)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in _[T]){const D=T==="default"?A:`${T}:${A}`;this._spritesImagesIds[T].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,_[T][A],!1):this.imageManager.addImage(D,_[T][A]),u&&(this._changedImages[D]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),f&&f(g)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(i){const u=this.sourceCaches[i.source];if(!u)return;const f=i.sourceLayer;if(!f)return;const g=u.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(f)===-1)&&this.fire(new l.j(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const u=this._serializedAllLayers();if(!i||i.length===0)return Object.values(u);const f=[];for(const g of i)u[g]&&f.push(u[g]);return f}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const u=Object.keys(this._layers);for(const f of u){const g=this._layers[f];g.type!=="custom"&&(i[f]=g.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const u=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(g.length||_.length)&&this._updateWorkerLayers(g,_);for(const T in this._updatedSources){const E=this._updatedSources[T];if(E==="reload")this._reloadSource(T);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const f={};for(const g in this.sourceCaches){const _=this.sourceCaches[g];f[g]=_.used,_.used=!1}for(const g of this._order){const _=this._layers[g];_.recalculate(i,this._availableImages),!_.isHidden(i.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const g in f){const _=this.sourceCaches[g];f[g]!==_.used&&_.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(i),this.z=i.zoom,u&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(i),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,u={}){this._checkLoaded();const f=this.serialize();if(i=u.transformStyle?u.transformStyle(f,i):i,Ts(this,l.y(i)))return!1;(i=l.aD(i)).layers=l.aB(i.layers);const g=l.aE(f,i).filter(T=>!(T.command in dg));if(g.length===0)return!1;const _=g.filter(T=>!(T.command in ii));if(_.length>0)throw new Error(`Unimplemented: ${_.map(T=>T.command).join(", ")}.`);for(const T of g)T.command!=="setTransition"&&this[T.command].apply(this,T.args);return this.stylesheet=i,this._serializedLayers=null,!0}addImage(i,u){if(this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,u),this._afterImageUpdated(i)}updateImage(i,u){this.imageManager.updateImage(i,u)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new l.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,u,f={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(l.y.source,`sources.${i}`,u,null,f))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const g=this.sourceCaches[i]=new fs(i,u,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:i})),g.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===i)return this.fire(new l.j(new Error(`Source "${i}" cannot be removed while layer "${f}" is using it.`)));const u=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],u.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,u){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const f=this.sourceCaches[i].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(u),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,u,f={}){this._checkLoaded();const g=i.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let _;if(i.type==="custom"){if(Ts(this,l.aF(i)))return;_=l.aC(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(g,i.source),i=l.aD(i),i=l.e(i,{source:g})),this._validate(l.y.layer,`layers.${g}`,i,{arrayIndex:-1},f))return;_=l.aC(i),this._validateLayer(_),_.setEventedParent(this,{layer:{id:g}})}const T=u?this._order.indexOf(u):this._order.length;if(u&&T===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${u}".`)));else{if(this._order.splice(T,0,g),this._layerOrderChanged=!0,this._layers[g]=_,this._removedLayers[g]&&_.source&&_.type!=="custom"){const E=this._removedLayers[g];delete this._removedLayers[g],E.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(i,u){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new l.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===u)return;const f=this._order.indexOf(i);this._order.splice(f,1);const g=u?this._order.indexOf(u):this._order.length;u&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${i}" before non-existing layer "${u}".`))):(this._order.splice(g,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const u=this._layers[i];if(!u)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${i}".`)));u.setEventedParent(null);const f=this._order.indexOf(i);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=u,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],u.onRemove&&u.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,u,f){this._checkLoaded();const g=this.getLayer(i);g?g.minzoom===u&&g.maxzoom===f||(u!=null&&(g.minzoom=u),f!=null&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,u,f={}){this._checkLoaded();const g=this.getLayer(i);if(g){if(!l.aG(g.filter,u))return u==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.y.filter,`layers.${g.id}.filter`,u,null,f)||(g.filter=l.aD(u),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return l.aD(this.getLayer(i).filter)}setLayoutProperty(i,u,f,g={}){this._checkLoaded();const _=this.getLayer(i);_?l.aG(_.getLayoutProperty(u),f)||(_.setLayoutProperty(u,f,g),this._updateLayer(_)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,u){const f=this.getLayer(i);if(f)return f.getLayoutProperty(u);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,u,f,g={}){this._checkLoaded();const _=this.getLayer(i);_?l.aG(_.getPaintProperty(u),f)||(_.setPaintProperty(u,f,g)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,u){return this.getLayer(i).getPaintProperty(u)}setFeatureState(i,u){this._checkLoaded();const f=i.source,g=i.sourceLayer,_=this.sourceCaches[f];if(_===void 0)return void this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)));const T=_.getSource().type;T==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||g?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(g,i.id,u)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,u){this._checkLoaded();const f=i.source,g=this.sourceCaches[f];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)));const _=g.getSource().type,T=_==="vector"?i.sourceLayer:void 0;_!=="vector"||T?u&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(T,i.id,u):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const u=i.source,f=i.sourceLayer,g=this.sourceCaches[u];if(g!==void 0)return g.getSource().type!=="vector"||f?(i.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,i.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=l.aH(this.sourceCaches,_=>_.serialize()),u=this._serializeByIds(this._order),f=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aI({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:i,layers:u,terrain:f},_=>_!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const u=T=>this._layers[T].type==="fill-extrusion",f={},g=[];for(let T=this._order.length-1;T>=0;T--){const E=this._order[T];if(u(E)){f[E]=T;for(const A of i){const D=A[E];if(D)for(const R of D)g.push(R)}}}g.sort((T,E)=>E.intersectionZ-T.intersectionZ);const _=[];for(let T=this._order.length-1;T>=0;T--){const E=this._order[T];if(u(E))for(let A=g.length-1;A>=0;A--){const D=g[A].feature;if(f[D.layer.id]<T)break;_.push(D),g.pop()}else for(const A of i){const D=A[E];if(D)for(const R of D)_.push(R.feature)}}return _}queryRenderedFeatures(i,u,f){u&&u.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",u.filter,null,u);const g={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const E of u.layers){const A=this._layers[E];if(!A)return this.fire(new l.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];g[A.source]=!0}}const _=[];u.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const E in this.sourceCaches)u.layers&&!g[E]||_.push(bi(this.sourceCaches[E],this._layers,T,i,u,f));return this.placement&&_.push(function(E,A,D,R,z,$,ee){const Q={},ie=$.queryRenderedSymbols(R),X=[];for(const ye of Object.keys(ie).map(Number))X.push(ee[ye]);X.sort(rn);for(const ye of X){const Se=ye.featureIndex.lookupSymbolFeatures(ie[ye.bucketInstanceId],A,ye.bucketIndex,ye.sourceLayerIndex,z.filter,z.layers,z.availableImages,E);for(const ae in Se){const _e=Q[ae]=Q[ae]||[],Ee=Se[ae];Ee.sort((Ae,je)=>{const Re=ye.featureSortOrder;if(Re){const Le=Re.indexOf(Ae.featureIndex);return Re.indexOf(je.featureIndex)-Le}return je.featureIndex-Ae.featureIndex});for(const Ae of Ee)_e.push(Ae)}}for(const ye in Q)Q[ye].forEach(Se=>{const ae=Se.feature,_e=D[E[ye].source].getFeatureState(ae.layer["source-layer"],ae.id);ae.source=ae.layer.source,ae.layer["source-layer"]&&(ae.sourceLayer=ae.layer["source-layer"]),ae.state=_e});return Q}(this._layers,T,this.sourceCaches,i,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,u){u&&u.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",u.filter,null,u);const f=this.sourceCaches[i];return f?function(g,_){const T=g.getRenderableIds().map(D=>g.getTileByID(D)),E=[],A={};for(let D=0;D<T.length;D++){const R=T[D],z=R.tileID.canonical.key;A[z]||(A[z]=!0,R.querySourceFeatures(E,_))}return E}(f,u):[]}addSourceType(i,u,f){return Fi(i)?f(new Error(`A source type called "${i}" already exists.`)):(((g,_)=>{qr[g]=_})(i,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:u.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(i,u={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const T in i)if(!l.aG(i[T],f[T])){g=!0;break}if(!g)return;const _={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,u),this.light.updateTransitions(_)}_validate(i,u,f,g,_={}){return(!_||_.validate!==!1)&&Ts(this,i.call(l.y,l.e({key:u,style:this.serialize(),value:f,styleSpec:l.v},g)))}_remove(i=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const f=this.sourceCaches[u];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const u in this.sourceCaches)this.sourceCaches[u].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,u,f,g,_=!1){let T=!1,E=!1;const A={};for(const D of this._order){const R=this._layers[D];if(R.type!=="symbol")continue;if(!A[R.source]){const $=this.sourceCaches[R.source];A[R.source]=$.getRenderableIds(!0).map(ee=>$.getTileByID(ee)).sort((ee,Q)=>Q.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(Q.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(R,A[R.source],i.center.lng);T=T||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),i.zoom))&&(this.pauseablePlacement=new Wa(i,this.map.terrain,this._order,_,u,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),E=!0),T&&this.pauseablePlacement.placement.setStale()),E||T)for(const D of this._order){const R=this._layers[D];R.type==="symbol"&&this.placement.updateLayerOpacities(R,A[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,u,f){this.imageManager.getImages(u.icons,f),this._updateTilesForChangedImages();const g=this.sourceCaches[u.source];g&&g.setDependencies(u.tileID.key,u.type,u.icons)}getGlyphs(i,u,f){this.glyphManager.getGlyphs(u.stacks,f);const g=this.sourceCaches[u.source];g&&g.setDependencies(u.tileID.key,u.type,[""])}getResource(i,u,f){return l.m(u,f)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,u={}){this._checkLoaded(),i&&this._validate(l.y.glyphs,"glyphs",i,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,u,f={},g){this._checkLoaded();const _=[{id:i,url:u}],T=[...Te(this.stylesheet.sprite),..._];this._validate(l.y.sprite,"sprite",T,null,f)||(this.stylesheet.sprite=T,this._loadSprite(_,!0,g))}removeSprite(i){this._checkLoaded();const u=Te(this.stylesheet.sprite);if(u.find(f=>f.id===i)){if(this._spritesImagesIds[i])for(const f of this._spritesImagesIds[i])this.imageManager.removeImage(f),this._changedImages[f]=!0;u.splice(u.findIndex(f=>f.id===i),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return Te(this.stylesheet.sprite)}setSprite(i,u={},f){this._checkLoaded(),i&&this._validate(l.y.sprite,"sprite",i,null,u)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,f):(this._unloadSprite(),f&&f(null)))}}gs.registerForPluginStateChange=l.aK;var Ol=l.Q([{name:"a_pos",type:"Int16",components:2}]),Ha="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const xr={prelude:Yt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Yt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Yt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Yt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Yt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Yt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Yt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Yt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Yt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Yt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Yt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Yt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Yt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Yt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Yt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Yt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Yt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Yt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Yt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Yt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Yt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Yt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Yt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Yt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ha),terrainDepth:Yt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ha),terrainCoords:Yt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ha)};function Yt(y,i){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=i.match(/attribute ([\w]+) ([\w]+)/g),g=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=_?_.concat(g):g,E={};return{fragmentSource:y=y.replace(u,(A,D,R,z,$)=>(E[$]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${R} ${z} ${$};
#else
uniform ${R} ${z} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${R} ${z} ${$} = u_${$};
#endif
`)),vertexSource:i=i.replace(u,(A,D,R,z,$)=>{const ee=z==="float"?"vec2":"vec4",Q=$.match(/color/)?"color":ee;return E[$]?D==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${R} ${ee} a_${$};
varying ${R} ${z} ${$};
#else
uniform ${R} ${z} u_${$};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${R} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${Q}(a_${$}, u_${$}_t);
#else
    ${R} ${z} ${$} = u_${$};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${R} ${ee} a_${$};
#else
uniform ${R} ${z} u_${$};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${R} ${z} ${$} = a_${$};
#else
    ${R} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${R} ${z} ${$} = unpack_mix_${Q}(a_${$}, u_${$}_t);
#else
    ${R} ${z} ${$} = u_${$};
#endif
`}),staticAttributes:f,staticUniforms:T}}class ga{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,u,f,g,_,T,E,A,D){this.context=i;let R=this.boundPaintVertexBuffers.length!==g.length;for(let z=0;!R&&z<g.length;z++)this.boundPaintVertexBuffers[z]!==g[z]&&(R=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==f||R||this.boundIndexBuffer!==_||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==D?this.freshBind(u,f,g,_,T,E,A,D):(i.bindVertexArray.set(this.vao),E&&E.bind(),_&&_.dynamicDraw&&_.bind(),A&&A.bind(),D&&D.bind())}freshBind(i,u,f,g,_,T,E,A){const D=i.numAttributes,R=this.context,z=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=A,u.enableAttributes(z,i);for(const $ of f)$.enableAttributes(z,i);T&&T.enableAttributes(z,i),E&&E.enableAttributes(z,i),A&&A.enableAttributes(z,i),u.bind(),u.setVertexAttribPointers(z,i,_);for(const $ of f)$.bind(),$.setVertexAttribPointers(z,i,_);T&&(T.bind(),T.setVertexAttribPointers(z,i,_)),g&&g.bind(),E&&(E.bind(),E.setVertexAttribPointers(z,i,_)),A&&(A.bind(),A.setVertexAttribPointers(z,i,_)),R.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Er(y){const i=[];for(let u=0;u<y.length;u++){if(y[u]===null)continue;const f=y[u].split(" ");i.push(f.pop())}return i}class Fl{constructor(i,u,f,g,_,T){const E=i.gl;this.program=E.createProgram();const A=Er(u.staticAttributes),D=f?f.getBinderAttributes():[],R=A.concat(D),z=xr.prelude.staticUniforms?Er(xr.prelude.staticUniforms):[],$=u.staticUniforms?Er(u.staticUniforms):[],ee=f?f.getBinderUniforms():[],Q=z.concat($).concat(ee),ie=[];for(const Ae of Q)ie.indexOf(Ae)<0&&ie.push(Ae);const X=f?f.defines():[];_&&X.push("#define OVERDRAW_INSPECTOR;"),T&&X.push("#define TERRAIN3D;");const ye=X.concat(xr.prelude.fragmentSource,u.fragmentSource).join(`
`),Se=X.concat(xr.prelude.vertexSource,u.vertexSource).join(`
`),ae=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(ae,ye),E.compileShader(ae),!E.getShaderParameter(ae,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(ae)}`);E.attachShader(this.program,ae);const _e=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(_e,Se),E.compileShader(_e),!E.getShaderParameter(_e,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(_e)}`);E.attachShader(this.program,_e),this.attributes={};const Ee={};this.numAttributes=R.length;for(let Ae=0;Ae<this.numAttributes;Ae++)R[Ae]&&(E.bindAttribLocation(this.program,Ae,R[Ae]),this.attributes[R[Ae]]=Ae);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(_e),E.deleteShader(ae);for(let Ae=0;Ae<ie.length;Ae++){const je=ie[Ae];if(je&&!Ee[je]){const Re=E.getUniformLocation(this.program,je);Re&&(Ee[je]=Re)}}this.fixedUniforms=g(i,Ee),this.terrainUniforms=((Ae,je)=>({u_depth:new l.aL(Ae,je.u_depth),u_terrain:new l.aL(Ae,je.u_terrain),u_terrain_dim:new l.aM(Ae,je.u_terrain_dim),u_terrain_matrix:new l.aN(Ae,je.u_terrain_matrix),u_terrain_unpack:new l.aO(Ae,je.u_terrain_unpack),u_terrain_exaggeration:new l.aM(Ae,je.u_terrain_exaggeration)}))(i,Ee),this.binderUniforms=f?f.getUniforms(i,Ee):[]}draw(i,u,f,g,_,T,E,A,D,R,z,$,ee,Q,ie,X,ye,Se){const ae=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(f),i.setStencilMode(g),i.setColorMode(_),i.setCullFace(T),A){i.activeTexture.set(ae.TEXTURE2),ae.bindTexture(ae.TEXTURE_2D,A.depthTexture),i.activeTexture.set(ae.TEXTURE3),ae.bindTexture(ae.TEXTURE_2D,A.texture);for(const Ee in this.terrainUniforms)this.terrainUniforms[Ee].set(A[Ee])}for(const Ee in this.fixedUniforms)this.fixedUniforms[Ee].set(E[Ee]);ie&&ie.setUniforms(i,this.binderUniforms,ee,{zoom:Q});let _e=0;switch(u){case ae.LINES:_e=2;break;case ae.TRIANGLES:_e=3;break;case ae.LINE_STRIP:_e=1}for(const Ee of $.get()){const Ae=Ee.vaos||(Ee.vaos={});(Ae[D]||(Ae[D]=new ga)).bind(i,this,R,ie?ie.getPaintVertexBuffers():[],z,Ee.vertexOffset,X,ye,Se),ae.drawElements(u,Ee.primitiveLength*_e,ae.UNSIGNED_SHORT,Ee.primitiveOffset*_e*2)}}}function Ei(y,i,u){const f=1/he(u,1,i.transform.tileZoom),g=Math.pow(2,u.tileID.overscaledZ),_=u.tileSize*Math.pow(2,i.transform.tileZoom)/g,T=_*(u.tileID.canonical.x+u.tileID.wrap*g),E=_*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[T>>16,E>>16],u_pixel_coord_lower:[65535&T,65535&E]}}const Tu=(y,i,u,f)=>{const g=i.style.light,_=g.properties.get("position"),T=[_.x,_.y,_.z],E=function(){var D=new l.A(9);return l.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();g.properties.get("anchor")==="viewport"&&function(D,R){var z=Math.sin(R),$=Math.cos(R);D[0]=$,D[1]=z,D[2]=0,D[3]=-z,D[4]=$,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(E,-i.transform.angle),function(D,R,z){var $=R[0],ee=R[1],Q=R[2];D[0]=$*z[0]+ee*z[3]+Q*z[6],D[1]=$*z[1]+ee*z[4]+Q*z[7],D[2]=$*z[2]+ee*z[5]+Q*z[8]}(T,T,E);const A=g.properties.get("color");return{u_matrix:y,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+u,u_opacity:f}},Kn=(y,i,u,f,g,_,T)=>l.e(Tu(y,i,u,f),Ei(_,i,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8}),tf=y=>({u_matrix:y}),Eu=(y,i,u,f)=>l.e(tf(y),Ei(u,i,f)),$l=(y,i)=>({u_matrix:y,u_world:i}),Ul=(y,i,u,f,g)=>l.e(Eu(y,i,u,f),{u_world:g}),Xn=(y,i,u,f)=>{const g=y.transform;let _,T;if(f.paint.get("circle-pitch-alignment")==="map"){const E=he(u,1,g.zoom);_=!0,T=[E,E]}else _=!1,T=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(i.posMatrix,u,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:T}},Cu=(y,i,u)=>{const f=he(u,1,i.zoom),g=Math.pow(2,i.zoom-u.tileID.overscaledZ),_=u.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[i.pixelsToGLUnits[0]/(f*g),i.pixelsToGLUnits[1]/(f*g)],u_overscale_factor:_}},qo=(y,i,u=1)=>({u_matrix:y,u_color:i,u_overlay:0,u_overlay_scale:u}),rf=y=>({u_matrix:y}),fg=(y,i,u,f)=>({u_matrix:y,u_extrude_scale:he(i,1,u),u_intensity:f});function Au(y,i){const u=Math.pow(2,i.canonical.z),f=i.canonical.y;return[new l.U(0,f/u).toLngLat().lat,new l.U(0,(f+1)/u).toLngLat().lat]}const Pu=(y,i,u,f)=>{const g=y.transform;return{u_matrix:Vl(y,i,u,f),u_ratio:1/he(i,1,g.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},sf=(y,i,u,f,g)=>l.e(Pu(y,i,u,g),{u_image:0,u_image_height:f}),pg=(y,i,u,f,g)=>{const _=y.transform,T=af(i,_);return{u_matrix:Vl(y,i,u,g),u_texsize:i.imageAtlasTexture.size,u_ratio:1/he(i,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[T,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},nf=(y,i,u,f,g,_)=>{const T=y.lineAtlas,E=af(i,y.transform),A=u.layout.get("line-cap")==="round",D=T.getDash(f.from,A),R=T.getDash(f.to,A),z=D.width*g.fromScale,$=R.width*g.toScale;return l.e(Pu(y,i,u,_),{u_patternscale_a:[E/z,-D.height/2],u_patternscale_b:[E/$,-R.height/2],u_sdfgamma:T.width/(256*Math.min(z,$)*y.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:R.y,u_mix:g.t})};function af(y,i){return 1/he(y,1,i.tileZoom)}function Vl(y,i,u,f){return y.translatePosMatrix(f?f.posMatrix:i.tileID.posMatrix,i,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const of=(y,i,u,f,g)=>{return{u_matrix:y,u_tl_parent:i,u_scale_parent:u,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(_=g.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:lf(g.paint.get("raster-hue-rotate"))};var _,T};function lf(y){y*=Math.PI/180;const i=Math.sin(y),u=Math.cos(y);return[(2*u+1)/3,(-Math.sqrt(3)*i-u+1)/3,(Math.sqrt(3)*i-u+1)/3]}const Iu=(y,i,u,f,g,_,T,E,A,D)=>{const R=g.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:R.width/R.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:T,u_coord_matrix:E,u_is_text:+A,u_pitch_with_map:+f,u_texsize:D,u_texture:0}},Mu=(y,i,u,f,g,_,T,E,A,D,R)=>{const z=g.transform;return l.e(Iu(y,i,u,f,g,_,T,E,A,D),{u_gamma_scale:f?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:1})},ya=(y,i,u,f,g,_,T,E,A,D)=>l.e(Mu(y,i,u,f,g,_,T,E,!0,A),{u_texsize_icon:D,u_texture_icon:1}),ql=(y,i,u)=>({u_matrix:y,u_opacity:i,u_color:u}),Ci=(y,i,u,f,g,_)=>l.e(function(T,E,A,D){const R=A.imageManager.getPattern(T.from.toString()),z=A.imageManager.getPattern(T.to.toString()),{width:$,height:ee}=A.imageManager.getPixelSize(),Q=Math.pow(2,D.tileID.overscaledZ),ie=D.tileSize*Math.pow(2,A.transform.tileZoom)/Q,X=ie*(D.tileID.canonical.x+D.tileID.wrap*Q),ye=ie*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[$,ee],u_mix:E.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/he(D,1,A.transform.tileZoom),u_pixel_coord_upper:[X>>16,ye>>16],u_pixel_coord_lower:[65535&X,65535&ye]}}(f,_,u,g),{u_matrix:y,u_opacity:i}),Gl={fillExtrusion:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_lightpos:new l.aP(y,i.u_lightpos),u_lightintensity:new l.aM(y,i.u_lightintensity),u_lightcolor:new l.aP(y,i.u_lightcolor),u_vertical_gradient:new l.aM(y,i.u_vertical_gradient),u_opacity:new l.aM(y,i.u_opacity)}),fillExtrusionPattern:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_lightpos:new l.aP(y,i.u_lightpos),u_lightintensity:new l.aM(y,i.u_lightintensity),u_lightcolor:new l.aP(y,i.u_lightcolor),u_vertical_gradient:new l.aM(y,i.u_vertical_gradient),u_height_factor:new l.aM(y,i.u_height_factor),u_image:new l.aL(y,i.u_image),u_texsize:new l.aQ(y,i.u_texsize),u_pixel_coord_upper:new l.aQ(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(y,i.u_pixel_coord_lower),u_scale:new l.aP(y,i.u_scale),u_fade:new l.aM(y,i.u_fade),u_opacity:new l.aM(y,i.u_opacity)}),fill:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix)}),fillPattern:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_image:new l.aL(y,i.u_image),u_texsize:new l.aQ(y,i.u_texsize),u_pixel_coord_upper:new l.aQ(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(y,i.u_pixel_coord_lower),u_scale:new l.aP(y,i.u_scale),u_fade:new l.aM(y,i.u_fade)}),fillOutline:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_world:new l.aQ(y,i.u_world)}),fillOutlinePattern:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_world:new l.aQ(y,i.u_world),u_image:new l.aL(y,i.u_image),u_texsize:new l.aQ(y,i.u_texsize),u_pixel_coord_upper:new l.aQ(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(y,i.u_pixel_coord_lower),u_scale:new l.aP(y,i.u_scale),u_fade:new l.aM(y,i.u_fade)}),circle:(y,i)=>({u_camera_to_center_distance:new l.aM(y,i.u_camera_to_center_distance),u_scale_with_map:new l.aL(y,i.u_scale_with_map),u_pitch_with_map:new l.aL(y,i.u_pitch_with_map),u_extrude_scale:new l.aQ(y,i.u_extrude_scale),u_device_pixel_ratio:new l.aM(y,i.u_device_pixel_ratio),u_matrix:new l.aN(y,i.u_matrix)}),collisionBox:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_camera_to_center_distance:new l.aM(y,i.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(y,i.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(y,i.u_extrude_scale),u_overscale_factor:new l.aM(y,i.u_overscale_factor)}),collisionCircle:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_inv_matrix:new l.aN(y,i.u_inv_matrix),u_camera_to_center_distance:new l.aM(y,i.u_camera_to_center_distance),u_viewport_size:new l.aQ(y,i.u_viewport_size)}),debug:(y,i)=>({u_color:new l.aR(y,i.u_color),u_matrix:new l.aN(y,i.u_matrix),u_overlay:new l.aL(y,i.u_overlay),u_overlay_scale:new l.aM(y,i.u_overlay_scale)}),clippingMask:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix)}),heatmap:(y,i)=>({u_extrude_scale:new l.aM(y,i.u_extrude_scale),u_intensity:new l.aM(y,i.u_intensity),u_matrix:new l.aN(y,i.u_matrix)}),heatmapTexture:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_world:new l.aQ(y,i.u_world),u_image:new l.aL(y,i.u_image),u_color_ramp:new l.aL(y,i.u_color_ramp),u_opacity:new l.aM(y,i.u_opacity)}),hillshade:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_image:new l.aL(y,i.u_image),u_latrange:new l.aQ(y,i.u_latrange),u_light:new l.aQ(y,i.u_light),u_shadow:new l.aR(y,i.u_shadow),u_highlight:new l.aR(y,i.u_highlight),u_accent:new l.aR(y,i.u_accent)}),hillshadePrepare:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_image:new l.aL(y,i.u_image),u_dimension:new l.aQ(y,i.u_dimension),u_zoom:new l.aM(y,i.u_zoom),u_unpack:new l.aO(y,i.u_unpack)}),line:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_ratio:new l.aM(y,i.u_ratio),u_device_pixel_ratio:new l.aM(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(y,i.u_units_to_pixels)}),lineGradient:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_ratio:new l.aM(y,i.u_ratio),u_device_pixel_ratio:new l.aM(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(y,i.u_units_to_pixels),u_image:new l.aL(y,i.u_image),u_image_height:new l.aM(y,i.u_image_height)}),linePattern:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_texsize:new l.aQ(y,i.u_texsize),u_ratio:new l.aM(y,i.u_ratio),u_device_pixel_ratio:new l.aM(y,i.u_device_pixel_ratio),u_image:new l.aL(y,i.u_image),u_units_to_pixels:new l.aQ(y,i.u_units_to_pixels),u_scale:new l.aP(y,i.u_scale),u_fade:new l.aM(y,i.u_fade)}),lineSDF:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_ratio:new l.aM(y,i.u_ratio),u_device_pixel_ratio:new l.aM(y,i.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(y,i.u_units_to_pixels),u_patternscale_a:new l.aQ(y,i.u_patternscale_a),u_patternscale_b:new l.aQ(y,i.u_patternscale_b),u_sdfgamma:new l.aM(y,i.u_sdfgamma),u_image:new l.aL(y,i.u_image),u_tex_y_a:new l.aM(y,i.u_tex_y_a),u_tex_y_b:new l.aM(y,i.u_tex_y_b),u_mix:new l.aM(y,i.u_mix)}),raster:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_tl_parent:new l.aQ(y,i.u_tl_parent),u_scale_parent:new l.aM(y,i.u_scale_parent),u_buffer_scale:new l.aM(y,i.u_buffer_scale),u_fade_t:new l.aM(y,i.u_fade_t),u_opacity:new l.aM(y,i.u_opacity),u_image0:new l.aL(y,i.u_image0),u_image1:new l.aL(y,i.u_image1),u_brightness_low:new l.aM(y,i.u_brightness_low),u_brightness_high:new l.aM(y,i.u_brightness_high),u_saturation_factor:new l.aM(y,i.u_saturation_factor),u_contrast_factor:new l.aM(y,i.u_contrast_factor),u_spin_weights:new l.aP(y,i.u_spin_weights)}),symbolIcon:(y,i)=>({u_is_size_zoom_constant:new l.aL(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(y,i.u_is_size_feature_constant),u_size_t:new l.aM(y,i.u_size_t),u_size:new l.aM(y,i.u_size),u_camera_to_center_distance:new l.aM(y,i.u_camera_to_center_distance),u_pitch:new l.aM(y,i.u_pitch),u_rotate_symbol:new l.aL(y,i.u_rotate_symbol),u_aspect_ratio:new l.aM(y,i.u_aspect_ratio),u_fade_change:new l.aM(y,i.u_fade_change),u_matrix:new l.aN(y,i.u_matrix),u_label_plane_matrix:new l.aN(y,i.u_label_plane_matrix),u_coord_matrix:new l.aN(y,i.u_coord_matrix),u_is_text:new l.aL(y,i.u_is_text),u_pitch_with_map:new l.aL(y,i.u_pitch_with_map),u_texsize:new l.aQ(y,i.u_texsize),u_texture:new l.aL(y,i.u_texture)}),symbolSDF:(y,i)=>({u_is_size_zoom_constant:new l.aL(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(y,i.u_is_size_feature_constant),u_size_t:new l.aM(y,i.u_size_t),u_size:new l.aM(y,i.u_size),u_camera_to_center_distance:new l.aM(y,i.u_camera_to_center_distance),u_pitch:new l.aM(y,i.u_pitch),u_rotate_symbol:new l.aL(y,i.u_rotate_symbol),u_aspect_ratio:new l.aM(y,i.u_aspect_ratio),u_fade_change:new l.aM(y,i.u_fade_change),u_matrix:new l.aN(y,i.u_matrix),u_label_plane_matrix:new l.aN(y,i.u_label_plane_matrix),u_coord_matrix:new l.aN(y,i.u_coord_matrix),u_is_text:new l.aL(y,i.u_is_text),u_pitch_with_map:new l.aL(y,i.u_pitch_with_map),u_texsize:new l.aQ(y,i.u_texsize),u_texture:new l.aL(y,i.u_texture),u_gamma_scale:new l.aM(y,i.u_gamma_scale),u_device_pixel_ratio:new l.aM(y,i.u_device_pixel_ratio),u_is_halo:new l.aL(y,i.u_is_halo)}),symbolTextAndIcon:(y,i)=>({u_is_size_zoom_constant:new l.aL(y,i.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(y,i.u_is_size_feature_constant),u_size_t:new l.aM(y,i.u_size_t),u_size:new l.aM(y,i.u_size),u_camera_to_center_distance:new l.aM(y,i.u_camera_to_center_distance),u_pitch:new l.aM(y,i.u_pitch),u_rotate_symbol:new l.aL(y,i.u_rotate_symbol),u_aspect_ratio:new l.aM(y,i.u_aspect_ratio),u_fade_change:new l.aM(y,i.u_fade_change),u_matrix:new l.aN(y,i.u_matrix),u_label_plane_matrix:new l.aN(y,i.u_label_plane_matrix),u_coord_matrix:new l.aN(y,i.u_coord_matrix),u_is_text:new l.aL(y,i.u_is_text),u_pitch_with_map:new l.aL(y,i.u_pitch_with_map),u_texsize:new l.aQ(y,i.u_texsize),u_texsize_icon:new l.aQ(y,i.u_texsize_icon),u_texture:new l.aL(y,i.u_texture),u_texture_icon:new l.aL(y,i.u_texture_icon),u_gamma_scale:new l.aM(y,i.u_gamma_scale),u_device_pixel_ratio:new l.aM(y,i.u_device_pixel_ratio),u_is_halo:new l.aL(y,i.u_is_halo)}),background:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_opacity:new l.aM(y,i.u_opacity),u_color:new l.aR(y,i.u_color)}),backgroundPattern:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_opacity:new l.aM(y,i.u_opacity),u_image:new l.aL(y,i.u_image),u_pattern_tl_a:new l.aQ(y,i.u_pattern_tl_a),u_pattern_br_a:new l.aQ(y,i.u_pattern_br_a),u_pattern_tl_b:new l.aQ(y,i.u_pattern_tl_b),u_pattern_br_b:new l.aQ(y,i.u_pattern_br_b),u_texsize:new l.aQ(y,i.u_texsize),u_mix:new l.aM(y,i.u_mix),u_pattern_size_a:new l.aQ(y,i.u_pattern_size_a),u_pattern_size_b:new l.aQ(y,i.u_pattern_size_b),u_scale_a:new l.aM(y,i.u_scale_a),u_scale_b:new l.aM(y,i.u_scale_b),u_pixel_coord_upper:new l.aQ(y,i.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(y,i.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(y,i.u_tile_units_to_pixels)}),terrain:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_texture:new l.aL(y,i.u_texture),u_ele_delta:new l.aM(y,i.u_ele_delta)}),terrainDepth:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_ele_delta:new l.aM(y,i.u_ele_delta)}),terrainCoords:(y,i)=>({u_matrix:new l.aN(y,i.u_matrix),u_texture:new l.aL(y,i.u_texture),u_terrain_coords_id:new l.aM(y,i.u_terrain_coords_id),u_ele_delta:new l.aM(y,i.u_ele_delta)})};class Wl{constructor(i,u,f){this.context=i;const g=i.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Go={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zl{constructor(i,u,f,g){this.length=u.length,this.attributes=f,this.itemSize=u.bytesPerElement,this.dynamicDraw=g,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),i.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,u){for(let f=0;f<this.attributes.length;f++){const g=u.attributes[this.attributes[f].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,u,f){for(let g=0;g<this.attributes.length;g++){const _=this.attributes[g],T=u.attributes[_.name];T!==void 0&&i.vertexAttribPointer(T,_.components,i[Go[_.type]],!1,this.itemSize,_.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ka=new WeakMap;function Yn(y){var i;if(Ka.has(y))return Ka.get(y);{const u=(i=y.getParameter(y.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return Ka.set(y,u),u}}class Vt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hl extends Vt{getDefault(){return l.aT.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ni extends Vt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class ai extends Vt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class ju extends Vt{getDefault(){return[!0,!0,!0,!0]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Kl extends Vt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Xl extends Vt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Du extends Vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const u=this.current;(i.func!==u.func||i.ref!==u.ref||i.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Nu extends Vt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Yl extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=i,this.dirty=!1}}class Lu extends Vt{getDefault(){return[0,1]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ru extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=i,this.dirty=!1}}class Jl extends Vt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class cf extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.BLEND):u.disable(u.BLEND),this.current=i,this.dirty=!1}}class uf extends Vt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Xa extends Vt{getDefault(){return l.aT.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class mg extends Vt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class gg extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=i,this.dirty=!1}}class yg extends Vt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class _g extends Vt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class vg extends Vt{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class xg extends Vt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class zu extends Vt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ql extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Bu extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ou extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ya extends Vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class hf extends Vt{getDefault(){return null}set(i){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class df extends Vt{getDefault(){return null}set(i){var u;if(i===this.current&&!this.dirty)return;const f=this.gl;Yn(f)?f.bindVertexArray(i):(u=f.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Fu extends Vt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class _a extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class ff extends Vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Jn extends Vt{constructor(i,u){super(i),this.context=i,this.parent=u}getDefault(){return null}}class Ja extends Jn{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class pf extends Jn{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class $u extends Jn{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Jt{constructor(i,u,f,g,_){this.context=i,this.width=u,this.height=f;const T=i.gl,E=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Ja(i,E),g)this.depthAttachment=_?new $u(i,E):new pf(i,E);else if(_)throw new Error("Stencil cannot be setted without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){const f=this.depthAttachment.get();f&&i.deleteRenderbuffer(f)}i.deleteFramebuffer(this.framebuffer)}}class br{constructor(i,u,f){this.blendFunction=i,this.blendColor=u,this.mask=f}}br.Replace=[1,0],br.disabled=new br(br.Replace,l.aT.transparent,[!1,!1,!1,!1]),br.unblended=new br(br.Replace,l.aT.transparent,[!0,!0,!0,!0]),br.alphaBlended=new br([1,771],l.aT.transparent,[!0,!0,!0,!0]);class bg{constructor(i){var u,f;if(this.gl=i,this.clearColor=new Hl(this),this.clearDepth=new ni(this),this.clearStencil=new ai(this),this.colorMask=new ju(this),this.depthMask=new Kl(this),this.stencilMask=new Xl(this),this.stencilFunc=new Du(this),this.stencilOp=new Nu(this),this.stencilTest=new Yl(this),this.depthRange=new Lu(this),this.depthTest=new Ru(this),this.depthFunc=new Jl(this),this.blend=new cf(this),this.blendFunc=new uf(this),this.blendColor=new Xa(this),this.blendEquation=new mg(this),this.cullFace=new gg(this),this.cullFaceSide=new yg(this),this.frontFace=new _g(this),this.program=new vg(this),this.activeTexture=new xg(this),this.viewport=new zu(this),this.bindFramebuffer=new Ql(this),this.bindRenderbuffer=new Bu(this),this.bindTexture=new Ou(this),this.bindVertexBuffer=new Ya(this),this.bindElementBuffer=new hf(this),this.bindVertexArray=new df(this),this.pixelStoreUnpack=new Fu(this),this.pixelStoreUnpackPremultiplyAlpha=new _a(this),this.pixelStoreUnpackFlipY=new ff(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),Yn(i)){this.HALF_FLOAT=i.HALF_FLOAT;const g=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=i.RGBA16F)!==null&&u!==void 0?u:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(f=i.RGB16F)!==null&&f!==void 0?f:g==null?void 0:g.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const g=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,u){return new Wl(this,i,u)}createVertexBuffer(i,u,f){return new Zl(this,i,u,f)}createRenderbuffer(i,u,f){const g=this.gl,_=g.createRenderbuffer();return this.bindRenderbuffer.set(_),g.renderbufferStorage(g.RENDERBUFFER,i,u,f),this.bindRenderbuffer.set(null),_}createFramebuffer(i,u,f,g){return new Jt(this,i,u,f,g)}clear({color:i,depth:u,stencil:f}){const g=this.gl;let _=0;i&&(_|=g.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(_|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),f!==void 0&&(_|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),g.clear(_)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){l.aG(i.blendFunction,br.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return Yn(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var u;return Yn(this.gl)?this.gl.deleteVertexArray(i):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class qt{constructor(i,u,f){this.func=i,this.mask=u,this.range=f}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const va=7680;class wr{constructor(i,u,f,g,_,T){this.test=i,this.ref=u,this.mask=f,this.fail=g,this.depthFail=_,this.pass=T}}wr.disabled=new wr({func:519,mask:0},0,0,va,va,va);class _r{constructor(i,u,f){this.enable=i,this.mode=u,this.frontFace=f}}let Wo;function mf(y,i,u,f,g,_,T){const E=y.context,A=E.gl,D=y.useProgram("collisionBox"),R=[];let z=0,$=0;for(let ae=0;ae<f.length;ae++){const _e=f[ae],Ee=i.getTile(_e),Ae=Ee.getBucket(u);if(!Ae)continue;let je=_e.posMatrix;g[0]===0&&g[1]===0||(je=y.translatePosMatrix(_e.posMatrix,Ee,g,_));const Re=T?Ae.textCollisionBox:Ae.iconCollisionBox,Le=Ae.collisionCircleArray;if(Le.length>0){const $e=l.Z(),lt=je;l.aU($e,Ae.placementInvProjMatrix,y.transform.glCoordMatrix),l.aU($e,$e,Ae.placementViewportMatrix),R.push({circleArray:Le,circleOffset:$,transform:lt,invTransform:$e,coord:_e}),z+=Le.length/4,$=z}Re&&D.draw(E,A.LINES,qt.disabled,wr.disabled,y.colorModeForRenderPass(),_r.disabled,Cu(je,y.transform,Ee),y.style.map.terrain&&y.style.map.terrain.getTerrainData(_e),u.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,y.transform.zoom,null,null,Re.collisionVertexBuffer)}if(!T||!R.length)return;const ee=y.useProgram("collisionCircle"),Q=new l.aV;Q.resize(4*z),Q._trim();let ie=0;for(const ae of R)for(let _e=0;_e<ae.circleArray.length/4;_e++){const Ee=4*_e,Ae=ae.circleArray[Ee+0],je=ae.circleArray[Ee+1],Re=ae.circleArray[Ee+2],Le=ae.circleArray[Ee+3];Q.emplace(ie++,Ae,je,Re,Le,0),Q.emplace(ie++,Ae,je,Re,Le,1),Q.emplace(ie++,Ae,je,Re,Le,2),Q.emplace(ie++,Ae,je,Re,Le,3)}(!Wo||Wo.length<2*z)&&(Wo=function(ae){const _e=2*ae,Ee=new l.aX;Ee.resize(_e),Ee._trim();for(let Ae=0;Ae<_e;Ae++){const je=6*Ae;Ee.uint16[je+0]=4*Ae+0,Ee.uint16[je+1]=4*Ae+1,Ee.uint16[je+2]=4*Ae+2,Ee.uint16[je+3]=4*Ae+2,Ee.uint16[je+4]=4*Ae+3,Ee.uint16[je+5]=4*Ae+0}return Ee}(z));const X=E.createIndexBuffer(Wo,!0),ye=E.createVertexBuffer(Q,l.aW.members,!0);for(const ae of R){const _e={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(Se=y.transform).cameraToCenterDistance,u_viewport_size:[Se.width,Se.height]};ee.draw(E,A.TRIANGLES,qt.disabled,wr.disabled,y.colorModeForRenderPass(),_r.disabled,_e,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ae.coord),u.id,ye,X,l.S.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Se;ye.destroy(),X.destroy()}_r.disabled=new _r(!1,1029,2305),_r.backCCW=new _r(!0,1029,2305);const Uu=l.ao(new Float32Array(16));function ec(y,i,u,f,g,_){const{horizontalAlign:T,verticalAlign:E}=l.au(y);return new l.P((-(T-.5)*i/g+f[0])*_,(-(E-.5)*u/g+f[1])*_)}function tc(y,i,u,f,g,_,T,E,A,D,R){const z=y.text.placedSymbolArray,$=y.text.dynamicLayoutVertexArray,ee=y.icon.dynamicLayoutVertexArray,Q={};$.clear();for(let ie=0;ie<z.length;ie++){const X=z.get(ie),ye=X.hidden||!X.crossTileID||y.allowVerticalPlacement&&!X.placedOrientation?null:f[X.crossTileID];if(ye){const Se=new l.P(X.anchorX,X.anchorY),ae=pr(Se,u?T:_,R),_e=En(g.cameraToCenterDistance,ae.signedDistanceFromCamera);let Ee=l.aj(y.textSizeData,A,X)*_e/l.ap;u&&(Ee*=y.tilePixelRatio/E);const{width:Ae,height:je,anchor:Re,textOffset:Le,textBoxScale:$e}=ye,lt=ec(Re,Ae,je,Le,$e,Ee),Bt=u?pr(Se.add(lt),_,R).point:ae.point.add(i?lt.rotate(-g.angle):lt),Ke=y.allowVerticalPlacement&&X.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let bt=0;bt<X.numGlyphs;bt++)l.ak($,Bt,Ke);D&&X.associatedIconIndex>=0&&(Q[X.associatedIconIndex]={shiftedAnchor:Bt,angle:Ke})}else V(X.numGlyphs,$)}if(D){ee.clear();const ie=y.icon.placedSymbolArray;for(let X=0;X<ie.length;X++){const ye=ie.get(X);if(ye.hidden)V(ye.numGlyphs,ee);else{const Se=Q[X];if(Se)for(let ae=0;ae<ye.numGlyphs;ae++)l.ak(ee,Se.shiftedAnchor,Se.angle);else V(ye.numGlyphs,ee)}}y.icon.dynamicLayoutVertexBuffer.updateData(ee)}y.text.dynamicLayoutVertexBuffer.updateData($)}function Vu(y,i,u){return u.iconsInText&&i?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function rc(y,i,u,f,g,_,T,E,A,D,R,z){const $=y.context,ee=$.gl,Q=y.transform,ie=E==="map",X=A==="map",ye=E!=="viewport"&&u.layout.get("symbol-placement")!=="point",Se=ie&&!X&&!ye,ae=!u.layout.get("symbol-sort-key").isConstant();let _e=!1;const Ee=y.depthModeForSublayer(0,qt.ReadOnly),Ae=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),je=[];for(const Re of f){const Le=i.getTile(Re),$e=Le.getBucket(u);if(!$e)continue;const lt=g?$e.text:$e.icon;if(!lt||!lt.segments.get().length||!lt.hasVisibleVertices)continue;const Bt=lt.programConfigurations.get(u.id),Ke=g||$e.sdfIcons,bt=g?$e.textSizeData:$e.iconSizeData,ut=X||Q.pitch!==0,or=y.useProgram(Vu(Ke,g,$e),Bt),zt=l.ah(bt,Q.zoom),Dt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re);let Ot,Mr,dr,ys,Yr=[0,0],zr=null;if(g)Mr=Le.glyphAtlasTexture,dr=ee.LINEAR,Ot=Le.glyphAtlasTexture.size,$e.iconsInText&&(Yr=Le.imageAtlasTexture.size,zr=Le.imageAtlasTexture,ys=ut||y.options.rotating||y.options.zooming||bt.kind==="composite"||bt.kind==="camera"?ee.LINEAR:ee.NEAREST);else{const jr=u.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;Mr=Le.imageAtlasTexture,dr=Ke||y.options.rotating||y.options.zooming||jr||ut?ee.LINEAR:ee.NEAREST,Ot=Le.imageAtlasTexture.size}const ci=he(Le,1,y.transform.zoom),gr=Ve(Re.posMatrix,X,ie,y.transform,ci),an=si(Re.posMatrix,X,ie,y.transform,ci),on=Ae&&$e.hasTextData(),ra=u.layout.get("icon-text-fit")!=="none"&&on&&$e.hasIconData();if(ye){const jr=y.style.map.terrain?(Ws,Dr)=>y.style.map.terrain.getElevation(Re,Ws,Dr):null,Jr=u.layout.get("text-rotation-alignment")==="map";Ge($e,Re.posMatrix,y,g,gr,an,X,D,Jr,jr)}const ka=y.translatePosMatrix(Re.posMatrix,Le,_,T),no=ye||g&&Ae||ra?Uu:gr,Es=y.translatePosMatrix(an,Le,_,T,!0),_s=Ke&&u.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ls;Ls=Ke?$e.iconsInText?ya(bt.kind,zt,Se,X,y,ka,no,Es,Ot,Yr):Mu(bt.kind,zt,Se,X,y,ka,no,Es,g,Ot):Iu(bt.kind,zt,Se,X,y,ka,no,Es,g,Ot);const Ta={program:or,buffers:lt,uniformValues:Ls,atlasTexture:Mr,atlasTextureIcon:zr,atlasInterpolation:dr,atlasInterpolationIcon:ys,isSDF:Ke,hasHalo:_s};if(ae&&$e.canOverlap){_e=!0;const jr=lt.segments.get();for(const Jr of jr)je.push({segments:new l.S([Jr]),sortKey:Jr.sortKey,state:Ta,terrainData:Dt})}else je.push({segments:lt.segments,sortKey:0,state:Ta,terrainData:Dt})}_e&&je.sort((Re,Le)=>Re.sortKey-Le.sortKey);for(const Re of je){const Le=Re.state;if($.activeTexture.set(ee.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,ee.CLAMP_TO_EDGE),Le.atlasTextureIcon&&($.activeTexture.set(ee.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),Le.isSDF){const $e=Le.uniformValues;Le.hasHalo&&($e.u_is_halo=1,qu(Le.buffers,Re.segments,u,y,Le.program,Ee,R,z,$e,Re.terrainData)),$e.u_is_halo=0}qu(Le.buffers,Re.segments,u,y,Le.program,Ee,R,z,Le.uniformValues,Re.terrainData)}}function qu(y,i,u,f,g,_,T,E,A,D){const R=f.context;g.draw(R,R.gl.TRIANGLES,_,T,E,_r.disabled,A,D,u.id,y.layoutVertexBuffer,y.indexBuffer,i,u.paint,f.transform.zoom,y.programConfigurations.get(u.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Zo(y,i,u,f,g){if(!u||!f||!f.imageAtlas)return;const _=f.imageAtlas.patternPositions;let T=_[u.to.toString()],E=_[u.from.toString()];if(!T&&E&&(T=E),!E&&T&&(E=T),!T||!E){const A=g.getPaintProperty(i);T=_[A],E=_[A]}T&&E&&y.setConstantPatternPositions(T,E)}function Ho(y,i,u,f,g,_,T){const E=y.context.gl,A="fill-pattern",D=u.paint.get(A),R=D&&D.constantOr(1),z=u.getCrossfadeParameters();let $,ee,Q,ie,X;T?(ee=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=E.LINES):(ee=R?"fillPattern":"fill",$=E.TRIANGLES);const ye=D.constantOr(null);for(const Se of f){const ae=i.getTile(Se);if(R&&!ae.patternsLoaded())continue;const _e=ae.getBucket(u);if(!_e)continue;const Ee=_e.programConfigurations.get(u.id),Ae=y.useProgram(ee,Ee),je=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se);R&&(y.context.activeTexture.set(E.TEXTURE0),ae.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Ee.updatePaintBuffers(z)),Zo(Ee,A,ye,ae,u);const Re=je?Se:null,Le=y.translatePosMatrix(Re?Re.posMatrix:Se.posMatrix,ae,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(T){ie=_e.indexBuffer2,X=_e.segments2;const $e=[E.drawingBufferWidth,E.drawingBufferHeight];Q=ee==="fillOutlinePattern"&&R?Ul(Le,y,z,ae,$e):$l(Le,$e)}else ie=_e.indexBuffer,X=_e.segments,Q=R?Eu(Le,y,z,ae):tf(Le);Ae.draw(y.context,$,g,y.stencilModeForClipping(Se),_,_r.disabled,Q,je,u.id,_e.layoutVertexBuffer,ie,X,u.paint,y.transform.zoom,Ee)}}function Ko(y,i,u,f,g,_,T){const E=y.context,A=E.gl,D="fill-extrusion-pattern",R=u.paint.get(D),z=R.constantOr(1),$=u.getCrossfadeParameters(),ee=u.paint.get("fill-extrusion-opacity"),Q=R.constantOr(null);for(const ie of f){const X=i.getTile(ie),ye=X.getBucket(u);if(!ye)continue;const Se=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ie),ae=ye.programConfigurations.get(u.id),_e=y.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ae);z&&(y.context.activeTexture.set(A.TEXTURE0),X.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ae.updatePaintBuffers($)),Zo(ae,D,Q,X,u);const Ee=y.translatePosMatrix(ie.posMatrix,X,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ae=u.paint.get("fill-extrusion-vertical-gradient"),je=z?Kn(Ee,y,Ae,ee,ie,$,X):Tu(Ee,y,Ae,ee);_e.draw(E,E.gl.TRIANGLES,g,_,T,_r.backCCW,je,Se,u.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,u.paint,y.transform.zoom,ae,y.style.map.terrain&&ye.centroidVertexBuffer)}}function wg(y,i,u,f,g,_,T){const E=y.context,A=E.gl,D=u.fbo;if(!D)return;const R=y.useProgram("hillshade"),z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(i);E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,D.colorAttachment.get()),R.draw(E,A.TRIANGLES,g,_,T,_r.disabled,(($,ee,Q,ie)=>{const X=Q.paint.get("hillshade-shadow-color"),ye=Q.paint.get("hillshade-highlight-color"),Se=Q.paint.get("hillshade-accent-color");let ae=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(ae-=$.transform.angle);const _e=!$.options.moving;return{u_matrix:ie?ie.posMatrix:$.transform.calculatePosMatrix(ee.tileID.toUnwrapped(),_e),u_image:0,u_latrange:Au(0,ee.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),ae],u_shadow:X,u_highlight:ye,u_accent:Se}})(y,u,f,z?i:null),z,f.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Gu(y,i,u,f,g,_){const T=y.context,E=T.gl,A=i.dem;if(A&&A.data){const D=A.dim,R=A.stride,z=A.getPixels();if(T.activeTexture.set(E.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||y.getTileTexture(R),i.demTexture){const ee=i.demTexture;ee.update(z,{premultiply:!1}),ee.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else i.demTexture=new Ue(T,z,E.RGBA,{premultiply:!1}),i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);T.activeTexture.set(E.TEXTURE0);let $=i.fbo;if(!$){const ee=new Ue(T,{width:D,height:D,data:null},E.RGBA);ee.bind(E.LINEAR,E.CLAMP_TO_EDGE),$=i.fbo=T.createFramebuffer(D,D,!0,!1),$.colorAttachment.set(ee.texture)}T.bindFramebuffer.set($.framebuffer),T.viewport.set([0,0,D,D]),y.useProgram("hillshadePrepare").draw(T,E.TRIANGLES,f,g,_,_r.disabled,((ee,Q)=>{const ie=Q.stride,X=l.Z();return l.aS(X,0,l.N,-l.N,0,0,1),l.$(X,X,[0,-l.N,0]),{u_matrix:X,u_image:1,u_dimension:[ie,ie],u_zoom:ee.overscaledZ,u_unpack:Q.getUnpackVector()}})(i.tileID,A),null,u.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Sg(y,i,u,f,g,_){const T=f.paint.get("raster-fade-duration");if(!_&&T>0){const E=l.h.now(),A=(E-y.timeAdded)/T,D=i?(E-i.timeAdded)/T:-1,R=u.getSource(),z=g.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),$=!i||Math.abs(i.tileID.overscaledZ-z)>Math.abs(y.tileID.overscaledZ-z),ee=$&&y.refreshedUponExpiration?1:l.ad($?A:1-D,0,1);return y.refreshedUponExpiration&&A>=1&&(y.refreshedUponExpiration=!1),i?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}const gf=new l.aT(1,0,0,1),sc=new l.aT(0,1,0,1),Wu=new l.aT(0,0,1,1),yf=new l.aT(1,0,1,1),_f=new l.aT(0,1,1,1);function Xo(y,i,u,f){nc(y,0,i+u/2,y.transform.width,u,f)}function ic(y,i,u,f){nc(y,i-u/2,0,u,y.transform.height,f)}function nc(y,i,u,f,g,_){const T=y.context,E=T.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*y.pixelRatio,u*y.pixelRatio,f*y.pixelRatio,g*y.pixelRatio),T.clear({color:_}),E.disable(E.SCISSOR_TEST)}function vf(y,i,u){const f=y.context,g=f.gl,_=u.posMatrix,T=y.useProgram("debug"),E=qt.disabled,A=wr.disabled,D=y.colorModeForRenderPass(),R="$debug",z=y.style.map.terrain&&y.style.map.terrain.getTerrainData(u);f.activeTexture.set(g.TEXTURE0);const $=i.getTileByID(u.key).latestRawTileData,ee=Math.floor(($&&$.byteLength||0)/1024),Q=i.getTile(u).tileSize,ie=512/Math.min(Q,512)*(u.overscaledZ/y.transform.zoom)*.5;let X=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(X+=` => ${u.overscaledZ}`),function(ye,Se){ye.initDebugOverlayCanvas();const ae=ye.debugOverlayCanvas,_e=ye.context.gl,Ee=ye.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,ae.width,ae.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(Se,5,5),Ee.strokeText(Se,5,5),ye.debugOverlayTexture.update(ae),ye.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(y,`${X} ${ee}kB`),T.draw(f,g.TRIANGLES,E,A,br.alphaBlended,_r.disabled,qo(_,l.aT.transparent,ie),null,R,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),T.draw(f,g.LINE_STRIP,E,A,D,_r.disabled,qo(_,l.aT.red),z,R,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Cr(y,i,u){const f=y.context,g=f.gl,_=y.colorModeForRenderPass(),T=new qt(g.LEQUAL,qt.ReadWrite,y.depthRangeFor3D),E=y.useProgram("terrain"),A=i.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,y.width,y.height]);for(const D of u){const R=y.renderToTexture.getTexture(D),z=i.getTerrainData(D.tileID);f.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,R.texture);const $={u_matrix:y.transform.calculatePosMatrix(D.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(y.transform.zoom)};E.draw(f,g.TRIANGLES,T,wr.disabled,_,_r.backCCW,$,z,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class xa{constructor(i,u){this.context=new bg(i),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=fs.maxUnderzooming+fs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bl}resize(i,u,f){if(this.width=Math.floor(i*f),this.height=Math.floor(u*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const i=this.context,u=new l.a_;u.emplaceBack(0,0),u.emplaceBack(l.N,0),u.emplaceBack(0,l.N),u.emplaceBack(l.N,l.N),this.tileExtentBuffer=i.createVertexBuffer(u,Ol.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);const f=new l.a_;f.emplaceBack(0,0),f.emplaceBack(l.N,0),f.emplaceBack(0,l.N),f.emplaceBack(l.N,l.N),this.debugBuffer=i.createVertexBuffer(f,Ol.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);const g=new l.V;g.emplaceBack(0,0,0,0),g.emplaceBack(l.N,0,l.N,0),g.emplaceBack(0,l.N,0,l.N),g.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=i.createVertexBuffer(g,_t.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);const _=new l.a_;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,Ol.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);const T=new l.a$;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(T);const E=new l.b0;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const A=this.context.gl;this.stencilClearMode=new wr({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=l.Z();l.aS(f,0,this.width,this.height,0,0,1),l.a0(f,f,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,qt.disabled,this.stencilClearMode,br.disabled,_r.disabled,rf(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,u){if(this.currentStencilSource===i.source||!i.isTileClipped()||!u||!u.length)return;this.currentStencilSource=i.source;const f=this.context,g=f.gl;this.nextStencilID+u.length>256&&this.clearStencil(),f.setColorMode(br.disabled),f.setDepthMode(qt.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of u){const E=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);_.draw(f,g.TRIANGLES,qt.disabled,new wr({func:g.ALWAYS,mask:0},E,255,g.KEEP,g.KEEP,g.REPLACE),br.disabled,_r.disabled,rf(T.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,u=this.context.gl;return new wr({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(i){const u=this.context.gl;return new wr({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(i){const u=this.context.gl,f=i.sort((T,E)=>E.overscaledZ-T.overscaledZ),g=f[f.length-1].overscaledZ,_=f[0].overscaledZ-g+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const T={};for(let E=0;E<_;E++)T[E+g]=new wr({func:u.GEQUAL,mask:255},E+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=_,[T,f]}return[{[g]:wr.disabled},f]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new br([i.CONSTANT_COLOR,i.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?br.unblended:br.alphaBlended}depthModeForSublayer(i,u,f){if(!this.opaquePassEnabledForLayer())return qt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new qt(f||this.context.gl.LEQUAL,u,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,u){this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();const f=this.style._order,g=this.style.sourceCaches,_={},T={},E={};for(const A in g){const D=g[A];D.used&&D.prepare(this.context),_[A]=D.getVisibleCoordinates(),T[A]=_[A].slice().reverse(),E[A]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<f.length;A++)if(this.style._layers[f[A]].is3D()){this.opaquePassCutoff=A;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const A=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||A.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(D,R){const z=D.context,$=z.gl,ee=br.unblended,Q=new qt($.LEQUAL,qt.ReadWrite,[0,1]),ie=R.getTerrainMesh(),X=R.sourceCache.getRenderableTiles(),ye=D.useProgram("terrainDepth");z.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,D.width/devicePixelRatio,D.height/devicePixelRatio]),z.clear({color:l.aT.transparent,depth:1});for(const Se of X){const ae=R.getTerrainData(Se.tileID),_e={u_matrix:D.transform.calculatePosMatrix(Se.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(D.transform.zoom)};ye.draw(z,$.TRIANGLES,Q,wr.disabled,ee,_r.backCCW,_e,ae,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,D.width,D.height])}(this,this.style.map.terrain),function(D,R){const z=D.context,$=z.gl,ee=br.unblended,Q=new qt($.LEQUAL,qt.ReadWrite,[0,1]),ie=R.getTerrainMesh(),X=R.getCoordsTexture(),ye=R.sourceCache.getRenderableTiles(),Se=D.useProgram("terrainCoords");z.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,D.width/devicePixelRatio,D.height/devicePixelRatio]),z.clear({color:l.aT.transparent,depth:1}),R.coordsIndex=[];for(const ae of ye){const _e=R.getTerrainData(ae.tileID);z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,X.texture);const Ee={u_matrix:D.transform.calculatePosMatrix(ae.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(D.transform.zoom)};Se.draw(z,$.TRIANGLES,Q,wr.disabled,ee,_r.backCCW,Ee,_e,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments),R.coordsIndex.push(ae.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,D.width,D.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const A of f){const D=this.style._layers[A];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const R=T[D.source];(D.type==="custom"||R.length)&&this.renderLayer(this,g[D.source],D,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[f[this.currentLayer]],D=g[A.source],R=_[A.source];this._renderTileClippingMasks(A,R),this.renderLayer(this,D,A,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const A=this.style._layers[f[this.currentLayer]],D=g[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const R=(A.type==="symbol"?E:T)[A.source];this._renderTileClippingMasks(A,_[A.source]),this.renderLayer(this,D,A,R)}if(this.options.showTileBoundaries){const A=function(D,R){let z=null;const $=Object.values(D._layers).flatMap(X=>X.source&&!X.isHidden(R)?[D.sourceCaches[X.source]]:[]),ee=$.filter(X=>X.getSource().type==="vector"),Q=$.filter(X=>X.getSource().type!=="vector"),ie=X=>{(!z||z.getSource().maxzoom<X.getSource().maxzoom)&&(z=X)};return ee.forEach(X=>ie(X)),z||Q.forEach(X=>ie(X)),z}(this.style,this.transform.zoom);A&&function(D,R,z){for(let $=0;$<z.length;$++)vf(D,R,z[$])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const D=A.transform.padding;Xo(A,A.transform.height-(D.top||0),3,gf),Xo(A,D.bottom||0,3,sc),ic(A,D.left||0,3,Wu),ic(A,A.transform.width-(D.right||0),3,yf);const R=A.transform.centerPoint;(function(z,$,ee,Q){nc(z,$-1,ee-10,2,20,Q),nc(z,$-10,ee-1,20,2,Q)})(A,R.x,A.transform.height-R.y,_f)}(this),this.context.setDefault()}renderLayer(i,u,f,g){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(g||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(_,T,E,A,D){if(_.renderPass!=="translucent")return;const R=wr.disabled,z=_.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,ee,Q,ie,X,ye,Se){const ae=ee.transform,_e=X==="map",Ee=ye==="map";for(const Ae of $){const je=ie.getTile(Ae),Re=je.getBucket(Q);if(!Re||!Re.text||!Re.text.segments.get().length)continue;const Le=l.ah(Re.textSizeData,ae.zoom),$e=he(je,1,ee.transform.zoom),lt=Ve(Ae.posMatrix,Ee,_e,ee.transform,$e),Bt=Q.layout.get("icon-text-fit")!=="none"&&Re.hasIconData();if(Le){const Ke=Math.pow(2,ae.zoom-je.tileID.overscaledZ);tc(Re,_e,Ee,Se,ae,lt,Ae.posMatrix,Ke,Le,Bt,ee.style.map.terrain?(bt,ut)=>ee.style.map.terrain.getElevation(Ae,bt,ut):null)}}}(A,_,E,T,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),D),E.paint.get("icon-opacity").constantOr(1)!==0&&rc(_,T,E,A,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),R,z),E.paint.get("text-opacity").constantOr(1)!==0&&rc(_,T,E,A,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),R,z),T.map.showCollisionBoxes&&(mf(_,T,E,A,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),mf(_,T,E,A,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))})(i,u,f,g,this.style.placement.variableOffsets);break;case"circle":(function(_,T,E,A){if(_.renderPass!=="translucent")return;const D=E.paint.get("circle-opacity"),R=E.paint.get("circle-stroke-width"),z=E.paint.get("circle-stroke-opacity"),$=!E.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(R.constantOr(1)===0||z.constantOr(1)===0))return;const ee=_.context,Q=ee.gl,ie=_.depthModeForSublayer(0,qt.ReadOnly),X=wr.disabled,ye=_.colorModeForRenderPass(),Se=[];for(let ae=0;ae<A.length;ae++){const _e=A[ae],Ee=T.getTile(_e),Ae=Ee.getBucket(E);if(!Ae)continue;const je=Ae.programConfigurations.get(E.id),Re=_.useProgram("circle",je),Le=Ae.layoutVertexBuffer,$e=Ae.indexBuffer,lt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(_e),Bt={programConfiguration:je,program:Re,layoutVertexBuffer:Le,indexBuffer:$e,uniformValues:Xn(_,_e,Ee,E),terrainData:lt};if($){const Ke=Ae.segments.get();for(const bt of Ke)Se.push({segments:new l.S([bt]),sortKey:bt.sortKey,state:Bt})}else Se.push({segments:Ae.segments,sortKey:0,state:Bt})}$&&Se.sort((ae,_e)=>ae.sortKey-_e.sortKey);for(const ae of Se){const{programConfiguration:_e,program:Ee,layoutVertexBuffer:Ae,indexBuffer:je,uniformValues:Re,terrainData:Le}=ae.state;Ee.draw(ee,Q.TRIANGLES,ie,X,ye,_r.disabled,Re,Le,E.id,Ae,je,ae.segments,E.paint,_.transform.zoom,_e)}})(i,u,f,g);break;case"heatmap":(function(_,T,E,A){if(E.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const D=_.context,R=D.gl,z=wr.disabled,$=new br([R.ONE,R.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function(ee,Q,ie){const X=ee.gl;ee.activeTexture.set(X.TEXTURE1),ee.viewport.set([0,0,Q.width/4,Q.height/4]);let ye=ie.heatmapFbo;if(ye)X.bindTexture(X.TEXTURE_2D,ye.colorAttachment.get()),ee.bindFramebuffer.set(ye.framebuffer);else{const Se=X.createTexture();X.bindTexture(X.TEXTURE_2D,Se),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),ye=ie.heatmapFbo=ee.createFramebuffer(Q.width/4,Q.height/4,!1,!1),function(ae,_e,Ee,Ae){var je,Re;const Le=ae.gl,$e=(je=ae.HALF_FLOAT)!==null&&je!==void 0?je:Le.UNSIGNED_BYTE,lt=(Re=ae.RGBA16F)!==null&&Re!==void 0?Re:Le.RGBA;Le.texImage2D(Le.TEXTURE_2D,0,lt,_e.width/4,_e.height/4,0,Le.RGBA,$e,null),Ae.colorAttachment.set(Ee)}(ee,Q,Se,ye)}})(D,_,E),D.clear({color:l.aT.transparent});for(let ee=0;ee<A.length;ee++){const Q=A[ee];if(T.hasRenderableParent(Q))continue;const ie=T.getTile(Q),X=ie.getBucket(E);if(!X)continue;const ye=X.programConfigurations.get(E.id),Se=_.useProgram("heatmap",ye),{zoom:ae}=_.transform;Se.draw(D,R.TRIANGLES,qt.disabled,z,$,_r.disabled,fg(Q.posMatrix,ie,ae,E.paint.get("heatmap-intensity")),null,E.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,E.paint,_.transform.zoom,ye)}D.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(D,R){const z=D.context,$=z.gl,ee=R.heatmapFbo;if(!ee)return;z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,ee.colorAttachment.get()),z.activeTexture.set($.TEXTURE1);let Q=R.colorRampTexture;Q||(Q=R.colorRampTexture=new Ue(z,R.colorRamp,$.RGBA)),Q.bind($.LINEAR,$.CLAMP_TO_EDGE),D.useProgram("heatmapTexture").draw(z,$.TRIANGLES,qt.disabled,wr.disabled,D.colorModeForRenderPass(),_r.disabled,((ie,X,ye,Se)=>{const ae=l.Z();l.aS(ae,0,ie.width,ie.height,0,0,1);const _e=ie.context.gl;return{u_matrix:ae,u_world:[_e.drawingBufferWidth,_e.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}})(D,R),null,R.id,D.viewportBuffer,D.quadTriangleIndexBuffer,D.viewportSegments,R.paint,D.transform.zoom)}(_,E))})(i,u,f,g);break;case"line":(function(_,T,E,A){if(_.renderPass!=="translucent")return;const D=E.paint.get("line-opacity"),R=E.paint.get("line-width");if(D.constantOr(1)===0||R.constantOr(1)===0)return;const z=_.depthModeForSublayer(0,qt.ReadOnly),$=_.colorModeForRenderPass(),ee=E.paint.get("line-dasharray"),Q=E.paint.get("line-pattern"),ie=Q.constantOr(1),X=E.paint.get("line-gradient"),ye=E.getCrossfadeParameters(),Se=ie?"linePattern":ee?"lineSDF":X?"lineGradient":"line",ae=_.context,_e=ae.gl;let Ee=!0;for(const Ae of A){const je=T.getTile(Ae);if(ie&&!je.patternsLoaded())continue;const Re=je.getBucket(E);if(!Re)continue;const Le=Re.programConfigurations.get(E.id),$e=_.context.program.get(),lt=_.useProgram(Se,Le),Bt=Ee||lt.program!==$e,Ke=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ae),bt=Q.constantOr(null);if(bt&&je.imageAtlas){const zt=je.imageAtlas,Dt=zt.patternPositions[bt.to.toString()],Ot=zt.patternPositions[bt.from.toString()];Dt&&Ot&&Le.setConstantPatternPositions(Dt,Ot)}const ut=Ke?Ae:null,or=ie?pg(_,je,E,ye,ut):ee?nf(_,je,E,ee,ye,ut):X?sf(_,je,E,Re.lineClipsArray.length,ut):Pu(_,je,E,ut);if(ie)ae.activeTexture.set(_e.TEXTURE0),je.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Le.updatePaintBuffers(ye);else if(ee&&(Bt||_.lineAtlas.dirty))ae.activeTexture.set(_e.TEXTURE0),_.lineAtlas.bind(ae);else if(X){const zt=Re.gradients[E.id];let Dt=zt.texture;if(E.gradientVersion!==zt.version){let Ot=256;if(E.stepInterpolant){const Mr=T.getSource().maxzoom,dr=Ae.canonical.z===Mr?Math.ceil(1<<_.transform.maxZoom-Ae.canonical.z):1;Ot=l.ad(l.aY(Re.maxLineLength/l.N*1024*dr),256,ae.maxTextureSize)}zt.gradient=l.aZ({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:zt.gradient||void 0,clips:Re.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new Ue(ae,zt.gradient,_e.RGBA),zt.version=E.gradientVersion,Dt=zt.texture}ae.activeTexture.set(_e.TEXTURE0),Dt.bind(E.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}lt.draw(ae,_e.TRIANGLES,z,_.stencilModeForClipping(Ae),$,_r.disabled,or,Ke,E.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,E.paint,_.transform.zoom,Le,Re.layoutVertexBuffer2),Ee=!1}})(i,u,f,g);break;case"fill":(function(_,T,E,A){const D=E.paint.get("fill-color"),R=E.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const z=_.colorModeForRenderPass(),$=E.paint.get("fill-pattern"),ee=_.opaquePassEnabledForLayer()&&!$.constantOr(1)&&D.constantOr(l.aT.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===ee){const Q=_.depthModeForSublayer(1,_.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly);Ho(_,T,E,A,Q,z,!1)}if(_.renderPass==="translucent"&&E.paint.get("fill-antialias")){const Q=_.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly);Ho(_,T,E,A,Q,z,!0)}})(i,u,f,g);break;case"fill-extrusion":(function(_,T,E,A){const D=E.paint.get("fill-extrusion-opacity");if(D!==0&&_.renderPass==="translucent"){const R=new qt(_.context.gl.LEQUAL,qt.ReadWrite,_.depthRangeFor3D);if(D!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))Ko(_,T,E,A,R,wr.disabled,br.disabled),Ko(_,T,E,A,R,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const z=_.colorModeForRenderPass();Ko(_,T,E,A,R,wr.disabled,z)}}})(i,u,f,g);break;case"hillshade":(function(_,T,E,A){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const D=_.context,R=_.depthModeForSublayer(0,qt.ReadOnly),z=_.colorModeForRenderPass(),[$,ee]=_.renderPass==="translucent"?_.stencilConfigForOverlap(A):[{},A];for(const Q of ee){const ie=T.getTile(Q);ie.needsHillshadePrepare!==void 0&&ie.needsHillshadePrepare&&_.renderPass==="offscreen"?Gu(_,ie,E,R,wr.disabled,z):_.renderPass==="translucent"&&wg(_,Q,ie,E,R,$[Q.overscaledZ],z)}D.viewport.set([0,0,_.width,_.height])})(i,u,f,g);break;case"raster":(function(_,T,E,A){if(_.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!A.length)return;const D=_.context,R=D.gl,z=T.getSource(),$=_.useProgram("raster"),ee=_.colorModeForRenderPass(),[Q,ie]=z instanceof ur?[{},A]:_.stencilConfigForOverlap(A),X=ie[ie.length-1].overscaledZ,ye=!_.options.moving;for(const Se of ie){const ae=_.depthModeForSublayer(Se.overscaledZ-X,E.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,R.LESS),_e=T.getTile(Se);_e.registerFadeDuration(E.paint.get("raster-fade-duration"));const Ee=T.findLoadedParent(Se,0),Ae=Sg(_e,Ee,T,E,_.transform,_.style.map.terrain);let je,Re;const Le=E.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;D.activeTexture.set(R.TEXTURE0),_e.texture.bind(Le,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(R.TEXTURE1),Ee?(Ee.texture.bind(Le,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),je=Math.pow(2,Ee.tileID.overscaledZ-_e.tileID.overscaledZ),Re=[_e.tileID.canonical.x*je%1,_e.tileID.canonical.y*je%1]):_e.texture.bind(Le,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const $e=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Se),lt=$e?Se:null,Bt=lt?lt.posMatrix:_.transform.calculatePosMatrix(Se.toUnwrapped(),ye),Ke=of(Bt,Re||[0,0],je||1,Ae,E);z instanceof ur?$.draw(D,R.TRIANGLES,ae,wr.disabled,ee,_r.disabled,Ke,$e,E.id,z.boundsBuffer,_.quadTriangleIndexBuffer,z.boundsSegments):$.draw(D,R.TRIANGLES,ae,Q[Se.overscaledZ],ee,_r.disabled,Ke,$e,E.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(i,u,f,g);break;case"background":(function(_,T,E,A){const D=E.paint.get("background-color"),R=E.paint.get("background-opacity");if(R===0)return;const z=_.context,$=z.gl,ee=_.transform,Q=ee.tileSize,ie=E.paint.get("background-pattern");if(_.isPatternMissing(ie))return;const X=!ie&&D.a===1&&R===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==X)return;const ye=wr.disabled,Se=_.depthModeForSublayer(0,X==="opaque"?qt.ReadWrite:qt.ReadOnly),ae=_.colorModeForRenderPass(),_e=_.useProgram(ie?"backgroundPattern":"background"),Ee=A||ee.coveringTiles({tileSize:Q,terrain:_.style.map.terrain});ie&&(z.activeTexture.set($.TEXTURE0),_.imageManager.bind(_.context));const Ae=E.getCrossfadeParameters();for(const je of Ee){const Re=A?je.posMatrix:_.transform.calculatePosMatrix(je.toUnwrapped()),Le=ie?Ci(Re,R,_,ie,{tileID:je,tileSize:Q},Ae):ql(Re,R,D),$e=_.style.map.terrain&&_.style.map.terrain.getTerrainData(je);_e.draw(z,$.TRIANGLES,Se,ye,ae,_r.disabled,Le,$e,E.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(i,0,f,g);break;case"custom":(function(_,T,E){const A=_.context,D=E.implementation;if(_.renderPass==="offscreen"){const R=D.prerender;R&&(_.setCustomLayerDefaults(),A.setColorMode(_.colorModeForRenderPass()),R.call(D,A.gl,_.transform.customLayerMatrix()),A.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),A.setColorMode(_.colorModeForRenderPass()),A.setStencilMode(wr.disabled);const R=D.renderingMode==="3d"?new qt(_.context.gl.LEQUAL,qt.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,qt.ReadOnly);A.setDepthMode(R),D.render(A.gl,_.transform.customLayerMatrix()),A.setDirty(),_.setBaseState(),A.bindFramebuffer.set(null)}})(i,0,f)}}translatePosMatrix(i,u,f,g,_){if(!f[0]&&!f[1])return i;const T=_?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),R=Math.cos(T);f=[f[0]*R-f[1]*D,f[0]*D+f[1]*R]}const E=[_?f[0]:he(u,f[0],this.transform.zoom),_?f[1]:he(u,f[1],this.transform.zoom),0],A=new Float32Array(16);return l.$(A,i,E),A}saveTileTexture(i){const u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const u=this._tileTextures[i];return u&&u.length>0?u.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const u=this.imageManager.getPattern(i.from.toString()),f=this.imageManager.getPattern(i.to.toString());return!u||!f}useProgram(i,u){this.cache=this.cache||{};const f=i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Fl(this.context,xr[i],u,Gl[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ue(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:u}=this.context.gl;return this.width!==i||this.height!==u}}class qs{constructor(i,u){this.points=i,this.planes=u}static fromInvProjectionMatrix(i,u,f){const g=Math.pow(2,f),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const A=1/(E=l.ag([],E,i))[3]/u*g;return l.b3(E,E,[A,A,1/E[3],A])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const A=function($,ee){var Q=ee[0],ie=ee[1],X=ee[2],ye=Q*Q+ie*ie+X*X;return ye>0&&(ye=1/Math.sqrt(ye)),$[0]=ee[0]*ye,$[1]=ee[1]*ye,$[2]=ee[2]*ye,$}([],function($,ee,Q){var ie=ee[0],X=ee[1],ye=ee[2],Se=Q[0],ae=Q[1],_e=Q[2];return $[0]=X*_e-ye*ae,$[1]=ye*Se-ie*_e,$[2]=ie*ae-X*Se,$}([],be([],_[E[0]],_[E[1]]),be([],_[E[2]],_[E[1]]))),D=-((R=A)[0]*(z=_[E[1]])[0]+R[1]*z[1]+R[2]*z[2]);var R,z;return A.concat(D)});return new qs(_,T)}}class Qa{constructor(i,u){this.min=i,this.max=u,this.center=function(f,g,_){return f[0]=.5*g[0],f[1]=.5*g[1],f[2]=.5*g[2],f}([],function(f,g,_){return f[0]=g[0]+_[0],f[1]=g[1]+_[1],f[2]=g[2]+_[2],f}([],this.min,this.max))}quadrant(i){const u=[i%2==0,i<2],f=ue(this.min),g=ue(this.max);for(let _=0;_<u.length;_++)f[_]=u[_]?this.min[_]:this.center[_],g[_]=u[_]?this.center[_]:this.max[_];return g[2]=this.max[2],new Qa(f,g)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let g=0;g<i.planes.length;g++){const _=i.planes[g];let T=0;for(let E=0;E<u.length;E++)l.b4(_,u[E])>=0&&T++;if(T===0)return 0;T!==u.length&&(f=!1)}if(f)return 2;for(let g=0;g<3;g++){let _=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let E=0;E<i.points.length;E++){const A=i.points[E][g]-this.min[g];_=Math.min(_,A),T=Math.max(T,A)}if(T<0||_>this.max[g]-this.min[g])return 0}return 1}}class Yo{constructor(i=0,u=0,f=0,g=0){if(isNaN(i)||i<0||isNaN(u)||u<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=f,this.right=g}interpolate(i,u,f){return u.top!=null&&i.top!=null&&(this.top=l.B.number(i.top,u.top,f)),u.bottom!=null&&i.bottom!=null&&(this.bottom=l.B.number(i.bottom,u.bottom,f)),u.left!=null&&i.left!=null&&(this.left=l.B.number(i.left,u.left,f)),u.right!=null&&i.right!=null&&(this.right=l.B.number(i.right,u.right,f)),this}getCenter(i,u){const f=l.ad((this.left+i-this.right)/2,0,i),g=l.ad((this.top+u-this.bottom)/2,0,u);return new l.P(f,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Yo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ac{constructor(i,u,f,g,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||!!_,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Yo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const i=new ac(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this._minEleveationForCurrentTile=i._minEleveationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const u=-l.b5(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=function(){var f=new l.A(4);return l.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,g,_){var T=g[0],E=g[1],A=g[2],D=g[3],R=Math.sin(_),z=Math.cos(_);f[0]=T*z+A*R,f[1]=E*z+D*R,f[2]=T*-R+A*z,f[3]=E*-R+D*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const u=l.ad(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.tileZoom=Math.max(0,Math.floor(u)),this.scale=this.zoomScale(u),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,u,f){this._unmodified=!1,this._edgeInsets.interpolate(i,u,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(i){const u=[new l.b6(0,i)];if(this._renderWorldCopies){const f=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),_=this.pointCoordinate(new l.P(this.width,this.height)),T=this.pointCoordinate(new l.P(0,this.height)),E=Math.floor(Math.min(f.x,g.x,_.x,T.x)),A=Math.floor(Math.max(f.x,g.x,_.x,T.x)),D=1;for(let R=E-D;R<=A+D;R++)R!==0&&u.push(new l.b6(R,i))}return u}coveringTiles(i){var u,f;let g=this.coveringZoomLevel(i);const _=g;if(i.minzoom!==void 0&&g<i.minzoom)return[];i.maxzoom!==void 0&&g>i.maxzoom&&(g=i.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),E=l.U.fromLngLat(this.center),A=Math.pow(2,g),D=[A*T.x,A*T.y,0],R=[A*E.x,A*E.y,0],z=qs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let $=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=g);const ee=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,Q=ae=>({aabb:new Qa([ae*A,0,0],[(ae+1)*A,A,0]),zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),ie=[],X=[],ye=g,Se=i.reparseOverscaled?_:g;if(this._renderWorldCopies)for(let ae=1;ae<=3;ae++)ie.push(Q(-ae)),ie.push(Q(ae));for(ie.push(Q(0));ie.length>0;){const ae=ie.pop(),_e=ae.x,Ee=ae.y;let Ae=ae.fullyVisible;if(!Ae){const lt=ae.aabb.intersects(z);if(lt===0)continue;Ae=lt===2}const je=i.terrain?D:R,Re=ae.aabb.distanceX(je),Le=ae.aabb.distanceY(je),$e=Math.max(Math.abs(Re),Math.abs(Le));if(ae.zoom===ye||$e>ee+(1<<ye-ae.zoom)-2&&ae.zoom>=$){const lt=ye-ae.zoom,Bt=D[0]-.5-(_e<<lt),Ke=D[1]-.5-(Ee<<lt);X.push({tileID:new l.O(ae.zoom===ye?Se:ae.zoom,ae.wrap,ae.zoom,_e,Ee),distanceSq:Ce([R[0]-.5-_e,R[1]-.5-Ee]),tileDistanceToCamera:Math.sqrt(Bt*Bt+Ke*Ke)})}else for(let lt=0;lt<4;lt++){const Bt=(_e<<1)+lt%2,Ke=(Ee<<1)+(lt>>1),bt=ae.zoom+1;let ut=ae.aabb.quadrant(lt);if(i.terrain){const or=new l.O(bt,ae.wrap,bt,Bt,Ke),zt=i.terrain.getMinMaxElevation(or),Dt=(u=zt.minElevation)!==null&&u!==void 0?u:this.elevation,Ot=(f=zt.maxElevation)!==null&&f!==void 0?f:this.elevation;ut=new Qa([ut.min[0],ut.min[1],Dt],[ut.max[0],ut.max[1],Ot])}ie.push({aabb:ut,zoom:bt,x:Bt,y:Ke,wrap:ae.wrap,fullyVisible:Ae})}}return X.sort((ae,_e)=>ae.distanceSq-_e.distanceSq).map(ae=>ae.tileID)}resize(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const u=l.ad(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(i.lng)*this.worldSize,l.H(u)*this.worldSize)}unproject(i){return new l.U(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const u=this.pointLocation(this.centerPoint,i),f=i.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-f))return;const g=this.getCameraPosition(),_=l.U.fromLngLat(g.lngLat,g.altitude),T=l.U.fromLngLat(u,f),E=_.x-T.x,A=_.y-T.y,D=_.z-T.z,R=Math.sqrt(E*E+A*A+D*D),z=this.scaleZoom(this.cameraToCenterDistance/R/this.tileSize);this._elevation=f,this._center=u,this.zoom=z}setLocationAtPoint(i,u){const f=this.pointCoordinate(u),g=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(i),T=new l.U(_.x-(f.x-g.x),_.y-(f.y-g.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,u){return u?this.coordinatePoint(this.locationCoordinate(i),u.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,u){return this.coordinateLocation(this.pointCoordinate(i,u))}locationCoordinate(i){return l.U.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,u){if(u){const $=u.pointCoordinate(i);if($!=null)return $}const f=[i.x,i.y,0,1],g=[i.x,i.y,1,1];l.ag(f,f,this.pixelMatrixInverse),l.ag(g,g,this.pixelMatrixInverse);const _=f[3],T=g[3],E=f[1]/_,A=g[1]/T,D=f[2]/_,R=g[2]/T,z=D===R?0:(0-D)/(R-D);return new l.U(l.B.number(f[0]/_,g[0]/T,z)/this.worldSize,l.B.number(E,A,z)/this.worldSize)}coordinatePoint(i,u=0,f=this.pixelMatrix){const g=[i.x*this.worldSize,i.y*this.worldSize,u,1];return l.ag(g,g,f),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new Ye().extend(this.pointLocation(new l.P(0,i))).extend(this.pointLocation(new l.P(this.width,i))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(i,u=!1){const f=i.key,g=u?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];const _=i.canonical,T=this.worldSize/this.zoomScale(_.z),E=_.x+Math.pow(2,_.z)*i.wrap,A=l.ao(new Float64Array(16));return l.$(A,A,[E*T,_.y*T,0]),l.a0(A,A,[T/l.N,T/l.N,1]),l.a1(A,u?this.alignedProjMatrix:this.projMatrix,A),g[f]=new Float32Array(A),g[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i,u,f,g,_=-90,T=90,E=-180,A=180;const D=this.size,R=this._unmodified;if(this.latRange){const ee=this.latRange;_=l.H(ee[1])*this.worldSize,T=l.H(ee[0])*this.worldSize,i=T-_<D.y?D.y/(T-_):0}if(this.lngRange){const ee=this.lngRange;E=l.b5(l.G(ee[0])*this.worldSize,0,this.worldSize),A=l.b5(l.G(ee[1])*this.worldSize,0,this.worldSize),A<E&&(A+=this.worldSize),u=A-E<D.x?D.x/(A-E):0}const z=this.point,$=Math.max(u||0,i||0);if($)return this.center=this.unproject(new l.P(u?(A+E)/2:z.x,i?(T+_)/2:z.y)),this.zoom+=this.scaleZoom($),this._unmodified=R,void(this._constraining=!1);if(this.latRange){const ee=z.y,Q=D.y/2;ee-Q<_&&(g=_+Q),ee+Q>T&&(g=T-Q)}if(this.lngRange){const ee=(E+A)/2,Q=l.b5(z.x,ee-this.worldSize/2,ee+this.worldSize/2),ie=D.x/2;Q-ie<E&&(f=E+ie),Q+ie>A&&(f=A-ie)}f===void 0&&g===void 0||(this.center=this.unproject(new l.P(f!==void 0?f:z.x,g!==void 0?g:z.y)).wrap()),this._unmodified=R,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,u=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let g=l.ao(new Float64Array(16));l.a0(g,g,[this.width/2,-this.height/2,1]),l.$(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.ao(new Float64Array(16)),l.a0(g,g,[1,-1,1]),l.$(g,g,[-1,-1,0]),l.a0(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this._minEleveationForCurrentTile),E=_-T*this._pixelPerMeter/Math.cos(this._pitch),A=T<0?E:_,D=Math.PI/2+this._pitch,R=this._fov*(.5+i.y/this.height),z=Math.sin(R)*A/Math.sin(l.ad(Math.PI-D-R,.01,Math.PI-.01)),$=this.getHorizon(),ee=2*Math.atan($/this.cameraToCenterDistance)*(.5+i.y/(2*$)),Q=Math.sin(ee)*A/Math.sin(l.ad(Math.PI-D-ee,.01,Math.PI-.01)),ie=Math.min(z,Q),X=1.01*(Math.cos(Math.PI/2-this._pitch)*ie+A),ye=this.height/50;g=new Float64Array(16),l.b8(g,this._fov,this.width/this.height,ye,X),g[8]=2*-i.x/this.width,g[9]=2*i.y/this.height,l.a0(g,g,[1,-1,1]),l.$(g,g,[0,0,-this.cameraToCenterDistance]),l.b9(g,g,this._pitch),l.ae(g,g,this.angle),l.$(g,g,[-u,-f,0]),this.mercatorMatrix=l.a0([],g,[this.worldSize,this.worldSize,this.worldSize]),l.a0(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,g),l.$(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.as([],g),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,g);const Se=this.width%2/2,ae=this.height%2/2,_e=Math.cos(this.angle),Ee=Math.sin(this.angle),Ae=u-Math.round(u)+_e*Se+Ee*ae,je=f-Math.round(f)+_e*ae+Ee*Se,Re=new Float64Array(g);if(l.$(Re,Re,[Ae>.5?Ae-1:Ae,je>.5?je-1:je,0]),this.alignedProjMatrix=Re,g=l.as(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new l.P(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return l.ag(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,i))}getCameraQueryGeometry(i){const u=this.getCameraPoint();if(i.length===1)return[i[0],u];{let f=u.x,g=u.y,_=u.x,T=u.y;for(const E of i)f=Math.min(f,E.x),g=Math.min(g,E.y),_=Math.max(_,E.x),T=Math.max(T,E.y);return[new l.P(f,g),new l.P(_,g),new l.P(_,T),new l.P(f,T),new l.P(f,g)]}}}function ba(y,i){let u,f=!1,g=null,_=null;const T=()=>{g=null,f&&(y.apply(_,u),g=setTimeout(T,i),f=!1)};return(...E)=>(f=!0,_=this,u=E,g||T(),g)}class Jo{constructor(i){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let f;return u.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(f=g)}),(f&&f[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:f,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,u)}catch{}},this._updateHash=ba(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const u=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,g),T=Math.round(u.lng*_)/_,E=Math.round(u.lat*_)/_,A=this._map.getBearing(),D=this._map.getPitch();let R="";if(R+=i?`/${T}/${E}/${f}`:`${f}/${E}/${T}`,(A||D)&&(R+="/"+Math.round(10*A)/10),D&&(R+=`/${Math.round(D)}`),this._hashName){const z=this._hashName;let $=!1;const ee=window.location.hash.slice(1).split("&").map(Q=>{const ie=Q.split("=")[0];return ie===z?($=!0,`${ie}=${R}`):Q}).filter(Q=>Q);return $||ee.push(`${z}=${R}`),`#${ee.join("&")}`}return`#${R}`}}const eo={linearity:.3,easing:l.ba(0,0,.3,1)},xf=l.e({deceleration:2500,maxSpeed:1400},eo),bf=l.e({deceleration:20,maxSpeed:1400},eo),wf=l.e({deceleration:1e3,maxSpeed:360},eo),Sf=l.e({deceleration:1e3,maxSpeed:90},eo);class kf{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,u=l.h.now();for(;i.length>0&&u-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)u.zoom+=_.zoomDelta||0,u.bearing+=_.bearingDelta||0,u.pitch+=_.pitchDelta||0,_.panDelta&&u.pan._add(_.panDelta),_.around&&(u.around=_.around),_.pinchAround&&(u.pinchAround=_.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(u.pan.mag()){const _=Qo(u.pan.mag(),f,l.e({},xf,i||{}));g.offset=u.pan.mult(_.amount/u.pan.mag()),g.center=this._map.transform.center,nn(g,_)}if(u.zoom){const _=Qo(u.zoom,f,bf);g.zoom=this._map.transform.zoom+_.amount,nn(g,_)}if(u.bearing){const _=Qo(u.bearing,f,wf);g.bearing=this._map.transform.bearing+l.ad(_.amount,-179,179),nn(g,_)}if(u.pitch){const _=Qo(u.pitch,f,Sf);g.pitch=this._map.transform.pitch+_.amount,nn(g,_)}if(g.zoom||g.bearing){const _=u.pinchAround===void 0?u.around:u.pinchAround;g.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function nn(y,i){(!y.duration||y.duration<i.duration)&&(y.duration=i.duration,y.easing=i.easing)}function Qo(y,i,u){const{maxSpeed:f,linearity:g,deceleration:_}=u,T=l.ad(y*g/(i/1e3),-f,f),E=Math.abs(T)/(_*g);return{easing:u.easing,duration:1e3*E,amount:T*(E/2)}}class oi extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,f,g={}){const _=k.mousePos(u.getCanvasContainer(),f),T=u.unproject(_);super(i,l.e({point:_,lngLat:T,originalEvent:f},g)),this._defaultPrevented=!1,this.target=u}}class el extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,f){const g=i==="touchend"?f.changedTouches:f.touches,_=k.touchPos(u.getCanvasContainer(),g),T=_.map(A=>u.unproject(A)),E=_.reduce((A,D,R,z)=>A.add(D.div(z.length)),new l.P(0,0));super(i,{points:_,point:E,lngLats:T,lngLat:u.unproject(E),originalEvent:f}),this._defaultPrevented=!1}}class Tf extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,f){super(i,{originalEvent:f}),this._defaultPrevented=!1}}class Ef{constructor(i,u){this._map=i,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Tf(i.type,this._map,i))}mousedown(i,u){return this._mousedownPos=u,this._firePreventable(new oi(i.type,this._map,i))}mouseup(i){this._map.fire(new oi(i.type,this._map,i))}click(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new oi(i.type,this._map,i))}dblclick(i){return this._firePreventable(new oi(i.type,this._map,i))}mouseover(i){this._map.fire(new oi(i.type,this._map,i))}mouseout(i){this._map.fire(new oi(i.type,this._map,i))}touchstart(i){return this._firePreventable(new el(i.type,this._map,i))}touchmove(i){this._map.fire(new el(i.type,this._map,i))}touchend(i){this._map.fire(new el(i.type,this._map,i))}touchcancel(i){this._map.fire(new el(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cf{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new oi(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new oi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new oi(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qn{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(l.P.convert(i),this._map.terrain)}}class Af{constructor(i,u){this._map=i,this._tr=new Qn(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(k.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(i,u){if(!this._active)return;const f=u;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=f,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const _=Math.min(g.x,f.x),T=Math.max(g.x,f.x),E=Math.min(g.y,f.y),A=Math.max(g.y,f.y);k.setTransform(this._box,`translate(${_}px,${E}px)`),this._box.style.width=T-_+"px",this._box.style.height=A-E+"px"}mouseupWindow(i,u){if(!this._active||i.button!==0)return;const f=this._startPos,g=u;if(this.reset(),k.suppressClick(),f.x!==g.x||f.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(f,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,u){return this._map.fire(new l.k(i,{originalEvent:u}))}}function Ai(y,i){if(y.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${i.length}`);const u={};for(let f=0;f<y.length;f++)u[y[f].identifier]=i[f];return u}class Cn{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,u,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const _=new l.P(0,0);for(const T of g)_._add(T);return _.div(g.length)}(u),this.touches=Ai(f,u)))}touchmove(i,u,f){if(this.aborted||!this.centroid)return;const g=Ai(f,u);for(const _ in this.touches){const T=g[_];(!T||T.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,u,f){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class oc{constructor(i){this.singleTap=new Cn(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,u,f){this.singleTap.touchstart(i,u,f)}touchmove(i,u,f){this.singleTap.touchmove(i,u,f)}touchend(i,u,f){const g=this.singleTap.touchend(i,u,f);if(g){const _=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(g)<30;if(_&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class An{constructor(i){this._tr=new Qn(i),this._zoomIn=new oc({numTouches:1,numTaps:2}),this._zoomOut=new oc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,u,f){this._zoomIn.touchstart(i,u,f),this._zoomOut.touchstart(i,u,f)}touchmove(i,u,f){this._zoomIn.touchmove(i,u,f),this._zoomOut.touchmove(i,u,f)}touchend(i,u,f){const g=this._zoomIn.touchend(i,u,f),_=this._zoomOut.touchend(i,u,f),T=this._tr;return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(g)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pn{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const u=this._moveFunction(...i);if(u.bearingDelta||u.pitchDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(i,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=u.length?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,u){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const g=u.length?u[0]:u;return!this._moved&&g.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(f,g))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&k.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const kg={0:1,2:2};class Zu{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const u=k.mouseButton(i);this._eventButton=u}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(u,f){const g=kg[f];return u.buttons===void 0||(u.buttons&g)!==g}(i,this._eventButton)}isValidEndEvent(i){return k.mouseButton(i)===this._eventButton}}class Pf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const lc=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(i){i.preventDefault()}},to=({enable:y,clickTolerance:i,bearingDegreesPerPixelMoved:u=.8})=>{const f=new Zu({checkCorrectEvent:g=>k.mouseButton(g)===0&&g.ctrlKey||k.mouseButton(g)===2});return new Pn({clickTolerance:i,move:(g,_)=>({bearingDelta:(_.x-g.x)*u}),moveStateManager:f,enable:y,assignEvents:lc})},In=({enable:y,clickTolerance:i,pitchDegreesPerPixelMoved:u=-.5})=>{const f=new Zu({checkCorrectEvent:g=>k.mouseButton(g)===0&&g.ctrlKey||k.mouseButton(g)===2});return new Pn({clickTolerance:i,move:(g,_)=>({pitchDelta:(_.y-g.y)*u}),moveStateManager:f,enable:y,assignEvents:lc})};class nt{constructor(i,u){this._minTouches=i.cooperativeGestures?2:1,this._clickTolerance=i.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(i,u,f){return this._calculateTransform(i,u,f)}touchmove(i,u,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(i,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,f)}touchend(i,u,f){this._calculateTransform(i,u,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,u,f){f.length>0&&(this._active=!0);const g=Ai(f,u),_=new l.P(0,0),T=new l.P(0,0);let E=0;for(const D in g){const R=g[D],z=this._touches[D];z&&(_._add(R),T._add(R.sub(z)),E++,g[D]=R)}if(this._touches=g,E<this._minTouches||!T.mag())return;const A=T.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(E),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,u,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([u[0],u[1]]))}touchmove(i,u,f){if(!this._firstTwoTouches)return;i.preventDefault();const[g,_]=this._firstTwoTouches,T=ea(f,u,g),E=ea(f,u,_);if(!T||!E)return;const A=this._aroundCenter?null:T.add(E).div(2);return this._move([T,E],A,i)}touchend(i,u,f){if(!this._firstTwoTouches)return;const[g,_]=this._firstTwoTouches,T=ea(f,u,g),E=ea(f,u,_);T&&E||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ea(y,i,u){for(let f=0;f<y.length;f++)if(y[f].identifier===u)return i[f]}function ro(y,i){return Math.log(y/i)/Math.LN2}class If extends cc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,u){const f=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(ro(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ro(this._distance,f),pinchAround:u}}}function Qe(y,i){return 180*y.angleWith(i)/Math.PI}class Hu extends cc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,u){const f=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qe(this._vector,f),pinchAround:u}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const u=25/(Math.PI*this._minDiameter)*360,f=Qe(i,this._startVector);return Math.abs(f)<u}}function Ku(y){return Math.abs(y.y)>Math.abs(y.x)}class Tg extends cc{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,u,f){super.touchstart(i,u,f),this._currentTouchCount=f.length}_start(i){this._lastPoints=i,Ku(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,u,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const g=i[0].sub(this._lastPoints[0]),_=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,_,f.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(g.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(i,u,f){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,_=u.mag()>=2;if(!g&&!_)return;if(!g||!_)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=i.y>0==u.y>0;return Ku(i)&&Ku(u)&&T}}const Xu={panStep:100,bearingStep:15,pitchStep:10};class Mf{constructor(i){this._tr=new Qn(i);const u=Xu;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let u=0,f=0,g=0,_=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:i.shiftKey?f=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?f=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:E=>{const A=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:jf,zoom:u?Math.round(A.zoom)+u*(i.shiftKey?2:1):A.zoom,bearing:A.bearing+f*this._bearingStep,pitch:A.pitch+g*this._pitchStep,offset:[-_*this._panStep,-T*this._panStep],center:A.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jf(y){return y*(2-y)}const Df=4.000244140625;class Eg{constructor(i,u){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=i,this._tr=new Qn(i),this._el=i.getCanvasContainer(),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!i[this._map._metaKey])return;i.preventDefault()}let u=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const f=l.h.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,u!==0&&u%Df==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=k.mousePos(this._el,i),f=this._tr;this._around=l.L.convert(this._aroundCenter?f.center:f.unproject(u)),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Df?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&A!==0&&(A=1/A);const D=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(D*A))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,f=this._startZoom,g=this._easing;let _,T=!1;if(this._type==="wheel"&&f&&g){const E=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),A=g(E);_=l.B.number(f,u,A),E<1?this._frameId||(this._frameId=!0):T=!0}else _=u,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:_-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let u=l.bb;if(this._prevEase){const f=this._prevEase,g=(l.h.now()-f.start)/f.duration,_=f.easing(g+.01)-f.easing(g),T=.27/Math.sqrt(_*_+1e-4)*.01,E=Math.sqrt(.0729-T*T);u=l.ba(T,E,.25,1)}return this._prevEase={start:l.h.now(),duration:i,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Yu{constructor(i,u){this._clickZoom=i,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ju{constructor(i){this._tr=new Qn(i),this.reset()}reset(){this._active=!1}dblclick(i,u){return i.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qu{constructor(){this._tap=new oc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,u,f){if(!this._swipePoint)if(this._tapTime){const g=u[0],_=i.timeStamp-this._tapTime<500,T=this._tapPoint.dist(g)<30;_&&T?f.length>0&&(this._swipePoint=g,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(i,u,f)}touchmove(i,u,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=u[0],_=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,u,f)}touchend(i,u,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const g=this._tap.touchend(i,u,f);g&&(this._tapTime=i.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eh{constructor(i,u,f){this._el=i,this._mousePan=u,this._touchPan=f}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gs{constructor(i,u,f){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ta{constructor(i,u,f,g){this._el=i,this._touchZoom=u,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const tl=y=>y.zoom||y.drag||y.pitch||y.rotate;class th extends l.k{}function rl(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class rh{constructor(i,u){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,_)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=g.type==="renderFrame"?void 0:g,E={needsRenderFrame:!1},A={},D={},R=g.touches,z=R?this._getMapTouches(R):void 0,$=z?k.touchPos(this._el,z):k.mousePos(this._el,g);for(const{handlerName:ie,handler:X,allowed:ye}of this._handlers){if(!X.isEnabled())continue;let Se;this._blockedByActive(D,ye,ie)?X.reset():X[_||g.type]&&(Se=X[_||g.type](g,$,z),this.mergeHandlerResult(E,A,Se,ie,T),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||X.isActive())&&(D[ie]=X)}const ee={};for(const ie in this._previousActiveHandlers)D[ie]||(ee[ie]=T);this._previousActiveHandlers=D,(Object.keys(ee).length||rl(E))&&(this._changes.push([E,A,ee]),this._triggerRenderFrame()),(Object.keys(D).length||rl(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=E;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kf(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,_,T]of this._listeners)k.addEventListener(g,_,g===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[i,u,f]of this._listeners)k.removeEventListener(i,u,i===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(i){const u=this._map,f=u.getCanvasContainer();this._add("mapEvent",new Ef(u,i));const g=u.boxZoom=new Af(u,i);this._add("boxZoom",g),i.interactive&&i.boxZoom&&g.enable();const _=new An(u),T=new Ju(u);u.doubleClickZoom=new Yu(T,_),this._add("tapZoom",_),this._add("clickZoom",T),i.interactive&&i.doubleClickZoom&&u.doubleClickZoom.enable();const E=new Qu;this._add("tapDragZoom",E);const A=u.touchPitch=new Tg(u);this._add("touchPitch",A),i.interactive&&i.touchPitch&&u.touchPitch.enable(i.touchPitch);const D=to(i),R=In(i);u.dragRotate=new Gs(i,D,R),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),i.interactive&&i.dragRotate&&u.dragRotate.enable();const z=(({enable:ye,clickTolerance:Se})=>{const ae=new Zu({checkCorrectEvent:_e=>k.mouseButton(_e)===0&&!_e.ctrlKey});return new Pn({clickTolerance:Se,move:(_e,Ee)=>({around:Ee,panDelta:Ee.sub(_e)}),activateOnStart:!0,moveStateManager:ae,enable:ye,assignEvents:lc})})(i),$=new nt(i,u);u.dragPan=new eh(f,z,$),this._add("mousePan",z),this._add("touchPan",$,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&u.dragPan.enable(i.dragPan);const ee=new Hu,Q=new If;u.touchZoomRotate=new ta(f,Q,ee,E),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&u.touchZoomRotate.enable(i.touchZoomRotate);const ie=u.scrollZoom=new Eg(u,()=>this._triggerRenderFrame());this._add("scrollZoom",ie,["mousePan"]),i.interactive&&i.scrollZoom&&u.scrollZoom.enable(i.scrollZoom);const X=u.keyboard=new Mf(u);this._add("keyboard",X),i.interactive&&i.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new Cf(u))}_add(i,u,f){this._handlers.push({handlerName:i,handler:u,allowed:f}),this._handlersById[i]=u}stop(i){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!tl(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,u,f){for(const g in i)if(g!==f&&(!u||u.indexOf(g)<0))return!0;return!1}_getMapTouches(i){const u=[];for(const f of i)this._el.contains(f.target)&&u.push(f);return u}mergeHandlerResult(i,u,f,g,_){if(!f)return;l.e(i,f);const T={handlerName:g,originalEvent:f.originalEvent||_};f.zoomDelta!==void 0&&(u.zoom=T),f.panDelta!==void 0&&(u.drag=T),f.pitchDelta!==void 0&&(u.pitch=T),f.bearingDelta!==void 0&&(u.rotate=T)}_applyChanges(){const i={},u={},f={};for(const[g,_,T]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(i.around=g.around),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),l.e(u,_),l.e(f,T);this._updateMapTransform(i,u,f),this._changes=[]}_updateMapTransform(i,u,f){const g=this._map,_=g._getTransformForUpdate(),T=g.terrain;if(!(rl(i)||T&&this._terrainMovement))return this._fireEvents(u,f,!0);let{panDelta:E,zoomDelta:A,bearingDelta:D,pitchDelta:R,around:z,pinchAround:$}=i;$!==void 0&&(z=$),g._stop(!0),z=z||g.transform.centerPoint;const ee=_.pointLocation(E?z.sub(E):z);D&&(_.bearing+=D),R&&(_.pitch+=R),A&&(_.zoom+=A),T?this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(E)):_.setLocationAtPoint(ee,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(ee,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(g.terrain)})):_.setLocationAtPoint(ee,z),g._applyUpdatedTransform(_),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,f,!0)}_fireEvents(i,u,f){const g=tl(this._eventsInProgress),_=tl(i),T={};for(const R in i){const{originalEvent:z}=i[R];this._eventsInProgress[R]||(T[`${R}start`]=z),this._eventsInProgress[R]=i[R]}!g&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in T)this._fireEvent(R,T[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in i){const{originalEvent:z}=i[R];this._fireEvent(R,z)}const E={};let A;for(const R in this._eventsInProgress){const{handlerName:z,originalEvent:$}=this._eventsInProgress[R];this._handlersById[z].isActive()||(delete this._eventsInProgress[R],A=u[z]||$,E[`${R}end`]=A)}for(const R in E)this._fireEvent(R,E[R]);const D=tl(this._eventsInProgress);if(f&&(g||_)&&!D){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!R||!R.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:A})),z(this._map.getBearing())&&this._map.resetNorth()):(z(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(i,u){this._map.fire(new l.k(i,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new th("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Nf extends l.E{constructor(i,u){super(),this._renderFrameCallback=()=>{const f=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=u.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(i,u){return this.jumpTo({center:i},u)}panBy(i,u,f){return i=l.P.convert(i).mult(-1),this.panTo(this.transform.center,l.e({offset:i},u),f)}panTo(i,u,f){return this.easeTo(l.e({center:i},u),f)}getZoom(){return this.transform.zoom}setZoom(i,u){return this.jumpTo({zoom:i},u),this}zoomTo(i,u,f){return this.easeTo(l.e({zoom:i},u),f)}zoomIn(i,u){return this.zoomTo(this.getZoom()+1,i,u),this}zoomOut(i,u){return this.zoomTo(this.getZoom()-1,i,u),this}getBearing(){return this.transform.bearing}setBearing(i,u){return this.jumpTo({bearing:i},u),this}getPadding(){return this.transform.padding}setPadding(i,u){return this.jumpTo({padding:i},u),this}rotateTo(i,u,f){return this.easeTo(l.e({bearing:i},u),f)}resetNorth(i,u){return this.rotateTo(0,l.e({duration:1e3},i),u),this}resetNorthPitch(i,u){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},i),u),this}snapToNorth(i,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,u):this}getPitch(){return this.transform.pitch}setPitch(i,u){return this.jumpTo({pitch:i},u),this}cameraForBounds(i,u){i=Ye.convert(i);const f=u&&u.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),f,u)}_cameraForBoxAndBearing(i,u,f,g){const _={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Ee=g.padding;g.padding={top:Ee,bottom:Ee,right:Ee,left:Ee}}g.padding=l.e(_,g.padding);const T=this.transform,E=T.padding,A=T.project(l.L.convert(i)),D=T.project(l.L.convert(u)),R=A.rotate(-f*Math.PI/180),z=D.rotate(-f*Math.PI/180),$=new l.P(Math.max(R.x,z.x),Math.max(R.y,z.y)),ee=new l.P(Math.min(R.x,z.x),Math.min(R.y,z.y)),Q=$.sub(ee),ie=(T.width-(E.left+E.right+g.padding.left+g.padding.right))/Q.x,X=(T.height-(E.top+E.bottom+g.padding.top+g.padding.bottom))/Q.y;if(X<0||ie<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ye=Math.min(T.scaleZoom(T.scale*Math.min(ie,X)),g.maxZoom),Se=l.P.convert(g.offset),ae=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(f*Math.PI/180),_e=Se.add(ae).mult(T.scale/T.zoomScale(ye));return{center:T.unproject(A.add(D).div(2).sub(_e)),zoom:ye,bearing:f}}fitBounds(i,u,f){return this._fitInternal(this.cameraForBounds(i,u),u,f)}fitScreenCoordinates(i,u,f,g,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(i)),this.transform.pointLocation(l.P.convert(u)),f,g),g,_)}_fitInternal(i,u,f){return i?(delete(u=l.e(i,u)).padding,u.linear?this.easeTo(u,f):this.flyTo(u,f)):this}jumpTo(i,u){this.stop();const f=this._getTransformForUpdate();let g=!1,_=!1,T=!1;return"zoom"in i&&f.zoom!==+i.zoom&&(g=!0,f.zoom=+i.zoom),i.center!==void 0&&(f.center=l.L.convert(i.center)),"bearing"in i&&f.bearing!==+i.bearing&&(_=!0,f.bearing=+i.bearing),"pitch"in i&&f.pitch!==+i.pitch&&(T=!0,f.pitch=+i.pitch),i.padding==null||f.isPaddingEqual(i.padding)||(f.padding=i.padding),this._applyUpdatedTransform(f),this.fire(new l.k("movestart",u)).fire(new l.k("move",u)),g&&this.fire(new l.k("zoomstart",u)).fire(new l.k("zoom",u)).fire(new l.k("zoomend",u)),_&&this.fire(new l.k("rotatestart",u)).fire(new l.k("rotate",u)).fire(new l.k("rotateend",u)),T&&this.fire(new l.k("pitchstart",u)).fire(new l.k("pitch",u)).fire(new l.k("pitchend",u)),this.fire(new l.k("moveend",u))}calculateCameraOptionsFromTo(i,u,f,g=0){const _=l.U.fromLngLat(i,u),T=l.U.fromLngLat(f,g),E=T.x-_.x,A=T.y-_.y,D=T.z-_.z,R=Math.hypot(E,A,D);if(R===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(E,A),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),ee=180*Math.atan2(E,-A)/Math.PI;let Q=180*Math.acos(z/R)/Math.PI;return Q=D<0?90-Q:90+Q,{center:T.toLngLat(),zoom:$,pitch:Q,bearing:ee}}easeTo(i,u){this._stop(!1,i.easeId),((i=l.e({offset:[0,0],duration:500,easing:l.bb},i)).animate===!1||!i.essential&&l.h.prefersReducedMotion)&&(i.duration=0);const f=this._getTransformForUpdate(),g=this.getZoom(),_=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in i?+i.zoom:g,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,R="pitch"in i?+i.pitch:T,z="padding"in i?i.padding:f.padding,$=l.P.convert(i.offset);let ee=f.centerPoint.add($);const Q=f.pointLocation(ee),ie=l.L.convert(i.center||Q);this._normalizeCenter(ie);const X=f.project(Q),ye=f.project(ie).sub(X),Se=f.zoomScale(A-g);let ae,_e;i.around&&(ae=l.L.convert(i.around),_e=f.locationPoint(ae));const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||A!==g,this._rotating=this._rotating||_!==D,this._pitching=this._pitching||R!==T,this._padding=!f.isPaddingEqual(z),this._easeId=i.easeId,this._prepareEase(u,i.noMoveStart,Ee),this.terrain&&this._prepareElevation(ie),this._ease(Ae=>{if(this._zooming&&(f.zoom=l.B.number(g,A,Ae)),this._rotating&&(f.bearing=l.B.number(_,D,Ae)),this._pitching&&(f.pitch=l.B.number(T,R,Ae)),this._padding&&(f.interpolatePadding(E,z,Ae),ee=f.centerPoint.add($)),this.terrain&&!i.freezeElevation&&this._updateElevation(Ae),ae)f.setLocationAtPoint(ae,_e);else{const je=f.zoomScale(f.zoom-g),Re=A>g?Math.min(2,Se):Math.max(.5,Se),Le=Math.pow(Re,1-Ae),$e=f.unproject(X.add(ye.mult(Ae*Le)).mult(je));f.setLocationAtPoint(f.renderWorldCopies?$e.wrap():$e,ee)}this._applyUpdatedTransform(f),this._fireMoveEvents(u)},Ae=>{this.terrain&&this._finalizeElevation(),this._afterEase(u,Ae)},i),this}_prepareEase(i,u,f={}){this._moving=!0,u||f.moving||this.fire(new l.k("movestart",i)),this._zooming&&!f.zooming&&this.fire(new l.k("zoomstart",i)),this._rotating&&!f.rotating&&this.fire(new l.k("rotatestart",i)),this._pitching&&!f.pitching&&this.fire(new l.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&u!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(f-(u-(f*i+this._elevationStart))/(1-i)),this._elevationTarget=u}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const u=i.clone(),{center:f,zoom:g,pitch:_,bearing:T,elevation:E}=this.transformCameraUpdate(u);f&&(u.center=f),g!==void 0&&(u.zoom=g),_!==void 0&&(u.pitch=_),T!==void 0&&(u.bearing=T),E!==void 0&&(u.elevation=E),this.transform.apply(u)}_fireMoveEvents(i){this.fire(new l.k("move",i)),this._zooming&&this.fire(new l.k("zoom",i)),this._rotating&&this.fire(new l.k("rotate",i)),this._pitching&&this.fire(new l.k("pitch",i))}_afterEase(i,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const f=this._zooming,g=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new l.k("zoomend",i)),g&&this.fire(new l.k("rotateend",i)),_&&this.fire(new l.k("pitchend",i)),this.fire(new l.k("moveend",i))}flyTo(i,u){if(!i.essential&&l.h.prefersReducedMotion){const ut=l.F(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,u)}this.stop(),i=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},i);const f=this._getTransformForUpdate(),g=this.getZoom(),_=this.getBearing(),T=this.getPitch(),E=this.getPadding(),A="zoom"in i?l.ad(+i.zoom,f.minZoom,f.maxZoom):g,D="bearing"in i?this._normalizeBearing(i.bearing,_):_,R="pitch"in i?+i.pitch:T,z="padding"in i?i.padding:f.padding,$=f.zoomScale(A-g),ee=l.P.convert(i.offset);let Q=f.centerPoint.add(ee);const ie=f.pointLocation(Q),X=l.L.convert(i.center||ie);this._normalizeCenter(X);const ye=f.project(ie),Se=f.project(X).sub(ye);let ae=i.curve;const _e=Math.max(f.width,f.height),Ee=_e/$,Ae=Se.mag();if("minZoom"in i){const ut=l.ad(Math.min(i.minZoom,g,A),f.minZoom,f.maxZoom),or=_e/f.zoomScale(ut-g);ae=Math.sqrt(or/Ae*2)}const je=ae*ae;function Re(ut){const or=(Ee*Ee-_e*_e+(ut?-1:1)*je*je*Ae*Ae)/(2*(ut?Ee:_e)*je*Ae);return Math.log(Math.sqrt(or*or+1)-or)}function Le(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function $e(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const lt=Re(!1);let Bt=function(ut){return $e(lt)/$e(lt+ae*ut)},Ke=function(ut){return _e*(($e(lt)*(Le(or=lt+ae*ut)/$e(or))-Le(lt))/je)/Ae;var or},bt=(Re(!0)-lt)/ae;if(Math.abs(Ae)<1e-6||!isFinite(bt)){if(Math.abs(_e-Ee)<1e-6)return this.easeTo(i,u);const ut=Ee<_e?-1:1;bt=Math.abs(Math.log(Ee/_e))/ae,Ke=function(){return 0},Bt=function(or){return Math.exp(ut*ae*or)}}return i.duration="duration"in i?+i.duration:1e3*bt/("screenSpeed"in i?+i.screenSpeed/ae:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=_!==D,this._pitching=R!==T,this._padding=!f.isPaddingEqual(z),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(X),this._ease(ut=>{const or=ut*bt,zt=1/Bt(or);f.zoom=ut===1?A:g+f.scaleZoom(zt),this._rotating&&(f.bearing=l.B.number(_,D,ut)),this._pitching&&(f.pitch=l.B.number(T,R,ut)),this._padding&&(f.interpolatePadding(E,z,ut),Q=f.centerPoint.add(ee)),this.terrain&&!i.freezeElevation&&this._updateElevation(ut);const Dt=ut===1?X:f.unproject(ye.add(Se.mult(Ke(or))).mult(zt));f.setLocationAtPoint(f.renderWorldCopies?Dt.wrap():Dt,Q),this._applyUpdatedTransform(f),this._fireMoveEvents(u)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(u)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,u)}if(!i){const f=this.handlers;f&&f.stop(!1)}return this}_ease(i,u,f){f.animate===!1||f.duration===0?(i(1),u()):(this._easeStart=l.h.now(),this._easeOptions=f,this._onEaseFrame=i,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,u){i=l.b5(i,-180,180);const f=Math.abs(i-u);return Math.abs(i-360-u)<f&&(i-=360),Math.abs(i+360-u)<f&&(i+=360),i}_normalizeCenter(i){const u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;const f=i.lng-u.center.lng;i.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}class li{constructor(i={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options&&this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,u){const f=this._map._getUIString(`AttributionControl.${u}`);i.title=f,i.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const u=this._map.style.sourceCaches;for(const g in u){const _=u[g];if(_.used||_.usedForTerrain){const T=_.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i=i.filter(g=>String(g).trim()),i.sort((g,_)=>g.length-_.length),i=i.filter((g,_)=>{for(let T=_+1;T<i.length;T++)if(i[T].indexOf(g)>=0)return!1;return!0});const f=i.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,i.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class mr{constructor(i={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const f=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const u=k.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class uc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u}remove(i){const u=this._currentlyRunning,f=u?this._queue.concat(u):this._queue;for(const g of f)if(g.id===i)return void(g.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const f of u)if(!f.cancelled&&(f.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const sh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Lf=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Rf extends l.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,u){this.sourceCache.update(i,u),this._renderableTilesKeys=[];const f={};for(const g of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))f[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aS(g.posMatrix,0,l.N,0,l.N,0,1),this._tiles[g.key]=new os(g,this.tileSize));for(const g in this._tiles)f[g]||delete this._tiles[g]}freeRtt(i){for(const u in this._tiles){const f=this._tiles[u];(!i||f.tileID.equals(i)||f.tileID.isChildOf(i)||i.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const u={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID;if(g.canonical.equals(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16),l.aS(_.posMatrix,0,l.N,0,l.N,0,1),u[f]=_}else if(g.canonical.isChildOf(i.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const T=g.canonical.z-i.canonical.z,E=g.canonical.x-(g.canonical.x>>T<<T),A=g.canonical.y-(g.canonical.y>>T<<T),D=l.N>>T;l.aS(_.posMatrix,0,D,0,D,0,1),l.$(_.posMatrix,_.posMatrix,[-E*D,-A*D,0]),u[f]=_}else if(i.canonical.isChildOf(g.canonical)){const _=i.clone();_.posMatrix=new Float64Array(16);const T=i.canonical.z-g.canonical.z,E=i.canonical.x-(i.canonical.x>>T<<T),A=i.canonical.y-(i.canonical.y>>T<<T),D=l.N>>T;l.aS(_.posMatrix,0,l.N,0,l.N,0,1),l.$(_.posMatrix,_.posMatrix,[E*D,A*D,0]),l.a0(_.posMatrix,_.posMatrix,[1/2**T,1/2**T,0]),u[f]=_}}return u}getSourceTile(i,u){const f=this.sourceCache._source;let g=i.overscaledZ-this.deltaZoom;if(g>f.maxzoom&&(g=f.maxzoom),g<f.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(g).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!_||!_.dem)&&u)for(;g>=f.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(i.scaledTo(g--).key);return _}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(u=>u.timeAdded>=i)}}class zf{constructor(i,u,f){this.painter=i,this.sourceCache=new Rf(u),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,u,f,g=l.N){var _;if(!(u>=0&&u<g&&f>=0&&f<g))return 0;const T=this.getTerrainData(i),E=(_=T.tile)===null||_===void 0?void 0:_.dem;if(!E)return 0;const A=function(Q,ie,X){var ye=ie[0],Se=ie[1];return Q[0]=X[0]*ye+X[4]*Se+X[12],Q[1]=X[1]*ye+X[5]*Se+X[13],Q}([],[u/g*l.N,f/g*l.N],T.u_terrain_matrix),D=[A[0]*E.dim,A[1]*E.dim],R=Math.floor(D[0]),z=Math.floor(D[1]),$=D[0]-R,ee=D[1]-z;return E.get(R,z)*(1-$)*(1-ee)+E.get(R+1,z)*$*(1-ee)+E.get(R,z+1)*(1-$)*ee+E.get(R+1,z+1)*$*ee}getElevationForLngLatZoom(i,u){const{tileID:f,mercatorX:g,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(i,u);return this.getElevation(f,g%l.N,_%l.N,l.N)}getElevation(i,u,f,g=l.N){return this.getDEMElevation(i,u,f,g)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const g=this.painter.context,_=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ue(g,_,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ue(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}const u=this.sourceCache.getSourceTile(i,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const g=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new Ue(g,u.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),u.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const f=u&&u+u.tileID.key+i.key;if(f&&!this._demMatrixCache[f]){const g=this.sourceCache.sourceCache._source.maxzoom;let _=i.canonical.z-u.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=g?_=i.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=i.canonical.x-(i.canonical.x>>_<<_),E=i.canonical.y-(i.canonical.y>>_<<_),A=l.bc(new Float64Array(16),[1/(l.N<<_),1/(l.N<<_),0]);l.$(A,A,[T*l.N,E*l.N,0]),this._demMatrixCache[i.key]={matrix:A,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(i){const u=this.painter,f=u.width/devicePixelRatio,g=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ue(u.context,{width:f,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ue(u.context,{width:f,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(f,g,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,f,g))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,T=0;_<this._coordsTextureSize;_++)for(let E=0;E<this._coordsTextureSize;E++,T+=4)u[T+0]=255&E,u[T+1]=255&_,u[T+2]=E>>8<<4|_>>8,u[T+3]=0;const f=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),g=new Ue(i,f,i.gl.RGBA,{premultiply:!1});return g.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(i){const u=new Uint8Array(4),f=this.painter.context,g=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,u),f.bindFramebuffer.set(null);const _=u[0]+(u[2]>>4<<8),T=u[1]+((15&u[2])<<8),E=this.coordsIndex[255-u[3]],A=E&&this.sourceCache.getTileByID(E);if(!A)return null;const D=this._coordsTextureSize,R=(1<<A.tileID.canonical.z)*D;return new l.U(this._allowMercatorOverflow(i,(A.tileID.canonical.x*D+_)/R),(A.tileID.canonical.y*D+T)/R,this.getElevation(A.tileID,_,T,D))}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,u=new l.bd,f=new l.b0,g=this.meshSize,_=l.N/g,T=g*g;for(let z=0;z<=g;z++)for(let $=0;$<=g;$++)u.emplaceBack($*_,z*_,0);for(let z=0;z<T;z+=g+1)for(let $=0;$<g;$++)f.emplaceBack($+z,g+$+z+1,g+$+z+2),f.emplaceBack($+z,g+$+z+2,$+z+1);const E=u.length,A=E+2*(g+1);for(const z of[0,1])for(let $=0;$<=g;$++)for(const ee of[0,1])u.emplaceBack($*_,z*l.N,ee);for(let z=0;z<2*g;z+=2)f.emplaceBack(A+z,A+z+1,A+z+3),f.emplaceBack(A+z,A+z+3,A+z+2),f.emplaceBack(E+z,E+z+3,E+z+1),f.emplaceBack(E+z,E+z+2,E+z+3);const D=u.length,R=D+2*(g+1);for(const z of[0,1])for(let $=0;$<=g;$++)for(const ee of[0,1])u.emplaceBack(z*l.N,$*_,ee);for(let z=0;z<2*g;z+=2)f.emplaceBack(D+z,D+z+1,D+z+3),f.emplaceBack(D+z,D+z+3,D+z+2),f.emplaceBack(R+z,R+z+3,R+z+1),f.emplaceBack(R+z,R+z+2,R+z+3);return this._mesh={indexBuffer:i.createIndexBuffer(f),vertexBuffer:i.createVertexBuffer(u,Lf.members),segments:l.S.simpleSegment(0,0,u.length,f.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*l.be/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,u){var f;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(i,u);return(f=this.getMinMaxElevation(g).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(i){const u=this.getTerrainData(i).tile,f={minElevation:null,maxElevation:null};return u&&u.dem&&(f.minElevation=u.dem.min*this.exaggeration,f.maxElevation=u.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(i,u){const f=l.U.fromLngLat(i.wrap()),g=(1<<u)*l.N,_=f.x*g,T=f.y*g,E=Math.floor(_/l.N),A=Math.floor(T/l.N);return{tileID:new l.O(u,0,u,E,A),mercatorX:_,mercatorY:T}}_allowMercatorOverflow(i,u){const f=i.x<this.painter.width/2;let g=l.bf(u);const _=this.painter.transform.center.lng;return f&&Math.sign(g)>0&&Math.sign(_)<0||!f&&Math.sign(g)<0&&Math.sign(_)>0?(g=360*Math.sign(_)+g,l.G(g)):u}}class Cg{constructor(i,u,f){this._context=i,this._size=u,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new Ue(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(f.texture),{id:i,fbo:u,texture:f,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>i.id!==u),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Ns={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class hc{constructor(i,u){this.painter=i,this.terrain=u,this.pool=new Cg(i.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(f=>!i._layers[f].isHidden(u)),this._coordsDescendingInv={};for(const f in i.sourceCaches){this._coordsDescendingInv[f]={};const g=i.sourceCaches[f].getVisibleCoordinates();for(const _ of g){const T=this.terrain.sourceCache.getTerrainCoords(_);for(const E in T)this._coordsDescendingInv[f][E]||(this._coordsDescendingInv[f][E]=[]),this._coordsDescendingInv[f][E].push(T[E])}}this._coordsDescendingInvStr={};for(const f of i._order){const g=i._layers[f],_=g.source;if(Ns[g.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const T in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][T]=this._coordsDescendingInv[_][T].map(E=>E.key).sort().join()}}for(const f of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[g][f.tileID.key];_&&_!==f.rttCoords[g]&&(f.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const u=i.type,f=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Ns[u]&&(this._prevType&&Ns[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(i.id),!g))return!0;if(Ns[this._prevType]||Ns[u]&&g){this._prevType=u;const _=this._stacks.length-1,T=this._stacks[_]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(Cr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[_]){const D=this.pool.getObjectForId(E.rtt[_].id);if(D.stamp===E.rtt[_].stamp){this.pool.useObject(D);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),E.rtt[_]={id:A.id,stamp:A.stamp},f.context.bindFramebuffer.set(A.fbo.framebuffer),f.context.clear({color:l.aT.transparent,stencil:0}),f.currentStencilSource=void 0;for(let D=0;D<T.length;D++){const R=f.style._layers[T[D]],z=R.source?this._coordsDescendingInv[R.source][E.tileID.key]:[E.tileID];f.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),f._renderTileClippingMasks(R,z),f.renderLayer(f,f.style.sourceCaches[R.source],R,z),R.source&&(E.rttCoords[R.source]=this._coordsDescendingInvStr[R.source][E.tileID.key])}}return Cr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ns[u]}return!1}}const dt=w,xt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},sl=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},ih={showCompass:!0,showZoom:!0,visualizePitch:!1};class nh{constructor(i,u,f=!1){this.mousedown=T=>{this.startMouse(l.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),k.mousePos(this.element,T)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,k.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=i.dragRotate._mouseRotate.getClickTolerance(),_=i.dragRotate._mousePitch.getClickTolerance();this.element=u,this.mouseRotate=to({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:E,bearingDegreesPerPixelMoved:A=.8})=>{const D=new Pf;return new Pn({clickTolerance:E,move:(R,z)=>({bearingDelta:(z.x-R.x)*A}),moveStateManager:D,enable:T,assignEvents:sl})})({clickTolerance:g,enable:!0}),this.map=i,f&&(this.mousePitch=In({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:E,pitchDegreesPerPixelMoved:A=-.5})=>{const D=new Pf;return new Pn({clickTolerance:E,move:(R,z)=>({pitchDelta:(z.y-R.y)*A}),moveStateManager:D,enable:T,assignEvents:sl})})({clickTolerance:_,enable:!0})),k.addEventListener(u,"mousedown",this.mousedown),k.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(u,"touchcancel",this.reset)}startMouse(i,u){this.mouseRotate.dragStart(i,u),this.mousePitch&&this.mousePitch.dragStart(i,u),k.disableDrag()}startTouch(i,u){this.touchRotate.dragStart(i,u),this.touchPitch&&this.touchPitch.dragStart(i,u),k.disableDrag()}moveMouse(i,u){const f=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(i,u)||{};if(g&&f.setBearing(f.getBearing()+g),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(i,u)||{};_&&f.setPitch(f.getPitch()+_)}}moveTouch(i,u){const f=this.map,{bearingDelta:g}=this.touchRotate.dragMove(i,u)||{};if(g&&f.setBearing(f.getBearing()+g),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(i,u)||{};_&&f.setPitch(f.getPitch()+_)}}off(){const i=this.element;k.removeEventListener(i,"mousedown",this.mousedown),k.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let Rr;function ah(y,i,u){if(y=new l.L(y.lng,y.lat),i){const f=new l.L(y.lng-360,y.lat),g=new l.L(y.lng+360,y.lat),_=u.locationPoint(y).distSqr(i);u.locationPoint(f).distSqr(i)<_?y=f:u.locationPoint(g).distSqr(i)<_&&(y=g)}for(;Math.abs(y.lng-u.center.lng)>180;){const f=u.locationPoint(y);if(f.x>=0&&f.y>=0&&f.x<=u.width&&f.y<=u.height)break;y.lng>u.center.lng?y.lng-=360:y.lng+=360}return y}const Pi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bf(y,i,u){const f=y.classList;for(const g in Pi)f.remove(`maplibregl-${u}-anchor-${g}`);f.add(`maplibregl-${u}-anchor-${i}`)}class wa extends l.E{constructor(i){if(super(),this._onKeyPress=u=>{const f=u.code,g=u.charCode||u.keyCode;f!=="Space"&&f!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=u=>{const f=u.originalEvent.target,g=this._element;this._popup&&(f===g||g.contains(f))&&this.togglePopup()},this._update=u=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!f)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=ah(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),u&&u.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${Pi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${g}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const T=this._map.unproject(this._pos),E=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=T.distanceTo(this._lngLat)>20*E?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=u=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=l.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div"),this._element.setAttribute("aria-label","Map marker");const u=k.createNS("http://www.w3.org/2000/svg","svg"),f=41,g=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${f}px`),u.setAttributeNS(null,"width",`${g}px`),u.setAttributeNS(null,"viewBox",`0 0 ${g} ${f}`);const _=k.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const T=k.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const E=k.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ye of A){const Se=k.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",ye.rx),Se.setAttributeNS(null,"ry",ye.ry),E.appendChild(Se)}const D=k.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const R=k.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(R);const z=k.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const $=k.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild($);const ee=k.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ee.setAttributeNS(null,"fill","#FFFFFF");const Q=k.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=k.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const X=k.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),Q.appendChild(ie),Q.appendChild(X),T.appendChild(E),T.appendChild(D),T.appendChild(z),T.appendChild(ee),T.appendChild(Q),u.appendChild(T),u.setAttributeNS(null,"height",f*this._scale+"px"),u.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(u),this._offset=l.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Bf(this._element,this._anchor,"marker"),i&&i.className)for(const u of i.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=l.L.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?i.remove():i.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(i){return this._offset=l.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Ar={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Sr=0,so=!1;const il={maxWidth:100,unit:"metric"};function nl(y,i,u){const f=u&&u.maxWidth||100,g=y._container.clientHeight/2,_=y.unproject([0,g]),T=y.unproject([f,g]),E=_.distanceTo(T);if(u&&u.unit==="imperial"){const A=3.2808*E;A>5280?Sa(i,f,A/5280,y._getUIString("ScaleControl.Miles")):Sa(i,f,A,y._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Sa(i,f,E/1852,y._getUIString("ScaleControl.NauticalMiles")):E>=1e3?Sa(i,f,E/1e3,y._getUIString("ScaleControl.Kilometers")):Sa(i,f,E,y._getUIString("ScaleControl.Meters"))}function Sa(y,i,u,f){const g=function(_){const T=Math.pow(10,`${Math.floor(_)}`.length-1);let E=_/T;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(A){const D=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*D)/D}(E),T*E}(u);y.style.width=i*(g/u)+"px",y.innerHTML=`${g}&nbsp;${f}`}const oh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},lh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function io(y){if(y){if(typeof y=="number"){const i=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(i,i),"top-right":new l.P(-i,i),bottom:new l.P(0,-y),"bottom-left":new l.P(i,-i),"bottom-right":new l.P(-i,-i),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const i=l.P.convert(y);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return io(new l.P(0,0))}const ch={extend:(y,...i)=>l.e(y,...i),run(y){y()},logToElement(y,i=!1,u="log"){const f=window.document.getElementById(u);f&&(i&&(f.innerHTML=""),f.innerHTML+=`<br>${y}`)}},uh=w;class Qt{static get version(){return uh}static get workerCount(){return wi.workerCount}static set workerCount(i){wi.workerCount=i}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(i){l.c.MAX_PARALLEL_IMAGE_REQUESTS=i}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(i){l.c.WORKER_URL=i}static addProtocol(i,u){l.c.REGISTERED_PROTOCOLS[i]=u}static removeProtocol(i){delete l.c.REGISTERED_PROTOCOLS[i]}}return Qt.Map=class extends Nf{constructor(y){if(l.bg.mark(l.bh.create),(y=l.e({},xt,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ac(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._cooperativeGesturesOnWheel=i=>{this._onCooperativeGesture(i,i[this._metaKey],1)},this._contextLost=i=>{i.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:i}))},this._contextRestored=i=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:i}))},this._onMapScroll=i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._cooperativeGestures=y.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new uc,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},sh,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=de.addThrottleControl(()=>this.isMoving()),this._requestManager=new H(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let i=!1;const u=ba(f=>{this._trackResize&&!this._removed&&this.resize(f)._update()},50);this._resizeObserver=new ResizeObserver(f=>{i?u(f):i=!0}),this._resizeObserver.observe(this._container)}this.handlers=new rh(this,y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=y.hash&&new Jo(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,l.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new li({customAttribution:y.customAttribution})),y.maplibreLogo&&this.addControl(new mr,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new l.k(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new l.k(`${i.dataType}dataloading`,i))}),this.on("dataabort",i=>{this.fire(new l.k("sourcedataabort",i))})}_getMapId(){return this._mapId}addControl(y,i){if(i===void 0&&(i=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=y.onAdd(this);this._controls.push(y);const f=this._controlPositions[i];return i.indexOf("bottom")!==-1?f.insertBefore(u,f.firstChild):f.appendChild(u),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(y);return i>-1&&this._controls.splice(i,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,i,u,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,i,u,f)}resize(y){var i;const u=this._containerDimensions(),f=u[0],g=u[1],_=this._getClampedPixelRatio(f,g);if(this._resizeCanvas(f,g,_),this.painter.resize(f,g,_),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const A=this._getClampedPixelRatio(f,g);this._resizeCanvas(f,g,A),this.painter.resize(f,g,A)}this.transform.resize(f,g),(i=this._requestedCameraState)===null||i===void 0||i.resize(f,g);const T=!this._moving;return T&&(this.stop(),this.fire(new l.k("movestart",y)).fire(new l.k("move",y))),this.fire(new l.k("resize",y)),T&&this.fire(new l.k("moveend",y)),this}_getClampedPixelRatio(y,i){const{0:u,1:f}=this._maxCanvasSize,g=this.getPixelRatio(),_=y*g,T=i*g;return Math.min(_>u?u/_:1,T>f?f/T:1)*g}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Ye.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(y){return this.transform.locationPoint(l.L.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,i,u){if(y==="mouseenter"||y==="mouseover"){let f=!1;return{layer:i,listener:u,delegates:{mousemove:_=>{const T=this.getLayer(i)?this.queryRenderedFeatures(_.point,{layers:[i]}):[];T.length?f||(f=!0,u.call(this,new oi(y,this,_.originalEvent,{features:T}))):f=!1},mouseout:()=>{f=!1}}}}if(y==="mouseleave"||y==="mouseout"){let f=!1;return{layer:i,listener:u,delegates:{mousemove:T=>{(this.getLayer(i)?this.queryRenderedFeatures(T.point,{layers:[i]}):[]).length?f=!0:f&&(f=!1,u.call(this,new oi(y,this,T.originalEvent)))},mouseout:T=>{f&&(f=!1,u.call(this,new oi(y,this,T.originalEvent)))}}}}{const f=g=>{const _=this.getLayer(i)?this.queryRenderedFeatures(g.point,{layers:[i]}):[];_.length&&(g.features=_,u.call(this,g),delete g.features)};return{layer:i,listener:u,delegates:{[y]:f}}}}on(y,i,u){if(u===void 0)return super.on(y,i);const f=this._createDelegatedListener(y,i,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(y,i,u){if(u===void 0)return super.once(y,i);const f=this._createDelegatedListener(y,i,u);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(y,i,u){return u===void 0?super.off(y,i):(this._delegatedListeners&&this._delegatedListeners[y]&&(f=>{const g=this._delegatedListeners[y];for(let _=0;_<g.length;_++){const T=g[_];if(T.layer===i&&T.listener===u){for(const E in T.delegates)this.off(E,T.delegates[E]);return g.splice(_,1),this}}})(),this)}queryRenderedFeatures(y,i){if(!this.style)return[];let u;const f=y instanceof l.P||Array.isArray(y),g=f?y:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(f?{}:y)||{},g instanceof l.P||typeof g[0]=="number")u=[l.P.convert(g)];else{const _=l.P.convert(g[0]),T=l.P.convert(g[1]);u=[_,new l.P(T.x,_.y),T,new l.P(_.x,T.y),_]}return this.style.queryRenderedFeatures(u,i,this.transform)}querySourceFeatures(y,i){return this.style.querySourceFeatures(y,i)}setStyle(y,i){return(i=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(y,i))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const i=this._locale[y];if(i==null)throw new Error(`Missing UI string '${y}'`);return i}_updateStyle(y,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,i));const u=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new gs(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,i,u):this.style.loadJSON(y,i,u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,i){if(typeof y=="string"){const u=this._requestManager.transformRequest(y,G.Style);l.f(u,(f,g)=>{f?this.fire(new l.j(f)):g&&this._updateDiff(g,i)})}else typeof y=="object"&&this._updateDiff(y,i)}_updateDiff(y,i){try{this.style.setState(y,i)&&this._update(!0)}catch(u){l.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(y,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,i){return this._lazyInitEmptyStyle(),this.style.addSource(y,i),this._update(!0)}isSourceLoaded(y){const i=this.style&&this.style.sourceCaches[y];if(i!==void 0)return i.loaded();this.fire(new l.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const i=this.style.sourceCaches[y.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);for(const u in this.style._layers){const f=this.style._layers[u];f.type==="hillshade"&&f.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zf(this.painter,i,y),this.painter.renderToTexture=new hc(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=u=>{u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==y.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:y})),this}getTerrain(){var y,i;return(i=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const i in y){const u=y[i]._tiles;for(const f in u){const g=u[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(y,i,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,i,u)}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,i,u={}){const{pixelRatio:f=1,sdf:g=!1,stretchX:_,stretchY:T,content:E}=u;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||l.a(i))){if(i.width===void 0||i.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:D,data:R}=i,z=i;return this.style.addImage(y,{data:new l.R({width:A,height:D},new Uint8Array(R)),pixelRatio:f,stretchX:_,stretchY:T,content:E,sdf:g,version:0,userImage:z}),z.onAdd&&z.onAdd(this,y),this}}{const{width:A,height:D,data:R}=l.h.getImageData(i);this.style.addImage(y,{data:new l.R({width:A,height:D},R),pixelRatio:f,stretchX:_,stretchY:T,content:E,sdf:g,version:0})}}updateImage(y,i){const u=this.style.getImage(y);if(!u)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=i instanceof HTMLImageElement||l.a(i)?l.h.getImageData(i):i,{width:g,height:_,data:T}=f;if(g===void 0||_===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==u.data.width||_!==u.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(i instanceof HTMLImageElement||l.a(i));return u.data.replace(T,E),this.style.updateImage(y,u),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,i){de.getImage(this._requestManager.transformRequest(y,G.Image),i)}listImages(){return this.style.listImages()}addLayer(y,i){return this._lazyInitEmptyStyle(),this.style.addLayer(y,i),this._update(!0)}moveLayer(y,i){return this.style.moveLayer(y,i),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,i,u){return this.style.setLayerZoomRange(y,i,u),this._update(!0)}setFilter(y,i,u={}){return this.style.setFilter(y,i,u),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,i,u,f={}){return this.style.setPaintProperty(y,i,u,f),this._update(!0)}getPaintProperty(y,i){return this.style.getPaintProperty(y,i)}setLayoutProperty(y,i,u,f={}){return this.style.setLayoutProperty(y,i,u,f),this._update(!0)}getLayoutProperty(y,i){return this.style.getLayoutProperty(y,i)}setGlyphs(y,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,i,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,i,u,f=>{f||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,i,u=>{u||this._update(!0)}),this}setLight(y,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,i){return this.style.setFeatureState(y,i),this._update()}removeFeatureState(y,i){return this.style.removeFeatureState(y,i),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,i=0;return this._container&&(y=this._container.clientWidth||400,i=this._container.clientHeight||300),[y,i]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const i=this._canvasContainer=k.create("div","maplibregl-canvas-container",y);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),f=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],f);const g=this._controlContainer=k.create("div","maplibregl-control-container",y),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{_[T]=k.create("div",`maplibregl-ctrl-${T} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=k.create("div","maplibregl-cooperative-gesture-screen",this._container);let y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${y}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){k.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(y,i,u){this._canvas.width=Math.floor(u*y),this._canvas.height=Math.floor(u*i),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{i={requestedAttributes:y},f&&(i.statusMessage=f.statusMessage,i.type=f.type)},{once:!0});const u=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!u){const f="Failed to initialize WebGL";throw i?(i.message=f,new Error(JSON.stringify(i))):new Error(f)}this.painter=new xa(u,this.transform),P.testSupport(u)}_onCooperativeGesture(y,i,u){return!i&&u<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,_=l.h.now();this.style.zoomHistory.update(g,_);const T=new l.a8(g,{now:_,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=T.crossFadingFactor();E===1&&E===this._crossFadingFactor||(u=!0,this._crossFadingFactor=E),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),de.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(y=>{l.bg.frame(y),this._frame=null,this._render(y)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return dt}getCameraTargetElevation(){return this.transform.elevation}},Qt.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const i=this._map.getZoom(),u=i===this._map.getMaxZoom(),f=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,u)=>{const f=this._map._getUIString(`NavigationControl.${u}`);i.title=f,i.setAttribute("aria-label",f)},this.options=l.e({},ih,y),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,i){const u=k.create("button",y,this._container);return u.type="button",u.addEventListener("click",i),u}},Qt.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const u=new l.L(i.coords.longitude,i.coords.latitude),f=i.coords.accuracy,g=this._map.getBearing(),_=l.e({bearing:g},this.options.fitBoundsOptions),T=Ye.fromLngLat(u,f);this._map.fitBounds(T,_,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const u=new l.L(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&so)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=i=>{if(this._map){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",i===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new wa({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Ar,y)}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(i,u=!1){Rr===void 0||u?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(f=>{Rr=f.state!=="denied",i(Rr)}).catch(()=>{Rr=!!window.navigator.geolocation,i(Rr)}):(Rr=!!window.navigator.geolocation,i(Rr)):i(Rr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Sr=0,so=!1}_isOutOfMapMaxBounds(y){const i=this._map.getMaxBounds(),u=y.coords;return i&&(u.longitude<i.getWest()||u.longitude>i.getEast()||u.latitude<i.getSouth()||u.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),i=y.getSouthEast(),u=y.getNorthEast(),f=i.distanceTo(u),g=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Sr--,so=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Sr++,Sr>1?(y={maximumAge:6e5,timeout:0},so=!0):(y=this.options.positionOptions,so=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Qt.AttributionControl=li,Qt.LogoControl=mr,Qt.ScaleControl=class{constructor(y){this._onMove=()=>{nl(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,nl(this._map,this._container,this.options)},this.options=l.e({},il,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Qt.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Qt.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=y}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Qt.Popup=class extends l.E{constructor(y){super(),this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ah(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!i)return;const u=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);let f=this.options.anchor;const g=io(this.options.offset);if(!f){const T=this._container.offsetWidth,E=this._container.offsetHeight;let A;A=u.y+g.bottom.y<E?["top"]:u.y>this._map.transform.height-E?["bottom"]:[],u.x<T/2?A.push("left"):u.x>this._map.transform.width-T/2&&A.push("right"),f=A.length===0?"bottom":A.join("-")}const _=u.add(g[f]).round();k.setTransform(this._container,`${Pi[f]} translate(${_.x}px,${_.y}px)`),Bf(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(oh),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.L.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const i=document.createDocumentFragment(),u=document.createElement("body");let f;for(u.innerHTML=y;f=u.firstChild,f;)i.appendChild(f);return this.setDOMContent(i)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(lh);y&&y.focus()}},Qt.Marker=wa,Qt.Style=gs,Qt.LngLat=l.L,Qt.LngLatBounds=Ye,Qt.Point=l.P,Qt.MercatorCoordinate=l.U,Qt.Evented=l.E,Qt.AJAXError=l.bi,Qt.config=l.c,Qt.CanvasSource=It,Qt.GeoJSONSource=yt,Qt.ImageSource=ur,Qt.RasterDEMTileSource=Ht,Qt.RasterTileSource=kt,Qt.VectorTileSource=tt,Qt.VideoSource=Ds,Qt.setRTLTextPlugin=l.bj,Qt.getRTLTextPluginStatus=l.bk,Qt.prewarm=function(){ma().acquire(Wt)},Qt.clearPrewarmedResources=function(){const y=$i;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Wt),$i=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},ch.extend(Qt,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),Qt});var m=c;return m})})(CE);var XR=CE.exports;const gi=x2(XR),YR=()=>{var Nt;const[t,e]=re.useState(!1),[r,n]=re.useState(!1),[c,d]=re.useState(null),[m,l]=re.useState(null),[w,k]=re.useState(null),[P,j]=re.useState(null),[L,Z]=re.useState(null),[Y,ce]=re.useState(0),[de,G]=re.useState({email:"",password:""}),[H,W]=re.useState(null),[ue,me]=re.useState(!1),be=re.useRef(null),Ce=re.useRef(null),Te=re.useRef(null),rt=re.useRef(null),Ue=re.useRef(null),St=re.useRef(null);re.useEffect(()=>{const{data:{subscription:Ye}}=Or.auth.onAuthStateChange(async(we,tt)=>{we==="SIGNED_IN"&&tt?await ir(tt.access_token):we==="SIGNED_OUT"&&(e(!1),d(null),vt(),Oe())});return()=>Ye.unsubscribe()},[]),re.useEffect(()=>{t&&navigator.geolocation&&(console.log("🔍 Checking location permission on component mount..."),"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(Ye=>{console.log("📍 Initial permission state:",Ye.state),Ye.state==="granted"?console.log("✅ Location permission already granted"):Ye.state==="prompt"?console.log("❓ Location permission needs to be requested"):Ye.state==="denied"&&(console.log("❌ Location permission denied"),k("Location permission is denied. Please enable it in your browser settings."))}))},[t]),re.useEffect(()=>{(async()=>{if(!navigator.geolocation){k("Geolocation is not supported by this browser");return}try{"permissions"in navigator&&(await navigator.permissions.query({name:"geolocation"})).state==="denied"&&k("Location permission denied. Please enable location access in your browser settings.")}catch{console.log("Permission API not supported, will check when user clicks Start Tracking")}})()},[]);const Oe=()=>{St.current&&(St.current.remove(),St.current=null),rt.current&&(rt.current.remove(),rt.current=null)},it=(Ye,we)=>{if(!Ue.current||rt.current)return;rt.current=new gi.Map({container:Ue.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap contributors",maxzoom:19}},layers:[{id:"osm-tiles",type:"raster",source:"osm",minzoom:0,maxzoom:19}]},center:[we,Ye],zoom:15,bearing:0,pitch:0,attributionControl:!0,maxZoom:19,minZoom:1,preserveDrawingBuffer:!1,antialias:!0,dragRotate:!1}),rt.current.addControl(new gi.NavigationControl,"top-right"),rt.current.once("load",()=>{console.log("✅ Driver map loaded successfully"),rt.current&&(rt.current.dragRotate.disable(),rt.current.touchZoomRotate.disableRotation(),console.log("🔄 Rotation features disabled"))}),rt.current.on("error",Ht=>{console.error("❌ Driver map error:",Ht)});const tt=document.createElement("div");tt.className="driver-marker",tt.innerHTML=`
      <div class="driver-marker-content">
        <div style="font-size: 16px;">🚌</div>
      </div>
    `,St.current=new gi.Marker({element:tt,anchor:"center"}).setLngLat([we,Ye]).addTo(rt.current);const kt=new gi.Popup({offset:25,className:"driver-popup"}).setHTML(`
        <div class="driver-popup">
          <h3>🚌 Driver Location</h3>
          <p><strong>Bus:</strong> ${(c==null?void 0:c.bus_number)||"Unknown"}</p>
          <p><strong>Route:</strong> ${(c==null?void 0:c.route_name)||"Unknown"}</p>
          <p><strong>Driver:</strong> ${(c==null?void 0:c.driver_name)||"Unknown"}</p>
          <p><strong>Status:</strong> <span style="color: #059669;">Active</span></p>
        </div>
      `);St.current.setPopup(kt)},qe=(Ye,we)=>{if(!rt.current||!St.current)return;const tt=[we,Ye];St.current.setLngLat(tt),rt.current.flyTo({center:tt,duration:1e3});const kt=new gi.Popup({offset:25,className:"driver-popup"}).setHTML(`
        <div class="driver-popup">
          <h3>🚌 Driver Location</h3>
          <p><strong>Bus:</strong> ${(c==null?void 0:c.bus_number)||"Unknown"}</p>
          <p><strong>Route:</strong> ${(c==null?void 0:c.route_name)||"Unknown"}</p>
          <p><strong>Driver:</strong> ${(c==null?void 0:c.driver_name)||"Unknown"}</p>
          <p><strong>Status:</strong> <span style="color: #059669;">Active</span></p>
          <p><strong>Updated:</strong> ${new Date().toLocaleTimeString()}</p>
          <p><strong>Coordinates:</strong> ${Ye.toFixed(6)}, ${we.toFixed(6)}</p>
        </div>
      `);St.current.setPopup(kt)},Et=async Ye=>{Ye.preventDefault(),me(!0),W(null);try{const{data:we,error:tt}=await Or.auth.signInWithPassword({email:de.email,password:de.password});if(tt){console.error("❌ Login error:",tt),W(tt.message);return}we.user&&we.session?(console.log("✅ Login successful:",we.user.email),await ir(we.session.access_token),G({email:"",password:""})):W("Login failed - no user data received")}catch(we){console.error("❌ Login error:",we),W("An unexpected error occurred during login")}finally{me(!1)}},ir=async Ye=>{var we,tt,kt,Ht,yt;try{console.log("🔌 Driver: Connecting to WebSocket..."),await $t.connect(),(we=$t.socket)==null||we.on("connect",()=>{console.log("🔌 Driver: Connected to WebSocket server"),j(null)}),(tt=$t.socket)==null||tt.on("disconnect",()=>{console.log("🔌 Driver: Disconnected from WebSocket server"),j("Disconnected from server")}),(kt=$t.socket)==null||kt.on("error",_t=>{console.error("❌ Driver: Socket error:",_t),j(_t.message||"Socket error occurred")}),(Ht=$t.socket)==null||Ht.on("driver:authenticated",_t=>{console.log("✅ Driver: Authentication successful:",_t),e(!0),d(_t.busInfo),j(null)}),(yt=$t.socket)==null||yt.on("driver:locationConfirmed",_t=>{console.log("📍 Driver: Location confirmed:",_t),Z(new Date().toLocaleTimeString()),ce(ur=>ur+1)}),be.current=$t.socket,$t.authenticateAsDriver(Ye)}catch(_t){console.error("❌ Driver: Authentication error:",_t),j("Failed to authenticate with server")}},vt=()=>{$t.disconnect(),be.current=null},Be=async()=>{if(!navigator.geolocation){k("Geolocation is not supported by this browser");return}const Ye=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),we=navigator.userAgent.includes("Firefox"),tt=navigator.userAgent.includes("Chrome"),kt=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome");console.log(`🌐 Device detected: ${Ye?"Mobile":"Desktop"} - ${we?"Firefox":tt?"Chrome":kt?"Safari":"Other"}`);const Ht={enableHighAccuracy:!0,timeout:Ye?3e4:6e4,maximumAge:0};console.log("📍 Starting location tracking with options:",Ht);try{if("permissions"in navigator){const yt=await navigator.permissions.query({name:"geolocation"});if(console.log(`🔐 Current permission state: ${yt.state}`),yt.state==="denied"){k(Ye?`Location permission denied on mobile. Please:
1. Go to your phone Settings
2. Find this browser app
3. Enable Location permission
4. Refresh this page`:"Location permission denied. Please reset location permissions and try again.");return}}}catch{console.log("Permission API not supported, proceeding with geolocation request")}console.log("📍 Requesting location permission..."),k(Ye?"Requesting location permission on mobile... Please allow when prompted. If no prompt appears, check your phone settings.":"Requesting location permission... Please allow when prompted."),navigator.geolocation.getCurrentPosition(yt=>{console.log("✅ Initial position obtained:",{latitude:yt.coords.latitude,longitude:yt.coords.longitude,accuracy:yt.coords.accuracy,timestamp:new Date(yt.timestamp).toLocaleString()}),l(yt),k(null),it(yt.coords.latitude,yt.coords.longitude),Fe(yt)},yt=>{console.error("❌ Geolocation error:",yt);let _t="Location error: ";switch(yt.code){case yt.PERMISSION_DENIED:Ye?_t=`Mobile location permission denied. Please:

1. Go to your phone Settings
2. Find this browser app (Chrome/Firefox/Safari)
3. Tap "Permissions" or "Privacy"
4. Enable "Location" permission
5. Return to this page and refresh

Alternative: Try opening this page in a different browser app.`:we?_t+='Firefox location permission issue. Please: 1) Click the lock icon in address bar 2) Set location to "Allow" 3) Refresh the page 4) Try again':_t+="Permission denied. Please enable location access in your browser settings. On mobile, check your browser permissions and try refreshing the page.";break;case yt.POSITION_UNAVAILABLE:_t=Ye?`Location unavailable on mobile. Please:
1. Go outdoors or near a window
2. Wait 10-15 seconds
3. Make sure GPS is enabled in phone settings
4. Try again`:"Location information unavailable.";break;case yt.TIMEOUT:_t=Ye?`Location request timed out on mobile. Please:
1. Go outdoors for better GPS signal
2. Wait 30 seconds and try again
3. Check if GPS is enabled in phone settings`:"Location request timed out. Please try again.";break;default:_t+=yt.message}k(_t)},Ht),Te.current=navigator.geolocation.watchPosition(yt=>{console.log("📍 Location update received:",{latitude:yt.coords.latitude,longitude:yt.coords.longitude,accuracy:yt.coords.accuracy,timestamp:new Date(yt.timestamp).toLocaleString()}),l(yt),k(null),qe(yt.coords.latitude,yt.coords.longitude),Fe(yt)},yt=>{console.error("❌ Geolocation watch error:",yt);let _t="Location tracking error: ";switch(yt.code){case yt.PERMISSION_DENIED:_t=Ye?"Location permission lost on mobile. Please refresh the page and allow location access again.":"Permission denied. Please enable location access in your browser settings.";break;case yt.POSITION_UNAVAILABLE:_t=Ye?"GPS signal lost on mobile. Please go outdoors or near a window.":"Location information unavailable.";break;case yt.TIMEOUT:_t=Ye?"GPS timeout on mobile. Please check your location and try again.":"Location request timed out. Please try again.";break;default:_t+=yt.message}k(_t)},Ht),n(!0),console.log("📍 Location tracking started")},st=()=>{Te.current&&(navigator.geolocation.clearWatch(Te.current),Te.current=null),Ce.current&&(clearInterval(Ce.current),Ce.current=null),n(!1),console.log("📍 Location tracking stopped")},Fe=Ye=>{if(!be.current||!c)return;const we={driverId:c.driver_id,latitude:Ye.coords.latitude,longitude:Ye.coords.longitude,timestamp:new Date().toISOString(),speed:Ye.coords.speed||void 0,heading:Ye.coords.heading||void 0};be.current.emit("driver:locationUpdate",we)},Ct=async()=>{try{console.log("🔐 Driver: Starting sign out..."),r&&st(),vt();const{error:Ye}=await Or.auth.signOut();Ye?console.error("❌ Sign out error:",Ye):(console.log("✅ Driver: Sign out successful"),e(!1),d(null),l(null),k(null),j(null),Z(null),ce(0),Oe())}catch(Ye){console.error("❌ Sign out error:",Ye)}};return t?v.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:v.jsxs("div",{className:"max-w-7xl mx-auto",children:[v.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"🚌 Driver Dashboard"}),v.jsxs("p",{className:"text-gray-600 mt-1",children:["Welcome, ",c==null?void 0:c.driver_name," | Bus: ",c==null?void 0:c.bus_number," | Route: ",c==null?void 0:c.route_name]})]}),v.jsx("button",{onClick:Ct,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Sign Out"})]})}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[v.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${P?"bg-red-500":"bg-green-500"}`}),v.jsxs("div",{children:[v.jsx("h3",{className:"font-semibold text-gray-900",children:"Connection"}),v.jsx("p",{className:"text-sm text-gray-600",children:P?"Disconnected":"Connected"})]})]})}),v.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${r?"bg-green-500":"bg-gray-400"}`}),v.jsxs("div",{children:[v.jsx("h3",{className:"font-semibold text-gray-900",children:"GPS Tracking"}),v.jsx("p",{className:"text-sm text-gray-600",children:r?"Active":"Inactive"})]})]})}),v.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:v.jsxs("div",{children:[v.jsx("h3",{className:"font-semibold text-gray-900",children:"Updates Sent"}),v.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Y}),L&&v.jsxs("p",{className:"text-sm text-gray-600",children:["Last: ",L]})]})}),v.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:v.jsx("div",{className:"space-y-3",children:r?v.jsx("button",{onClick:st,className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",children:"⏹️ Stop Tracking"}):v.jsxs(v.Fragment,{children:[v.jsx("button",{onClick:Be,disabled:!!P,className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed text-sm",children:"🚀 Start Tracking"}),v.jsx("button",{onClick:()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(Ye=>{console.log("✅ Manual location permission granted:",Ye),k(null),Be()},Ye=>{console.error("❌ Manual location permission denied:",Ye),k("Location permission denied. Please check your browser settings.")},{enableHighAccuracy:!0,timeout:3e4,maximumAge:0})},className:"w-full mt-2 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:"🔐 Request Location Permission"}),w&&w.includes("Permission denied")&&v.jsx("button",{onClick:()=>{k(null),Be()},className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm mt-2",children:"🔄 Retry Location Permission"})]})})})]}),v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[v.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[v.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"🗺️ Live Location Map"}),v.jsx("div",{ref:Ue,className:"w-full h-96 rounded-lg border border-gray-200",style:{minHeight:"400px"}}),w&&v.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mt-4",children:[v.jsx("p",{className:"text-red-700 text-sm mb-3",children:w}),v.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[v.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"📱 Mobile Location Troubleshooting:"}),v.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-2 mb-2",children:[v.jsx("h5",{className:"font-semibold text-blue-800 text-xs mb-1",children:"📱 For Mobile Devices:"}),v.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Android Chrome:"})," Settings → Apps → Chrome → Permissions → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Android Firefox:"})," Settings → Apps → Firefox → Permissions → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"iPhone Safari:"})," Settings → Safari → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"iPhone Chrome:"})," Settings → Chrome → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Make sure:"})," GPS/Location Services are ON in phone settings"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Try:"})," Going outdoors or near a window for better GPS signal"]})]})]}),v.jsxs("div",{className:"bg-green-50 border border-green-200 rounded p-2",children:[v.jsx("h5",{className:"font-semibold text-green-800 text-xs mb-1",children:"💻 For Desktop Browsers:"}),v.jsxs("ul",{className:"text-xs text-green-700 space-y-1",children:[v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Chrome:"})," Click lock icon → Location → Allow → Refresh"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Firefox:"})," Click lock icon → Location → Allow → Refresh"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Safari:"})," Safari → Preferences → Websites → Location → Allow"]})]})]}),v.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600",children:"🔄 Refresh Page & Retry"}),v.jsx("button",{onClick:()=>{const Ye=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.geolocation?navigator.geolocation.getCurrentPosition(we=>{const tt=`✅ Location Test Successful!

Latitude: ${we.coords.latitude}
Longitude: ${we.coords.longitude}
Accuracy: ${we.coords.accuracy}m
Device: ${Ye?"Mobile":"Desktop"}

Location is working! You can now start tracking.`;alert(tt),k(null)},we=>{const tt=`❌ Location Test Failed

Error Code: ${we.code}
Error Message: ${we.message}
Device: ${Ye?"Mobile":"Desktop"}

Please check your location permissions.`;alert(tt)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):alert("Geolocation is not supported by this browser.")},className:"mt-2 bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 ml-2",children:"🧪 Test Location"})]})]})]}),v.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[v.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"📍 Current Location Details"}),m?v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600",children:"Latitude:"}),v.jsx("span",{className:"font-mono",children:m.coords.latitude.toFixed(6)})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600",children:"Longitude:"}),v.jsx("span",{className:"font-mono",children:m.coords.longitude.toFixed(6)})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600",children:"Accuracy:"}),v.jsxs("span",{children:[(Nt=m.coords.accuracy)==null?void 0:Nt.toFixed(1),"m"]})]}),m.coords.speed&&v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600",children:"Speed:"}),v.jsxs("span",{children:[(m.coords.speed*3.6).toFixed(1)," km/h"]})]}),m.coords.heading&&v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600",children:"Heading:"}),v.jsxs("span",{children:[m.coords.heading.toFixed(1),"°"]})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-gray-600",children:"Timestamp:"}),v.jsx("span",{className:"text-sm",children:new Date(m.timestamp).toLocaleTimeString()})]})]}):v.jsx("p",{className:"text-gray-500",children:"No location data available"}),v.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6",children:[v.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ℹ️ Instructions"}),v.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[v.jsx("li",{children:'• Click "Start Tracking" to begin sending location updates'}),v.jsx("li",{children:"• Your location will be sent every few seconds"}),v.jsx("li",{children:"• Students and admin can see your bus location in real-time"}),v.jsx("li",{children:"• Make sure to allow location access when prompted"}),v.jsx("li",{children:"• The map shows your current position with a blue marker"})]})]})]})]})]})}):v.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:v.jsx("div",{className:"max-w-md w-full",children:v.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[v.jsxs("div",{className:"text-center mb-6",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"🚌 Driver Login"}),v.jsx("p",{className:"text-gray-600 mt-2",children:"Sign in to start tracking your bus"})]}),H&&v.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:v.jsx("p",{className:"text-red-700 text-sm",children:H})}),v.jsxs("form",{onSubmit:Et,className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),v.jsx("input",{id:"email",type:"email",required:!0,value:de.email,onChange:Ye=>G(we=>({...we,email:Ye.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email"})]}),v.jsxs("div",{children:[v.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),v.jsx("input",{id:"password",type:"password",required:!0,value:de.password,onChange:Ye=>G(we=>({...we,password:Ye.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password"})]}),v.jsx("button",{type:"submit",disabled:ue,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed",children:ue?"Signing In...":"Sign In"})]}),v.jsx("div",{className:"mt-4 text-center",children:v.jsx("p",{className:"text-sm text-gray-600",children:"Please contact your administrator for login credentials"})})]})})})},a0=re.createContext({});function o0(t){const e=re.useRef(null);return e.current===null&&(e.current=t()),e.current}const l0=typeof window<"u",PE=l0?re.useLayoutEffect:re.useEffect,ag=re.createContext(null);function c0(t,e){t.indexOf(e)===-1&&t.push(e)}function u0(t,e){const r=t.indexOf(e);r>-1&&t.splice(r,1)}const Va=(t,e,r)=>r>e?e:r<t?t:r;let h0=()=>{};const qa={},IE=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function ME(t){return typeof t=="object"&&t!==null}const jE=t=>/^0[^.\s]+$/u.test(t);function d0(t){let e;return()=>(e===void 0&&(e=t()),e)}const bn=t=>t,JR=(t,e)=>r=>e(t(r)),Xd=(...t)=>t.reduce(JR),Nd=(t,e,r)=>{const n=e-t;return n===0?1:(r-t)/n};class f0{constructor(){this.subscriptions=[]}add(e){return c0(this.subscriptions,e),()=>u0(this.subscriptions,e)}notify(e,r,n){const c=this.subscriptions.length;if(c)if(c===1)this.subscriptions[0](e,r,n);else for(let d=0;d<c;d++){const m=this.subscriptions[d];m&&m(e,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ha=t=>t*1e3,da=t=>t/1e3;function DE(t,e){return e?t*(1e3/e):0}const NE=(t,e,r)=>(((1-3*r+3*e)*t+(3*r-6*e))*t+3*e)*t,QR=1e-7,ez=12;function tz(t,e,r,n,c){let d,m,l=0;do m=e+(r-e)/2,d=NE(m,n,c)-t,d>0?r=m:e=m;while(Math.abs(d)>QR&&++l<ez);return m}function Yd(t,e,r,n){if(t===e&&r===n)return bn;const c=d=>tz(d,0,1,t,r);return d=>d===0||d===1?d:NE(c(d),e,n)}const LE=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,RE=t=>e=>1-t(1-e),zE=Yd(.33,1.53,.69,.99),p0=RE(zE),BE=LE(p0),OE=t=>(t*=2)<1?.5*p0(t):.5*(2-Math.pow(2,-10*(t-1))),m0=t=>1-Math.sin(Math.acos(t)),FE=RE(m0),$E=LE(m0),rz=Yd(.42,0,1,1),sz=Yd(0,0,.58,1),UE=Yd(.42,0,.58,1),iz=t=>Array.isArray(t)&&typeof t[0]!="number",VE=t=>Array.isArray(t)&&typeof t[0]=="number",nz={linear:bn,easeIn:rz,easeInOut:UE,easeOut:sz,circIn:m0,circInOut:$E,circOut:FE,backIn:p0,backInOut:BE,backOut:zE,anticipate:OE},az=t=>typeof t=="string",aS=t=>{if(VE(t)){h0(t.length===4);const[e,r,n,c]=t;return Yd(e,r,n,c)}else if(az(t))return nz[t];return t},Mp=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function oz(t,e){let r=new Set,n=new Set,c=!1,d=!1;const m=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function w(P){m.has(P)&&(k.schedule(P),t()),P(l)}const k={schedule:(P,j=!1,L=!1)=>{const Y=L&&c?r:n;return j&&m.add(P),Y.has(P)||Y.add(P),P},cancel:P=>{n.delete(P),m.delete(P)},process:P=>{if(l=P,c){d=!0;return}c=!0,[r,n]=[n,r],r.forEach(w),r.clear(),c=!1,d&&(d=!1,k.process(P))}};return k}const lz=40;function qE(t,e){let r=!1,n=!0;const c={delta:0,timestamp:0,isProcessing:!1},d=()=>r=!0,m=Mp.reduce((W,ue)=>(W[ue]=oz(d),W),{}),{setup:l,read:w,resolveKeyframes:k,preUpdate:P,update:j,preRender:L,render:Z,postRender:Y}=m,ce=()=>{const W=qa.useManualTiming?c.timestamp:performance.now();r=!1,qa.useManualTiming||(c.delta=n?1e3/60:Math.max(Math.min(W-c.timestamp,lz),1)),c.timestamp=W,c.isProcessing=!0,l.process(c),w.process(c),k.process(c),P.process(c),j.process(c),L.process(c),Z.process(c),Y.process(c),c.isProcessing=!1,r&&e&&(n=!1,t(ce))},de=()=>{r=!0,n=!0,c.isProcessing||t(ce)};return{schedule:Mp.reduce((W,ue)=>{const me=m[ue];return W[ue]=(be,Ce=!1,Te=!1)=>(r||de(),me.schedule(be,Ce,Te)),W},{}),cancel:W=>{for(let ue=0;ue<Mp.length;ue++)m[Mp[ue]].cancel(W)},state:c,steps:m}}const{schedule:Lr,cancel:zo,state:$s,steps:t_}=qE(typeof requestAnimationFrame<"u"?requestAnimationFrame:bn,!0);let Qp;function cz(){Qp=void 0}const Ri={now:()=>(Qp===void 0&&Ri.set($s.isProcessing||qa.useManualTiming?$s.timestamp:performance.now()),Qp),set:t=>{Qp=t,queueMicrotask(cz)}},GE=t=>e=>typeof e=="string"&&e.startsWith(t),g0=GE("--"),uz=GE("var(--"),y0=t=>uz(t)?hz.test(t.split("/*")[0].trim()):!1,hz=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,bu={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Ld={...bu,transform:t=>Va(0,1,t)},jp={...bu,default:1},ld=t=>Math.round(t*1e5)/1e5,_0=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function dz(t){return t==null}const fz=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,v0=(t,e)=>r=>!!(typeof r=="string"&&fz.test(r)&&r.startsWith(t)||e&&!dz(r)&&Object.prototype.hasOwnProperty.call(r,e)),WE=(t,e,r)=>n=>{if(typeof n!="string")return n;const[c,d,m,l]=n.match(_0);return{[t]:parseFloat(c),[e]:parseFloat(d),[r]:parseFloat(m),alpha:l!==void 0?parseFloat(l):1}},pz=t=>Va(0,255,t),r_={...bu,transform:t=>Math.round(pz(t))},wl={test:v0("rgb","red"),parse:WE("red","green","blue"),transform:({red:t,green:e,blue:r,alpha:n=1})=>"rgba("+r_.transform(t)+", "+r_.transform(e)+", "+r_.transform(r)+", "+ld(Ld.transform(n))+")"};function mz(t){let e="",r="",n="",c="";return t.length>5?(e=t.substring(1,3),r=t.substring(3,5),n=t.substring(5,7),c=t.substring(7,9)):(e=t.substring(1,2),r=t.substring(2,3),n=t.substring(3,4),c=t.substring(4,5),e+=e,r+=r,n+=n,c+=c),{red:parseInt(e,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:c?parseInt(c,16)/255:1}}const jv={test:v0("#"),parse:mz,transform:wl.transform},Jd=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),go=Jd("deg"),fa=Jd("%"),jt=Jd("px"),gz=Jd("vh"),yz=Jd("vw"),oS={...fa,parse:t=>fa.parse(t)/100,transform:t=>fa.transform(t*100)},Vc={test:v0("hsl","hue"),parse:WE("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:r,alpha:n=1})=>"hsla("+Math.round(t)+", "+fa.transform(ld(e))+", "+fa.transform(ld(r))+", "+ld(Ld.transform(n))+")"},cs={test:t=>wl.test(t)||jv.test(t)||Vc.test(t),parse:t=>wl.test(t)?wl.parse(t):Vc.test(t)?Vc.parse(t):jv.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?wl.transform(t):Vc.transform(t),getAnimatableNone:t=>{const e=cs.parse(t);return e.alpha=0,cs.transform(e)}},_z=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function vz(t){var e,r;return isNaN(t)&&typeof t=="string"&&(((e=t.match(_0))==null?void 0:e.length)||0)+(((r=t.match(_z))==null?void 0:r.length)||0)>0}const ZE="number",HE="color",xz="var",bz="var(",lS="${}",wz=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Rd(t){const e=t.toString(),r=[],n={color:[],number:[],var:[]},c=[];let d=0;const l=e.replace(wz,w=>(cs.test(w)?(n.color.push(d),c.push(HE),r.push(cs.parse(w))):w.startsWith(bz)?(n.var.push(d),c.push(xz),r.push(w)):(n.number.push(d),c.push(ZE),r.push(parseFloat(w))),++d,lS)).split(lS);return{values:r,split:l,indexes:n,types:c}}function KE(t){return Rd(t).values}function XE(t){const{split:e,types:r}=Rd(t),n=e.length;return c=>{let d="";for(let m=0;m<n;m++)if(d+=e[m],c[m]!==void 0){const l=r[m];l===ZE?d+=ld(c[m]):l===HE?d+=cs.transform(c[m]):d+=c[m]}return d}}const Sz=t=>typeof t=="number"?0:cs.test(t)?cs.getAnimatableNone(t):t;function kz(t){const e=KE(t);return XE(t)(e.map(Sz))}const Bo={test:vz,parse:KE,createTransformer:XE,getAnimatableNone:kz};function s_(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function Tz({hue:t,saturation:e,lightness:r,alpha:n}){t/=360,e/=100,r/=100;let c=0,d=0,m=0;if(!e)c=d=m=r;else{const l=r<.5?r*(1+e):r+e-r*e,w=2*r-l;c=s_(w,l,t+1/3),d=s_(w,l,t),m=s_(w,l,t-1/3)}return{red:Math.round(c*255),green:Math.round(d*255),blue:Math.round(m*255),alpha:n}}function Im(t,e){return r=>r>0?e:t}const $r=(t,e,r)=>t+(e-t)*r,i_=(t,e,r)=>{const n=t*t,c=r*(e*e-n)+n;return c<0?0:Math.sqrt(c)},Ez=[jv,wl,Vc],Cz=t=>Ez.find(e=>e.test(t));function cS(t){const e=Cz(t);if(!e)return!1;let r=e.parse(t);return e===Vc&&(r=Tz(r)),r}const uS=(t,e)=>{const r=cS(t),n=cS(e);if(!r||!n)return Im(t,e);const c={...r};return d=>(c.red=i_(r.red,n.red,d),c.green=i_(r.green,n.green,d),c.blue=i_(r.blue,n.blue,d),c.alpha=$r(r.alpha,n.alpha,d),wl.transform(c))},Dv=new Set(["none","hidden"]);function Az(t,e){return Dv.has(t)?r=>r<=0?t:e:r=>r>=1?e:t}function Pz(t,e){return r=>$r(t,e,r)}function x0(t){return typeof t=="number"?Pz:typeof t=="string"?y0(t)?Im:cs.test(t)?uS:jz:Array.isArray(t)?YE:typeof t=="object"?cs.test(t)?uS:Iz:Im}function YE(t,e){const r=[...t],n=r.length,c=t.map((d,m)=>x0(d)(d,e[m]));return d=>{for(let m=0;m<n;m++)r[m]=c[m](d);return r}}function Iz(t,e){const r={...t,...e},n={};for(const c in r)t[c]!==void 0&&e[c]!==void 0&&(n[c]=x0(t[c])(t[c],e[c]));return c=>{for(const d in n)r[d]=n[d](c);return r}}function Mz(t,e){const r=[],n={color:0,var:0,number:0};for(let c=0;c<e.values.length;c++){const d=e.types[c],m=t.indexes[d][n[d]],l=t.values[m]??0;r[c]=l,n[d]++}return r}const jz=(t,e)=>{const r=Bo.createTransformer(e),n=Rd(t),c=Rd(e);return n.indexes.var.length===c.indexes.var.length&&n.indexes.color.length===c.indexes.color.length&&n.indexes.number.length>=c.indexes.number.length?Dv.has(t)&&!c.values.length||Dv.has(e)&&!n.values.length?Az(t,e):Xd(YE(Mz(n,c),c.values),r):Im(t,e)};function JE(t,e,r){return typeof t=="number"&&typeof e=="number"&&typeof r=="number"?$r(t,e,r):x0(t)(t,e)}const Dz=t=>{const e=({timestamp:r})=>t(r);return{start:(r=!0)=>Lr.update(e,r),stop:()=>zo(e),now:()=>$s.isProcessing?$s.timestamp:Ri.now()}},QE=(t,e,r=10)=>{let n="";const c=Math.max(Math.round(e/r),2);for(let d=0;d<c;d++)n+=Math.round(t(d/(c-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},Mm=2e4;function b0(t){let e=0;const r=50;let n=t.next(e);for(;!n.done&&e<Mm;)e+=r,n=t.next(e);return e>=Mm?1/0:e}function Nz(t,e=100,r){const n=r({...t,keyframes:[0,e]}),c=Math.min(b0(n),Mm);return{type:"keyframes",ease:d=>n.next(c*d).value/e,duration:da(c)}}const Lz=5;function eC(t,e,r){const n=Math.max(e-Lz,0);return DE(r-t(n),e-n)}const Kr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},n_=.001;function Rz({duration:t=Kr.duration,bounce:e=Kr.bounce,velocity:r=Kr.velocity,mass:n=Kr.mass}){let c,d,m=1-e;m=Va(Kr.minDamping,Kr.maxDamping,m),t=Va(Kr.minDuration,Kr.maxDuration,da(t)),m<1?(c=k=>{const P=k*m,j=P*t,L=P-r,Z=Nv(k,m),Y=Math.exp(-j);return n_-L/Z*Y},d=k=>{const j=k*m*t,L=j*r+r,Z=Math.pow(m,2)*Math.pow(k,2)*t,Y=Math.exp(-j),ce=Nv(Math.pow(k,2),m);return(-c(k)+n_>0?-1:1)*((L-Z)*Y)/ce}):(c=k=>{const P=Math.exp(-k*t),j=(k-r)*t+1;return-n_+P*j},d=k=>{const P=Math.exp(-k*t),j=(r-k)*(t*t);return P*j});const l=5/t,w=Bz(c,d,l);if(t=ha(t),isNaN(w))return{stiffness:Kr.stiffness,damping:Kr.damping,duration:t};{const k=Math.pow(w,2)*n;return{stiffness:k,damping:m*2*Math.sqrt(n*k),duration:t}}}const zz=12;function Bz(t,e,r){let n=r;for(let c=1;c<zz;c++)n=n-t(n)/e(n);return n}function Nv(t,e){return t*Math.sqrt(1-e*e)}const Oz=["duration","bounce"],Fz=["stiffness","damping","mass"];function hS(t,e){return e.some(r=>t[r]!==void 0)}function $z(t){let e={velocity:Kr.velocity,stiffness:Kr.stiffness,damping:Kr.damping,mass:Kr.mass,isResolvedFromDuration:!1,...t};if(!hS(t,Fz)&&hS(t,Oz))if(t.visualDuration){const r=t.visualDuration,n=2*Math.PI/(r*1.2),c=n*n,d=2*Va(.05,1,1-(t.bounce||0))*Math.sqrt(c);e={...e,mass:Kr.mass,stiffness:c,damping:d}}else{const r=Rz(t);e={...e,...r,mass:Kr.mass},e.isResolvedFromDuration=!0}return e}function jm(t=Kr.visualDuration,e=Kr.bounce){const r=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:n,restDelta:c}=r;const d=r.keyframes[0],m=r.keyframes[r.keyframes.length-1],l={done:!1,value:d},{stiffness:w,damping:k,mass:P,duration:j,velocity:L,isResolvedFromDuration:Z}=$z({...r,velocity:-da(r.velocity||0)}),Y=L||0,ce=k/(2*Math.sqrt(w*P)),de=m-d,G=da(Math.sqrt(w/P)),H=Math.abs(de)<5;n||(n=H?Kr.restSpeed.granular:Kr.restSpeed.default),c||(c=H?Kr.restDelta.granular:Kr.restDelta.default);let W;if(ce<1){const me=Nv(G,ce);W=be=>{const Ce=Math.exp(-ce*G*be);return m-Ce*((Y+ce*G*de)/me*Math.sin(me*be)+de*Math.cos(me*be))}}else if(ce===1)W=me=>m-Math.exp(-G*me)*(de+(Y+G*de)*me);else{const me=G*Math.sqrt(ce*ce-1);W=be=>{const Ce=Math.exp(-ce*G*be),Te=Math.min(me*be,300);return m-Ce*((Y+ce*G*de)*Math.sinh(Te)+me*de*Math.cosh(Te))/me}}const ue={calculatedDuration:Z&&j||null,next:me=>{const be=W(me);if(Z)l.done=me>=j;else{let Ce=me===0?Y:0;ce<1&&(Ce=me===0?ha(Y):eC(W,me,be));const Te=Math.abs(Ce)<=n,rt=Math.abs(m-be)<=c;l.done=Te&&rt}return l.value=l.done?m:be,l},toString:()=>{const me=Math.min(b0(ue),Mm),be=QE(Ce=>ue.next(me*Ce).value,me,30);return me+"ms "+be},toTransition:()=>{}};return ue}jm.applyToOptions=t=>{const e=Nz(t,100,jm);return t.ease=e.ease,t.duration=ha(e.duration),t.type="keyframes",t};function Lv({keyframes:t,velocity:e=0,power:r=.8,timeConstant:n=325,bounceDamping:c=10,bounceStiffness:d=500,modifyTarget:m,min:l,max:w,restDelta:k=.5,restSpeed:P}){const j=t[0],L={done:!1,value:j},Z=Te=>l!==void 0&&Te<l||w!==void 0&&Te>w,Y=Te=>l===void 0?w:w===void 0||Math.abs(l-Te)<Math.abs(w-Te)?l:w;let ce=r*e;const de=j+ce,G=m===void 0?de:m(de);G!==de&&(ce=G-j);const H=Te=>-ce*Math.exp(-Te/n),W=Te=>G+H(Te),ue=Te=>{const rt=H(Te),Ue=W(Te);L.done=Math.abs(rt)<=k,L.value=L.done?G:Ue};let me,be;const Ce=Te=>{Z(L.value)&&(me=Te,be=jm({keyframes:[L.value,Y(L.value)],velocity:eC(W,Te,L.value),damping:c,stiffness:d,restDelta:k,restSpeed:P}))};return Ce(0),{calculatedDuration:null,next:Te=>{let rt=!1;return!be&&me===void 0&&(rt=!0,ue(Te),Ce(Te)),me!==void 0&&Te>=me?be.next(Te-me):(!rt&&ue(Te),L)}}}function Uz(t,e,r){const n=[],c=r||qa.mix||JE,d=t.length-1;for(let m=0;m<d;m++){let l=c(t[m],t[m+1]);if(e){const w=Array.isArray(e)?e[m]||bn:e;l=Xd(w,l)}n.push(l)}return n}function Vz(t,e,{clamp:r=!0,ease:n,mixer:c}={}){const d=t.length;if(h0(d===e.length),d===1)return()=>e[0];if(d===2&&e[0]===e[1])return()=>e[1];const m=t[0]===t[1];t[0]>t[d-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=Uz(e,n,c),w=l.length,k=P=>{if(m&&P<t[0])return e[0];let j=0;if(w>1)for(;j<t.length-2&&!(P<t[j+1]);j++);const L=Nd(t[j],t[j+1],P);return l[j](L)};return r?P=>k(Va(t[0],t[d-1],P)):k}function qz(t,e){const r=t[t.length-1];for(let n=1;n<=e;n++){const c=Nd(0,e,n);t.push($r(r,1,c))}}function Gz(t){const e=[0];return qz(e,t.length-1),e}function Wz(t,e){return t.map(r=>r*e)}function Zz(t,e){return t.map(()=>e||UE).splice(0,t.length-1)}function cd({duration:t=300,keyframes:e,times:r,ease:n="easeInOut"}){const c=iz(n)?n.map(aS):aS(n),d={done:!1,value:e[0]},m=Wz(r&&r.length===e.length?r:Gz(e),t),l=Vz(m,e,{ease:Array.isArray(c)?c:Zz(e,c)});return{calculatedDuration:t,next:w=>(d.value=l(w),d.done=w>=t,d)}}const Hz=t=>t!==null;function w0(t,{repeat:e,repeatType:r="loop"},n,c=1){const d=t.filter(Hz),l=c<0||e&&r!=="loop"&&e%2===1?0:d.length-1;return!l||n===void 0?d[l]:n}const Kz={decay:Lv,inertia:Lv,tween:cd,keyframes:cd,spring:jm};function tC(t){typeof t.type=="string"&&(t.type=Kz[t.type])}class S0{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,r){return this.finished.then(e,r)}}const Xz=t=>t/100;class k0 extends S0{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,c;const{motionValue:r}=this.options;r&&r.updatedAt!==Ri.now()&&this.tick(Ri.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(c=(n=this.options).onStop)==null||c.call(n))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;tC(e);const{type:r=cd,repeat:n=0,repeatDelay:c=0,repeatType:d,velocity:m=0}=e;let{keyframes:l}=e;const w=r||cd;w!==cd&&typeof l[0]!="number"&&(this.mixKeyframes=Xd(Xz,JE(l[0],l[1])),l=[0,100]);const k=w({...e,keyframes:l});d==="mirror"&&(this.mirroredGenerator=w({...e,keyframes:[...l].reverse(),velocity:-m})),k.calculatedDuration===null&&(k.calculatedDuration=b0(k));const{calculatedDuration:P}=k;this.calculatedDuration=P,this.resolvedDuration=P+c,this.totalDuration=this.resolvedDuration*(n+1)-c,this.generator=k}updateTime(e){const r=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(e,r=!1){const{generator:n,totalDuration:c,mixKeyframes:d,mirroredGenerator:m,resolvedDuration:l,calculatedDuration:w}=this;if(this.startTime===null)return n.next(0);const{delay:k=0,keyframes:P,repeat:j,repeatType:L,repeatDelay:Z,type:Y,onUpdate:ce,finalKeyframe:de}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),r?this.currentTime=e:this.updateTime(e);const G=this.currentTime-k*(this.playbackSpeed>=0?1:-1),H=this.playbackSpeed>=0?G<0:G>c;this.currentTime=Math.max(G,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let W=this.currentTime,ue=n;if(j){const Te=Math.min(this.currentTime,c)/l;let rt=Math.floor(Te),Ue=Te%1;!Ue&&Te>=1&&(Ue=1),Ue===1&&rt--,rt=Math.min(rt,j+1),!!(rt%2)&&(L==="reverse"?(Ue=1-Ue,Z&&(Ue-=Z/l)):L==="mirror"&&(ue=m)),W=Va(0,1,Ue)*l}const me=H?{done:!1,value:P[0]}:ue.next(W);d&&(me.value=d(me.value));let{done:be}=me;!H&&w!==null&&(be=this.playbackSpeed>=0?this.currentTime>=c:this.currentTime<=0);const Ce=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&be);return Ce&&Y!==Lv&&(me.value=w0(P,this.options,de,this.speed)),ce&&ce(me.value),Ce&&this.finish(),me}then(e,r){return this.finished.then(e,r)}get duration(){return da(this.calculatedDuration)}get time(){return da(this.currentTime)}set time(e){var r;e=ha(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(r=this.driver)==null||r.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Ri.now());const r=this.playbackSpeed!==e;this.playbackSpeed=e,r&&(this.time=da(this.currentTime))}play(){var c,d;if(this.isStopped)return;const{driver:e=Dz,startTime:r}=this.options;this.driver||(this.driver=e(m=>this.tick(m))),(d=(c=this.options).onPlay)==null||d.call(c);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ri.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,r;this.notifyFinished(),this.teardown(),this.state="finished",(r=(e=this.options).onComplete)==null||r.call(e)}cancel(){var e,r;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(r=(e=this.options).onCancel)==null||r.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var r;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(r=this.driver)==null||r.stop(),e.observe(this)}}function Yz(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Sl=t=>t*180/Math.PI,Rv=t=>{const e=Sl(Math.atan2(t[1],t[0]));return zv(e)},Jz={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Rv,rotateZ:Rv,skewX:t=>Sl(Math.atan(t[1])),skewY:t=>Sl(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},zv=t=>(t=t%360,t<0&&(t+=360),t),dS=Rv,fS=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),pS=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),Qz={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:fS,scaleY:pS,scale:t=>(fS(t)+pS(t))/2,rotateX:t=>zv(Sl(Math.atan2(t[6],t[5]))),rotateY:t=>zv(Sl(Math.atan2(-t[2],t[0]))),rotateZ:dS,rotate:dS,skewX:t=>Sl(Math.atan(t[4])),skewY:t=>Sl(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function Bv(t){return t.includes("scale")?1:0}function Ov(t,e){if(!t||t==="none")return Bv(e);const r=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,c;if(r)n=Qz,c=r;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=Jz,c=l}if(!c)return Bv(e);const d=n[e],m=c[1].split(",").map(t3);return typeof d=="function"?d(m):m[d]}const e3=(t,e)=>{const{transform:r="none"}=getComputedStyle(t);return Ov(r,e)};function t3(t){return parseFloat(t.trim())}const wu=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Su=new Set(wu),mS=t=>t===bu||t===jt,r3=new Set(["x","y","z"]),s3=wu.filter(t=>!r3.has(t));function i3(t){const e=[];return s3.forEach(r=>{const n=t.getValue(r);n!==void 0&&(e.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),e}const El={width:({x:t},{paddingLeft:e="0",paddingRight:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),height:({y:t},{paddingTop:e="0",paddingBottom:r="0"})=>t.max-t.min-parseFloat(e)-parseFloat(r),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Ov(e,"x"),y:(t,{transform:e})=>Ov(e,"y")};El.translateX=El.x;El.translateY=El.y;const Cl=new Set;let Fv=!1,$v=!1,Uv=!1;function rC(){if($v){const t=Array.from(Cl).filter(n=>n.needsMeasurement),e=new Set(t.map(n=>n.element)),r=new Map;e.forEach(n=>{const c=i3(n);c.length&&(r.set(n,c),n.render())}),t.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const c=r.get(n);c&&c.forEach(([d,m])=>{var l;(l=n.getValue(d))==null||l.set(m)})}),t.forEach(n=>n.measureEndState()),t.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}$v=!1,Fv=!1,Cl.forEach(t=>t.complete(Uv)),Cl.clear()}function sC(){Cl.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&($v=!0)})}function n3(){Uv=!0,sC(),rC(),Uv=!1}class T0{constructor(e,r,n,c,d,m=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=r,this.name=n,this.motionValue=c,this.element=d,this.isAsync=m}scheduleResolve(){this.state="scheduled",this.isAsync?(Cl.add(this),Fv||(Fv=!0,Lr.read(sC),Lr.resolveKeyframes(rC))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:r,element:n,motionValue:c}=this;if(e[0]===null){const d=c==null?void 0:c.get(),m=e[e.length-1];if(d!==void 0)e[0]=d;else if(n&&r){const l=n.readValue(r,m);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=m),c&&d===void 0&&c.set(e[0])}Yz(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Cl.delete(this)}cancel(){this.state==="scheduled"&&(Cl.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const a3=t=>t.startsWith("--");function o3(t,e,r){a3(e)?t.style.setProperty(e,r):t.style[e]=r}const l3=d0(()=>window.ScrollTimeline!==void 0),c3={};function u3(t,e){const r=d0(t);return()=>c3[e]??r()}const iC=u3(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Kh=([t,e,r,n])=>`cubic-bezier(${t}, ${e}, ${r}, ${n})`,gS={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Kh([0,.65,.55,1]),circOut:Kh([.55,0,1,.45]),backIn:Kh([.31,.01,.66,-.59]),backOut:Kh([.33,1.53,.69,.99])};function nC(t,e){if(t)return typeof t=="function"?iC()?QE(t,e):"ease-out":VE(t)?Kh(t):Array.isArray(t)?t.map(r=>nC(r,e)||gS.easeOut):gS[t]}function h3(t,e,r,{delay:n=0,duration:c=300,repeat:d=0,repeatType:m="loop",ease:l="easeOut",times:w}={},k=void 0){const P={[e]:r};w&&(P.offset=w);const j=nC(l,c);Array.isArray(j)&&(P.easing=j);const L={delay:n,duration:c,easing:Array.isArray(j)?"linear":j,fill:"both",iterations:d+1,direction:m==="reverse"?"alternate":"normal"};return k&&(L.pseudoElement=k),t.animate(P,L)}function aC(t){return typeof t=="function"&&"applyToOptions"in t}function d3({type:t,...e}){return aC(t)&&iC()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class f3 extends S0{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:r,name:n,keyframes:c,pseudoElement:d,allowFlatten:m=!1,finalKeyframe:l,onComplete:w}=e;this.isPseudoElement=!!d,this.allowFlatten=m,this.options=e,h0(typeof e.type!="string");const k=d3(e);this.animation=h3(r,n,c,k,d),k.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!d){const P=w0(c,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(P):o3(r,n,P),this.animation.cancel()}w==null||w(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,r;(r=(e=this.animation).finish)==null||r.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,r;this.isPseudoElement||(r=(e=this.animation).commitStyles)==null||r.call(e)}get duration(){var r,n;const e=((n=(r=this.animation.effect)==null?void 0:r.getComputedTiming)==null?void 0:n.call(r).duration)||0;return da(Number(e))}get time(){return da(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=ha(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:r}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&l3()?(this.animation.timeline=e,bn):r(this)}}const oC={anticipate:OE,backInOut:BE,circInOut:$E};function p3(t){return t in oC}function m3(t){typeof t.ease=="string"&&p3(t.ease)&&(t.ease=oC[t.ease])}const yS=10;class g3 extends f3{constructor(e){m3(e),tC(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:r,onUpdate:n,onComplete:c,element:d,...m}=this.options;if(!r)return;if(e!==void 0){r.set(e);return}const l=new k0({...m,autoplay:!1}),w=ha(this.finishedTime??this.time);r.setWithVelocity(l.sample(w-yS).value,l.sample(w).value,yS),l.stop()}}const _S=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Bo.test(t)||t==="0")&&!t.startsWith("url("));function y3(t){const e=t[0];if(t.length===1)return!0;for(let r=0;r<t.length;r++)if(t[r]!==e)return!0}function _3(t,e,r,n){const c=t[0];if(c===null)return!1;if(e==="display"||e==="visibility")return!0;const d=t[t.length-1],m=_S(c,e),l=_S(d,e);return!m||!l?!1:y3(t)||(r==="spring"||aC(r))&&n}function Vv(t){t.duration=0,t.type}const v3=new Set(["opacity","clipPath","filter","transform"]),x3=d0(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function b3(t){var P;const{motionValue:e,name:r,repeatDelay:n,repeatType:c,damping:d,type:m}=t;if(!(((P=e==null?void 0:e.owner)==null?void 0:P.current)instanceof HTMLElement))return!1;const{onUpdate:w,transformTemplate:k}=e.owner.getProps();return x3()&&r&&v3.has(r)&&(r!=="transform"||!k)&&!w&&!n&&c!=="mirror"&&d!==0&&m!=="inertia"}const w3=40;class S3 extends S0{constructor({autoplay:e=!0,delay:r=0,type:n="keyframes",repeat:c=0,repeatDelay:d=0,repeatType:m="loop",keyframes:l,name:w,motionValue:k,element:P,...j}){var Y;super(),this.stop=()=>{var ce,de;this._animation&&(this._animation.stop(),(ce=this.stopTimeline)==null||ce.call(this)),(de=this.keyframeResolver)==null||de.cancel()},this.createdAt=Ri.now();const L={autoplay:e,delay:r,type:n,repeat:c,repeatDelay:d,repeatType:m,name:w,motionValue:k,element:P,...j},Z=(P==null?void 0:P.KeyframeResolver)||T0;this.keyframeResolver=new Z(l,(ce,de,G)=>this.onKeyframesResolved(ce,de,L,!G),w,k,P),(Y=this.keyframeResolver)==null||Y.scheduleResolve()}onKeyframesResolved(e,r,n,c){this.keyframeResolver=void 0;const{name:d,type:m,velocity:l,delay:w,isHandoff:k,onUpdate:P}=n;this.resolvedAt=Ri.now(),_3(e,d,m,l)||((qa.instantAnimations||!w)&&(P==null||P(w0(e,n,r))),e[0]=e[e.length-1],Vv(n),n.repeat=0);const L={startTime:c?this.resolvedAt?this.resolvedAt-this.createdAt>w3?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:e},Z=!k&&b3(L)?new g3({...L,element:L.motionValue.owner.current}):new k0(L);Z.finished.then(()=>this.notifyFinished()).catch(bn),this.pendingTimeline&&(this.stopTimeline=Z.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Z}get finished(){return this._animation?this.animation.finished:this._finished}then(e,r){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),n3()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const k3=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function T3(t){const e=k3.exec(t);if(!e)return[,];const[,r,n,c]=e;return[`--${r??n}`,c]}function lC(t,e,r=1){const[n,c]=T3(t);if(!n)return;const d=window.getComputedStyle(e).getPropertyValue(n);if(d){const m=d.trim();return IE(m)?parseFloat(m):m}return y0(c)?lC(c,e,r+1):c}function E0(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const cC=new Set(["width","height","top","left","right","bottom",...wu]),E3={test:t=>t==="auto",parse:t=>t},uC=t=>e=>e.test(t),hC=[bu,jt,fa,go,yz,gz,E3],vS=t=>hC.find(uC(t));function C3(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||jE(t):!0}const A3=new Set(["brightness","contrast","saturate","opacity"]);function P3(t){const[e,r]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[n]=r.match(_0)||[];if(!n)return t;const c=r.replace(n,"");let d=A3.has(e)?1:0;return n!==r&&(d*=100),e+"("+d+c+")"}const I3=/\b([a-z-]*)\(.*?\)/gu,qv={...Bo,getAnimatableNone:t=>{const e=t.match(I3);return e?e.map(P3).join(" "):t}},xS={...bu,transform:Math.round},M3={rotate:go,rotateX:go,rotateY:go,rotateZ:go,scale:jp,scaleX:jp,scaleY:jp,scaleZ:jp,skew:go,skewX:go,skewY:go,distance:jt,translateX:jt,translateY:jt,translateZ:jt,x:jt,y:jt,z:jt,perspective:jt,transformPerspective:jt,opacity:Ld,originX:oS,originY:oS,originZ:jt},C0={borderWidth:jt,borderTopWidth:jt,borderRightWidth:jt,borderBottomWidth:jt,borderLeftWidth:jt,borderRadius:jt,radius:jt,borderTopLeftRadius:jt,borderTopRightRadius:jt,borderBottomRightRadius:jt,borderBottomLeftRadius:jt,width:jt,maxWidth:jt,height:jt,maxHeight:jt,top:jt,right:jt,bottom:jt,left:jt,padding:jt,paddingTop:jt,paddingRight:jt,paddingBottom:jt,paddingLeft:jt,margin:jt,marginTop:jt,marginRight:jt,marginBottom:jt,marginLeft:jt,backgroundPositionX:jt,backgroundPositionY:jt,...M3,zIndex:xS,fillOpacity:Ld,strokeOpacity:Ld,numOctaves:xS},j3={...C0,color:cs,backgroundColor:cs,outlineColor:cs,fill:cs,stroke:cs,borderColor:cs,borderTopColor:cs,borderRightColor:cs,borderBottomColor:cs,borderLeftColor:cs,filter:qv,WebkitFilter:qv},dC=t=>j3[t];function fC(t,e){let r=dC(t);return r!==qv&&(r=Bo),r.getAnimatableNone?r.getAnimatableNone(e):void 0}const D3=new Set(["auto","none","0"]);function N3(t,e,r){let n=0,c;for(;n<t.length&&!c;){const d=t[n];typeof d=="string"&&!D3.has(d)&&Rd(d).values.length&&(c=t[n]),n++}if(c&&r)for(const d of e)t[d]=fC(r,c)}class L3 extends T0{constructor(e,r,n,c,d){super(e,r,n,c,d,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let w=0;w<e.length;w++){let k=e[w];if(typeof k=="string"&&(k=k.trim(),y0(k))){const P=lC(k,r.current);P!==void 0&&(e[w]=P),w===e.length-1&&(this.finalKeyframe=k)}}if(this.resolveNoneKeyframes(),!cC.has(n)||e.length!==2)return;const[c,d]=e,m=vS(c),l=vS(d);if(m!==l)if(mS(m)&&mS(l))for(let w=0;w<e.length;w++){const k=e[w];typeof k=="string"&&(e[w]=parseFloat(k))}else El[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:r}=this,n=[];for(let c=0;c<e.length;c++)(e[c]===null||C3(e[c]))&&n.push(c);n.length&&N3(e,n,r)}measureInitialState(){const{element:e,unresolvedKeyframes:r,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=El[n](e.measureViewportBox(),window.getComputedStyle(e.current)),r[0]=this.measuredOrigin;const c=r[r.length-1];c!==void 0&&e.getValue(n,c).jump(c,!1)}measureEndState(){var l;const{element:e,name:r,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const c=e.getValue(r);c&&c.jump(this.measuredOrigin,!1);const d=n.length-1,m=n[d];n[d]=El[r](e.measureViewportBox(),window.getComputedStyle(e.current)),m!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=m),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([w,k])=>{e.getValue(w).set(k)}),this.resolveNoneKeyframes()}}function R3(t,e,r){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let n=document;const c=(r==null?void 0:r[t])??n.querySelectorAll(t);return c?Array.from(c):[]}return Array.from(t)}const pC=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function mC(t){return ME(t)&&"offsetHeight"in t}const bS=30,z3=t=>!isNaN(parseFloat(t));class B3{constructor(e,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{var d;const c=Ri.now();if(this.updatedAt!==c&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((d=this.events.change)==null||d.notify(this.current),this.dependents))for(const m of this.dependents)m.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=r.owner}setCurrent(e){this.current=e,this.updatedAt=Ri.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=z3(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,r){this.events[e]||(this.events[e]=new f0);const n=this.events[e].add(r);return e==="change"?()=>{n(),Lr.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,r){this.passiveEffect=e,this.stopPassiveEffect=r}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,r=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ri.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>bS)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,bS);return DE(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(e){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=e(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,r;(e=this.dependents)==null||e.clear(),(r=this.events.destroy)==null||r.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function hu(t,e){return new B3(t,e)}const{schedule:A0}=qE(queueMicrotask,!1),Bn={x:!1,y:!1};function gC(){return Bn.x||Bn.y}function O3(t){return t==="x"||t==="y"?Bn[t]?null:(Bn[t]=!0,()=>{Bn[t]=!1}):Bn.x||Bn.y?null:(Bn.x=Bn.y=!0,()=>{Bn.x=Bn.y=!1})}function yC(t,e){const r=R3(t),n=new AbortController,c={passive:!0,...e,signal:n.signal};return[r,c,()=>n.abort()]}function wS(t){return!(t.pointerType==="touch"||gC())}function F3(t,e,r={}){const[n,c,d]=yC(t,r),m=l=>{if(!wS(l))return;const{target:w}=l,k=e(w,l);if(typeof k!="function"||!w)return;const P=j=>{wS(j)&&(k(j),w.removeEventListener("pointerleave",P))};w.addEventListener("pointerleave",P,c)};return n.forEach(l=>{l.addEventListener("pointerenter",m,c)}),d}const _C=(t,e)=>e?t===e?!0:_C(t,e.parentElement):!1,P0=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,$3=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function U3(t){return $3.has(t.tagName)||t.tabIndex!==-1}const em=new WeakSet;function SS(t){return e=>{e.key==="Enter"&&t(e)}}function a_(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const V3=(t,e)=>{const r=t.currentTarget;if(!r)return;const n=SS(()=>{if(em.has(r))return;a_(r,"down");const c=SS(()=>{a_(r,"up")}),d=()=>a_(r,"cancel");r.addEventListener("keyup",c,e),r.addEventListener("blur",d,e)});r.addEventListener("keydown",n,e),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),e)};function kS(t){return P0(t)&&!gC()}function q3(t,e,r={}){const[n,c,d]=yC(t,r),m=l=>{const w=l.currentTarget;if(!kS(l))return;em.add(w);const k=e(w,l),P=(Z,Y)=>{window.removeEventListener("pointerup",j),window.removeEventListener("pointercancel",L),em.has(w)&&em.delete(w),kS(Z)&&typeof k=="function"&&k(Z,{success:Y})},j=Z=>{P(Z,w===window||w===document||r.useGlobalTarget||_C(w,Z.target))},L=Z=>{P(Z,!1)};window.addEventListener("pointerup",j,c),window.addEventListener("pointercancel",L,c)};return n.forEach(l=>{(r.useGlobalTarget?window:l).addEventListener("pointerdown",m,c),mC(l)&&(l.addEventListener("focus",k=>V3(k,c)),!U3(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),d}function vC(t){return ME(t)&&"ownerSVGElement"in t}function G3(t){return vC(t)&&t.tagName==="svg"}const ti=t=>!!(t&&t.getVelocity),W3=[...hC,cs,Bo],Z3=t=>W3.find(uC(t)),I0=re.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class H3 extends re.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const n=r.offsetParent,c=mC(n)&&n.offsetWidth||0,d=this.props.sizeRef.current;d.height=r.offsetHeight||0,d.width=r.offsetWidth||0,d.top=r.offsetTop,d.left=r.offsetLeft,d.right=c-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function K3({children:t,isPresent:e,anchorX:r,root:n}){const c=re.useId(),d=re.useRef(null),m=re.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=re.useContext(I0);return re.useInsertionEffect(()=>{const{width:w,height:k,top:P,left:j,right:L}=m.current;if(e||!d.current||!w||!k)return;const Z=r==="left"?`left: ${j}`:`right: ${L}`;d.current.dataset.motionPopId=c;const Y=document.createElement("style");l&&(Y.nonce=l);const ce=n??document.head;return ce.appendChild(Y),Y.sheet&&Y.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${w}px !important;
            height: ${k}px !important;
            ${Z}px !important;
            top: ${P}px !important;
          }
        `),()=>{ce.contains(Y)&&ce.removeChild(Y)}},[e]),v.jsx(H3,{isPresent:e,childRef:d,sizeRef:m,children:re.cloneElement(t,{ref:d})})}const X3=({children:t,initial:e,isPresent:r,onExitComplete:n,custom:c,presenceAffectsLayout:d,mode:m,anchorX:l,root:w})=>{const k=o0(Y3),P=re.useId();let j=!0,L=re.useMemo(()=>(j=!1,{id:P,initial:e,isPresent:r,custom:c,onExitComplete:Z=>{k.set(Z,!0);for(const Y of k.values())if(!Y)return;n&&n()},register:Z=>(k.set(Z,!1),()=>k.delete(Z))}),[r,k,n]);return d&&j&&(L={...L}),re.useMemo(()=>{k.forEach((Z,Y)=>k.set(Y,!1))},[r]),re.useEffect(()=>{!r&&!k.size&&n&&n()},[r]),m==="popLayout"&&(t=v.jsx(K3,{isPresent:r,anchorX:l,root:w,children:t})),v.jsx(ag.Provider,{value:L,children:t})};function Y3(){return new Map}function xC(t=!0){const e=re.useContext(ag);if(e===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:c}=e,d=re.useId();re.useEffect(()=>{if(t)return c(d)},[t]);const m=re.useCallback(()=>t&&n&&n(d),[d,n,t]);return!r&&n?[!1,m]:[!0]}const Dp=t=>t.key||"";function TS(t){const e=[];return re.Children.forEach(t,r=>{re.isValidElement(r)&&e.push(r)}),e}const tu=({children:t,custom:e,initial:r=!0,onExitComplete:n,presenceAffectsLayout:c=!0,mode:d="sync",propagate:m=!1,anchorX:l="left",root:w})=>{const[k,P]=xC(m),j=re.useMemo(()=>TS(t),[t]),L=m&&!k?[]:j.map(Dp),Z=re.useRef(!0),Y=re.useRef(j),ce=o0(()=>new Map),[de,G]=re.useState(j),[H,W]=re.useState(j);PE(()=>{Z.current=!1,Y.current=j;for(let be=0;be<H.length;be++){const Ce=Dp(H[be]);L.includes(Ce)?ce.delete(Ce):ce.get(Ce)!==!0&&ce.set(Ce,!1)}},[H,L.length,L.join("-")]);const ue=[];if(j!==de){let be=[...j];for(let Ce=0;Ce<H.length;Ce++){const Te=H[Ce],rt=Dp(Te);L.includes(rt)||(be.splice(Ce,0,Te),ue.push(Te))}return d==="wait"&&ue.length&&(be=ue),W(TS(be)),G(j),null}const{forceRender:me}=re.useContext(a0);return v.jsx(v.Fragment,{children:H.map(be=>{const Ce=Dp(be),Te=m&&!k?!1:j===H||L.includes(Ce),rt=()=>{if(ce.has(Ce))ce.set(Ce,!0);else return;let Ue=!0;ce.forEach(St=>{St||(Ue=!1)}),Ue&&(me==null||me(),W(Y.current),m&&(P==null||P()),n&&n())};return v.jsx(X3,{isPresent:Te,initial:!Z.current||r?void 0:!1,custom:e,presenceAffectsLayout:c,mode:d,root:w,onExitComplete:Te?void 0:rt,anchorX:l,children:be},Ce)})})},bC=re.createContext({strict:!1}),ES={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},du={};for(const t in ES)du[t]={isEnabled:e=>ES[t].some(r=>!!e[r])};function J3(t){for(const e in t)du[e]={...du[e],...t[e]}}const Q3=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Dm(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||Q3.has(t)}let wC=t=>!Dm(t);function e4(t){typeof t=="function"&&(wC=e=>e.startsWith("on")?!Dm(e):t(e))}try{e4(require("@emotion/is-prop-valid").default)}catch{}function t4(t,e,r){const n={};for(const c in t)c==="values"&&typeof t.values=="object"||(wC(c)||r===!0&&Dm(c)||!e&&!Dm(c)||t.draggable&&c.startsWith("onDrag"))&&(n[c]=t[c]);return n}const og=re.createContext({});function lg(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function zd(t){return typeof t=="string"||Array.isArray(t)}const M0=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],j0=["initial",...M0];function cg(t){return lg(t.animate)||j0.some(e=>zd(t[e]))}function SC(t){return!!(cg(t)||t.variants)}function r4(t,e){if(cg(t)){const{initial:r,animate:n}=t;return{initial:r===!1||zd(r)?r:void 0,animate:zd(n)?n:void 0}}return t.inherit!==!1?e:{}}function s4(t){const{initial:e,animate:r}=r4(t,re.useContext(og));return re.useMemo(()=>({initial:e,animate:r}),[CS(e),CS(r)])}function CS(t){return Array.isArray(t)?t.join(" "):t}const Bd={};function i4(t){for(const e in t)Bd[e]=t[e],g0(e)&&(Bd[e].isCSSVariable=!0)}function kC(t,{layout:e,layoutId:r}){return Su.has(t)||t.startsWith("origin")||(e||r!==void 0)&&(!!Bd[t]||t==="opacity")}const n4={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},a4=wu.length;function o4(t,e,r){let n="",c=!0;for(let d=0;d<a4;d++){const m=wu[d],l=t[m];if(l===void 0)continue;let w=!0;if(typeof l=="number"?w=l===(m.startsWith("scale")?1:0):w=parseFloat(l)===0,!w||r){const k=pC(l,C0[m]);if(!w){c=!1;const P=n4[m]||m;n+=`${P}(${k}) `}r&&(e[m]=k)}}return n=n.trim(),r?n=r(e,c?"":n):c&&(n="none"),n}function D0(t,e,r){const{style:n,vars:c,transformOrigin:d}=t;let m=!1,l=!1;for(const w in e){const k=e[w];if(Su.has(w)){m=!0;continue}else if(g0(w)){c[w]=k;continue}else{const P=pC(k,C0[w]);w.startsWith("origin")?(l=!0,d[w]=P):n[w]=P}}if(e.transform||(m||r?n.transform=o4(e,t.transform,r):n.transform&&(n.transform="none")),l){const{originX:w="50%",originY:k="50%",originZ:P=0}=d;n.transformOrigin=`${w} ${k} ${P}`}}const N0=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function TC(t,e,r){for(const n in e)!ti(e[n])&&!kC(n,r)&&(t[n]=e[n])}function l4({transformTemplate:t},e){return re.useMemo(()=>{const r=N0();return D0(r,e,t),Object.assign({},r.vars,r.style)},[e])}function c4(t,e){const r=t.style||{},n={};return TC(n,r,t),Object.assign(n,l4(t,e)),n}function u4(t,e){const r={},n=c4(t,e);return t.drag&&t.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(r.tabIndex=0),r.style=n,r}const h4={offset:"stroke-dashoffset",array:"stroke-dasharray"},d4={offset:"strokeDashoffset",array:"strokeDasharray"};function f4(t,e,r=1,n=0,c=!0){t.pathLength=1;const d=c?h4:d4;t[d.offset]=jt.transform(-n);const m=jt.transform(e),l=jt.transform(r);t[d.array]=`${m} ${l}`}function EC(t,{attrX:e,attrY:r,attrScale:n,pathLength:c,pathSpacing:d=1,pathOffset:m=0,...l},w,k,P){if(D0(t,l,k),w){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:j,style:L}=t;j.transform&&(L.transform=j.transform,delete j.transform),(L.transform||j.transformOrigin)&&(L.transformOrigin=j.transformOrigin??"50% 50%",delete j.transformOrigin),L.transform&&(L.transformBox=(P==null?void 0:P.transformBox)??"fill-box",delete j.transformBox),e!==void 0&&(j.x=e),r!==void 0&&(j.y=r),n!==void 0&&(j.scale=n),c!==void 0&&f4(j,c,d,m,!1)}const CC=()=>({...N0(),attrs:{}}),AC=t=>typeof t=="string"&&t.toLowerCase()==="svg";function p4(t,e,r,n){const c=re.useMemo(()=>{const d=CC();return EC(d,e,AC(n),t.transformTemplate,t.style),{...d.attrs,style:{...d.style}}},[e]);if(t.style){const d={};TC(d,t.style,t),c.style={...d,...c.style}}return c}const m4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function L0(t){return typeof t!="string"||t.includes("-")?!1:!!(m4.indexOf(t)>-1||/[A-Z]/u.test(t))}function g4(t,e,r,{latestValues:n},c,d=!1){const l=(L0(t)?p4:u4)(e,n,c,t),w=t4(e,typeof t=="string",d),k=t!==re.Fragment?{...w,...l,ref:r}:{},{children:P}=e,j=re.useMemo(()=>ti(P)?P.get():P,[P]);return re.createElement(t,{...k,children:j})}function AS(t){const e=[{},{}];return t==null||t.values.forEach((r,n)=>{e[0][n]=r.get(),e[1][n]=r.getVelocity()}),e}function R0(t,e,r,n){if(typeof e=="function"){const[c,d]=AS(n);e=e(r!==void 0?r:t.custom,c,d)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[c,d]=AS(n);e=e(r!==void 0?r:t.custom,c,d)}return e}function tm(t){return ti(t)?t.get():t}function y4({scrapeMotionValuesFromProps:t,createRenderState:e},r,n,c){return{latestValues:_4(r,n,c,t),renderState:e()}}function _4(t,e,r,n){const c={},d=n(t,{});for(const L in d)c[L]=tm(d[L]);let{initial:m,animate:l}=t;const w=cg(t),k=SC(t);e&&k&&!w&&t.inherit!==!1&&(m===void 0&&(m=e.initial),l===void 0&&(l=e.animate));let P=r?r.initial===!1:!1;P=P||m===!1;const j=P?l:m;if(j&&typeof j!="boolean"&&!lg(j)){const L=Array.isArray(j)?j:[j];for(let Z=0;Z<L.length;Z++){const Y=R0(t,L[Z]);if(Y){const{transitionEnd:ce,transition:de,...G}=Y;for(const H in G){let W=G[H];if(Array.isArray(W)){const ue=P?W.length-1:0;W=W[ue]}W!==null&&(c[H]=W)}for(const H in ce)c[H]=ce[H]}}}return c}const PC=t=>(e,r)=>{const n=re.useContext(og),c=re.useContext(ag),d=()=>y4(t,e,n,c);return r?d():o0(d)};function z0(t,e,r){var d;const{style:n}=t,c={};for(const m in n)(ti(n[m])||e.style&&ti(e.style[m])||kC(m,t)||((d=r==null?void 0:r.getValue(m))==null?void 0:d.liveStyle)!==void 0)&&(c[m]=n[m]);return c}const v4=PC({scrapeMotionValuesFromProps:z0,createRenderState:N0});function IC(t,e,r){const n=z0(t,e,r);for(const c in t)if(ti(t[c])||ti(e[c])){const d=wu.indexOf(c)!==-1?"attr"+c.charAt(0).toUpperCase()+c.substring(1):c;n[d]=t[c]}return n}const x4=PC({scrapeMotionValuesFromProps:IC,createRenderState:CC}),b4=Symbol.for("motionComponentSymbol");function qc(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function w4(t,e,r){return re.useCallback(n=>{n&&t.onMount&&t.onMount(n),e&&(n?e.mount(n):e.unmount()),r&&(typeof r=="function"?r(n):qc(r)&&(r.current=n))},[e])}const B0=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),S4="framerAppearId",MC="data-"+B0(S4),jC=re.createContext({});function k4(t,e,r,n,c){var ce,de;const{visualElement:d}=re.useContext(og),m=re.useContext(bC),l=re.useContext(ag),w=re.useContext(I0).reducedMotion,k=re.useRef(null);n=n||m.renderer,!k.current&&n&&(k.current=n(t,{visualState:e,parent:d,props:r,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:w}));const P=k.current,j=re.useContext(jC);P&&!P.projection&&c&&(P.type==="html"||P.type==="svg")&&T4(k.current,r,c,j);const L=re.useRef(!1);re.useInsertionEffect(()=>{P&&L.current&&P.update(r,l)});const Z=r[MC],Y=re.useRef(!!Z&&!((ce=window.MotionHandoffIsComplete)!=null&&ce.call(window,Z))&&((de=window.MotionHasOptimisedAnimation)==null?void 0:de.call(window,Z)));return PE(()=>{P&&(L.current=!0,window.MotionIsMounted=!0,P.updateFeatures(),P.scheduleRenderMicrotask(),Y.current&&P.animationState&&P.animationState.animateChanges())}),re.useEffect(()=>{P&&(!Y.current&&P.animationState&&P.animationState.animateChanges(),Y.current&&(queueMicrotask(()=>{var G;(G=window.MotionHandoffMarkAsComplete)==null||G.call(window,Z)}),Y.current=!1),P.enteringChildren=void 0)}),P}function T4(t,e,r,n){const{layoutId:c,layout:d,drag:m,dragConstraints:l,layoutScroll:w,layoutRoot:k,layoutCrossfade:P}=e;t.projection=new r(t.latestValues,e["data-framer-portal-id"]?void 0:DC(t.parent)),t.projection.setOptions({layoutId:c,layout:d,alwaysMeasureLayout:!!m||l&&qc(l),visualElement:t,animationType:typeof d=="string"?d:"both",initialPromotionConfig:n,crossfade:P,layoutScroll:w,layoutRoot:k})}function DC(t){if(t)return t.options.allowProjection!==!1?t.projection:DC(t.parent)}function o_(t,{forwardMotionProps:e=!1}={},r,n){r&&J3(r);const c=L0(t)?x4:v4;function d(l,w){let k;const P={...re.useContext(I0),...l,layoutId:E4(l)},{isStatic:j}=P,L=s4(l),Z=c(l,j);if(!j&&l0){C4();const Y=A4(P);k=Y.MeasureLayout,L.visualElement=k4(t,Z,P,n,Y.ProjectionNode)}return v.jsxs(og.Provider,{value:L,children:[k&&L.visualElement?v.jsx(k,{visualElement:L.visualElement,...P}):null,g4(t,l,w4(Z,L.visualElement,w),Z,j,e)]})}d.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const m=re.forwardRef(d);return m[b4]=t,m}function E4({layoutId:t}){const e=re.useContext(a0).id;return e&&t!==void 0?e+"-"+t:t}function C4(t,e){re.useContext(bC).strict}function A4(t){const{drag:e,layout:r}=du;if(!e&&!r)return{};const n={...e,...r};return{MeasureLayout:e!=null&&e.isEnabled(t)||r!=null&&r.isEnabled(t)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function P4(t,e){if(typeof Proxy>"u")return o_;const r=new Map,n=(d,m)=>o_(d,m,t,e),c=(d,m)=>n(d,m);return new Proxy(c,{get:(d,m)=>m==="create"?n:(r.has(m)||r.set(m,o_(m,void 0,t,e)),r.get(m))})}function NC({top:t,left:e,right:r,bottom:n}){return{x:{min:e,max:r},y:{min:t,max:n}}}function I4({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function M4(t,e){if(!e)return t;const r=e({x:t.left,y:t.top}),n=e({x:t.right,y:t.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function l_(t){return t===void 0||t===1}function Gv({scale:t,scaleX:e,scaleY:r}){return!l_(t)||!l_(e)||!l_(r)}function yl(t){return Gv(t)||LC(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function LC(t){return PS(t.x)||PS(t.y)}function PS(t){return t&&t!=="0%"}function Nm(t,e,r){const n=t-r,c=e*n;return r+c}function IS(t,e,r,n,c){return c!==void 0&&(t=Nm(t,c,n)),Nm(t,r,n)+e}function Wv(t,e=0,r=1,n,c){t.min=IS(t.min,e,r,n,c),t.max=IS(t.max,e,r,n,c)}function RC(t,{x:e,y:r}){Wv(t.x,e.translate,e.scale,e.originPoint),Wv(t.y,r.translate,r.scale,r.originPoint)}const MS=.999999999999,jS=1.0000000000001;function j4(t,e,r,n=!1){const c=r.length;if(!c)return;e.x=e.y=1;let d,m;for(let l=0;l<c;l++){d=r[l],m=d.projectionDelta;const{visualElement:w}=d.options;w&&w.props.style&&w.props.style.display==="contents"||(n&&d.options.layoutScroll&&d.scroll&&d!==d.root&&Wc(t,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),m&&(e.x*=m.x.scale,e.y*=m.y.scale,RC(t,m)),n&&yl(d.latestValues)&&Wc(t,d.latestValues))}e.x<jS&&e.x>MS&&(e.x=1),e.y<jS&&e.y>MS&&(e.y=1)}function Gc(t,e){t.min=t.min+e,t.max=t.max+e}function DS(t,e,r,n,c=.5){const d=$r(t.min,t.max,c);Wv(t,e,r,d,n)}function Wc(t,e){DS(t.x,e.x,e.scaleX,e.scale,e.originX),DS(t.y,e.y,e.scaleY,e.scale,e.originY)}function zC(t,e){return NC(M4(t.getBoundingClientRect(),e))}function D4(t,e,r){const n=zC(t,r),{scroll:c}=e;return c&&(Gc(n.x,c.offset.x),Gc(n.y,c.offset.y)),n}const NS=()=>({translate:0,scale:1,origin:0,originPoint:0}),Zc=()=>({x:NS(),y:NS()}),LS=()=>({min:0,max:0}),ns=()=>({x:LS(),y:LS()}),Zv={current:null},BC={current:!1};function N4(){if(BC.current=!0,!!l0)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Zv.current=t.matches;t.addEventListener("change",e),e()}else Zv.current=!1}const L4=new WeakMap;function R4(t,e,r){for(const n in e){const c=e[n],d=r[n];if(ti(c))t.addValue(n,c);else if(ti(d))t.addValue(n,hu(c,{owner:t}));else if(d!==c)if(t.hasValue(n)){const m=t.getValue(n);m.liveStyle===!0?m.jump(c):m.hasAnimated||m.set(c)}else{const m=t.getStaticValue(n);t.addValue(n,hu(m!==void 0?m:c,{owner:t}))}}for(const n in r)e[n]===void 0&&t.removeValue(n);return e}const RS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class z4{scrapeMotionValuesFromProps(e,r,n){return{}}constructor({parent:e,props:r,presenceContext:n,reducedMotionConfig:c,blockInitialAnimation:d,visualState:m},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=T0,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=Ri.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,Lr.render(this.render,!1,!0))};const{latestValues:w,renderState:k}=m;this.latestValues=w,this.baseTarget={...w},this.initialValues=r.initial?{...w}:{},this.renderState=k,this.parent=e,this.props=r,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=c,this.options=l,this.blockInitialAnimation=!!d,this.isControllingVariants=cg(r),this.isVariantNode=SC(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:P,...j}=this.scrapeMotionValuesFromProps(r,{},this);for(const L in j){const Z=j[L];w[L]!==void 0&&ti(Z)&&Z.set(w[L])}}mount(e){var r;this.current=e,L4.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,c)=>this.bindToMotionValue(c,n)),BC.current||N4(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Zv.current,(r=this.parent)==null||r.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),zo(this.notifyUpdate),zo(this.render),this.valueSubscriptions.forEach(r=>r()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const r in this.events)this.events[r].clear();for(const r in this.features){const n=this.features[r];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,r){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=Su.has(e);n&&this.onBindTransform&&this.onBindTransform();const c=r.on("change",m=>{this.latestValues[e]=m,this.props.onUpdate&&Lr.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let d;window.MotionCheckAppearSync&&(d=window.MotionCheckAppearSync(this,e,r)),this.valueSubscriptions.set(e,()=>{c(),d&&d(),r.owner&&r.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in du){const r=du[e];if(!r)continue;const{isEnabled:n,Feature:c}=r;if(!this.features[e]&&c&&n(this.props)&&(this.features[e]=new c(this)),this.features[e]){const d=this.features[e];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ns()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,r){this.latestValues[e]=r}update(e,r){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<RS.length;n++){const c=RS[n];this.propEventSubscriptions[c]&&(this.propEventSubscriptions[c](),delete this.propEventSubscriptions[c]);const d="on"+c,m=e[d];m&&(this.propEventSubscriptions[c]=this.on(c,m))}this.prevMotionValues=R4(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(e),()=>r.variantChildren.delete(e)}addValue(e,r){const n=this.values.get(e);r!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,r),this.values.set(e,r),this.latestValues[e]=r.get())}removeValue(e){this.values.delete(e);const r=this.valueSubscriptions.get(e);r&&(r(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,r){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&r!==void 0&&(n=hu(r===null?void 0:r,{owner:this}),this.addValue(e,n)),n}readValue(e,r){let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(IE(n)||jE(n))?n=parseFloat(n):!Z3(n)&&Bo.test(r)&&(n=fC(e,r)),this.setBaseTarget(e,ti(n)?n.get():n)),ti(n)?n.get():n}setBaseTarget(e,r){this.baseTarget[e]=r}getBaseTarget(e){var d;const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const m=R0(this.props,r,(d=this.presenceContext)==null?void 0:d.custom);m&&(n=m[e])}if(r&&n!==void 0)return n;const c=this.getBaseTargetFromProps(this.props,e);return c!==void 0&&!ti(c)?c:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,r){return this.events[e]||(this.events[e]=new f0),this.events[e].add(r)}notify(e,...r){this.events[e]&&this.events[e].notify(...r)}scheduleRenderMicrotask(){A0.render(this.render)}}class OC extends z4{constructor(){super(...arguments),this.KeyframeResolver=L3}sortInstanceNodePosition(e,r){return e.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(e,r){return e.style?e.style[r]:void 0}removeValueFromRenderState(e,{vars:r,style:n}){delete r[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ti(e)&&(this.childSubscription=e.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function FC(t,{style:e,vars:r},n,c){const d=t.style;let m;for(m in e)d[m]=e[m];c==null||c.applyProjectionStyles(d,n);for(m in r)d.setProperty(m,r[m])}function B4(t){return window.getComputedStyle(t)}class O4 extends OC{constructor(){super(...arguments),this.type="html",this.renderInstance=FC}readValueFromInstance(e,r){var n;if(Su.has(r))return(n=this.projection)!=null&&n.isProjecting?Bv(r):e3(e,r);{const c=B4(e),d=(g0(r)?c.getPropertyValue(r):c[r])||0;return typeof d=="string"?d.trim():d}}measureInstanceViewportBox(e,{transformPagePoint:r}){return zC(e,r)}build(e,r,n){D0(e,r,n.transformTemplate)}scrapeMotionValuesFromProps(e,r,n){return z0(e,r,n)}}const $C=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function F4(t,e,r,n){FC(t,e,void 0,n);for(const c in e.attrs)t.setAttribute($C.has(c)?c:B0(c),e.attrs[c])}class $4 extends OC{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ns}getBaseTargetFromProps(e,r){return e[r]}readValueFromInstance(e,r){if(Su.has(r)){const n=dC(r);return n&&n.default||0}return r=$C.has(r)?r:B0(r),e.getAttribute(r)}scrapeMotionValuesFromProps(e,r,n){return IC(e,r,n)}build(e,r,n){EC(e,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,r,n,c){F4(e,r,n,c)}mount(e){this.isSVGTag=AC(e.tagName),super.mount(e)}}const U4=(t,e)=>L0(t)?new $4(e):new O4(e,{allowProjection:t!==re.Fragment});function ru(t,e,r){const n=t.getProps();return R0(n,e,r!==void 0?r:n.custom,t)}const Hv=t=>Array.isArray(t);function V4(t,e,r){t.hasValue(e)?t.getValue(e).set(r):t.addValue(e,hu(r))}function q4(t){return Hv(t)?t[t.length-1]||0:t}function G4(t,e){const r=ru(t,e);let{transitionEnd:n={},transition:c={},...d}=r||{};d={...d,...n};for(const m in d){const l=q4(d[m]);V4(t,m,l)}}function W4(t){return!!(ti(t)&&t.add)}function Kv(t,e){const r=t.getValue("willChange");if(W4(r))return r.add(e);if(!r&&qa.WillChange){const n=new qa.WillChange("auto");t.addValue("willChange",n),n.add(e)}}function UC(t){return t.props[MC]}const Z4=t=>t!==null;function H4(t,{repeat:e,repeatType:r="loop"},n){const c=t.filter(Z4),d=e&&r!=="loop"&&e%2===1?0:c.length-1;return c[d]}const K4={type:"spring",stiffness:500,damping:25,restSpeed:10},X4=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),Y4={type:"keyframes",duration:.8},J4={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Q4=(t,{keyframes:e})=>e.length>2?Y4:Su.has(t)?t.startsWith("scale")?X4(e[1]):K4:J4;function eB({when:t,delay:e,delayChildren:r,staggerChildren:n,staggerDirection:c,repeat:d,repeatType:m,repeatDelay:l,from:w,elapsed:k,...P}){return!!Object.keys(P).length}const O0=(t,e,r,n={},c,d)=>m=>{const l=E0(n,t)||{},w=l.delay||n.delay||0;let{elapsed:k=0}=n;k=k-ha(w);const P={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-k,onUpdate:L=>{e.set(L),l.onUpdate&&l.onUpdate(L)},onComplete:()=>{m(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:d?void 0:c};eB(l)||Object.assign(P,Q4(t,P)),P.duration&&(P.duration=ha(P.duration)),P.repeatDelay&&(P.repeatDelay=ha(P.repeatDelay)),P.from!==void 0&&(P.keyframes[0]=P.from);let j=!1;if((P.type===!1||P.duration===0&&!P.repeatDelay)&&(Vv(P),P.delay===0&&(j=!0)),(qa.instantAnimations||qa.skipAnimations)&&(j=!0,Vv(P),P.delay=0),P.allowFlatten=!l.type&&!l.ease,j&&!d&&e.get()!==void 0){const L=H4(P.keyframes,l);if(L!==void 0){Lr.update(()=>{P.onUpdate(L),P.onComplete()});return}}return l.isSync?new k0(P):new S3(P)};function tB({protectedKeys:t,needsAnimating:e},r){const n=t.hasOwnProperty(r)&&e[r]!==!0;return e[r]=!1,n}function VC(t,e,{delay:r=0,transitionOverride:n,type:c}={}){let{transition:d=t.getDefaultTransition(),transitionEnd:m,...l}=e;n&&(d=n);const w=[],k=c&&t.animationState&&t.animationState.getState()[c];for(const P in l){const j=t.getValue(P,t.latestValues[P]??null),L=l[P];if(L===void 0||k&&tB(k,P))continue;const Z={delay:r,...E0(d||{},P)},Y=j.get();if(Y!==void 0&&!j.isAnimating&&!Array.isArray(L)&&L===Y&&!Z.velocity)continue;let ce=!1;if(window.MotionHandoffAnimation){const G=UC(t);if(G){const H=window.MotionHandoffAnimation(G,P,Lr);H!==null&&(Z.startTime=H,ce=!0)}}Kv(t,P),j.start(O0(P,j,L,t.shouldReduceMotion&&cC.has(P)?{type:!1}:Z,t,ce));const de=j.animation;de&&w.push(de)}return m&&Promise.all(w).then(()=>{Lr.update(()=>{m&&G4(t,m)})}),w}function qC(t,e,r,n=0,c=1){const d=Array.from(t).sort((k,P)=>k.sortNodePosition(P)).indexOf(e),m=t.size,l=(m-1)*n;return typeof r=="function"?r(d,m):c===1?d*n:l-d*n}function Xv(t,e,r={}){var w;const n=ru(t,e,r.type==="exit"?(w=t.presenceContext)==null?void 0:w.custom:void 0);let{transition:c=t.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(c=r.transitionOverride);const d=n?()=>Promise.all(VC(t,n,r)):()=>Promise.resolve(),m=t.variantChildren&&t.variantChildren.size?(k=0)=>{const{delayChildren:P=0,staggerChildren:j,staggerDirection:L}=c;return rB(t,e,k,P,j,L,r)}:()=>Promise.resolve(),{when:l}=c;if(l){const[k,P]=l==="beforeChildren"?[d,m]:[m,d];return k().then(()=>P())}else return Promise.all([d(),m(r.delay)])}function rB(t,e,r=0,n=0,c=0,d=1,m){const l=[];for(const w of t.variantChildren)w.notify("AnimationStart",e),l.push(Xv(w,e,{...m,delay:r+(typeof n=="function"?0:n)+qC(t.variantChildren,w,n,c,d)}).then(()=>w.notify("AnimationComplete",e)));return Promise.all(l)}function sB(t,e,r={}){t.notify("AnimationStart",e);let n;if(Array.isArray(e)){const c=e.map(d=>Xv(t,d,r));n=Promise.all(c)}else if(typeof e=="string")n=Xv(t,e,r);else{const c=typeof e=="function"?ru(t,e,r.custom):e;n=Promise.all(VC(t,c,r))}return n.then(()=>{t.notify("AnimationComplete",e)})}function GC(t,e){if(!Array.isArray(e))return!1;const r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}const iB=j0.length;function WC(t){if(!t)return;if(!t.isControllingVariants){const r=t.parent?WC(t.parent)||{}:{};return t.props.initial!==void 0&&(r.initial=t.props.initial),r}const e={};for(let r=0;r<iB;r++){const n=j0[r],c=t.props[n];(zd(c)||c===!1)&&(e[n]=c)}return e}const nB=[...M0].reverse(),aB=M0.length;function oB(t){return e=>Promise.all(e.map(({animation:r,options:n})=>sB(t,r,n)))}function lB(t){let e=oB(t),r=zS(),n=!0;const c=w=>(k,P)=>{var L;const j=ru(t,P,w==="exit"?(L=t.presenceContext)==null?void 0:L.custom:void 0);if(j){const{transition:Z,transitionEnd:Y,...ce}=j;k={...k,...ce,...Y}}return k};function d(w){e=w(t)}function m(w){const{props:k}=t,P=WC(t.parent)||{},j=[],L=new Set;let Z={},Y=1/0;for(let de=0;de<aB;de++){const G=nB[de],H=r[G],W=k[G]!==void 0?k[G]:P[G],ue=zd(W),me=G===w?H.isActive:null;me===!1&&(Y=de);let be=W===P[G]&&W!==k[G]&&ue;if(be&&n&&t.manuallyAnimateOnMount&&(be=!1),H.protectedKeys={...Z},!H.isActive&&me===null||!W&&!H.prevProp||lg(W)||typeof W=="boolean")continue;const Ce=cB(H.prevProp,W);let Te=Ce||G===w&&H.isActive&&!be&&ue||de>Y&&ue,rt=!1;const Ue=Array.isArray(W)?W:[W];let St=Ue.reduce(c(G),{});me===!1&&(St={});const{prevResolvedValues:Oe={}}=H,it={...Oe,...St},qe=vt=>{Te=!0,L.has(vt)&&(rt=!0,L.delete(vt)),H.needsAnimating[vt]=!0;const Be=t.getValue(vt);Be&&(Be.liveStyle=!1)};for(const vt in it){const Be=St[vt],st=Oe[vt];if(Z.hasOwnProperty(vt))continue;let Fe=!1;Hv(Be)&&Hv(st)?Fe=!GC(Be,st):Fe=Be!==st,Fe?Be!=null?qe(vt):L.add(vt):Be!==void 0&&L.has(vt)?qe(vt):H.protectedKeys[vt]=!0}H.prevProp=W,H.prevResolvedValues=St,H.isActive&&(Z={...Z,...St}),n&&t.blockInitialAnimation&&(Te=!1);const Et=be&&Ce;Te&&(!Et||rt)&&j.push(...Ue.map(vt=>{const Be={type:G};if(typeof vt=="string"&&n&&!Et&&t.manuallyAnimateOnMount&&t.parent){const{parent:st}=t,Fe=ru(st,vt);if(st.enteringChildren&&Fe){const{delayChildren:Ct}=Fe.transition||{};Be.delay=qC(st.enteringChildren,t,Ct)}}return{animation:vt,options:Be}}))}if(L.size){const de={};if(typeof k.initial!="boolean"){const G=ru(t,Array.isArray(k.initial)?k.initial[0]:k.initial);G&&G.transition&&(de.transition=G.transition)}L.forEach(G=>{const H=t.getBaseTarget(G),W=t.getValue(G);W&&(W.liveStyle=!0),de[G]=H??null}),j.push({animation:de})}let ce=!!j.length;return n&&(k.initial===!1||k.initial===k.animate)&&!t.manuallyAnimateOnMount&&(ce=!1),n=!1,ce?e(j):Promise.resolve()}function l(w,k){var j;if(r[w].isActive===k)return Promise.resolve();(j=t.variantChildren)==null||j.forEach(L=>{var Z;return(Z=L.animationState)==null?void 0:Z.setActive(w,k)}),r[w].isActive=k;const P=m(w);for(const L in r)r[L].protectedKeys={};return P}return{animateChanges:m,setActive:l,setAnimateFunction:d,getState:()=>r,reset:()=>{r=zS(),n=!0}}}function cB(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!GC(e,t):!1}function fl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function zS(){return{animate:fl(!0),whileInView:fl(),whileHover:fl(),whileTap:fl(),whileDrag:fl(),whileFocus:fl(),exit:fl()}}class Vo{constructor(e){this.isMounted=!1,this.node=e}update(){}}class uB extends Vo{constructor(e){super(e),e.animationState||(e.animationState=lB(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();lg(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:r}=this.node.prevProps||{};e!==r&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let hB=0;class dB extends Vo{constructor(){super(...arguments),this.id=hB++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const c=this.node.animationState.setActive("exit",!e);r&&!e&&c.then(()=>{r(this.id)})}mount(){const{register:e,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const fB={animation:{Feature:uB},exit:{Feature:dB}};function Od(t,e,r,n={passive:!0}){return t.addEventListener(e,r,n),()=>t.removeEventListener(e,r)}function Qd(t){return{point:{x:t.pageX,y:t.pageY}}}const pB=t=>e=>P0(e)&&t(e,Qd(e));function ud(t,e,r,n){return Od(t,e,pB(r),n)}const ZC=1e-4,mB=1-ZC,gB=1+ZC,HC=.01,yB=0-HC,_B=0+HC;function yi(t){return t.max-t.min}function vB(t,e,r){return Math.abs(t-e)<=r}function BS(t,e,r,n=.5){t.origin=n,t.originPoint=$r(e.min,e.max,t.origin),t.scale=yi(r)/yi(e),t.translate=$r(r.min,r.max,t.origin)-t.originPoint,(t.scale>=mB&&t.scale<=gB||isNaN(t.scale))&&(t.scale=1),(t.translate>=yB&&t.translate<=_B||isNaN(t.translate))&&(t.translate=0)}function hd(t,e,r,n){BS(t.x,e.x,r.x,n?n.originX:void 0),BS(t.y,e.y,r.y,n?n.originY:void 0)}function OS(t,e,r){t.min=r.min+e.min,t.max=t.min+yi(e)}function xB(t,e,r){OS(t.x,e.x,r.x),OS(t.y,e.y,r.y)}function FS(t,e,r){t.min=e.min-r.min,t.max=t.min+yi(e)}function dd(t,e,r){FS(t.x,e.x,r.x),FS(t.y,e.y,r.y)}function mn(t){return[t("x"),t("y")]}const KC=({current:t})=>t?t.ownerDocument.defaultView:null,$S=(t,e)=>Math.abs(t-e);function bB(t,e){const r=$S(t.x,e.x),n=$S(t.y,e.y);return Math.sqrt(r**2+n**2)}class XC{constructor(e,r,{transformPagePoint:n,contextWindow:c=window,dragSnapToOrigin:d=!1,distanceThreshold:m=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=u_(this.lastMoveEventInfo,this.history),Z=this.startEvent!==null,Y=bB(L.offset,{x:0,y:0})>=this.distanceThreshold;if(!Z&&!Y)return;const{point:ce}=L,{timestamp:de}=$s;this.history.push({...ce,timestamp:de});const{onStart:G,onMove:H}=this.handlers;Z||(G&&G(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),H&&H(this.lastMoveEvent,L)},this.handlePointerMove=(L,Z)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=c_(Z,this.transformPagePoint),Lr.update(this.updatePoint,!0)},this.handlePointerUp=(L,Z)=>{this.end();const{onEnd:Y,onSessionEnd:ce,resumeAnimation:de}=this.handlers;if(this.dragSnapToOrigin&&de&&de(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const G=u_(L.type==="pointercancel"?this.lastMoveEventInfo:c_(Z,this.transformPagePoint),this.history);this.startEvent&&Y&&Y(L,G),ce&&ce(L,G)},!P0(e))return;this.dragSnapToOrigin=d,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=m,this.contextWindow=c||window;const l=Qd(e),w=c_(l,this.transformPagePoint),{point:k}=w,{timestamp:P}=$s;this.history=[{...k,timestamp:P}];const{onSessionStart:j}=r;j&&j(e,u_(w,this.history)),this.removeListeners=Xd(ud(this.contextWindow,"pointermove",this.handlePointerMove),ud(this.contextWindow,"pointerup",this.handlePointerUp),ud(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),zo(this.updatePoint)}}function c_(t,e){return e?{point:e(t.point)}:t}function US(t,e){return{x:t.x-e.x,y:t.y-e.y}}function u_({point:t},e){return{point:t,delta:US(t,YC(e)),offset:US(t,wB(e)),velocity:SB(e,.1)}}function wB(t){return t[0]}function YC(t){return t[t.length-1]}function SB(t,e){if(t.length<2)return{x:0,y:0};let r=t.length-1,n=null;const c=YC(t);for(;r>=0&&(n=t[r],!(c.timestamp-n.timestamp>ha(e)));)r--;if(!n)return{x:0,y:0};const d=da(c.timestamp-n.timestamp);if(d===0)return{x:0,y:0};const m={x:(c.x-n.x)/d,y:(c.y-n.y)/d};return m.x===1/0&&(m.x=0),m.y===1/0&&(m.y=0),m}function kB(t,{min:e,max:r},n){return e!==void 0&&t<e?t=n?$r(e,t,n.min):Math.max(t,e):r!==void 0&&t>r&&(t=n?$r(r,t,n.max):Math.min(t,r)),t}function VS(t,e,r){return{min:e!==void 0?t.min+e:void 0,max:r!==void 0?t.max+r-(t.max-t.min):void 0}}function TB(t,{top:e,left:r,bottom:n,right:c}){return{x:VS(t.x,r,c),y:VS(t.y,e,n)}}function qS(t,e){let r=e.min-t.min,n=e.max-t.max;return e.max-e.min<t.max-t.min&&([r,n]=[n,r]),{min:r,max:n}}function EB(t,e){return{x:qS(t.x,e.x),y:qS(t.y,e.y)}}function CB(t,e){let r=.5;const n=yi(t),c=yi(e);return c>n?r=Nd(e.min,e.max-n,t.min):n>c&&(r=Nd(t.min,t.max-c,e.min)),Va(0,1,r)}function AB(t,e){const r={};return e.min!==void 0&&(r.min=e.min-t.min),e.max!==void 0&&(r.max=e.max-t.min),r}const Yv=.35;function PB(t=Yv){return t===!1?t=0:t===!0&&(t=Yv),{x:GS(t,"left","right"),y:GS(t,"top","bottom")}}function GS(t,e,r){return{min:WS(t,e),max:WS(t,r)}}function WS(t,e){return typeof t=="number"?t:t[e]||0}const IB=new WeakMap;class MB{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ns(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:c}=this.visualElement;if(c&&c.isPresent===!1)return;const d=j=>{const{dragSnapToOrigin:L}=this.getProps();L?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(Qd(j).point)},m=(j,L)=>{const{drag:Z,dragPropagation:Y,onDragStart:ce}=this.getProps();if(Z&&!Y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=O3(Z),!this.openDragLock))return;this.latestPointerEvent=j,this.latestPanInfo=L,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),mn(G=>{let H=this.getAxisMotionValue(G).get()||0;if(fa.test(H)){const{projection:W}=this.visualElement;if(W&&W.layout){const ue=W.layout.layoutBox[G];ue&&(H=yi(ue)*(parseFloat(H)/100))}}this.originPoint[G]=H}),ce&&Lr.postRender(()=>ce(j,L)),Kv(this.visualElement,"transform");const{animationState:de}=this.visualElement;de&&de.setActive("whileDrag",!0)},l=(j,L)=>{this.latestPointerEvent=j,this.latestPanInfo=L;const{dragPropagation:Z,dragDirectionLock:Y,onDirectionLock:ce,onDrag:de}=this.getProps();if(!Z&&!this.openDragLock)return;const{offset:G}=L;if(Y&&this.currentDirection===null){this.currentDirection=jB(G),this.currentDirection!==null&&ce&&ce(this.currentDirection);return}this.updateAxis("x",L.point,G),this.updateAxis("y",L.point,G),this.visualElement.render(),de&&de(j,L)},w=(j,L)=>{this.latestPointerEvent=j,this.latestPanInfo=L,this.stop(j,L),this.latestPointerEvent=null,this.latestPanInfo=null},k=()=>mn(j=>{var L;return this.getAnimationState(j)==="paused"&&((L=this.getAxisMotionValue(j).animation)==null?void 0:L.play())}),{dragSnapToOrigin:P}=this.getProps();this.panSession=new XC(e,{onSessionStart:d,onStart:m,onMove:l,onSessionEnd:w,resumeAnimation:k},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:P,distanceThreshold:n,contextWindow:KC(this.visualElement)})}stop(e,r){const n=e||this.latestPointerEvent,c=r||this.latestPanInfo,d=this.isDragging;if(this.cancel(),!d||!c||!n)return;const{velocity:m}=c;this.startAnimation(m);const{onDragEnd:l}=this.getProps();l&&Lr.postRender(()=>l(n,c))}cancel(){this.isDragging=!1;const{projection:e,animationState:r}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(e,r,n){const{drag:c}=this.getProps();if(!n||!Np(e,c,this.currentDirection))return;const d=this.getAxisMotionValue(e);let m=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(m=kB(m,this.constraints[e],this.elastic[e])),d.set(m)}resolveConstraints(){var d;const{dragConstraints:e,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(d=this.visualElement.projection)==null?void 0:d.layout,c=this.constraints;e&&qc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=TB(n.layoutBox,e):this.constraints=!1,this.elastic=PB(r),c!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&mn(m=>{this.constraints!==!1&&this.getAxisMotionValue(m)&&(this.constraints[m]=AB(n.layoutBox[m],this.constraints[m]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:r}=this.getProps();if(!e||!qc(e))return!1;const n=e.current,{projection:c}=this.visualElement;if(!c||!c.layout)return!1;const d=D4(n,c.root,this.visualElement.getTransformPagePoint());let m=EB(c.layout.layoutBox,d);if(r){const l=r(I4(m));this.hasMutatedConstraints=!!l,l&&(m=NC(l))}return m}startAnimation(e){const{drag:r,dragMomentum:n,dragElastic:c,dragTransition:d,dragSnapToOrigin:m,onDragTransitionEnd:l}=this.getProps(),w=this.constraints||{},k=mn(P=>{if(!Np(P,r,this.currentDirection))return;let j=w&&w[P]||{};m&&(j={min:0,max:0});const L=c?200:1e6,Z=c?40:1e7,Y={type:"inertia",velocity:n?e[P]:0,bounceStiffness:L,bounceDamping:Z,timeConstant:750,restDelta:1,restSpeed:10,...d,...j};return this.startAxisValueAnimation(P,Y)});return Promise.all(k).then(l)}startAxisValueAnimation(e,r){const n=this.getAxisMotionValue(e);return Kv(this.visualElement,e),n.start(O0(e,n,0,r,this.visualElement,!1))}stopAnimation(){mn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){mn(e=>{var r;return(r=this.getAxisMotionValue(e).animation)==null?void 0:r.pause()})}getAnimationState(e){var r;return(r=this.getAxisMotionValue(e).animation)==null?void 0:r.state}getAxisMotionValue(e){const r=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),c=n[r];return c||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){mn(r=>{const{drag:n}=this.getProps();if(!Np(r,n,this.currentDirection))return;const{projection:c}=this.visualElement,d=this.getAxisMotionValue(r);if(c&&c.layout){const{min:m,max:l}=c.layout.layoutBox[r];d.set(e[r]-$r(m,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!qc(r)||!n||!this.constraints)return;this.stopAnimation();const c={x:0,y:0};mn(m=>{const l=this.getAxisMotionValue(m);if(l&&this.constraints!==!1){const w=l.get();c[m]=CB({min:w,max:w},this.constraints[m])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),mn(m=>{if(!Np(m,e,null))return;const l=this.getAxisMotionValue(m),{min:w,max:k}=this.constraints[m];l.set($r(w,k,c[m]))})}addListeners(){if(!this.visualElement.current)return;IB.set(this.visualElement,this);const e=this.visualElement.current,r=ud(e,"pointerdown",w=>{const{drag:k,dragListener:P=!0}=this.getProps();k&&P&&this.start(w)}),n=()=>{const{dragConstraints:w}=this.getProps();qc(w)&&w.current&&(this.constraints=this.resolveRefConstraints())},{projection:c}=this.visualElement,d=c.addEventListener("measure",n);c&&!c.layout&&(c.root&&c.root.updateScroll(),c.updateLayout()),Lr.read(n);const m=Od(window,"resize",()=>this.scalePositionWithinConstraints()),l=c.addEventListener("didUpdate",({delta:w,hasLayoutChanged:k})=>{this.isDragging&&k&&(mn(P=>{const j=this.getAxisMotionValue(P);j&&(this.originPoint[P]+=w[P].translate,j.set(j.get()+w[P].translate))}),this.visualElement.render())});return()=>{m(),r(),d(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:c=!1,dragConstraints:d=!1,dragElastic:m=Yv,dragMomentum:l=!0}=e;return{...e,drag:r,dragDirectionLock:n,dragPropagation:c,dragConstraints:d,dragElastic:m,dragMomentum:l}}}function Np(t,e,r){return(e===!0||e===t)&&(r===null||r===t)}function jB(t,e=10){let r=null;return Math.abs(t.y)>e?r="y":Math.abs(t.x)>e&&(r="x"),r}class DB extends Vo{constructor(e){super(e),this.removeGroupControls=bn,this.removeListeners=bn,this.controls=new MB(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||bn}unmount(){this.removeGroupControls(),this.removeListeners()}}const ZS=t=>(e,r)=>{t&&Lr.postRender(()=>t(e,r))};class NB extends Vo{constructor(){super(...arguments),this.removePointerDownListener=bn}onPointerDown(e){this.session=new XC(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:KC(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:r,onPan:n,onPanEnd:c}=this.node.getProps();return{onSessionStart:ZS(e),onStart:ZS(r),onMove:n,onEnd:(d,m)=>{delete this.session,c&&Lr.postRender(()=>c(d,m))}}}mount(){this.removePointerDownListener=ud(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const rm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function HS(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const $h={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(jt.test(t))t=parseFloat(t);else return t;const r=HS(t,e.target.x),n=HS(t,e.target.y);return`${r}% ${n}%`}},LB={correct:(t,{treeScale:e,projectionDelta:r})=>{const n=t,c=Bo.parse(t);if(c.length>5)return n;const d=Bo.createTransformer(t),m=typeof c[0]!="number"?1:0,l=r.x.scale*e.x,w=r.y.scale*e.y;c[0+m]/=l,c[1+m]/=w;const k=$r(l,w,.5);return typeof c[2+m]=="number"&&(c[2+m]/=k),typeof c[3+m]=="number"&&(c[3+m]/=k),d(c)}};let h_=!1;class RB extends re.Component{componentDidMount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:n,layoutId:c}=this.props,{projection:d}=e;i4(zB),d&&(r.group&&r.group.add(d),n&&n.register&&c&&n.register(d),h_&&d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),rm.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:r,visualElement:n,drag:c,isPresent:d}=this.props,{projection:m}=n;return m&&(m.isPresent=d,h_=!0,c||e.layoutDependency!==r||r===void 0||e.isPresent!==d?m.willUpdate():this.safeToRemove(),e.isPresent!==d&&(d?m.promote():m.relegate()||Lr.postRender(()=>{const l=m.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),A0.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:c}=e;h_=!0,c&&(c.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(c),n&&n.deregister&&n.deregister(c))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function JC(t){const[e,r]=xC(),n=re.useContext(a0);return v.jsx(RB,{...t,layoutGroup:n,switchLayoutGroup:re.useContext(jC),isPresent:e,safeToRemove:r})}const zB={borderRadius:{...$h,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:$h,borderTopRightRadius:$h,borderBottomLeftRadius:$h,borderBottomRightRadius:$h,boxShadow:LB};function BB(t,e,r){const n=ti(t)?t:hu(t);return n.start(O0("",n,e,r)),n.animation}const OB=(t,e)=>t.depth-e.depth;class FB{constructor(){this.children=[],this.isDirty=!1}add(e){c0(this.children,e),this.isDirty=!0}remove(e){u0(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(OB),this.isDirty=!1,this.children.forEach(e)}}function $B(t,e){const r=Ri.now(),n=({timestamp:c})=>{const d=c-r;d>=e&&(zo(n),t(d-e))};return Lr.setup(n,!0),()=>zo(n)}const QC=["TopLeft","TopRight","BottomLeft","BottomRight"],UB=QC.length,KS=t=>typeof t=="string"?parseFloat(t):t,XS=t=>typeof t=="number"||jt.test(t);function VB(t,e,r,n,c,d){c?(t.opacity=$r(0,r.opacity??1,qB(n)),t.opacityExit=$r(e.opacity??1,0,GB(n))):d&&(t.opacity=$r(e.opacity??1,r.opacity??1,n));for(let m=0;m<UB;m++){const l=`border${QC[m]}Radius`;let w=YS(e,l),k=YS(r,l);if(w===void 0&&k===void 0)continue;w||(w=0),k||(k=0),w===0||k===0||XS(w)===XS(k)?(t[l]=Math.max($r(KS(w),KS(k),n),0),(fa.test(k)||fa.test(w))&&(t[l]+="%")):t[l]=k}(e.rotate||r.rotate)&&(t.rotate=$r(e.rotate||0,r.rotate||0,n))}function YS(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const qB=eA(0,.5,FE),GB=eA(.5,.95,bn);function eA(t,e,r){return n=>n<t?0:n>e?1:r(Nd(t,e,n))}function JS(t,e){t.min=e.min,t.max=e.max}function fn(t,e){JS(t.x,e.x),JS(t.y,e.y)}function QS(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function e2(t,e,r,n,c){return t-=e,t=Nm(t,1/r,n),c!==void 0&&(t=Nm(t,1/c,n)),t}function WB(t,e=0,r=1,n=.5,c,d=t,m=t){if(fa.test(e)&&(e=parseFloat(e),e=$r(m.min,m.max,e/100)-m.min),typeof e!="number")return;let l=$r(d.min,d.max,n);t===d&&(l-=e),t.min=e2(t.min,e,r,l,c),t.max=e2(t.max,e,r,l,c)}function t2(t,e,[r,n,c],d,m){WB(t,e[r],e[n],e[c],e.scale,d,m)}const ZB=["x","scaleX","originX"],HB=["y","scaleY","originY"];function r2(t,e,r,n){t2(t.x,e,ZB,r?r.x:void 0,n?n.x:void 0),t2(t.y,e,HB,r?r.y:void 0,n?n.y:void 0)}function s2(t){return t.translate===0&&t.scale===1}function tA(t){return s2(t.x)&&s2(t.y)}function i2(t,e){return t.min===e.min&&t.max===e.max}function KB(t,e){return i2(t.x,e.x)&&i2(t.y,e.y)}function n2(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function rA(t,e){return n2(t.x,e.x)&&n2(t.y,e.y)}function a2(t){return yi(t.x)/yi(t.y)}function o2(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class XB{constructor(){this.members=[]}add(e){c0(this.members,e),e.scheduleRender()}remove(e){if(u0(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(e){const r=this.members.findIndex(c=>e===c);if(r===0)return!1;let n;for(let c=r;c>=0;c--){const d=this.members[c];if(d.isPresent!==!1){n=d;break}}return n?(this.promote(n),!0):!1}promote(e,r){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,r&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:c}=e.options;c===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:r,resumingFrom:n}=e;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function YB(t,e,r){let n="";const c=t.x.translate/e.x,d=t.y.translate/e.y,m=(r==null?void 0:r.z)||0;if((c||d||m)&&(n=`translate3d(${c}px, ${d}px, ${m}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),r){const{transformPerspective:k,rotate:P,rotateX:j,rotateY:L,skewX:Z,skewY:Y}=r;k&&(n=`perspective(${k}px) ${n}`),P&&(n+=`rotate(${P}deg) `),j&&(n+=`rotateX(${j}deg) `),L&&(n+=`rotateY(${L}deg) `),Z&&(n+=`skewX(${Z}deg) `),Y&&(n+=`skewY(${Y}deg) `)}const l=t.x.scale*e.x,w=t.y.scale*e.y;return(l!==1||w!==1)&&(n+=`scale(${l}, ${w})`),n||"none"}const d_=["","X","Y","Z"],JB=1e3;let QB=0;function f_(t,e,r,n){const{latestValues:c}=e;c[t]&&(r[t]=c[t],e.setStaticValue(t,0),n&&(n[t]=0))}function sA(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const r=UC(e);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:c,layoutId:d}=t.options;window.MotionCancelOptimisedAnimation(r,"transform",Lr,!(c||d))}const{parent:n}=t;n&&!n.hasCheckedOptimisedAppear&&sA(n)}function iA({attachResizeListener:t,defaultParent:e,measureScroll:r,checkIsScrollRoot:n,resetTransform:c}){return class{constructor(m={},l=e==null?void 0:e()){this.id=QB++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(r5),this.nodes.forEach(a5),this.nodes.forEach(o5),this.nodes.forEach(s5)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=m,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let w=0;w<this.path.length;w++)this.path[w].shouldResetTransform=!0;this.root===this&&(this.nodes=new FB)}addEventListener(m,l){return this.eventHandlers.has(m)||this.eventHandlers.set(m,new f0),this.eventHandlers.get(m).add(l)}notifyListeners(m,...l){const w=this.eventHandlers.get(m);w&&w.notify(...l)}hasListeners(m){return this.eventHandlers.has(m)}mount(m){if(this.instance)return;this.isSVG=vC(m)&&!G3(m),this.instance=m;const{layoutId:l,layout:w,visualElement:k}=this.options;if(k&&!k.current&&k.mount(m),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(w||l)&&(this.isLayoutDirty=!0),t){let P,j=0;const L=()=>this.root.updateBlockedByResize=!1;Lr.read(()=>{j=window.innerWidth}),t(m,()=>{const Z=window.innerWidth;Z!==j&&(j=Z,this.root.updateBlockedByResize=!0,P&&P(),P=$B(L,250),rm.hasAnimatedSinceResize&&(rm.hasAnimatedSinceResize=!1,this.nodes.forEach(u2)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&k&&(l||w)&&this.addEventListener("didUpdate",({delta:P,hasLayoutChanged:j,hasRelativeLayoutChanged:L,layout:Z})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Y=this.options.transition||k.getDefaultTransition()||d5,{onLayoutAnimationStart:ce,onLayoutAnimationComplete:de}=k.getProps(),G=!this.targetLayout||!rA(this.targetLayout,Z),H=!j&&L;if(this.options.layoutRoot||this.resumeFrom||H||j&&(G||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const W={...E0(Y,"layout"),onPlay:ce,onComplete:de};(k.shouldReduceMotion||this.options.layoutRoot)&&(W.delay=0,W.type=!1),this.startAnimation(W),this.setAnimationOrigin(P,H)}else j||u2(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Z})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const m=this.getStack();m&&m.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),zo(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(l5),this.animationId++)}getTransformTemplate(){const{visualElement:m}=this.options;return m&&m.getProps().transformTemplate}willUpdate(m=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&sA(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let P=0;P<this.path.length;P++){const j=this.path[P];j.shouldResetTransform=!0,j.updateScroll("snapshot"),j.options.layoutRoot&&j.willUpdate(!1)}const{layoutId:l,layout:w}=this.options;if(l===void 0&&!w)return;const k=this.getTransformTemplate();this.prevTransformTemplateValue=k?k(this.latestValues,""):void 0,this.updateSnapshot(),m&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(l2);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(c2);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(n5),this.nodes.forEach(e5),this.nodes.forEach(t5)):this.nodes.forEach(c2),this.clearAllSnapshots();const l=Ri.now();$s.delta=Va(0,1e3/60,l-$s.timestamp),$s.timestamp=l,$s.isProcessing=!0,t_.update.process($s),t_.preRender.process($s),t_.render.process($s),$s.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,A0.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(i5),this.sharedNodes.forEach(c5)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Lr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Lr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!yi(this.snapshot.measuredBox.x)&&!yi(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let w=0;w<this.path.length;w++)this.path[w].updateScroll();const m=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ns(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,m?m.layoutBox:void 0)}updateScroll(m="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===m&&(l=!1),l&&this.instance){const w=n(this.instance);this.scroll={animationId:this.root.animationId,phase:m,isRoot:w,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:w}}}resetTransform(){if(!c)return;const m=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!tA(this.projectionDelta),w=this.getTransformTemplate(),k=w?w(this.latestValues,""):void 0,P=k!==this.prevTransformTemplateValue;m&&this.instance&&(l||yl(this.latestValues)||P)&&(c(this.instance,k),this.shouldResetTransform=!1,this.scheduleRender())}measure(m=!0){const l=this.measurePageBox();let w=this.removeElementScroll(l);return m&&(w=this.removeTransform(w)),f5(w),{animationId:this.root.animationId,measuredBox:l,layoutBox:w,latestValues:{},source:this.id}}measurePageBox(){var k;const{visualElement:m}=this.options;if(!m)return ns();const l=m.measureViewportBox();if(!(((k=this.scroll)==null?void 0:k.wasRoot)||this.path.some(p5))){const{scroll:P}=this.root;P&&(Gc(l.x,P.offset.x),Gc(l.y,P.offset.y))}return l}removeElementScroll(m){var w;const l=ns();if(fn(l,m),(w=this.scroll)!=null&&w.wasRoot)return l;for(let k=0;k<this.path.length;k++){const P=this.path[k],{scroll:j,options:L}=P;P!==this.root&&j&&L.layoutScroll&&(j.wasRoot&&fn(l,m),Gc(l.x,j.offset.x),Gc(l.y,j.offset.y))}return l}applyTransform(m,l=!1){const w=ns();fn(w,m);for(let k=0;k<this.path.length;k++){const P=this.path[k];!l&&P.options.layoutScroll&&P.scroll&&P!==P.root&&Wc(w,{x:-P.scroll.offset.x,y:-P.scroll.offset.y}),yl(P.latestValues)&&Wc(w,P.latestValues)}return yl(this.latestValues)&&Wc(w,this.latestValues),w}removeTransform(m){const l=ns();fn(l,m);for(let w=0;w<this.path.length;w++){const k=this.path[w];if(!k.instance||!yl(k.latestValues))continue;Gv(k.latestValues)&&k.updateSnapshot();const P=ns(),j=k.measurePageBox();fn(P,j),r2(l,k.latestValues,k.snapshot?k.snapshot.layoutBox:void 0,P)}return yl(this.latestValues)&&r2(l,this.latestValues),l}setTargetDelta(m){this.targetDelta=m,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(m){this.options={...this.options,...m,crossfade:m.crossfade!==void 0?m.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==$s.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(m=!1){var L;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const w=!!this.resumingFrom||this!==l;if(!(m||w&&this.isSharedProjectionDirty||this.isProjectionDirty||(L=this.parent)!=null&&L.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:P,layoutId:j}=this.options;if(!(!this.layout||!(P||j))){if(this.resolvedRelativeTargetAt=$s.timestamp,!this.targetDelta&&!this.relativeTarget){const Z=this.getClosestProjectingParent();Z&&Z.layout&&this.animationProgress!==1?(this.relativeParent=Z,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ns(),this.relativeTargetOrigin=ns(),dd(this.relativeTargetOrigin,this.layout.layoutBox,Z.layout.layoutBox),fn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ns(),this.targetWithTransforms=ns()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),xB(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fn(this.target,this.layout.layoutBox),RC(this.target,this.targetDelta)):fn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const Z=this.getClosestProjectingParent();Z&&!!Z.resumingFrom==!!this.resumingFrom&&!Z.options.layoutScroll&&Z.target&&this.animationProgress!==1?(this.relativeParent=Z,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ns(),this.relativeTargetOrigin=ns(),dd(this.relativeTargetOrigin,this.target,Z.target),fn(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||Gv(this.parent.latestValues)||LC(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var Y;const m=this.getLead(),l=!!this.resumingFrom||this!==m;let w=!0;if((this.isProjectionDirty||(Y=this.parent)!=null&&Y.isProjectionDirty)&&(w=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(w=!1),this.resolvedRelativeTargetAt===$s.timestamp&&(w=!1),w)return;const{layout:k,layoutId:P}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(k||P))return;fn(this.layoutCorrected,this.layout.layoutBox);const j=this.treeScale.x,L=this.treeScale.y;j4(this.layoutCorrected,this.treeScale,this.path,l),m.layout&&!m.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(m.target=m.layout.layoutBox,m.targetWithTransforms=ns());const{target:Z}=m;if(!Z){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(QS(this.prevProjectionDelta.x,this.projectionDelta.x),QS(this.prevProjectionDelta.y,this.projectionDelta.y)),hd(this.projectionDelta,this.layoutCorrected,Z,this.latestValues),(this.treeScale.x!==j||this.treeScale.y!==L||!o2(this.projectionDelta.x,this.prevProjectionDelta.x)||!o2(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Z))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(m=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),m){const w=this.getStack();w&&w.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Zc(),this.projectionDelta=Zc(),this.projectionDeltaWithTransform=Zc()}setAnimationOrigin(m,l=!1){const w=this.snapshot,k=w?w.latestValues:{},P={...this.latestValues},j=Zc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const L=ns(),Z=w?w.source:void 0,Y=this.layout?this.layout.source:void 0,ce=Z!==Y,de=this.getStack(),G=!de||de.members.length<=1,H=!!(ce&&!G&&this.options.crossfade===!0&&!this.path.some(h5));this.animationProgress=0;let W;this.mixTargetDelta=ue=>{const me=ue/1e3;h2(j.x,m.x,me),h2(j.y,m.y,me),this.setTargetDelta(j),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(dd(L,this.layout.layoutBox,this.relativeParent.layout.layoutBox),u5(this.relativeTarget,this.relativeTargetOrigin,L,me),W&&KB(this.relativeTarget,W)&&(this.isProjectionDirty=!1),W||(W=ns()),fn(W,this.relativeTarget)),ce&&(this.animationValues=P,VB(P,k,this.latestValues,me,H,G)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=me},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(m){var l,w,k;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(k=(w=this.resumingFrom)==null?void 0:w.currentAnimation)==null||k.stop(),this.pendingAnimation&&(zo(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Lr.update(()=>{rm.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=hu(0)),this.currentAnimation=BB(this.motionValue,[0,1e3],{...m,velocity:0,isSync:!0,onUpdate:P=>{this.mixTargetDelta(P),m.onUpdate&&m.onUpdate(P)},onStop:()=>{},onComplete:()=>{m.onComplete&&m.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const m=this.getStack();m&&m.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(JB),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const m=this.getLead();let{targetWithTransforms:l,target:w,layout:k,latestValues:P}=m;if(!(!l||!w||!k)){if(this!==m&&this.layout&&k&&nA(this.options.animationType,this.layout.layoutBox,k.layoutBox)){w=this.target||ns();const j=yi(this.layout.layoutBox.x);w.x.min=m.target.x.min,w.x.max=w.x.min+j;const L=yi(this.layout.layoutBox.y);w.y.min=m.target.y.min,w.y.max=w.y.min+L}fn(l,w),Wc(l,P),hd(this.projectionDeltaWithTransform,this.layoutCorrected,l,P)}}registerSharedNode(m,l){this.sharedNodes.has(m)||this.sharedNodes.set(m,new XB),this.sharedNodes.get(m).add(l);const k=l.options.initialPromotionConfig;l.promote({transition:k?k.transition:void 0,preserveFollowOpacity:k&&k.shouldPreserveFollowOpacity?k.shouldPreserveFollowOpacity(l):void 0})}isLead(){const m=this.getStack();return m?m.lead===this:!0}getLead(){var l;const{layoutId:m}=this.options;return m?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:m}=this.options;return m?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:m}=this.options;if(m)return this.root.sharedNodes.get(m)}promote({needsReset:m,transition:l,preserveFollowOpacity:w}={}){const k=this.getStack();k&&k.promote(this,w),m&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const m=this.getStack();return m?m.relegate(this):!1}resetSkewAndRotation(){const{visualElement:m}=this.options;if(!m)return;let l=!1;const{latestValues:w}=m;if((w.z||w.rotate||w.rotateX||w.rotateY||w.rotateZ||w.skewX||w.skewY)&&(l=!0),!l)return;const k={};w.z&&f_("z",m,k,this.animationValues);for(let P=0;P<d_.length;P++)f_(`rotate${d_[P]}`,m,k,this.animationValues),f_(`skew${d_[P]}`,m,k,this.animationValues);m.render();for(const P in k)m.setStaticValue(P,k[P]),this.animationValues&&(this.animationValues[P]=k[P]);m.scheduleRender()}applyProjectionStyles(m,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){m.visibility="hidden";return}const w=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,m.visibility="",m.opacity="",m.pointerEvents=tm(l==null?void 0:l.pointerEvents)||"",m.transform=w?w(this.latestValues,""):"none";return}const k=this.getLead();if(!this.projectionDelta||!this.layout||!k.target){this.options.layoutId&&(m.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,m.pointerEvents=tm(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!yl(this.latestValues)&&(m.transform=w?w({},""):"none",this.hasProjected=!1);return}m.visibility="";const P=k.animationValues||k.latestValues;this.applyTransformsToTarget();let j=YB(this.projectionDeltaWithTransform,this.treeScale,P);w&&(j=w(P,j)),m.transform=j;const{x:L,y:Z}=this.projectionDelta;m.transformOrigin=`${L.origin*100}% ${Z.origin*100}% 0`,k.animationValues?m.opacity=k===this?P.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:P.opacityExit:m.opacity=k===this?P.opacity!==void 0?P.opacity:"":P.opacityExit!==void 0?P.opacityExit:0;for(const Y in Bd){if(P[Y]===void 0)continue;const{correct:ce,applyTo:de,isCSSVariable:G}=Bd[Y],H=j==="none"?P[Y]:ce(P[Y],k);if(de){const W=de.length;for(let ue=0;ue<W;ue++)m[de[ue]]=H}else G?this.options.visualElement.renderState.vars[Y]=H:m[Y]=H}this.options.layoutId&&(m.pointerEvents=k===this?tm(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(m=>{var l;return(l=m.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(l2),this.root.sharedNodes.clear()}}}function e5(t){t.updateLayout()}function t5(t){var r;const e=((r=t.resumeFrom)==null?void 0:r.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:c}=t.layout,{animationType:d}=t.options,m=e.source!==t.layout.source;d==="size"?mn(j=>{const L=m?e.measuredBox[j]:e.layoutBox[j],Z=yi(L);L.min=n[j].min,L.max=L.min+Z}):nA(d,e.layoutBox,n)&&mn(j=>{const L=m?e.measuredBox[j]:e.layoutBox[j],Z=yi(n[j]);L.max=L.min+Z,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[j].max=t.relativeTarget[j].min+Z)});const l=Zc();hd(l,n,e.layoutBox);const w=Zc();m?hd(w,t.applyTransform(c,!0),e.measuredBox):hd(w,n,e.layoutBox);const k=!tA(l);let P=!1;if(!t.resumeFrom){const j=t.getClosestProjectingParent();if(j&&!j.resumeFrom){const{snapshot:L,layout:Z}=j;if(L&&Z){const Y=ns();dd(Y,e.layoutBox,L.layoutBox);const ce=ns();dd(ce,n,Z.layoutBox),rA(Y,ce)||(P=!0),j.options.layoutRoot&&(t.relativeTarget=ce,t.relativeTargetOrigin=Y,t.relativeParent=j)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:w,layoutDelta:l,hasLayoutChanged:k,hasRelativeLayoutChanged:P})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function r5(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function s5(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function i5(t){t.clearSnapshot()}function l2(t){t.clearMeasurements()}function c2(t){t.isLayoutDirty=!1}function n5(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function u2(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function a5(t){t.resolveTargetDelta()}function o5(t){t.calcProjection()}function l5(t){t.resetSkewAndRotation()}function c5(t){t.removeLeadSnapshot()}function h2(t,e,r){t.translate=$r(e.translate,0,r),t.scale=$r(e.scale,1,r),t.origin=e.origin,t.originPoint=e.originPoint}function d2(t,e,r,n){t.min=$r(e.min,r.min,n),t.max=$r(e.max,r.max,n)}function u5(t,e,r,n){d2(t.x,e.x,r.x,n),d2(t.y,e.y,r.y,n)}function h5(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const d5={duration:.45,ease:[.4,0,.1,1]},f2=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),p2=f2("applewebkit/")&&!f2("chrome/")?Math.round:bn;function m2(t){t.min=p2(t.min),t.max=p2(t.max)}function f5(t){m2(t.x),m2(t.y)}function nA(t,e,r){return t==="position"||t==="preserve-aspect"&&!vB(a2(e),a2(r),.2)}function p5(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const m5=iA({attachResizeListener:(t,e)=>Od(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),p_={current:void 0},aA=iA({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!p_.current){const t=new m5({});t.mount(window),t.setOptions({layoutScroll:!0}),p_.current=t}return p_.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),g5={pan:{Feature:NB},drag:{Feature:DB,ProjectionNode:aA,MeasureLayout:JC}};function g2(t,e,r){const{props:n}=t;t.animationState&&n.whileHover&&t.animationState.setActive("whileHover",r==="Start");const c="onHover"+r,d=n[c];d&&Lr.postRender(()=>d(e,Qd(e)))}class y5 extends Vo{mount(){const{current:e}=this.node;e&&(this.unmount=F3(e,(r,n)=>(g2(this.node,n,"Start"),c=>g2(this.node,c,"End"))))}unmount(){}}class _5 extends Vo{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Xd(Od(this.node.current,"focus",()=>this.onFocus()),Od(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function y2(t,e,r){const{props:n}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&n.whileTap&&t.animationState.setActive("whileTap",r==="Start");const c="onTap"+(r==="End"?"":r),d=n[c];d&&Lr.postRender(()=>d(e,Qd(e)))}class v5 extends Vo{mount(){const{current:e}=this.node;e&&(this.unmount=q3(e,(r,n)=>(y2(this.node,n,"Start"),(c,{success:d})=>y2(this.node,c,d?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Jv=new WeakMap,m_=new WeakMap,x5=t=>{const e=Jv.get(t.target);e&&e(t)},b5=t=>{t.forEach(x5)};function w5({root:t,...e}){const r=t||document;m_.has(r)||m_.set(r,{});const n=m_.get(r),c=JSON.stringify(e);return n[c]||(n[c]=new IntersectionObserver(b5,{root:t,...e})),n[c]}function S5(t,e,r){const n=w5(e);return Jv.set(t,r),n.observe(t),()=>{Jv.delete(t),n.unobserve(t)}}const k5={some:0,all:1};class T5 extends Vo{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:r,margin:n,amount:c="some",once:d}=e,m={root:r?r.current:void 0,rootMargin:n,threshold:typeof c=="number"?c:k5[c]},l=w=>{const{isIntersecting:k}=w;if(this.isInView===k||(this.isInView=k,d&&!k&&this.hasEnteredView))return;k&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",k);const{onViewportEnter:P,onViewportLeave:j}=this.node.getProps(),L=k?P:j;L&&L(w)};return S5(this.node.current,m,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:r}=this.node;["amount","margin","root"].some(E5(e,r))&&this.startObserver()}unmount(){}}function E5({viewport:t={}},{viewport:e={}}={}){return r=>t[r]!==e[r]}const C5={inView:{Feature:T5},tap:{Feature:v5},focus:{Feature:_5},hover:{Feature:y5}},A5={layout:{ProjectionNode:aA,MeasureLayout:JC}},P5={...fB,...C5,...g5,...A5},Rt=P4(P5,U4),oA=re.createContext(void 0),ug=()=>{const t=re.useContext(oA);if(!t)throw new Error("useTransition must be used within a TransitionProvider");return t},I5=({children:t})=>{const[e,r]=re.useState("default"),{pathname:n}=Wd();re.useEffect(()=>{n==="/"&&(n.includes("login")||n.includes("admin-login")||n.includes("driver-login"))?r("homepage-to-login"):n==="/"&&(n.includes("student")||n.includes("student-map"))?r("homepage-to-map"):(n.includes("login")||n.includes("admin-login")||n.includes("driver-login"))&&(n.includes("dashboard")||n.includes("admin")||n.includes("driver-dashboard"))?r("login-to-dashboard"):r("default")},[n]);const c=d=>{r(d)};return v.jsx(oA.Provider,{value:{currentTransition:e,setTransition:c},children:t})},M5=({children:t,isVisible:e})=>v.jsx(Rt.div,{initial:{opacity:0,y:50},animate:{opacity:e?1:0,y:e?0:50},transition:{duration:.8,ease:"easeInOut"},className:"w-full h-full",children:t}),j5=({children:t,isVisible:e})=>v.jsx(Rt.div,{initial:{opacity:0,scale:.8},animate:{opacity:e?1:0,scale:e?1:.8},transition:{duration:1.2,ease:"easeInOut"},className:"w-full h-full",children:v.jsx(Rt.div,{initial:{opacity:0,y:100},animate:{opacity:e?1:0,y:e?0:100},transition:{duration:.8,delay:.3,ease:"easeOut"},className:"w-full h-full",children:t})}),D5=({children:t,isVisible:e})=>v.jsx(Rt.div,{initial:{opacity:0,scale:.9},animate:{opacity:e?1:0,scale:e?1:.9},transition:{duration:1,ease:"easeInOut"},className:"w-full h-full",children:v.jsx(Rt.div,{initial:{opacity:0,y:50},animate:{opacity:e?1:0,y:e?0:50},transition:{duration:.8,delay:.2,ease:"easeOut"},className:"w-full h-full",children:t})}),N5=({children:t})=>{const{currentTransition:e}=ug(),r=()=>{switch(e){case"homepage-to-login":return v.jsx(M5,{isVisible:!0,children:t});case"homepage-to-map":return v.jsx(j5,{isVisible:!0,children:t});case"login-to-dashboard":return v.jsx(D5,{isVisible:!0,children:t});default:return t}};return v.jsx(v.Fragment,{children:r()})},L5=()=>{const t=Jm(),{setTransition:e}=ug(),r=re.useRef(null),[n,c]=re.useState(!1),[d,m]=re.useState(null),[l,w]=re.useState({email:"",password:""}),[k,P]=re.useState(null),[j,L]=re.useState(!1),[Z,Y]=re.useState(!1),[ce,de]=re.useState(!1);re.useEffect(()=>{const ue=()=>{de(window.innerWidth<768)};return ue(),window.addEventListener("resize",ue),()=>window.removeEventListener("resize",ue)},[]),re.useEffect(()=>{if(r.current){r.current.playbackRate=.8;const ue=()=>Y(!0);return r.current.addEventListener("loadeddata",ue),()=>{r.current&&r.current.removeEventListener("loadeddata",ue)}}},[]),re.useEffect(()=>{const{data:{subscription:ue}}=Or.auth.onAuthStateChange(async(me,be)=>{me==="SIGNED_IN"&&be?await H(be.access_token):me==="SIGNED_OUT"&&(c(!1),m(null),W())});return()=>ue.unsubscribe()},[]);const G=async ue=>{ue.preventDefault(),L(!0),P(null);try{const{data:me,error:be}=await Or.auth.signInWithPassword({email:l.email,password:l.password});if(be){console.error("❌ Login error:",be),P(be.message);return}me.user&&me.session?(console.log("✅ Login successful:",me.user.email),await H(me.session.access_token),w({email:"",password:""})):P("Login failed - no user data received")}catch(me){console.error("❌ Login error:",me),P("An unexpected error occurred during login")}finally{L(!1)}},H=async ue=>{var me,be,Ce;try{console.log("🔌 Driver: Connecting to WebSocket..."),await $t.connect(),(me=$t.socket)==null||me.on("connect",()=>{console.log("🔌 Driver: Connected to WebSocket server")}),(be=$t.socket)==null||be.on("error",Te=>{console.error("❌ Driver: Socket error:",Te),P(Te.message||"Socket error occurred")}),(Ce=$t.socket)==null||Ce.on("driver:authenticated",Te=>{console.log("✅ Driver: Authentication successful:",Te),c(!0),m(Te.busInfo),e("login-to-dashboard"),setTimeout(()=>{t("/driver-dashboard")},1e3)}),$t.authenticateAsDriver(ue)}catch(Te){console.error("❌ Driver: Authentication error:",Te),P("Failed to authenticate with server")}},W=()=>{$t.disconnect()};return n&&d?v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:v.jsxs(Rt.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[v.jsx("div",{className:"loading-spinner mx-auto mb-4"}),v.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Authentication Successful!"}),v.jsx("p",{className:"text-white/70",children:"Redirecting to dashboard..."})]})}):v.jsxs("div",{className:"relative min-h-screen overflow-hidden",children:[v.jsxs("div",{className:"absolute inset-0 z-0",children:[v.jsxs("video",{ref:r,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover",preload:"auto",children:[v.jsx("source",{src:"/videos/Animated_Countryside_University_Bus.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/50 via-black/30 to-black/60"}),!Z&&v.jsx("div",{className:"absolute inset-0 bg-slate-900 flex items-center justify-center",children:v.jsx("div",{className:"loading-spinner"})})]}),v.jsx("div",{className:"relative z-10 flex items-center justify-center min-h-screen p-4",children:v.jsx(Rt.div,{initial:{opacity:0,y:50,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.8,ease:[.4,0,.2,1]},className:"w-full max-w-md",children:v.jsxs(Rt.div,{whileHover:ce?{}:{scale:1.02},whileTap:{scale:.98},className:"relative overflow-hidden rounded-3xl bg-white/10 backdrop-blur-2xl border border-white/20 shadow-2xl",children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-white/5 opacity-0 hover:opacity-100 transition-opacity duration-500"}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-pink-500/10 opacity-0 hover:opacity-100 transition-opacity duration-500 rounded-3xl"}),v.jsxs("div",{className:"relative z-10 p-8",children:[v.jsxs(Rt.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"text-center mb-8",children:[v.jsx("div",{className:"text-6xl mb-4 animate-pulse",children:"🚌"}),v.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Driver Login"}),v.jsx("p",{className:"text-white/70",children:"Sign in to start tracking your bus"})]}),v.jsx(tu,{children:k&&v.jsx(Rt.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-xl p-4 mb-6",children:v.jsx("p",{className:"text-red-200 text-sm",children:k})})}),v.jsxs(Rt.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},onSubmit:G,className:"space-y-6",children:[v.jsxs(Rt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.5},children:[v.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-white/90 mb-2",children:"Email Address"}),v.jsx("input",{id:"email",type:"email",required:!0,value:l.email,onChange:ue=>w(me=>({...me,email:ue.target.value})),className:"w-full px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300",placeholder:"Enter your email"})]}),v.jsxs(Rt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.6},children:[v.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-white/90 mb-2",children:"Password"}),v.jsx("input",{id:"password",type:"password",required:!0,value:l.password,onChange:ue=>w(me=>({...me,password:ue.target.value})),className:"w-full px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300",placeholder:"Enter your password"})]}),v.jsx(Rt.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.7},whileHover:ce?{}:{scale:1.02,y:-2},whileTap:{scale:.98},type:"submit",disabled:j,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl hover:shadow-blue-500/25 disabled:bg-gray-600 disabled:cursor-not-allowed disabled:shadow-none",children:j?v.jsxs("div",{className:"flex items-center justify-center",children:[v.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2"}),"Signing In..."]}):"Sign In"})]}),v.jsx(Rt.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.8},className:"mt-6 text-center",children:v.jsx("p",{className:"text-sm text-white/60",children:"Please contact your administrator for login credentials"})})]}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full hover:translate-x-full transition-transform duration-1000"})]})})}),v.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(ce?8:15)].map((ue,me)=>v.jsx(Rt.div,{className:"absolute w-1 h-1 sm:w-2 sm:h-2 bg-white/20 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{y:[0,-30,0],opacity:[0,1,0]},transition:{duration:3+Math.random()*2,repeat:1/0,delay:Math.random()*2}},me))})]})},R5=()=>{var St;const[t,e]=re.useState(!1),[r,n]=re.useState(null),[c,d]=re.useState(null),[m,l]=re.useState(null),[w,k]=re.useState(null),[P,j]=re.useState(null),[L,Z]=re.useState(0),Y=re.useRef(null),ce=re.useRef(null),de=re.useRef(null),G=re.useRef(null),H=re.useRef(null);re.useEffect(()=>((async()=>{var it,qe,Et,ir,vt,Be;try{const{data:{session:st}}=await Or.auth.getSession();st!=null&&st.user&&(await $t.connect(),(it=$t.socket)==null||it.on("connect",()=>{k(null)}),(qe=$t.socket)==null||qe.on("disconnect",()=>{k("Disconnected from server")}),(Et=$t.socket)==null||Et.on("error",Fe=>{console.error("❌ Driver Dashboard: Socket error:",Fe),k(Fe.message||"Socket error occurred")}),(ir=$t.socket)==null||ir.on("driver:authenticated",Fe=>{n(Fe.busInfo),k(null)}),(vt=$t.socket)==null||vt.on("driver:authentication_failed",Fe=>{console.error("❌ Driver Dashboard: Authentication failed:",Fe),k("Authentication failed: "+(Fe.message||"Unknown error"))}),(Be=$t.socket)==null||Be.on("driver:locationConfirmed",()=>{j(new Date().toLocaleTimeString()),Z(Fe=>Fe+1)}),Y.current=$t.socket,$t.authenticateAsDriver(st.access_token),setTimeout(()=>{r||Te(st.user.id)},3e3))}catch(st){console.error("❌ Driver Dashboard: Initialization error:",st),k("Failed to initialize driver data")}})(),()=>{$t.socket&&($t.socket.off("connect"),$t.socket.off("disconnect"),$t.socket.off("error"),$t.socket.off("driver:authenticated"),$t.socket.off("driver:locationConfirmed"))}),[]),re.useEffect(()=>(G.current&&!de.current&&W(),()=>{Ce()}),[]);const W=()=>{if(!G.current)return;const Oe=23.0225,it=72.5714;de.current=new gi.Map({container:G.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm",minzoom:0,maxzoom:22}]},center:[it,Oe],zoom:15,attributionControl:!1});const qe=document.createElement("div");qe.className="driver-marker",qe.innerHTML=`
      <div class="driver-marker-content">
        <div style="font-size: 16px;">🚌</div>
      </div>
    `,H.current=new gi.Marker({element:qe,anchor:"center"}).setLngLat([it,Oe]).addTo(de.current)},ue=(Oe,it)=>{if(!de.current||!H.current)return;const qe=[it,Oe];H.current.setLngLat(qe),de.current.flyTo({center:qe,duration:1e3})},me=async()=>{if(!navigator.geolocation){l("Geolocation is not supported by this browser");return}const it={enableHighAccuracy:!0,timeout:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?3e4:6e4,maximumAge:0};try{ce.current=navigator.geolocation.watchPosition(qe=>{if(d(qe),l(null),de.current&&H.current&&ue(qe.coords.latitude,qe.coords.longitude),$t.socket&&$t.isConnected()){const Et={driverId:(r==null?void 0:r.driver_id)||"",latitude:qe.coords.latitude,longitude:qe.coords.longitude,timestamp:new Date().toISOString(),speed:qe.coords.speed||void 0,heading:qe.coords.heading||void 0};$t.socket.emit("driver:locationUpdate",Et),j(new Date().toLocaleTimeString()),Z(ir=>ir+1)}},qe=>{console.error("❌ Location error:",qe);let Et="";switch(qe.code){case qe.PERMISSION_DENIED:Et="Location permission denied. Please enable location access.";break;case qe.POSITION_UNAVAILABLE:Et="Location information is unavailable.";break;case qe.TIMEOUT:Et="Location request timed out.";break;default:Et="An unknown error occurred."}l(Et),e(!1)},it),e(!0)}catch(qe){console.error("❌ Error starting location tracking:",qe),l("Failed to start location tracking")}},be=()=>{ce.current&&(navigator.geolocation.clearWatch(ce.current),ce.current=null),e(!1)},Ce=()=>{de.current&&(de.current.remove(),de.current=null),H.current=null},Te=async Oe=>{try{const it=await fetch(`${vu.api.url}/api/drivers/${Oe}/bus`,{method:"GET",headers:{"Content-Type":"application/json"}});if(it.ok){const qe=await it.json();qe.busInfo&&n(qe.busInfo)}else console.error("❌ Failed to fetch bus info from API:",it.status)}catch(it){console.error("❌ Error fetching bus info from API:",it)}},rt=()=>{$t.disconnect(),Y.current=null},Ue=async()=>{try{be(),rt(),Ce(),await Or.auth.signOut()}catch(Oe){console.error("❌ Sign out error:",Oe)}};return v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 p-4",children:v.jsxs("div",{className:"max-w-7xl mx-auto",children:[v.jsx("div",{className:"card-glass p-6 mb-6",children:v.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[v.jsxs("div",{className:"flex-1",children:[v.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-2",children:"🚌 Driver Dashboard"}),v.jsxs("div",{className:"space-y-1",children:[v.jsxs("p",{className:"text-white/80 text-sm sm:text-base",children:["Welcome, ",v.jsx("span",{className:"font-semibold text-white",children:r==null?void 0:r.driver_name})]}),v.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-sm",children:[v.jsxs("span",{className:"text-blue-300",children:["🚌 Bus: ",v.jsx("span",{className:"font-semibold text-white",children:r==null?void 0:r.bus_number})]}),v.jsxs("span",{className:"text-green-300",children:["🛣️ Route: ",v.jsx("span",{className:"font-semibold text-white",children:r==null?void 0:r.route_name})]})]})]})]}),v.jsx("button",{onClick:Ue,className:"btn-secondary w-full sm:w-auto",children:"Sign Out"})]})}),v.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[v.jsx("div",{className:"card-glass p-4",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${w?"bg-red-500":"bg-green-500"}`}),v.jsxs("div",{className:"min-w-0 flex-1",children:[v.jsx("h3",{className:"font-semibold text-white text-sm",children:"Connection"}),v.jsx("p",{className:"text-xs text-white/70 truncate",children:w?"Disconnected":"Connected"})]})]})}),v.jsx("div",{className:"card-glass p-4",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${t?"bg-green-500":"bg-gray-400"}`}),v.jsxs("div",{className:"min-w-0 flex-1",children:[v.jsx("h3",{className:"font-semibold text-white text-sm",children:"GPS Tracking"}),v.jsx("p",{className:"text-xs text-white/70 truncate",children:t?"Active":"Inactive"})]})]})}),v.jsx("div",{className:"card-glass p-4",children:v.jsxs("div",{children:[v.jsx("h3",{className:"font-semibold text-white text-sm",children:"Updates Sent"}),v.jsx("p",{className:"text-xl font-bold text-blue-300",children:L}),P&&v.jsxs("p",{className:"text-xs text-white/70 truncate",children:["Last: ",P]})]})}),v.jsx("div",{className:"card-glass p-4",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:`w-3 h-3 rounded-full mr-3 ${m?"bg-red-500":c?"bg-green-500":"bg-gray-400"}`}),v.jsxs("div",{className:"min-w-0 flex-1",children:[v.jsx("h3",{className:"font-semibold text-white text-sm",children:"Location"}),v.jsx("p",{className:"text-xs text-white/70 truncate",children:m?"Error":c?"Available":"Waiting"})]})]})})]}),v.jsxs("div",{className:"card-glass p-6 mb-6",children:[v.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"📍 Location Tracking Controls"}),v.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:t?v.jsx("button",{onClick:be,className:"btn-primary bg-red-600 hover:bg-red-700 w-full py-3 px-6 text-lg font-semibold",children:"⏹️ Stop Tracking"}):v.jsxs(v.Fragment,{children:[v.jsx("button",{onClick:me,className:"btn-primary flex-1 py-3 px-6 text-lg font-semibold",children:"🚀 Start Tracking"}),m&&v.jsx("button",{onClick:()=>{l(null),me()},className:"btn-secondary w-full py-2 px-4 text-sm",children:"🔄 Retry Location Permission"})]})})]}),v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[v.jsxs("div",{className:"card-glass p-6",children:[v.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"🗺️ Live Location Map"}),v.jsx("div",{ref:G,className:"w-full h-64 sm:h-80 lg:h-96 rounded-lg border border-white/20 bg-white/5",style:{minHeight:"300px"}}),m&&v.jsxs("div",{className:"bg-red-500/20 border border-red-400/30 rounded-lg p-4 mt-4",children:[v.jsx("p",{className:"text-red-200 text-sm mb-3",children:m}),v.jsxs("div",{className:"bg-yellow-500/20 border border-yellow-400/30 rounded-lg p-3",children:[v.jsx("h4",{className:"font-semibold text-yellow-200 mb-2",children:"📱 Mobile Location Troubleshooting:"}),v.jsxs("div",{className:"bg-blue-500/20 border border-blue-400/30 rounded p-2 mb-2",children:[v.jsx("h5",{className:"font-semibold text-blue-200 text-xs mb-1",children:"📱 For Mobile Devices:"}),v.jsxs("ul",{className:"text-xs text-blue-100 space-y-1",children:[v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Android Chrome:"})," Settings → Apps → Chrome → Permissions → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Android Firefox:"})," Settings → Apps → Firefox → Permissions → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"iPhone Safari:"})," Settings → Safari → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"iPhone Chrome:"})," Settings → Chrome → Location → Allow"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Make sure:"})," GPS/Location Services are ON in phone settings"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Try:"})," Going outdoors or near a window for better GPS signal"]})]})]}),v.jsxs("div",{className:"bg-green-500/20 border border-green-400/30 rounded p-2",children:[v.jsx("h5",{className:"font-semibold text-green-200 text-xs mb-1",children:"💻 For Desktop Browsers:"}),v.jsxs("ul",{className:"text-xs text-green-100 space-y-1",children:[v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Chrome:"})," Click lock icon → Location → Allow → Refresh"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Firefox:"})," Click lock icon → Location → Allow → Refresh"]}),v.jsxs("li",{children:["• ",v.jsx("strong",{children:"Safari:"})," Safari → Preferences → Websites → Location → Allow"]})]})]}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-2",children:[v.jsx("button",{onClick:()=>window.location.reload(),className:"btn-secondary text-xs px-3 py-1",children:"🔄 Refresh Page & Retry"}),v.jsx("button",{onClick:()=>{const Oe=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);navigator.geolocation?navigator.geolocation.getCurrentPosition(it=>{const qe=`✅ Location Test Successful!

Latitude: ${it.coords.latitude}
Longitude: ${it.coords.longitude}
Accuracy: ${it.coords.accuracy}m
Device: ${Oe?"Mobile":"Desktop"}

Location is working! You can now start tracking.`;alert(qe),l(null)},it=>{const qe=`❌ Location Test Failed

Error Code: ${it.code}
Error Message: ${it.message}
Device: ${Oe?"Mobile":"Desktop"}

Please check your location permissions.`;alert(qe)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):alert("Geolocation is not supported by this browser.")},className:"btn-primary text-xs px-3 py-1",children:"🧪 Test Location"})]})]})]})]}),v.jsxs("div",{className:"card-glass p-6",children:[v.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"📍 Current Location Details"}),c?v.jsxs("div",{className:"space-y-4 bg-white/10 rounded-lg p-4 border border-white/20",children:[v.jsxs("div",{className:"flex items-center justify-center mb-2",children:[v.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse mr-2"}),v.jsx("span",{className:"text-sm text-green-300 font-medium",children:"📍 Live Location Data"})]}),v.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Latitude:"}),v.jsx("span",{className:"font-mono text-white font-semibold text-sm",children:c.coords.latitude.toFixed(6)})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Longitude:"}),v.jsx("span",{className:"font-mono text-white font-semibold text-sm",children:c.coords.longitude.toFixed(6)})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Accuracy:"}),v.jsxs("span",{className:"text-white font-semibold text-sm",children:[(St=c.coords.accuracy)==null?void 0:St.toFixed(1),"m"]})]}),c.coords.speed&&v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Speed:"}),v.jsxs("span",{className:"text-white font-semibold text-sm",children:[(c.coords.speed*3.6).toFixed(1)," km/h"]})]}),c.coords.heading&&v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Heading:"}),v.jsxs("span",{className:"text-white font-semibold text-sm",children:[c.coords.heading.toFixed(1),"°"]})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Updates Sent:"}),v.jsx("span",{className:"font-bold text-blue-300 text-sm",children:L})]}),P&&v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Last Update:"}),v.jsx("span",{className:"text-white font-medium text-sm",children:P})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-white/70 text-sm",children:"Timestamp:"}),v.jsx("span",{className:"text-white font-medium text-sm",children:new Date(c.timestamp).toLocaleTimeString()})]})]})]}):v.jsxs("div",{className:"bg-yellow-500/20 border border-yellow-400/30 rounded-lg p-4 text-center",children:[v.jsx("div",{className:"text-yellow-300 mb-2 text-2xl",children:"📍"}),v.jsx("p",{className:"text-yellow-200 font-medium",children:"No location data available"}),v.jsx("p",{className:"text-yellow-100 text-sm mt-1",children:'Click "Start Tracking" to begin location sharing'})]}),v.jsxs("div",{className:"bg-blue-500/20 border border-blue-400/30 rounded-lg p-4 mt-6",children:[v.jsx("h3",{className:"font-semibold text-blue-200 mb-2",children:"ℹ️ Instructions"}),v.jsxs("ul",{className:"text-sm text-blue-100 space-y-1",children:[v.jsx("li",{children:'• Click "Start Tracking" to begin sending location updates'}),v.jsx("li",{children:"• Your location will be sent every few seconds"}),v.jsx("li",{children:"• Students and admin can see your bus location in real-time"}),v.jsx("li",{children:"• Make sure to allow location access when prompted"}),v.jsx("li",{children:"• The map shows your current position with a blue marker"})]})]})]})]})]})})};class z5{constructor(){Is(this,"buses",{});Is(this,"previousLocations",{})}calculateSpeed(e,r,n,c,d){const l=this.toRadians(n-e),w=this.toRadians(c-r),k=Math.sin(l/2)*Math.sin(l/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(n))*Math.sin(w/2)*Math.sin(w/2),j=6371*(2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))),L=d/(1e3*60*60),Z=j/L;return Math.round(Z*10)/10}toRadians(e){return e*(Math.PI/180)}updateBusLocation(e){var w,k;const{busId:r,latitude:n,longitude:c,timestamp:d}=e,m=this.previousLocations[r];let l;if(m){const P=new Date(d).getTime()-new Date(m.timestamp).getTime();P>0&&(l=this.calculateSpeed(m.latitude,m.longitude,n,c,P))}this.buses[r]?(this.buses[r].currentLocation={...e,speed:l||e.speed},this.buses[r].eta=(k=e.eta)==null?void 0:k.estimated_arrival_minutes):this.buses[r]={busId:r,busNumber:`Bus ${r}`,routeName:"Route TBD",driverName:"Driver TBD",currentLocation:{...e,speed:l||e.speed},eta:(w=e.eta)==null?void 0:w.estimated_arrival_minutes},this.previousLocations[r]={latitude:n,longitude:c,timestamp:d}}getAllBuses(){return Object.values(this.buses)}updateBusInfo(e,r){this.buses[e]&&(this.buses[e]={...this.buses[e],...r})}syncBusFromAPI(e,r){var m;const n=r.bus_number||r.number_plate||`Bus ${e}`,c=r.route_name||((m=r.routes)==null?void 0:m.name)||"Route TBD",d=r.driver_name||(r.driver?`${r.driver.first_name||""} ${r.driver.last_name||""}`.trim():"Driver TBD");this.buses[e]?this.buses[e]={...this.buses[e],busNumber:n,routeName:c,driverName:d}:this.buses[e]={busId:e,busNumber:n,routeName:c,driverName:d,currentLocation:{busId:e,driverId:"",latitude:0,longitude:0,timestamp:new Date().toISOString(),speed:0},eta:void 0},console.log(`🔄 Synced bus ${e}: ${n} - ${c} - ${d}`)}clearBuses(){this.buses={},this.previousLocations={}}getBus(e){return this.buses[e]||null}getBusesByRoute(e){return Object.values(this.buses).filter(r=>r.routeName.toLowerCase().includes(e.toLowerCase()))}getBusesNearLocation(e,r,n=5){return Object.values(this.buses).filter(c=>this.calculateDistance(e,r,c.currentLocation.latitude,c.currentLocation.longitude)<=n)}calculateDistance(e,r,n,c){const m=this.toRadians(n-e),l=this.toRadians(c-r),w=Math.sin(m/2)*Math.sin(m/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(n))*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)))}removeBus(e){delete this.buses[e],delete this.previousLocations[e]}getBusesCount(){return Object.keys(this.buses).length}}const g_=new z5,fd=({children:t,className:e="",variant:r="default",hover:n=!0,glow:c=!1,onClick:d,delay:m=0})=>{const l="relative overflow-hidden rounded-2xl transition-all duration-500",w={default:"bg-white/10 backdrop-blur-md border border-white/20 shadow-xl",premium:"bg-white/5 backdrop-blur-xl border border-white/10 shadow-2xl",ultra:"bg-white/5 backdrop-blur-2xl border border-white/10 shadow-2xl"},k=n?"hover:bg-white/15 hover:border-white/30 hover:-translate-y-1 hover:shadow-2xl":"",P=c?"hover:shadow-blue-500/20 hover:shadow-2xl":"",j=d?"cursor-pointer":"";return v.jsxs(Rt.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.6,delay:m,ease:[.4,0,.2,1]},whileHover:n?{y:-8,scale:1.02,transition:{duration:.3}}:{},whileTap:d?{scale:.98}:{},onClick:d,className:`
        ${l}
        ${w[r]}
        ${k}
        ${P}
        ${j}
        ${e}
      `,children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 via-transparent to-white/5 opacity-0 hover:opacity-100 transition-opacity duration-500"}),c&&v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 via-purple-500/10 to-pink-500/10 opacity-0 hover:opacity-100 transition-opacity duration-500 rounded-2xl"}),v.jsx("div",{className:"relative z-10 p-6",children:t}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full hover:translate-x-full transition-transform duration-1000"})]})},_2=({className:t=""})=>{const e=re.useRef(null),r=re.useRef(null),n=re.useRef({}),c=re.useRef(!1),d=re.useRef(new Set),[m,l]=re.useState(!1),[w,k]=re.useState(null),[P,j]=re.useState("disconnected"),[L,Z]=re.useState([]),[Y,ce]=re.useState([]),[de,G]=re.useState("all"),[H,W]=re.useState(!0),[ue,me]=re.useState({}),[be,Ce]=re.useState(!1),[Te,rt]=re.useState(!0),[Ue,St]=re.useState(!0),Oe=re.useCallback(async()=>{try{console.log("🔄 Loading routes from backend API...");const we=await Tv.getRoutes();we.success&&we.data?(console.log("✅ Routes loaded from backend:",we.data.length,"routes"),ce(we.data),we.data.forEach(tt=>{console.log(`📍 Route: ${tt.name} (ID: ${tt.id}) - Active: ${tt.is_active}`)})):console.error("❌ Failed to load routes:",we)}catch(we){console.error("❌ Error loading routes:",we)}},[]),it=re.useCallback(()=>{r.current&&Y.forEach(we=>{const tt=`route-${we.id}`;try{r.current.getLayer(tt)&&r.current.removeLayer(tt),r.current.getSource(tt)&&r.current.removeSource(tt),d.current.delete(tt)}catch(kt){console.warn(`⚠️ Error removing route ${we.name}:`,kt)}})},[Y]),qe=re.useCallback(()=>{!r.current||Y.length===0||(console.log("🗺️ Adding routes to map:",Y.length,"routes"),Y.forEach((we,tt)=>{const kt=`route-${we.id}`;if(d.current.has(kt)||r.current.getSource(kt)){console.log(`🗺️ Route ${kt} already exists, skipping...`);return}try{r.current.addSource(kt,{type:"geojson",data:{type:"Feature",properties:{name:we.name,description:we.description,distance:we.distance_km,duration:we.estimated_duration_minutes},geometry:we.stops}}),r.current.addLayer({id:kt,type:"line",source:kt,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":`hsl(${tt*137.5%360}, 70%, 50%)`,"line-width":4,"line-opacity":.8}}),console.log(`🗺️ Added route ${we.name} to map`),d.current.add(kt)}catch(Ht){console.warn(`⚠️ Error adding route ${we.name}:`,Ht)}}))},[Y]),Et=re.useCallback(we=>{if(!r.current)return;const{busId:tt,latitude:kt,longitude:Ht,speed:yt}=we,_t=g_.getBus(tt);if(_t)if(n.current[tt])n.current[tt].setLngLat([Ht,kt]),n.current[tt].getPopup().setHTML(`
        <div class="bus-popup">
          <div class="bus-popup-header">
            <h3>🚌 Bus ${_t.busNumber}</h3>
            <div class="bus-status ${m?"online":"offline"}">
              ${m?"🟢 Online":"🔴 Offline"}
            </div>
          </div>
          <div class="bus-popup-content">
            <div class="bus-info">
              <p><strong>Driver:</strong> ${_t.driverName||"N/A"}</p>
              <p><strong>Route:</strong> ${_t.routeName||"N/A"}</p>
              <p><strong>Speed:</strong> ${yt?`${yt} km/h`:"N/A"}</p>
              <p><strong>Last Update:</strong> ${new Date(we.timestamp).toLocaleTimeString()}</p>
            </div>
          </div>
        </div>
      `);else{const ur=document.createElement("div");ur.className="bus-marker",ur.innerHTML=`
        <div class="bus-marker-pin">
          <div class="bus-marker-icon">🚌</div>
          <div class="bus-marker-pulse"></div>
        </div>
        <div class="bus-marker-content">
          <div class="bus-number">${_t.busNumber}</div>
          <div class="bus-speed">${yt?`${yt} km/h`:"N/A"}</div>
          <div class="bus-eta">${we.eta?`ETA: ${we.eta.estimated_arrival_minutes} min`:"ETA: N/A"}</div>
        </div>
      `;const Ds=new gi.Marker({element:ur,anchor:"center"}).setLngLat([Ht,kt]).addTo(r.current),It=new gi.Popup({offset:25,className:"bus-popup-container"}).setHTML(`
        <div class="bus-popup">
          <div class="bus-popup-header">
            <h3>🚌 Bus ${_t.busNumber}</h3>
            <div class="bus-status ${m?"online":"offline"}">
              ${m?"🟢 Online":"🔴 Offline"}
            </div>
          </div>
          <div class="bus-popup-content">
            <div class="bus-info">
              <p><strong>Driver:</strong> ${_t.driverName||"N/A"}</p>
              <p><strong>Route:</strong> ${_t.routeName||"N/A"}</p>
              <p><strong>Speed:</strong> ${yt?`${yt} km/h`:"N/A"}</p>
              <p><strong>Last Update:</strong> ${new Date(we.timestamp).toLocaleTimeString()}</p>
            </div>
          </div>
        </div>
      `);Ds.setPopup(It),n.current[tt]=Ds}},[m]),ir=re.useCallback(we=>{n.current[we]&&(n.current[we].remove(),delete n.current[we])},[]),vt=re.useCallback(()=>{if(!r.current||Object.keys(ue).length===0)return;const we=Object.values(ue).map(tt=>[tt.longitude,tt.latitude]);if(we.length===1)r.current.flyTo({center:we[0],zoom:16,duration:2e3});else if(we.length>1){const tt=new gi.LngLatBounds;we.forEach(kt=>tt.extend(kt)),r.current.fitBounds(tt,{padding:50,duration:2e3})}},[ue]),Be=re.useCallback(we=>{console.log("📍 Bus location update:",we),me(tt=>({...tt,[we.busId]:we})),Et(we)},[Et]),st=re.useCallback(we=>{console.log("🚌 Driver connected:",we)},[]),Fe=re.useCallback(we=>{console.log("🚌 Driver disconnected:",we),ir(we.busId)},[ir]),Ct=re.useCallback(we=>{console.log("🚌 Bus arriving:",we)},[]);re.useEffect(()=>{if(!(c.current||!e.current))return console.log("🗺️ Initializing map..."),c.current=!0,r.current=new gi.Map({container:e.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap contributors",maxzoom:19}},layers:[{id:"osm-tiles",type:"raster",source:"osm",minzoom:0,maxzoom:19}]},center:[72.571,23.025],zoom:12,bearing:0,pitch:0,attributionControl:!0,maxZoom:19,minZoom:1,preserveDrawingBuffer:!1,antialias:!0,dragRotate:!1}),r.current.addControl(new gi.NavigationControl,"top-right"),r.current.once("load",()=>{console.log("🗺️ Map loaded successfully"),W(!1),Oe()}),r.current.on("error",we=>{console.error("❌ Map error:",we)}),()=>{r.current&&(r.current.remove(),r.current=null,c.current=!1,d.current.clear(),n.current={})}},[Oe]),re.useEffect(()=>{let we,tt;const kt=async()=>{try{k(null),j("connecting"),await $t.connect(),l(!0),j("connected"),$t.onBusLocationUpdate(Be),$t.onDriverConnected(st),$t.onDriverDisconnected(Fe),$t.onStudentConnected(()=>{console.log("✅ Student connected to WebSocket")}),$t.onBusArriving(Ct),tt=setInterval(()=>{!$t.getConnectionStatus()&&P==="connected"&&(j("disconnected"),l(!1))},1e4),(async()=>{try{for(;!tr.isInitialized();)await new Promise(ur=>setTimeout(ur,100));const _t=await Tv.getAllBuses();if(_t.success&&_t.data){console.log("📊 Initial bus data from API:",_t.data.length,"buses"),_t.data.forEach(Ds=>{const It=Ds.bus_id||Ds.id;It&&g_.syncBusFromAPI(It,Ds)});const ur=g_.getAllBuses();Z(ur),console.log("✅ Initial buses loaded and synced:",_t.data.length)}}catch(_t){console.error("❌ Error loading initial buses:",_t)}})()}catch(Ht){console.error("❌ WebSocket connection failed:",Ht),k("Failed to connect to real-time updates"),l(!1),j("disconnected"),we=setTimeout(()=>{console.log("🔄 Retrying WebSocket connection..."),j("reconnecting"),kt()},5e3)}};return kt(),()=>{we&&clearTimeout(we),tt&&clearInterval(tt),$t.disconnect()}},[Ct,Be,st,Fe]);const Nt=re.useMemo(()=>de==="all"?L:L.filter(we=>{const tt=Y.find(kt=>kt.name===we.routeName);return tt&&tt.id===de}),[L,de,Y]),Ye=re.useMemo(()=>Y.map(we=>({id:we.id,name:we.name,description:we.description})),[Y]);return re.useEffect(()=>(Y.length>0&&r.current&&r.current.isStyleLoaded()&&(it(),qe()),()=>{r.current&&it()}),[Y,qe,it]),v.jsxs("div",{className:`relative h-screen ${t}`,children:[H&&v.jsx("div",{className:"loading-overlay",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),v.jsx("p",{className:"mt-4 text-gray-600",children:"Loading map..."})]})}),w&&v.jsx("div",{className:"error-overlay",children:v.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:v.jsxs("div",{className:"flex",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:v.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),v.jsxs("div",{className:"ml-3",children:[v.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Connection Error"}),v.jsx("p",{className:"text-sm text-red-700 mt-1",children:w})]})]})})}),v.jsx("div",{ref:e,className:"map-container rounded-lg"}),v.jsxs(Rt.div,{initial:{x:-400},animate:{x:be?-350:0},transition:{duration:.3,ease:"easeInOut"},className:"absolute top-4 left-4 z-30",children:[v.jsx("button",{onClick:()=>Ce(!be),className:"absolute -right-12 top-0 p-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg hover:bg-white/20 transition-all duration-200 z-40",children:v.jsx("svg",{className:`w-5 h-5 text-white transition-transform duration-200 ${be?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),v.jsxs(fd,{variant:"premium",glow:!0,className:"w-80 max-h-[calc(100vh-2rem)] overflow-hidden",children:[v.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/20",children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),v.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Student Live Tracking"})]}),v.jsx("div",{className:"text-xs text-gray-600 bg-white/50 px-2 py-1 rounded",children:"Live Map"})]}),v.jsxs("div",{className:"p-4 space-y-4 max-h-[calc(100vh-8rem)] overflow-y-auto",children:[v.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50/80 rounded-lg border border-blue-200/50",children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("div",{className:`w-2 h-2 rounded-full ${m?"bg-green-500 animate-pulse":"bg-red-500"}`}),v.jsx("span",{className:"text-sm text-gray-800 font-medium",children:m?"Live Connected":"Offline"})]}),v.jsxs("span",{className:"text-xs text-gray-600 bg-white/70 px-2 py-1 rounded",children:[Nt.length," buses"]})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Route Filter"}),v.jsx("button",{onClick:()=>rt(!Te),className:"p-1 hover:bg-gray-100 rounded transition-colors duration-200",children:v.jsx("svg",{className:`w-4 h-4 text-gray-600 transition-transform duration-200 ${Te?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),v.jsx(tu,{children:Te&&v.jsxs(Rt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"space-y-3",children:[v.jsxs("select",{value:de,onChange:we=>G(we.target.value),className:"w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-all duration-200",children:[v.jsxs("option",{value:"all",children:["All Routes (",Y.length,")"]}),Ye.map(we=>v.jsx("option",{value:we.id,children:we.name},we.id))]}),v.jsxs("button",{onClick:vt,disabled:Nt.length===0,className:"w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 border border-blue-600 rounded-lg text-white font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:["📍 Center on Buses (",Nt.length,")"]})]})})]}),v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("h3",{className:"text-sm font-semibold text-gray-800",children:"Active Buses"}),v.jsx("button",{onClick:()=>St(!Ue),className:"p-1 hover:bg-gray-100 rounded transition-colors duration-200",children:v.jsx("svg",{className:`w-4 h-4 text-gray-600 transition-transform duration-200 ${Ue?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),v.jsx(tu,{children:Ue&&v.jsx(Rt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"space-y-2 max-h-64 overflow-y-auto",children:Nt.length===0?v.jsxs("div",{className:"text-center py-4",children:[v.jsx("div",{className:"text-gray-400 text-2xl mb-2",children:"🚌"}),v.jsx("p",{className:"text-gray-600 text-sm",children:"No buses tracking"}),v.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Check connection status"})]}):Nt.map(we=>{const tt=ue[we.busId];return v.jsxs(Rt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-blue-300 cursor-pointer transition-all duration-200 shadow-sm",onClick:()=>{const kt=ue[we.busId];if(kt&&r.current){r.current.flyTo({center:[kt.longitude,kt.latitude],zoom:16,duration:1e3});const Ht=n.current[we.busId];Ht&&Ht.getPopup().addTo(r.current)}},children:[v.jsxs("div",{className:"flex items-center justify-between mb-2",children:[v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),v.jsx("span",{className:"font-medium text-sm text-gray-800",children:we.busNumber}),v.jsx("span",{className:"text-xs text-blue-600 opacity-75",children:"👆"})]}),v.jsx("div",{className:"text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded",children:we.eta?`${we.eta} min`:"ETA: --"})]}),v.jsxs("div",{className:"space-y-1",children:[v.jsxs("div",{className:"text-xs text-gray-600",children:["📍 Route: ",we.routeName]}),v.jsxs("div",{className:"text-xs text-gray-600",children:["👨‍💼 Driver: ",we.driverName]}),tt&&v.jsxs("div",{className:"flex items-center justify-between text-xs",children:[v.jsxs("span",{className:"text-green-600",children:["🕐"," ",new Date(tt.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),v.jsx("span",{className:"text-blue-600",children:tt.speed?`${tt.speed} km/h`:"Speed: --"})]})]})]},we.busId)})})})]})]})]})]})]})},B5=({children:t,variant:e="primary",size:r="md",className:n="",onClick:c,disabled:d=!1,loading:m=!1,icon:l,iconPosition:w="left"})=>{const k="relative inline-flex items-center justify-center font-semibold rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden",P={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg",xl:"px-10 py-5 text-xl"},j={primary:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white shadow-lg hover:shadow-xl hover:shadow-blue-500/25 focus:ring-blue-400",secondary:"bg-white/10 backdrop-blur-sm border border-white/20 text-white hover:bg-white/20 hover:border-white/30 shadow-lg hover:shadow-xl focus:ring-white/20",danger:"bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-500 hover:to-pink-500 text-white shadow-lg hover:shadow-xl hover:shadow-red-500/25 focus:ring-red-400",ghost:"bg-transparent text-white hover:bg-white/10 border border-transparent hover:border-white/20 focus:ring-white/20",gradient:"bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 hover:from-purple-500 hover:via-pink-500 hover:to-red-500 text-white shadow-lg hover:shadow-xl hover:shadow-purple-500/25 focus:ring-purple-400"};return v.jsxs(Rt.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:c,disabled:d||m,className:`
        ${k}
        ${P[r]}
        ${j[e]}
        hover:-translate-y-0.5 active:translate-y-0
        ${n}
      `,children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 via-transparent to-white/10 opacity-0 hover:opacity-100 transition-opacity duration-300"}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full hover:translate-x-full transition-transform duration-700"}),v.jsxs("div",{className:"relative z-10 flex items-center gap-2",children:[m&&v.jsx(Rt.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full"}),l&&w==="left"&&!m&&v.jsx("span",{className:"flex-shrink-0",children:l}),v.jsx("span",{children:t}),l&&w==="right"&&!m&&v.jsx("span",{className:"flex-shrink-0",children:l})]})]})};function lA({onLoginSuccess:t}){const e=Jm(),{setTransition:r}=ug(),[n,c]=re.useState(!1),[d,m]=re.useState(null),[l,w]=re.useState(""),[k,P]=re.useState(""),[j,L]=re.useState(""),[Z,Y]=re.useState(null);re.useEffect(()=>{setTimeout(async()=>{try{console.log("🔄 Attempting automatic session recovery...");const ue=await tr.recoverSession();ue.success&&tr.isAdmin()?(console.log("✅ Session recovered, redirecting to admin panel"),de()):console.log("📝 Session recovery failed or user is not admin:",ue.error)}catch(ue){console.log("📝 No valid session to recover:",ue)}},1e3)},[]);const ce=async W=>{W.preventDefault(),c(!0),m(null),Y(null);try{const ue=new Promise((Ce,Te)=>{setTimeout(()=>Te(new Error("Login timeout")),15e3)}),me=tr.signIn(l,k),be=await Promise.race([me,ue]);be.success&&be.user?be.user.role==="admin"?(Y("Login successful! Redirecting to admin dashboard..."),setTimeout(()=>{de()},1500)):(m("Access denied. Admin privileges required."),await tr.signOut()):m(be.error||"Login failed. Please check your credentials.")}catch(ue){console.error("❌ Login error:",ue),ue instanceof Error&&ue.message==="Login timeout"?m("Login timed out. This might be due to slow network or profile loading. Please try again."):ue instanceof Error&&ue.message.includes("environment variables")?m("Configuration error. Please check your environment setup."):ue instanceof Error&&ue.message.includes("Profile loading timeout")?m("Profile loading is taking longer than expected. Please try again."):m("Network error. Please check your connection and try again.")}finally{c(!1)}},de=()=>{r("login-to-dashboard"),t?t():e("/admin-dashboard")},G=async()=>{c(!0),m(null);try{(await tr.recoverSession()).success&&tr.isAdmin()?(Y("Session recovered! Redirecting..."),setTimeout(()=>{de()},1e3)):m("No valid session found. Please log in again.")}catch{m("Session recovery failed. Please log in again.")}finally{c(!1)}},H=async()=>{c(!0),m(null);try{await tr.forceFreshLogin(),Y("Session cleared. Please log in again with your credentials.")}catch{m("Failed to clear session.")}finally{c(!1)}};return v.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4 relative overflow-hidden",children:[v.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[v.jsx("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob"}),v.jsx("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-2000"}),v.jsx("div",{className:"absolute top-40 left-40 w-80 h-80 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-blob animation-delay-4000"})]}),v.jsx("div",{className:"absolute inset-0",children:[...Array(20)].map((W,ue)=>v.jsx(Rt.div,{className:"absolute w-1 h-1 bg-white/30 rounded-full",animate:{x:[0,100,0],y:[0,-100,0],opacity:[0,1,0]},transition:{duration:Math.random()*10+10,repeat:1/0,delay:Math.random()*5},style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`}},ue))}),v.jsx(Rt.div,{initial:{opacity:0,y:50,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{duration:.8,ease:[.4,0,.2,1]},className:"w-full max-w-md relative z-10",children:v.jsxs(fd,{variant:"ultra",glow:!0,className:"p-8 relative",children:[v.jsxs(Rt.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.2,duration:.6},className:"text-center mb-8",children:[v.jsxs("div",{className:"mx-auto h-16 w-16 flex items-center justify-center rounded-full bg-gradient-to-br from-purple-500 to-blue-500 mb-4 relative",children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full blur-lg opacity-50"}),v.jsx("svg",{className:"h-8 w-8 text-white relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),v.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-white to-blue-200 bg-clip-text text-transparent",children:"Admin Login"}),v.jsx("p",{className:"text-blue-200/80 mt-2 text-sm",children:"Access the administrative dashboard"})]}),v.jsxs(Rt.form,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4,duration:.6},onSubmit:ce,className:"space-y-6",children:[v.jsxs(Rt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5,duration:.6},children:[v.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-blue-200 mb-2",children:"Email Address"}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:l,onChange:W=>w(W.target.value),className:"w-full px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-blue-200/50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300",placeholder:"admin@university.edu",disabled:n}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-xl opacity-0 hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]})]}),v.jsxs(Rt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6,duration:.6},children:[v.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-blue-200 mb-2",children:"Password"}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:k,onChange:W=>P(W.target.value),className:"w-full px-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-xl text-white placeholder-blue-200/50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-300",placeholder:"••••••••",disabled:n}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-xl opacity-0 hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]})]}),v.jsxs(Rt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.7,duration:.6},children:[v.jsxs("label",{htmlFor:"twoFactorCode",className:"block text-sm font-medium text-blue-200/80 mb-2",children:["2FA Code ",v.jsx("span",{className:"text-blue-200/50",children:"(Optional)"})]}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{id:"twoFactorCode",name:"twoFactorCode",type:"text",autoComplete:"one-time-code",value:j,onChange:W=>L(W.target.value),className:"w-full px-4 py-3 bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl text-white placeholder-blue-200/30 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:border-transparent transition-all duration-300",placeholder:"Enter 2FA code if enabled",disabled:n}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/5 to-purple-500/5 rounded-xl opacity-0 hover:opacity-100 transition-opacity duration-300 pointer-events-none"})]})]}),v.jsx(tu,{children:n&&v.jsx(Rt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"text-center",children:v.jsxs("div",{className:"inline-flex items-center px-4 py-2 text-sm text-blue-200 bg-blue-500/20 backdrop-blur-sm border border-blue-400/30 rounded-xl",children:[v.jsx(Rt.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-blue-300/30 border-t-blue-300 rounded-full mr-3"}),"Signing in and loading profile..."]})})}),v.jsx(tu,{children:d&&v.jsx(Rt.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-xl p-4",children:v.jsxs("div",{className:"flex",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:v.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),v.jsxs("div",{className:"ml-3",children:[v.jsx("h3",{className:"text-sm font-medium text-red-300",children:"Login Error"}),v.jsx("p",{className:"text-sm text-red-200 mt-1",children:d})]})]})})}),v.jsx(tu,{children:Z&&v.jsx(Rt.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"bg-green-500/20 backdrop-blur-sm border border-green-400/30 rounded-xl p-4",children:v.jsxs("div",{className:"flex",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:v.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),v.jsxs("div",{className:"ml-3",children:[v.jsx("h3",{className:"text-sm font-medium text-green-300",children:"Success"}),v.jsx("p",{className:"text-sm text-green-200 mt-1",children:Z})]})]})})}),v.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.6},children:v.jsx(B5,{variant:"gradient",size:"lg",className:"w-full relative group",disabled:n,loading:n,icon:v.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:n?"Signing In...":"Admin Login"})}),v.jsxs(Rt.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.9,duration:.6},className:"text-center space-y-3",children:[v.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center text-xs",children:[v.jsx("button",{type:"button",onClick:G,disabled:n,className:"text-blue-300 hover:text-blue-200 underline transition-colors duration-200",children:"Recover Session"}),v.jsx("span",{className:"hidden sm:inline text-blue-200/50",children:"•"}),v.jsx("button",{type:"button",onClick:H,disabled:n,className:"text-red-300 hover:text-red-200 underline transition-colors duration-200",children:"Force Fresh Login"})]}),v.jsxs("div",{className:"text-xs text-blue-200/50 space-y-1",children:[v.jsx("p",{children:"Enter your admin credentials to access the system"}),v.jsx("p",{children:"Using Supabase Authentication"})]})]})]})]})})]})}const O5=vu.api.url;class F5{async makeRequest(e,r={}){let n;try{const c=tr.getAccessToken();if(console.log("🔑 Token check for",e,":",c?"Token exists":"No token"),!c)throw console.error("❌ No access token available for",e),new Error("No access token available");const d=new AbortController;n=setTimeout(()=>d.abort(),15e3);const m=await fetch(`${O5}/admin${e}`,{...r,signal:d.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`,...r.headers}}),l=await m.json();if(n&&clearTimeout(n),!m.ok)throw m.status===429?new Error("Rate limit exceeded. Please wait a moment and try again."):m.status===401?new Error("Authentication required. Please log in again."):m.status===403?new Error("Access denied. You do not have permission for this action."):m.status===404?new Error("Resource not found."):m.status===409?new Error(l.message||"Resource already exists"):m.status>=500?new Error("Server error. Please try again later."):new Error(l.message||l.error||"Request failed");return l}catch(c){return n&&clearTimeout(n),console.error(`❌ API request failed for ${e}:`,c),{success:!1,error:c instanceof Error?c.message:"Request failed"}}}async getAnalytics(){return this.makeRequest("/analytics")}async getSystemHealth(){return this.makeRequest("/health")}async getAllBuses(){var r;console.log("🚌 Fetching all buses...");const e=await this.makeRequest("/buses");return console.log("🚌 Buses result:",e.success?`${((r=e.data)==null?void 0:r.length)||0} buses`:e.error),e}async getBusById(e){return this.makeRequest(`/buses/${e}`)}async createBus(e){return this.makeRequest("/buses",{method:"POST",body:JSON.stringify(e)})}async updateBus(e,r){return this.makeRequest(`/buses/${e}`,{method:"PUT",body:JSON.stringify(r)})}async deleteBus(e){return this.makeRequest(`/buses/${e}`,{method:"DELETE"})}async getAllDrivers(){var r;console.log("👨‍💼 Fetching all drivers...");const e=await this.makeRequest("/drivers");return console.log("👨‍💼 Drivers result:",e.success?`${((r=e.data)==null?void 0:r.length)||0} drivers`:e.error),e}async getAssignedDrivers(){var r;console.log("🚌 Fetching assigned drivers...");const e=await this.makeRequest("/assigned-drivers");return console.log("🚌 Assigned drivers result:",e.success?`${((r=e.data)==null?void 0:r.length)||0} assigned drivers`:e.error),e}async getDriverById(e){return this.makeRequest(`/drivers/${e}`)}async assignDriverToBus(e,r){return this.makeRequest(`/drivers/${e}/assign-bus`,{method:"POST",body:JSON.stringify({busId:r})})}async unassignDriverFromBus(e){return this.makeRequest(`/drivers/${e}/unassign-bus`,{method:"POST"})}async createDriver(e){return this.makeRequest("/drivers",{method:"POST",body:JSON.stringify(e)})}async updateDriver(e,r){return this.makeRequest(`/drivers/${e}`,{method:"PUT",body:JSON.stringify(r)})}async deleteDriver(e){return this.makeRequest(`/drivers/${e}`,{method:"DELETE"})}async getAllRoutes(){var r;console.log("🛣️ Fetching all routes...");const e=await this.makeRequest("/routes");return console.log("🛣️ Routes result:",e.success?`${((r=e.data)==null?void 0:r.length)||0} routes`:e.error),e}async getRouteById(e){return this.makeRequest(`/routes/${e}`)}async createRoute(e){return this.makeRequest("/routes",{method:"POST",body:JSON.stringify(e)})}async updateRoute(e,r){return this.makeRequest(`/routes/${e}`,{method:"PUT",body:JSON.stringify(r)})}async deleteRoute(e){return this.makeRequest(`/routes/${e}`,{method:"DELETE"})}}const Hr=new F5,Uh="http://localhost:3000";class Lp{static async makeRequest(e,r={}){let n=tr.getAccessToken();if(!n&&tr.isAuthenticated()){console.log("🔄 No token found but user is authenticated, attempting to refresh session...");const d=await tr.refreshSession();if(d.success)n=tr.getAccessToken(),console.log("✅ Session refreshed, new token obtained");else throw console.error("❌ Failed to refresh session:",d.error),new Error("Authentication required")}const c={"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}};return fetch(`${Uh}${e}`,{...r,headers:{...c,...r.headers}})}static async uploadBusImage(e,r){try{console.log("🔐 Getting access token...");const n=tr.getAccessToken();if(!n)return console.error("❌ No access token available"),{success:!1,error:"Authentication required"};console.log("✅ Access token obtained");const c=new FormData;c.append("image",r),c.append("busId",e),console.log("📤 Sending request to:",`${Uh}/storage/upload/bus-image`),console.log("📋 FormData contents:",{busId:e,fileName:r.name,fileSize:r.size,fileType:r.type});const d=await fetch(`${Uh}/storage/upload/bus-image`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:c});if(console.log("📥 Response status:",d.status),console.log("📥 Response headers:",Object.fromEntries(d.headers.entries())),!d.ok){const l=await d.json();return console.error("❌ Upload failed:",l),{success:!1,error:l.error||"Upload failed"}}const m=await d.json();return console.log("✅ Upload successful:",m),{success:!0,url:m.url,fileName:m.fileName}}catch(n){return console.error("❌ Upload bus image error:",n),{success:!1,error:"Network error during upload"}}}static async uploadDriverPhoto(e,r){try{const n=tr.getAccessToken();if(!n)return{success:!1,error:"Authentication required"};const c=new FormData;c.append("photo",r),c.append("driverId",e);const d=await fetch(`${Uh}/storage/upload/driver-photo`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:c});if(!d.ok)return{success:!1,error:(await d.json()).error||"Upload failed"};const m=await d.json();return{success:!0,url:m.url,fileName:m.fileName}}catch(n){return console.error("Upload driver photo error:",n),{success:!1,error:"Network error during upload"}}}static async uploadRouteMap(e,r){try{const n=tr.getAccessToken();if(!n)return{success:!1,error:"Authentication required"};const c=new FormData;c.append("map",r),c.append("routeId",e);const d=await fetch(`${Uh}/storage/upload/route-map`,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:c});if(!d.ok)return{success:!1,error:(await d.json()).error||"Upload failed"};const m=await d.json();return{success:!0,url:m.url,fileName:m.fileName}}catch(n){return console.error("Upload route map error:",n),{success:!1,error:"Network error during upload"}}}static async getSignedUrl(e,r){try{const n=await this.makeRequest(`/storage/signed-url/${e}/${r}`);if(!n.ok)return{success:!1,error:(await n.json()).error||"Failed to get signed URL"};const c=await n.json();return{success:!0,signedUrl:c.signedUrl,expiresIn:c.expiresIn}}catch(n){return console.error("Get signed URL error:",n),{success:!1,error:"Network error"}}}static async deleteFile(e,r,n){try{const c=await this.makeRequest(`/storage/delete/${e}/${r}`,{method:"DELETE",body:JSON.stringify({fileUrl:n})});return c.ok?{success:!0}:{success:!1,error:(await c.json()).error||"Delete failed"}}catch(c){return console.error("Delete file error:",c),{success:!1,error:"Network error during deletion"}}}static async getFileInfo(e,r){try{const n=await this.makeRequest(`/storage/info/${e}/${r}`);if(!n.ok)return{success:!1,hasFile:!1,error:(await n.json()).error||"Failed to get file info"};const c=await n.json();return{success:!0,hasFile:c.hasFile,url:c.url,info:c.info}}catch(n){return console.error("Get file info error:",n),{success:!1,hasFile:!1,error:"Network error"}}}static async listFiles(e){try{const r=await this.makeRequest(`/storage/list/${e}`);return r.ok?{success:!0,files:(await r.json()).files}:{success:!1,error:(await r.json()).error||"Failed to list files"}}catch(r){return console.error("List files error:",r),{success:!1,error:"Network error"}}}static validateFile(e,r,n){return e?r.includes(e.type)?e.size>n?{isValid:!1,error:`File too large. Maximum size: ${n/(1024*1024)}MB`}:{isValid:!0}:{isValid:!1,error:`Invalid file type. Allowed types: ${r.join(", ")}`}:{isValid:!1,error:"No file selected"}}static validateImage(e){const r=["image/jpeg","image/jpg","image/png","image/webp"];return this.validateFile(e,r,5242880)}static validateDocument(e){const r=["application/pdf","image/jpeg","image/jpg","image/png"];return this.validateFile(e,r,10485760)}}function $5(){const[t,e]=re.useState("bus"),[r,n]=re.useState([]),[c,d]=re.useState([]),[m,l]=re.useState([]),[w,k]=re.useState(!0),[P,j]=re.useState(!1),[L,Z]=re.useState(null),[Y,ce]=re.useState(""),[de,G]=re.useState(null),[H,W]=re.useState(null);re.useEffect(()=>{ue()},[]);const ue=async()=>{k(!0),G(null);try{const[Oe,it,qe]=await Promise.all([Hr.getAllBuses(),Hr.getAllDrivers(),Hr.getAllRoutes()]);if(Oe.success&&Oe.data&&n(Oe.data),it.success&&it.data){const Et=new Map;it.data.forEach(vt=>{const Be=vt.id;if(!Et.has(Be))Et.set(Be,vt);else{const st=Et.get(Be);(!st.email&&vt.email||st.email&&vt.email&&!st.first_name&&vt.first_name)&&Et.set(Be,vt)}});const ir=Array.from(Et.values());d(ir)}qe.success&&qe.data&&l(qe.data)}catch(Oe){G("Failed to load data"),console.error("❌ Data loading error:",Oe)}finally{k(!1)}},me=Oe=>{var qe;const it=(qe=Oe.target.files)==null?void 0:qe[0];it&&(Z(it),G(null))},be=async()=>{if(!L||!Y){G("Please select a file and an item");return}console.log("🚀 Starting upload...",{activeTab:t,selectedItem:Y,fileName:L.name,fileSize:L.size,fileType:L.type}),j(!0),G(null),W(null);try{let Oe;switch(t){case"bus":console.log("📤 Uploading bus image..."),Oe=await Lp.uploadBusImage(Y,L);break;case"driver":console.log("📤 Uploading driver photo..."),Oe=await Lp.uploadDriverPhoto(Y,L);break;case"route":console.log("📤 Uploading route map..."),Oe=await Lp.uploadRouteMap(Y,L);break}console.log("📥 Upload result:",Oe),Oe.success?(W("File uploaded successfully!"),Z(null),ce(""),ue()):(G(Oe.error||"Upload failed"),console.error("❌ Upload failed:",Oe.error))}catch(Oe){G("Upload failed. Please try again."),console.error("❌ Upload error:",Oe)}finally{j(!1)}},Ce=async(Oe,it)=>{if(confirm("Are you sure you want to delete this file?"))try{const qe=await Lp.deleteFile(t,Oe,it);qe.success?(W("File deleted successfully!"),ue()):G(qe.error||"Delete failed")}catch(qe){G("Delete failed. Please try again."),console.error("❌ Delete error:",qe)}},Te=()=>{switch(t){case"bus":return r;case"driver":return c;case"route":return m;default:return[]}},rt=Oe=>{switch(t){case"bus":return Oe.number_plate;case"driver":{const it=Oe;return`${it.first_name} ${it.last_name}`}case"route":return Oe.name;default:return"Unknown"}},Ue=Oe=>{let it=null;switch(t){case"bus":it=Oe.bus_image_url||null;break;case"driver":it=Oe.profile_photo_url||null;break;case"route":it=Oe.route_map_url||null;break;default:return null}return it?it.startsWith("http")?it:it.includes("/")?`https://gthwmwfwvhyriygpcdlr.supabase.co/storage/v1/object/public/bus-tracking-media/${it}`:it:null},St=()=>{switch(t){case"bus":return"Bus Images";case"driver":return"Driver Photos";case"route":return"Route Maps";default:return"Media"}};return w?v.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"}),v.jsx("p",{className:"mt-4 text-gray-600",children:"Loading media management..."})]})}):v.jsx("div",{className:"min-h-screen bg-gray-50",children:v.jsx("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:v.jsx("div",{className:"px-4 py-6 sm:px-0",children:v.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Media Management"}),de&&v.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-4",children:v.jsx("p",{className:"text-red-700",children:de})}),H&&v.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-md p-4",children:v.jsx("p",{className:"text-green-700",children:H})}),v.jsx("div",{className:"border-b border-gray-200 mb-6",children:v.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"bus",name:"Bus Images"},{id:"driver",name:"Driver Photos"},{id:"route",name:"Route Maps"}].map(Oe=>v.jsx("button",{onClick:()=>e(Oe.id),className:`py-2 px-1 border-b-2 font-medium text-sm ${t===Oe.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:Oe.name},Oe.id))})}),v.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mb-6",children:[v.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Upload ",St()]}),v.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select File"}),v.jsx("input",{type:"file",onChange:me,accept:t==="route"?".pdf,.jpg,.jpeg,.png":".jpg,.jpeg,.png,.webp",className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100"}),L&&v.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Selected: ",L.name," (",(L.size/1024/1024).toFixed(2)," MB)"]})]}),v.jsxs("div",{children:[v.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select"," ",t==="bus"?"Bus":t==="driver"?"Driver":"Route"]}),v.jsxs("select",{value:Y,onChange:Oe=>ce(Oe.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500",children:[v.jsx("option",{value:"",children:"Choose..."}),Te().map(Oe=>v.jsx("option",{value:Oe.id||"",children:rt(Oe)},Oe.id||"temp"))]})]}),v.jsx("div",{className:"flex items-end",children:v.jsx("button",{onClick:be,disabled:!L||!Y||P,className:"w-full bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:P?"Uploading...":"Upload"})})]})]}),v.jsxs("div",{children:[v.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Current ",St()]}),Te().length===0?v.jsx("p",{className:"text-gray-500 text-center py-8",children:"No items found."}):v.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Te().map(Oe=>{const it=Ue(Oe),qe=rt(Oe);return v.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[v.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:qe}),it?v.jsxs("div",{children:[v.jsx("div",{className:"mb-3",children:t!=="route"?v.jsx("img",{src:it,alt:qe,className:"w-full h-32 object-cover rounded-md",onError:Et=>{Et.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5Y2EzYWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBVbmF2YWlsYWJsZTwvdGV4dD48L3N2Zz4="}}):v.jsx("div",{className:"w-full h-32 bg-gray-100 rounded-md flex items-center justify-center",children:v.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})})}),v.jsxs("div",{className:"flex space-x-2",children:[v.jsx("button",{onClick:()=>window.open(it,"_blank"),className:"flex-1 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors",children:"View"}),v.jsx("button",{onClick:()=>Oe.id&&Ce(Oe.id,it),className:"flex-1 bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors",disabled:!Oe.id,children:"Delete"})]})]}):v.jsxs("div",{className:"text-center py-4",children:[v.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"No file uploaded"}),v.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:v.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]})]},Oe.id||"temp")})})]})]})})})})}const ji={name:"Ganpat University",coordinates:[72.4563,23.5295],address:"Ganpat Vidyanagar, Mehsana-Gozaria Highway, Kherva, Gujarat 384012",city:"Mehsana"},U5=({onLocationSelect:t,onClose:e,title:r,defaultCenter:n=ji.coordinates,searchPlaceholder:c="Search for a location..."})=>{const d=sx.useRef(Math.random().toString(36).substr(2,9)),m=re.useRef(null),l=re.useRef(null),w=re.useRef(null),[k,P]=re.useState(""),[j,L]=re.useState(null),[Z,Y]=re.useState(!0),[ce,de]=re.useState(null);re.useEffect(()=>{if(!(!m.current||l.current))return console.log(`🗺️ [${d.current}] Initializing map with center:`,n),console.log(`🗺️ [${d.current}] Ganpat University coordinates:`,ji.coordinates),l.current=new gi.Map({container:m.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm",minzoom:0,maxzoom:22}]},center:ji.coordinates,zoom:12,preserveDrawingBuffer:!0,antialias:!1,maxZoom:18,minZoom:5,maxPitch:0,pitch:0}),l.current.on("load",()=>{var me;console.log("🗺️ Map loaded, adding controls and marker");try{(me=l.current)==null||me.addControl(new gi.NavigationControl),w.current=new gi.Marker({draggable:!0,color:"#3B82F6"}).setLngLat(n).addTo(l.current),l.current.flyTo({center:ji.coordinates,zoom:12,duration:1e3}),L({name:ji.name,coordinates:ji.coordinates,address:ji.address}),w.current.on("dragend",()=>{var Ce;const be=(Ce=w.current)==null?void 0:Ce.getLngLat();be&&G([be.lng,be.lat])}),console.log(`🗺️ [${d.current}] Map centered on ${ji.name}`),Y(!1)}catch(be){console.error("❌ Error setting up map:",be),de("Failed to initialize map"),Y(!1)}}),l.current.on("error",me=>{console.error("❌ Map error:",me),de("Map failed to load"),Y(!1)}),l.current.on("click",me=>{var Ce;const be=[me.lngLat.lng,me.lngLat.lat];(Ce=w.current)==null||Ce.setLngLat(be),G(be)}),l.current.on("webglcontextlost",()=>{console.warn("⚠️ WebGL context lost, attempting to restore...")}),l.current.on("webglcontextrestored",()=>{console.log("✅ WebGL context restored")}),()=>{if(l.current){console.log("🗺️ Cleaning up map instance");try{l.current.off("load",()=>{}),l.current.off("click",()=>{}),l.current.off("error",()=>{}),l.current.off("webglcontextlost",()=>{}),l.current.off("webglcontextrestored",()=>{}),w.current&&w.current.remove(),l.current.remove()}catch(me){console.warn("⚠️ Error during map cleanup:",me)}finally{l.current=null,w.current=null}}}},[n]);const G=async me=>{try{const Ce=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${me[1]}&lon=${me[0]}&zoom=18&addressdetails=1`)).json(),Te={name:Ce.display_name.split(",")[0]||"Selected Location",coordinates:me,address:Ce.display_name};L(Te)}catch(be){console.error("Error reverse geocoding:",be),L({name:"Selected Location",coordinates:me,address:`${me[1]}, ${me[0]}`})}},H=async()=>{var me;if(!(!k.trim()||!l.current))try{console.log("🔍 Searching for:",k);const Ce=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(k)}&limit=5&countrycodes=in`)).json();if(console.log("🔍 Search results:",Ce),Ce.length>0){const Te=Ce[0],rt=[parseFloat(Te.lon),parseFloat(Te.lat)];console.log("🗺️ Flying to coordinates:",rt),l.current.flyTo({center:rt,zoom:15}),(me=w.current)==null||me.setLngLat(rt);const Ue={name:Te.display_name.split(",")[0]||k,coordinates:rt,address:Te.display_name};L(Ue)}else console.log("🔍 No search results found")}catch(be){console.error("❌ Error searching location:",be)}},W=()=>{j&&(t(j),e())},ue=me=>{me.key==="Enter"&&H()};return v.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:v.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl h-[80vh] flex flex-col",children:[v.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[v.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:r}),v.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:v.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:v.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),v.jsxs("div",{className:"p-4 border-b",children:[v.jsxs("div",{className:"flex gap-2 mb-2",children:[v.jsx("input",{type:"text",value:k,onChange:me=>P(me.target.value),onKeyPress:ue,placeholder:c,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),v.jsx("button",{onClick:H,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Search"})]}),v.jsx("div",{className:"flex gap-2",children:v.jsx("button",{onClick:()=>{var me;l.current&&(console.log("🏫 Resetting to Ganpat University at coordinates:",ji.coordinates),l.current.flyTo({center:ji.coordinates,zoom:12}),(me=w.current)==null||me.setLngLat(ji.coordinates),L({name:ji.name,coordinates:ji.coordinates,address:ji.address}))},className:"px-3 py-1 text-sm bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"🏫 Reset to Ganpat University"})})]}),v.jsxs("div",{className:"flex-1 relative",children:[Z&&v.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),v.jsx("p",{className:"text-gray-600",children:"Loading map..."})]})}),ce&&v.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-50 z-10",children:v.jsxs("div",{className:"text-center",children:[v.jsxs("p",{className:"text-red-600 mb-2",children:["⚠️ ",ce]}),v.jsx("button",{onClick:()=>{de(null),Y(!0),l.current&&(l.current.remove(),l.current=null,w.current=null);const me=m.current;me&&(me.innerHTML="")},className:"px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry"})]})}),v.jsx("div",{ref:m,className:"w-full h-full"})]}),j&&v.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[v.jsxs("div",{className:"mb-4",children:[v.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Selected Location:"}),v.jsx("p",{className:"text-gray-700 font-medium",children:j.name}),j.address&&v.jsx("p",{className:"text-sm text-gray-600 mt-1",children:j.address}),v.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Coordinates: ",j.coordinates[1].toFixed(6),","," ",j.coordinates[0].toFixed(6)]})]}),v.jsxs("div",{className:"flex gap-2",children:[v.jsx("button",{onClick:W,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Confirm Selection"}),v.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"})]})]})]})})};function V5(){const[t,e]=re.useState("buses"),[r,n]=re.useState(!1),[c,d]=re.useState(null),[m,l]=re.useState(null),[w,k]=re.useState([]),[P,j]=re.useState([]),[L,Z]=re.useState([]),[Y,ce]=re.useState([]),[de,G]=re.useState(!1),[H,W]=re.useState(!1),[ue,me]=re.useState(!1),[be,Ce]=re.useState(!1),[Te,rt]=re.useState(!1),[Ue,St]=re.useState(!1),[Oe,it]=re.useState(null),[qe,Et]=re.useState(null),[ir,vt]=re.useState(!1),[Be,st]=re.useState(!1),[Fe,Ct]=re.useState({code:"",number_plate:"",capacity:50,model:"",year:new Date().getFullYear(),is_active:!0}),[Nt,Ye]=re.useState({email:"",first_name:"",last_name:"",phone:"",role:"driver",assigned_bus_id:""}),[we,tt]=re.useState({email:"",first_name:"",last_name:"",phone:"",password:"",confirm_password:""}),[kt,Ht]=re.useState(!1),[yt,_t]=re.useState(!1),[ur,Ds]=re.useState(""),[It,qr]=re.useState({name:"",description:"",distance_km:"",estimated_duration_minutes:"",is_active:!0,city:""}),[Fi,kn]=re.useState(!1),[bi,rn]=re.useState("destination"),[os,sn]=re.useState(null),[Pe,fs]=re.useState(null),ls=re.useCallback(async()=>{n(!0),d(null);try{const[I,O,V]=await Promise.all([Hr.getAllBuses(),Hr.getAllDrivers(),Hr.getAllRoutes()]);if(I.success&&I.data&&k(I.data),O.success&&O.data){const K=new Map;O.data.forEach(pe=>{const he=pe.id;if(!K.has(he))K.set(he,pe);else{const oe=K.get(he);(!oe.email&&pe.email||oe.email&&pe.email&&!oe.first_name&&pe.first_name)&&K.set(he,pe)}});const te=Array.from(K.values());j(te)}V.success&&V.data&&ce(V.data),await nr(),(!I.success||!O.success||!V.success)&&d("Failed to load some data")}catch(I){d("An error occurred while loading data"),console.error("❌ Data loading error:",I)}finally{n(!1)}},[]);re.useEffect(()=>{ls()},[ls]);const nr=async()=>{try{const I=await Hr.getAssignedDrivers();if(I.success&&I.data){const O=new Map;I.data.forEach(K=>{const te=K.driver_id;if(!O.has(te))O.set(te,K);else{const pe=O.get(te);(!pe.driver_email&&K.driver_email||pe.driver_email&&K.driver_email&&!pe.driver_name&&K.driver_name)&&O.set(te,K)}});const V=Array.from(O.values());Z(V)}else console.warn("⚠️ Failed to load assigned drivers:",I.error),Z([])}catch(I){console.warn("⚠️ Failed to load assigned drivers:",I),Z([])}},Wt=async I=>{if(I.preventDefault(),n(!0),d(null),w.find(V=>V.code===Fe.code||V.number_plate===Fe.number_plate)){d(`Bus with code '${Fe.code}' or number plate '${Fe.number_plate}' already exists`),n(!1);return}try{const V=await Hr.createBus(Fe);V.success&&V.data?(k([...w,V.data]),Ct({code:"",number_plate:"",capacity:50,model:"",year:new Date().getFullYear(),is_active:!0}),G(!1),l("Bus created successfully!"),setTimeout(()=>l(null),3e3)):d(V.error||"Failed to create bus")}catch{d("An error occurred while creating bus")}finally{n(!1)}},wi=async I=>{if(confirm("Are you sure you want to delete this bus?")){n(!0),d(null);try{const O=await Hr.deleteBus(I);O.success?(k(w.filter(V=>V.id!==I)),l("Bus deleted successfully!"),setTimeout(()=>l(null),3e3)):d(O.error||"Failed to delete bus")}catch{d("An error occurred while deleting bus")}finally{n(!1)}}},Zn=async(I,O)=>{n(!0),d(null);try{const V=await Hr.updateBus(I,{route_id:O});V.success&&V.data?(k(w.map(K=>K.id===I?{...K,route_id:O}:K)),l("Route assigned to bus successfully!"),setTimeout(()=>l(null),3e3)):d(V.error||"Failed to assign route to bus")}catch{d("An error occurred while assigning route to bus")}finally{n(!1)}},$i=async I=>{if(I.preventDefault(),n(!0),d(null),!we.email||!we.first_name||!we.last_name||!we.password){d("All fields are required: Email, First Name, Last Name, and Password"),n(!1);return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(we.email)){d("Please enter a valid email address"),n(!1);return}if(we.password!==we.confirm_password){d("Passwords do not match"),n(!1);return}if(we.password.length<6){d("Password must be at least 6 characters long"),n(!1);return}if(P.find(K=>K.email===we.email)){d("Driver with this email already exists"),n(!1);return}if(!r)try{const K={email:we.email,first_name:we.first_name,last_name:we.last_name,phone:we.phone,role:"driver",password:we.password},te=await Hr.createDriver(K);if(te.success&&te.data){const pe=await Hr.getAllDrivers();if(pe.success&&pe.data){const he=new Map;pe.data.forEach(ge=>{const Ie=ge.id;if(!he.has(Ie))he.set(Ie,ge);else{const Me=he.get(Ie);(!Me.email&&ge.email||Me.email&&ge.email&&!Me.first_name&&ge.first_name)&&he.set(Ie,ge)}});const oe=Array.from(he.values());j(oe)}tt({email:"",first_name:"",last_name:"",phone:"",password:"",confirm_password:""}),Ht(!1),_t(!1),me(!1),l(`Driver ${te.data.first_name} ${te.data.last_name} created successfully! They can now login with their credentials.`),setTimeout(()=>l(null),5e3)}else d(te.error||"Failed to create driver")}catch(K){d("An error occurred while creating driver"),console.error("❌ Error creating driver:",K)}finally{n(!1)}},ma=async(I,O)=>{n(!0),d(null);try{const V=await Hr.assignDriverToBus(I,O);V.success&&V.data?(await ls(),l("Bus assigned to driver successfully!"),setTimeout(()=>l(null),3e3)):d(V.error||"Failed to assign bus to driver")}catch{d("An error occurred while assigning bus to driver")}finally{n(!1)}},Hn=async I=>{if(confirm("Are you sure you want to unassign this driver?")){n(!0),d(null);try{const O=await Hr.unassignDriverFromBus(I);O.success?(await ls(),l("Driver unassigned successfully!"),setTimeout(()=>l(null),3e3)):d(O.error||"Failed to unassign driver")}catch{d("An error occurred while unassigning driver")}finally{n(!1)}}},Ui=async(I,O,V)=>{const K=`${O} ${V}`,te=`Are you sure you want to delete driver "${K}"?

This action will:
• Remove the driver from all database tables
• Delete their Supabase Auth account
• Unassign them from any buses
• This action cannot be undone!`;if(confirm(te)){n(!0),d(null);try{const pe=await Hr.deleteDriver(I);pe.success&&pe.data?(j(P.filter(he=>he.id!==I)),Z(L.filter(he=>he.driver_id!==I)),l(`Driver "${K}" deleted successfully from all systems!`),setTimeout(()=>l(null),5e3)):d(pe.error||`Failed to delete driver "${K}"`)}catch(pe){d(`An error occurred while deleting driver "${K}"`),console.error("❌ Error deleting driver:",pe)}finally{n(!1)}}},Tn=async I=>{if(I.preventDefault(),n(!0),d(null),!It.name.trim()){d("Route name is required"),n(!1);return}if(!It.city.trim()){d("City is required"),n(!1);return}if(!It.description.trim()){d("Route description is required"),n(!1);return}try{const O={...It,distance_km:parseFloat(It.distance_km)||0,estimated_duration_minutes:parseInt(It.estimated_duration_minutes)||0,custom_destination:os==null?void 0:os.name,custom_destination_coordinates:os==null?void 0:os.coordinates,custom_origin:Pe==null?void 0:Pe.name,custom_origin_coordinates:Pe==null?void 0:Pe.coordinates,bus_stops:[]},V=await Hr.createRoute(O);V.success&&V.data?(ce([...Y,V.data]),qr({name:"",description:"",distance_km:"",estimated_duration_minutes:"",is_active:!0,city:""}),sn(null),fs(null),Ce(!1),l("Route created successfully!"),setTimeout(()=>l(null),3e3)):d(V.error||"Failed to create route")}catch{d("An error occurred while creating route")}finally{n(!1)}},Ve=async I=>{if(confirm("Are you sure you want to delete this route?")){n(!0),d(null);try{const O=await Hr.deleteRoute(I);O.success?(ce(Y.filter(V=>V.id!==I)),l("Route deleted successfully!"),setTimeout(()=>l(null),3e3)):d(O.error||"Failed to delete route")}catch{d("An error occurred while deleting route")}finally{n(!1)}}},si=I=>{if(!I)return"Not Assigned";const O=Y.find(te=>te.id===I);if(!O)return"Unknown Route";const V=O.city||"Unknown City",K=O.destination||"Ganpat University";return`${V} → ${K}`},pr=I=>{rn(I),kn(!0)},En=I=>{bi==="destination"?sn(I):fs(I)},Vi=I=>{if(!I)return"Not Assigned";const O=P.find(V=>V.id===I);return O?`${O.first_name} ${O.last_name}`:"Unknown Driver"},Ge=I=>I.driver_full_name?I.driver_full_name:I.driver_first_name&&I.driver_last_name?`${I.driver_first_name} ${I.driver_last_name}`:I.assigned_driver_id?Vi(I.assigned_driver_id):"Not Assigned",Mt=I=>{if(!I)return"Not Assigned";const O=w.find(V=>V.id===I);return O?O.number_plate:"Unknown Bus"},Tt=I=>{it(I),vt(!1),rt(!0)},ps=I=>{it(I),Ct({code:I.code,number_plate:I.number_plate,capacity:I.capacity,model:I.model||"",year:I.year||new Date().getFullYear(),is_active:I.is_active}),vt(!0),rt(!0)},Si=I=>{Et(I),st(!1),St(!0)},Pt=I=>{Et(I),qr({name:I.name,description:I.description,distance_km:I.distance_km.toString(),estimated_duration_minutes:I.estimated_duration_minutes.toString(),is_active:I.is_active,city:I.city||""}),st(!0),St(!0)},qi=async I=>{if(I.preventDefault(),!!(Oe!=null&&Oe.id)){n(!0),d(null);try{const O=await Hr.updateBus(Oe.id,Fe);O.success&&O.data?(k(w.map(V=>V.id===Oe.id?O.data:V)),rt(!1),vt(!1),it(null),l("Bus updated successfully!"),setTimeout(()=>l(null),3e3)):d(O.error||"Failed to update bus")}catch{d("An error occurred while updating bus")}finally{n(!1)}}},se=async I=>{if(I.preventDefault(),!!(qe!=null&&qe.id)){n(!0),d(null);try{const O={...It,distance_km:parseFloat(It.distance_km)||0,estimated_duration_minutes:parseInt(It.estimated_duration_minutes)||0},V=await Hr.updateRoute(qe.id,O);V.success&&V.data?(ce(Y.map(K=>K.id===qe.id?V.data:K)),St(!1),st(!1),Et(null),l("Route updated successfully!"),setTimeout(()=>l(null),3e3)):d(V.error||"Failed to update route")}catch{d("An error occurred while updating route")}finally{n(!1)}}};return r?v.jsxs("div",{className:"flex items-center justify-center p-8",children:[v.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),v.jsx("span",{className:"ml-2 text-gray-600",children:"Loading management data..."}),v.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a few moments"})]}):v.jsxs("div",{className:"space-y-6",children:[v.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsxs("div",{children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"🚍 Streamlined System Management"}),v.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage buses, drivers, and routes in one unified interface"})]}),v.jsx("button",{onClick:ls,className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition-colors",children:"🔄 Refresh Data"})]}),m&&v.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md",children:v.jsx("p",{className:"text-green-800",children:m})}),c&&v.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:v.jsx("p",{className:"text-red-800",children:c})}),v.jsx("div",{className:"border-b border-gray-200",children:v.jsxs("nav",{className:"-mb-px flex space-x-8",children:[v.jsxs("button",{onClick:()=>e("buses"),className:`py-2 px-1 border-b-2 font-medium text-sm ${t==="buses"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["🚌 Buses (",w.length,")"]}),v.jsxs("button",{onClick:()=>e("drivers"),className:`py-2 px-1 border-b-2 font-medium text-sm ${t==="drivers"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["👨‍💼 Drivers (",P.length,")"]}),v.jsxs("button",{onClick:()=>e("routes"),className:`py-2 px-1 border-b-2 font-medium text-sm ${t==="routes"?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:["🗺️ Routes (",Y.length,")"]})]})})]}),t==="buses"&&v.jsx("div",{className:"space-y-6",children:v.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Bus Management"}),v.jsx("div",{className:"flex space-x-2",children:v.jsx("button",{onClick:()=>G(!de),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:de?"❌ Cancel":"➕ Add New Bus"})})]}),de&&v.jsxs("form",{onSubmit:Wt,className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bus Code *"}),v.jsx("input",{type:"text",required:!0,value:Fe.code,onChange:I=>Ct({...Fe,code:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., BUS-2024-001"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number Plate *"}),v.jsx("input",{type:"text",required:!0,value:Fe.number_plate,onChange:I=>Ct({...Fe,number_plate:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., GJ-01-AB-1234"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capacity *"}),v.jsx("input",{type:"number",required:!0,value:Fe.capacity,onChange:I=>Ct({...Fe,capacity:parseInt(I.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),v.jsx("input",{type:"text",value:Fe.model,onChange:I=>Ct({...Fe,model:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Mercedes-Benz"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),v.jsx("input",{type:"number",value:Fe.year,onChange:I=>Ct({...Fe,year:parseInt(I.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"2000",max:new Date().getFullYear()+1})]}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("input",{type:"checkbox",checked:Fe.is_active,onChange:I=>Ct({...Fe,is_active:I.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),v.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Active"})]})]}),v.jsx("div",{className:"mt-4 flex justify-end",children:v.jsx("button",{type:"submit",disabled:r,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:r?"Creating...":"Create Bus"})})]}),v.jsx("div",{className:"overflow-x-auto",children:v.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[v.jsx("thead",{className:"bg-gray-50",children:v.jsxs("tr",{children:[v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bus Details"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Driver"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Route"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"City"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),v.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(I=>v.jsxs("tr",{className:"hover:bg-gray-50",children:[v.jsx("td",{className:"px-6 py-4 whitespace-nowrap"}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsxs("div",{children:[v.jsx("div",{className:"text-sm font-medium text-gray-900",children:I.number_plate}),v.jsxs("div",{className:"text-sm text-gray-900",children:["Capacity: ",I.capacity," | ",I.model," (",I.year,")"]})]})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("div",{className:"text-sm text-gray-900",children:Ge(I)})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("div",{className:"text-sm text-gray-900",children:I.route_name||si(I.route_id)})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("div",{className:"text-sm text-gray-900",children:I.route_id?(()=>{const O=Y.find(V=>V.id===I.route_id);return(O==null?void 0:O.city)||"Not specified"})():"No route assigned"})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${I.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:I.is_active?"Active":"Inactive"})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:v.jsxs("div",{className:"flex flex-col space-y-2",children:[v.jsxs("div",{className:"flex space-x-2",children:[v.jsx("button",{onClick:()=>Tt(I),className:"text-blue-600 hover:text-blue-900",title:"View details",children:"👁️ Details"}),v.jsx("button",{onClick:()=>ps(I),className:"text-green-600 hover:text-green-900",title:"Edit bus",children:"✏️ Edit"}),v.jsx("button",{onClick:()=>wi(I.id),className:"text-red-600 hover:text-red-900",title:"Delete bus",children:"🗑️ Delete"})]}),v.jsxs("select",{onChange:O=>Zn(I.id,O.target.value),value:I.route_id||"",className:"text-sm border border-gray-300 rounded px-2 py-1 text-gray-900 bg-white",children:[v.jsx("option",{value:"",className:"text-gray-900",children:"Select Route"}),Y.map(O=>v.jsx("option",{value:O.id,className:"text-gray-900",children:O.name},O.id))]})]})})]},I.id))})]})})]})}),t==="drivers"&&v.jsxs("div",{className:"space-y-6",children:[v.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Driver & Bus Assignment Management"}),v.jsxs("div",{className:"flex space-x-2",children:[v.jsx("button",{onClick:()=>me(!ue),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors",children:ue?"❌ Cancel":"➕ Create New Driver"}),v.jsx("button",{onClick:()=>W(!H),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:H?"❌ Cancel":"🚗 Assign Driver to Bus"})]})]}),H&&v.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[v.jsxs("div",{className:"mb-4",children:[v.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Assign Bus to Driver"}),v.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select a driver from Supabase authentication and assign them to a bus."})]}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Driver *"}),v.jsxs("select",{required:!0,value:ur,onChange:I=>Ds(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",children:[v.jsx("option",{value:"",className:"text-gray-900",children:"Choose a driver..."}),P.map(I=>v.jsxs("option",{value:I.id,className:"text-gray-900",children:[I.first_name," ",I.last_name," (",I.email,")"]},I.id))]}),P.length===0&&v.jsx("p",{className:"text-sm text-orange-600 mt-1",children:"No drivers found. Please create driver accounts first."})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Bus *"}),v.jsxs("select",{required:!0,value:Nt.assigned_bus_id||"",onChange:I=>Ye({...Nt,assigned_bus_id:I.target.value||""}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",children:[v.jsx("option",{value:"",className:"text-gray-900",children:"Choose a bus..."}),w.map(I=>v.jsxs("option",{value:I.id,className:"text-gray-900",children:[I.number_plate," (",I.model||"Unknown Model",")"]},I.id))]})]})]}),v.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[v.jsx("button",{type:"button",onClick:()=>{W(!1),Ds(""),Ye({...Nt,assigned_bus_id:""})},className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700",children:"Cancel"}),v.jsx("button",{onClick:()=>ma(ur,Nt.assigned_bus_id),disabled:r||!ur||!Nt.assigned_bus_id,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:r?"Assigning...":"Assign Driver to Bus"})]})]}),ue&&v.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[v.jsxs("div",{className:"mb-4",children:[v.jsx("h4",{className:"text-lg font-medium text-green-900 mb-2",children:"🆕 Create New Driver Account"}),v.jsx("p",{className:"text-sm text-green-700 mb-4",children:"Create a new driver account with Supabase authentication. The driver will receive login credentials and can immediately access the driver interface."})]}),v.jsxs("form",{onSubmit:$i,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),v.jsx("input",{type:"email",required:!0,value:we.email,onChange:I=>tt({...we,email:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 text-gray-900 bg-white",placeholder:"driver@university.com"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),v.jsx("input",{type:"text",required:!0,value:we.first_name,onChange:I=>tt({...we,first_name:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"John"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),v.jsx("input",{type:"text",required:!0,value:we.last_name,onChange:I=>tt({...we,last_name:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Smith"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),v.jsx("input",{type:"tel",value:we.phone,onChange:I=>tt({...we,phone:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 text-gray-900 bg-white",placeholder:"+91-9876543210"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password *"}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{type:kt?"text":"password",required:!0,value:we.password,onChange:I=>{console.log("Password input changed:",I.target.value),tt({...we,password:I.target.value})},onFocus:I=>{console.log("Password field focused"),I.target.select()},className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 text-gray-900 bg-white",placeholder:"Minimum 6 characters",minLength:6,autoComplete:"new-password",id:"driver-password-input"}),v.jsx("button",{type:"button",onClick:()=>Ht(!kt),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:kt?"🙈":"👁️"})]}),v.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Current length: ",we.password.length,"/6"]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password *"}),v.jsxs("div",{className:"relative",children:[v.jsx("input",{type:yt?"text":"password",required:!0,value:we.confirm_password,onChange:I=>{console.log("Confirm password input changed:",I.target.value),tt({...we,confirm_password:I.target.value})},onFocus:I=>{console.log("Confirm password field focused"),I.target.select()},className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 text-gray-900 bg-white",placeholder:"Confirm password",minLength:6,autoComplete:"new-password",id:"driver-confirm-password-input"}),v.jsx("button",{type:"button",onClick:()=>_t(!yt),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:yt?"🙈":"👁️"})]}),v.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[we.password!==we.confirm_password&&we.confirm_password.length>0&&v.jsx("span",{className:"text-red-500",children:"Passwords do not match"}),we.password===we.confirm_password&&we.confirm_password.length>0&&v.jsx("span",{className:"text-green-500",children:"Passwords match ✓"})]})]})]}),v.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[v.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"ℹ️ Important Information:"}),v.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[v.jsx("li",{children:"• Driver account will be created in Supabase Auth"}),v.jsx("li",{children:"• Driver can immediately login with these credentials"}),v.jsx("li",{children:"• Email will be auto-confirmed (no email verification required)"}),v.jsx("li",{children:"• Driver will have access to the driver interface at /driver"}),v.jsx("li",{children:"• You can assign them to a bus after creation"})]})]}),v.jsxs("div",{className:"flex justify-end space-x-2",children:[v.jsx("button",{type:"button",onClick:()=>{me(!1),tt({email:"",first_name:"",last_name:"",phone:"",password:"",confirm_password:""}),Ht(!1),_t(!1)},className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700",children:"Cancel"}),v.jsx("button",{type:"submit",disabled:r,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:r?"Creating...":"Create Driver Account"})]})]})]}),v.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsx("h4",{className:"text-lg font-medium text-blue-900",children:"🚗 Available Drivers"}),v.jsx("button",{onClick:async()=>{try{const I=await Hr.getAllDrivers();if(I.success&&I.data){const O=new Map;I.data.forEach(K=>{const te=K.id;if(!O.has(te))O.set(te,K);else{const pe=O.get(te);(!pe.email&&K.email||pe.email&&K.email&&!pe.first_name&&K.first_name)&&O.set(te,K)}});const V=Array.from(O.values());j(V)}else console.warn("⚠️ Manual refresh failed:",I.error)}catch(I){console.warn("⚠️ Manual refresh failed:",I)}},className:"text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200",children:"🔄 Refresh"})]}),P.length>0?v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:P.map(I=>v.jsxs("div",{className:"bg-white p-3 rounded border",children:[v.jsxs("div",{className:"font-medium text-gray-900",children:[I.first_name," ",I.last_name]}),v.jsx("div",{className:"text-sm text-gray-600",children:I.email}),v.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Role: ",I.role]})]},I.id))}):v.jsxs("div",{className:"text-center py-4",children:[v.jsx("p",{className:"text-gray-600",children:"No available drivers found."}),v.jsx("p",{className:"text-sm text-gray-500 mt-1",children:'Create new driver accounts using the "Create New Driver" button above, or check if drivers exist in the system.'}),v.jsx("p",{className:"text-xs text-green-600 mt-2",children:'💡 Use the "Create New Driver" button to add drivers with full Supabase Auth integration.'})]})]}),v.jsx("div",{className:"overflow-x-auto",children:v.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[v.jsx("thead",{className:"bg-gray-50",children:v.jsxs("tr",{children:[v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver Details"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact Info"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Bus"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),v.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(I=>v.jsxs("tr",{className:"hover:bg-gray-50",children:[v.jsx("td",{className:"px-6 py-4 whitespace-nowrap"}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsxs("div",{children:[v.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[I.first_name," ",I.last_name]}),v.jsxs("div",{className:"text-sm text-gray-900",children:["Role: ",I.role]})]})}),v.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[v.jsx("div",{className:"text-sm text-gray-900",children:I.email}),v.jsx("div",{className:"text-sm text-gray-900",children:I.phone||"No phone"})]}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("div",{className:"text-sm text-gray-900",children:Mt(I.assigned_bus_id)})}),v.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[v.jsxs("select",{onChange:O=>ma(I.id,O.target.value),value:I.assigned_bus_id||"",className:"text-sm border border-gray-300 rounded px-2 py-1 text-gray-900 bg-white",children:[v.jsx("option",{value:"",className:"text-gray-900",children:"Select Bus"}),w.map(O=>v.jsx("option",{value:O.id,className:"text-gray-900",children:O.number_plate},O.id))]}),v.jsx("button",{onClick:()=>Ui(I.id,I.first_name,I.last_name),className:"ml-2 bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-700 transition-colors",title:"Delete driver from all systems",children:"🗑️ Delete"})]})]},I.id))})]})})]}),v.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Currently Assigned Drivers"}),v.jsxs("div",{className:"text-sm text-gray-900",children:[L.length," driver",L.length!==1?"s":""," assigned"]})]}),L.length===0?v.jsxs("div",{className:"text-center py-8",children:[v.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"🚌"}),v.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Drivers Assigned"}),v.jsx("p",{className:"text-gray-600",children:"No drivers are currently assigned to buses."})]}):v.jsx("div",{className:"overflow-x-auto",children:v.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[v.jsx("thead",{className:"bg-gray-50",children:v.jsxs("tr",{children:[v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Driver"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Bus"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Route"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),v.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map(I=>v.jsxs("tr",{className:"hover:bg-gray-50",children:[v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsxs("div",{children:[v.jsx("div",{className:"text-sm font-medium text-gray-900",children:I.driver_name}),v.jsx("div",{className:"text-sm text-gray-900",children:I.driver_email})]})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsxs("div",{children:[v.jsx("div",{className:"text-sm font-medium text-gray-900",children:I.bus_code}),v.jsx("div",{className:"text-sm text-gray-900",children:I.number_plate})]})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("div",{className:"text-sm text-gray-900",children:I.route_name||"No route assigned"})}),v.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[v.jsx("button",{onClick:()=>Hn(I.driver_id),disabled:r,className:"text-red-600 hover:text-red-900 disabled:opacity-50",title:"Unassign driver from bus",children:"🚫 Unassign"}),v.jsx("button",{onClick:()=>{const O=P.find(V=>V.id===I.driver_id);O&&Ui(O.id,O.first_name,O.last_name)},disabled:r,className:"text-red-800 hover:text-red-900 disabled:opacity-50 font-bold",title:"Delete driver from all systems",children:"🗑️ Delete"})]})]},I.driver_id))})]})})]})]}),t==="routes"&&v.jsx("div",{className:"space-y-6",children:v.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Route Management"}),v.jsx("div",{className:"flex space-x-2",children:v.jsx("button",{onClick:()=>Ce(!be),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:be?"❌ Cancel":"➕ Add New Route"})})]}),be&&v.jsxs("form",{onSubmit:Tn,className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Route Name *"}),v.jsx("input",{type:"text",required:!0,value:It.name,onChange:I=>qr({...It,name:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Downtown Express"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),v.jsx("input",{type:"text",required:!0,value:It.city,onChange:I=>qr({...It,city:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Ahmedabad"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Distance (km) *"}),v.jsx("input",{type:"number",required:!0,step:"0.1",value:It.distance_km,onChange:I=>qr({...It,distance_km:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes) *"}),v.jsx("input",{type:"number",required:!0,value:It.estimated_duration_minutes,onChange:I=>qr({...It,estimated_duration_minutes:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("input",{type:"checkbox",checked:It.is_active,onChange:I=>qr({...It,is_active:I.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),v.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Active"})]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),v.jsx("textarea",{value:It.description,onChange:I=>qr({...It,description:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",rows:3,placeholder:"Route description..."})]}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Destination"}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("div",{className:"text-sm text-gray-600",children:"Default: Ganpat University"}),os&&v.jsxs("div",{className:"p-2 bg-green-50 border border-green-200 rounded",children:[v.jsx("div",{className:"font-medium text-green-800",children:os.name}),v.jsx("div",{className:"text-sm text-green-600",children:os.address})]}),v.jsx("button",{type:"button",onClick:()=>pr("destination"),className:"w-full px-3 py-2 border border-blue-300 text-blue-700 rounded-md hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"🗺️ Set Custom Destination"})]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Origin (Starting Point)"}),v.jsxs("div",{className:"space-y-2",children:[v.jsx("div",{className:"text-sm text-gray-600",children:"Auto: Driver's live location"}),Pe&&v.jsxs("div",{className:"p-2 bg-blue-50 border border-blue-200 rounded",children:[v.jsx("div",{className:"font-medium text-blue-800",children:Pe.name}),v.jsx("div",{className:"text-sm text-blue-600",children:Pe.address})]}),v.jsx("button",{type:"button",onClick:()=>pr("origin"),className:"w-full px-3 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"🗺️ Set Custom Origin (Optional)"})]})]})]}),v.jsx("div",{className:"mt-4 flex justify-end",children:v.jsx("button",{type:"submit",disabled:r,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:r?"Creating...":"Create Route"})})]}),v.jsx("div",{className:"overflow-x-auto",children:v.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[v.jsx("thead",{className:"bg-gray-50",children:v.jsxs("tr",{children:[v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Route Details"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"City"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Distance & Duration"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),v.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),v.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Y.map(I=>v.jsxs("tr",{className:"hover:bg-gray-50",children:[v.jsx("td",{className:"px-6 py-4 whitespace-nowrap"}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsxs("div",{children:[v.jsx("div",{className:"text-sm font-medium text-gray-900",children:I.name}),v.jsx("div",{className:"text-sm text-gray-900",children:I.description})]})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("div",{className:"text-sm text-gray-900",children:I.city||"Not specified"})}),v.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[v.jsxs("div",{className:"text-sm text-gray-900",children:[I.distance_km," km"]}),v.jsxs("div",{className:"text-sm text-gray-900",children:[I.estimated_duration_minutes," min"]})]}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:v.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${I.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:I.is_active?"Active":"Inactive"})}),v.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:v.jsxs("div",{className:"flex space-x-2",children:[v.jsx("button",{onClick:()=>Si(I),className:"text-blue-600 hover:text-blue-900",title:"View details",children:"👁️ Details"}),v.jsx("button",{onClick:()=>Pt(I),className:"text-green-600 hover:text-green-900",title:"Edit route",children:"✏️ Edit"}),v.jsx("button",{onClick:()=>Ve(I.id),className:"text-red-600 hover:text-red-900",title:"Delete route",children:"🗑️ Delete"})]})})]},I.id))})]})})]})}),Fi&&v.jsx(U5,{onLocationSelect:En,onClose:()=>kn(!1),title:bi==="destination"?"Select Destination":"Select Origin",searchPlaceholder:bi==="destination"?"Search for destination...":"Search for origin..."},`map-selector-${bi}`),Te&&Oe&&v.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:v.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h3",{className:"text-lg font-medium text-gray-900",children:ir?"Edit Bus Details":"Bus Details"}),v.jsx("button",{onClick:()=>{rt(!1),vt(!1),it(null)},className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),ir?v.jsxs("form",{onSubmit:qi,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bus Code *"}),v.jsx("input",{type:"text",required:!0,value:Fe.code,onChange:I=>Ct({...Fe,code:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number Plate *"}),v.jsx("input",{type:"text",required:!0,value:Fe.number_plate,onChange:I=>Ct({...Fe,number_plate:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capacity *"}),v.jsx("input",{type:"number",required:!0,value:Fe.capacity,onChange:I=>Ct({...Fe,capacity:parseInt(I.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),v.jsx("input",{type:"text",value:Fe.model,onChange:I=>Ct({...Fe,model:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),v.jsx("input",{type:"number",value:Fe.year,onChange:I=>Ct({...Fe,year:parseInt(I.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"2000",max:new Date().getFullYear()+1})]}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("input",{type:"checkbox",checked:Fe.is_active,onChange:I=>Ct({...Fe,is_active:I.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),v.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Active"})]})]}),v.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[v.jsx("button",{type:"button",onClick:()=>vt(!1),className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700",children:"Cancel"}),v.jsx("button",{type:"submit",disabled:r,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:r?"Updating...":"Update Bus"})]})]}):v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Bus Code"}),v.jsx("p",{className:"text-sm text-gray-900",children:Oe.code})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Number Plate"}),v.jsx("p",{className:"text-sm text-gray-900",children:Oe.number_plate})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Capacity"}),v.jsxs("p",{className:"text-sm text-gray-900",children:[Oe.capacity," passengers"]})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Model"}),v.jsx("p",{className:"text-sm text-gray-900",children:Oe.model||"Not specified"})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Year"}),v.jsx("p",{className:"text-sm text-gray-900",children:Oe.year||"Not specified"})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),v.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Oe.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:Oe.is_active?"Active":"Inactive"})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Assigned Driver"}),v.jsx("p",{className:"text-sm text-gray-900",children:Ge(Oe)})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Assigned Route"}),v.jsx("p",{className:"text-sm text-gray-900",children:Oe.route_name||si(Oe.route_id)})]})]}),v.jsx("div",{className:"flex justify-end space-x-2 pt-4",children:v.jsx("button",{onClick:()=>vt(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"✏️ Edit"})})]})]})}),Ue&&qe&&v.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:v.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx("h3",{className:"text-lg font-medium text-gray-900",children:Be?"Edit Route Details":"Route Details"}),v.jsx("button",{onClick:()=>{St(!1),st(!1),Et(null)},className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),Be?v.jsxs("form",{onSubmit:se,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Route Name *"}),v.jsx("input",{type:"text",required:!0,value:It.name,onChange:I=>qr({...It,name:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),v.jsx("input",{type:"text",required:!0,value:It.city,onChange:I=>qr({...It,city:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Distance (km) *"}),v.jsx("input",{type:"number",required:!0,step:"0.1",value:It.distance_km,onChange:I=>qr({...It,distance_km:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes) *"}),v.jsx("input",{type:"number",required:!0,value:It.estimated_duration_minutes,onChange:I=>qr({...It,estimated_duration_minutes:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("input",{type:"checkbox",checked:It.is_active,onChange:I=>qr({...It,is_active:I.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),v.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Active"})]})]}),v.jsxs("div",{children:[v.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),v.jsx("textarea",{value:It.description,onChange:I=>qr({...It,description:I.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",rows:3})]}),v.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[v.jsx("button",{type:"button",onClick:()=>st(!1),className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700",children:"Cancel"}),v.jsx("button",{type:"submit",disabled:r,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:r?"Updating...":"Update Route"})]})]}):v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Route Name"}),v.jsx("p",{className:"text-sm text-gray-900",children:qe.name})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"City"}),v.jsx("p",{className:"text-sm text-gray-900",children:qe.city||"Not specified"})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Distance"}),v.jsxs("p",{className:"text-sm text-gray-900",children:[qe.distance_km," km"]})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Duration"}),v.jsxs("p",{className:"text-sm text-gray-900",children:[qe.estimated_duration_minutes," minutes"]})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),v.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${qe.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:qe.is_active?"Active":"Inactive"})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Created"}),v.jsx("p",{className:"text-sm text-gray-900",children:qe.created_at?new Date(qe.created_at).toLocaleDateString():"Not available"})]})]}),qe.description&&v.jsxs("div",{children:[v.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Description"}),v.jsx("p",{className:"text-sm text-gray-900",children:qe.description})]}),v.jsx("div",{className:"flex justify-end space-x-2 pt-4",children:v.jsx("button",{onClick:()=>st(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",children:"✏️ Edit"})})]})]})})]})}function q5(){const[t,e]=re.useState(null),[r,n]=re.useState(null),[c,d]=re.useState(!0),[m,l]=re.useState(null),[w,k]=re.useState("overview");re.useEffect(()=>{P()},[]);const P=async()=>{d(!0),l(null);try{const[Z,Y]=await Promise.all([Hr.getAnalytics(),Hr.getSystemHealth()]);Z.success&&Z.data&&e(Z.data),Y.success&&Y.data&&n(Y.data),(!Z.success||!Y.success)&&l("Failed to load dashboard data")}catch(Z){l("An error occurred while loading dashboard data"),console.error("❌ Dashboard data loading error:",Z)}finally{d(!1)}},j=async()=>{try{await tr.signOut(),window.location.href="/"}catch(Z){console.error("❌ Sign out error:",Z)}},L=tr.getCurrentProfile();return c?v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"loading-spinner mx-auto"}),v.jsx("p",{className:"mt-4 text-white/70",children:"Loading admin dashboard..."})]})}):m?v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:v.jsx("div",{className:"text-center",children:v.jsxs("div",{className:"card-glass p-8",children:[v.jsx("h3",{className:"text-lg font-medium text-red-300 mb-2",children:"Error Loading Dashboard"}),v.jsx("p",{className:"text-red-200 mb-4",children:m}),v.jsx("button",{onClick:P,className:"btn-primary bg-red-600 hover:bg-red-700",children:"Retry"})]})})}):v.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900",children:[v.jsx("header",{className:"bg-white/10 backdrop-blur-sm border-b border-white/20",children:v.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:v.jsxs("div",{className:"flex justify-between items-center py-6",children:[v.jsx("div",{className:"flex items-center",children:v.jsx("div",{className:"flex-shrink-0",children:v.jsx("h1",{className:"text-2xl font-bold text-white",children:"🚍 Admin Dashboard"})})}),v.jsxs("div",{className:"flex items-center space-x-4",children:[v.jsxs("span",{className:"text-sm text-white/80",children:["Welcome,"," ",(L==null?void 0:L.first_name)||(L==null?void 0:L.full_name)||(L==null?void 0:L.email)]}),v.jsx("button",{onClick:P,className:"btn-primary text-sm",disabled:c,children:c?"Refreshing...":"🔄 Refresh"}),v.jsx("button",{onClick:j,className:"btn-secondary text-sm",children:"Sign Out"})]})]})})}),v.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:v.jsx("div",{className:"border-b border-white/20",children:v.jsxs("nav",{className:"-mb-px flex space-x-8",children:[v.jsx("button",{onClick:()=>k("overview"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${w==="overview"?"border-blue-400 text-blue-300":"border-transparent text-white/60 hover:text-white/80 hover:border-white/40"}`,children:"Overview"}),v.jsx("button",{onClick:()=>k("analytics"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${w==="analytics"?"border-blue-400 text-blue-300":"border-transparent text-white/60 hover:text-white/80 hover:border-white/40"}`,children:"Analytics"}),v.jsx("button",{onClick:()=>k("management"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${w==="management"?"border-blue-400 text-blue-300":"border-transparent text-white/60 hover:text-white/80 hover:border-white/40"}`,children:"Management"}),v.jsx("button",{onClick:()=>k("media"),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${w==="media"?"border-blue-400 text-blue-300":"border-transparent text-white/60 hover:text-white/80 hover:border-white/40"}`,children:"Media"})]})})}),v.jsxs("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:[w==="overview"&&v.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[v.jsxs("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[v.jsx("div",{className:"card-glass overflow-hidden",children:v.jsx("div",{className:"p-5",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center",children:v.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:v.jsx("path",{d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"})})})}),v.jsx("div",{className:"ml-5 w-0 flex-1",children:v.jsxs("dl",{children:[v.jsx("dt",{className:"text-sm font-medium text-white/70 truncate",children:"Total Buses"}),v.jsx("dd",{className:"text-lg font-medium text-white",children:(r==null?void 0:r.buses)||0})]})})]})})}),v.jsx("div",{className:"card-glass overflow-hidden",children:v.jsx("div",{className:"p-5",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-md flex items-center justify-center",children:v.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:v.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})}),v.jsx("div",{className:"ml-5 w-0 flex-1",children:v.jsxs("dl",{children:[v.jsx("dt",{className:"text-sm font-medium text-white/70 truncate",children:"Total Routes"}),v.jsx("dd",{className:"text-lg font-medium text-white",children:(r==null?void 0:r.routes)||0})]})})]})})}),v.jsx("div",{className:"card-glass overflow-hidden",children:v.jsx("div",{className:"p-5",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("div",{className:"w-8 h-8 bg-yellow-500 rounded-md flex items-center justify-center",children:v.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:v.jsx("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})})}),v.jsx("div",{className:"ml-5 w-0 flex-1",children:v.jsxs("dl",{children:[v.jsx("dt",{className:"text-sm font-medium text-white/70 truncate",children:"Total Drivers"}),v.jsx("dd",{className:"text-lg font-medium text-white",children:(r==null?void 0:r.drivers)||0})]})})]})})}),v.jsx("div",{className:"card-glass overflow-hidden",children:v.jsx("div",{className:"p-5",children:v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center",children:v.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:v.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})})}),v.jsx("div",{className:"ml-5 w-0 flex-1",children:v.jsxs("dl",{children:[v.jsx("dt",{className:"text-sm font-medium text-white/70 truncate",children:"Recent Locations"}),v.jsx("dd",{className:"text-lg font-medium text-white",children:(r==null?void 0:r.recentLocations)||0})]})})]})})})]}),t&&v.jsxs("div",{className:"mt-8 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3",children:[v.jsx("div",{className:"card-glass overflow-hidden",children:v.jsxs("div",{className:"p-5",children:[v.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"System Status"}),v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-sm text-white/70",children:"Active Buses"}),v.jsxs("span",{className:"text-sm font-medium text-white",children:[t.activeBuses,"/",t.totalBuses]})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-sm text-white/70",children:"Active Routes"}),v.jsxs("span",{className:"text-sm font-medium text-white",children:[t.activeRoutes,"/",t.totalRoutes]})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-sm text-white/70",children:"Active Drivers"}),v.jsxs("span",{className:"text-sm font-medium text-white",children:[t.activeDrivers,"/",t.totalDrivers]})]})]})]})}),v.jsx("div",{className:"card-glass overflow-hidden",children:v.jsxs("div",{className:"p-5",children:[v.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Performance"}),v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-sm text-white/70",children:"Average Delay"}),v.jsxs("span",{className:"text-sm font-medium text-white",children:[t.averageDelay.toFixed(1)," min"]})]}),v.jsxs("div",{className:"flex justify-between",children:[v.jsx("span",{className:"text-sm text-white/70",children:"System Health"}),v.jsx("span",{className:"text-sm font-medium text-green-400",children:"Good"})]})]})]})}),v.jsx("div",{className:"card-glass overflow-hidden",children:v.jsxs("div",{className:"p-5",children:[v.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Last Updated"}),v.jsx("div",{className:"text-sm text-white/70",children:r!=null&&r.timestamp?new Date(r.timestamp).toLocaleString():"N/A"})]})})]})]}),w==="analytics"&&t&&v.jsx("div",{className:"px-4 py-6 sm:px-0",children:v.jsxs("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-2",children:[v.jsxs("div",{className:"card-glass p-6",children:[v.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"System Statistics"}),v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-500/20 rounded-lg border border-blue-400/30",children:[v.jsx("span",{className:"text-blue-300 font-medium",children:"Active Buses"}),v.jsx("span",{className:"text-2xl font-bold text-blue-200",children:t.activeBuses})]}),v.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-500/20 rounded-lg border border-green-400/30",children:[v.jsx("span",{className:"text-green-300 font-medium",children:"Active Routes"}),v.jsx("span",{className:"text-2xl font-bold text-green-200",children:t.activeRoutes})]}),v.jsxs("div",{className:"flex justify-between items-center p-3 bg-yellow-500/20 rounded-lg border border-yellow-400/30",children:[v.jsx("span",{className:"text-yellow-300 font-medium",children:"Active Drivers"}),v.jsx("span",{className:"text-2xl font-bold text-yellow-200",children:t.activeDrivers})]}),v.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-500/20 rounded-lg border border-purple-400/30",children:[v.jsx("span",{className:"text-purple-300 font-medium",children:"Average Delay"}),v.jsxs("span",{className:"text-2xl font-bold text-purple-200",children:[t.averageDelay.toFixed(1)," min"]})]})]})]}),v.jsxs("div",{className:"card-glass p-6",children:[v.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"System Distribution"}),v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("span",{className:"text-sm font-medium text-white/80",children:"Active Buses"}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"w-32 bg-white/20 rounded-full h-2 mr-2",children:v.jsx("div",{className:"bg-blue-400 h-2 rounded-full",style:{width:`${t.activeBuses/t.totalBuses*100}%`}})}),v.jsxs("span",{className:"text-sm text-white/70",children:[t.activeBuses,"/",t.totalBuses]})]})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("span",{className:"text-sm font-medium text-white/80",children:"Active Routes"}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"w-32 bg-white/20 rounded-full h-2 mr-2",children:v.jsx("div",{className:"bg-green-400 h-2 rounded-full",style:{width:`${t.activeRoutes/t.totalRoutes*100}%`}})}),v.jsxs("span",{className:"text-sm text-white/70",children:[t.activeRoutes,"/",t.totalRoutes]})]})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx("span",{className:"text-sm font-medium text-white/80",children:"Active Drivers"}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"w-32 bg-white/20 rounded-full h-2 mr-2",children:v.jsx("div",{className:"bg-yellow-400 h-2 rounded-full",style:{width:`${t.activeDrivers/t.totalDrivers*100}%`}})}),v.jsxs("span",{className:"text-sm text-white/70",children:[t.activeDrivers,"/",t.totalDrivers]})]})]})]})]})]})}),w==="management"&&v.jsx(V5,{}),w==="media"&&v.jsx($5,{})]})]})}function v2(){const[t,e]=re.useState(!1),[r,n]=re.useState(!1),[c,d]=re.useState(!0),[m,l]=re.useState(null);re.useEffect(()=>{w();const j=()=>{w()};return tr.onAuthStateChange(j),()=>{tr.removeAuthStateChangeListener()}},[]);const w=async()=>{try{for(d(!0),l(null);!tr.isInitialized();)await new Promise(Z=>setTimeout(Z,100));const j=tr.isAuthenticated(),L=tr.isAdmin();console.log("🔍 Auth Status Check:",{initialized:tr.isInitialized(),authenticated:j,admin:L}),e(j),n(L),j&&!L?l("Access denied. Admin privileges required."):j||l(null)}catch(j){console.error("❌ Auth status check error:",j),l("Failed to check authentication status"),e(!1),n(!1)}finally{d(!1)}},k=()=>{e(!0),n(!0),l(null)},P=async()=>{try{const j=await tr.signOut();j.success?(e(!1),n(!1),l(null)):(console.error("❌ Sign out failed:",j.error),e(!1),n(!1),l("Sign out failed, but you have been logged out locally."))}catch(j){console.error("❌ Sign out error:",j),e(!1),n(!1),l("Sign out failed, but you have been logged out locally.")}};return c?v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"loading-spinner mx-auto"}),v.jsx("p",{className:"mt-4 text-white/70",children:"Checking authentication..."})]})}):t?r?v.jsx(q5,{}):v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:v.jsx("div",{className:"text-center",children:v.jsxs("div",{className:"card-glass p-8 max-w-md",children:[v.jsx("h3",{className:"text-lg font-medium text-red-300 mb-2",children:"Access Denied"}),v.jsx("p",{className:"text-red-200 mb-4",children:"You don't have admin privileges. Please contact your administrator."}),m&&v.jsx("div",{className:"mb-4 p-3 bg-red-500/20 border border-red-400/30 rounded-lg",children:v.jsx("p",{className:"text-sm text-red-200",children:m})}),v.jsx("button",{onClick:P,className:"btn-primary bg-red-600 hover:bg-red-700",children:"Sign Out"})]})})}):m&&m.includes("environment variables")?v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:v.jsx("div",{className:"text-center",children:v.jsxs("div",{className:"card-glass p-8 max-w-md",children:[v.jsx("h3",{className:"text-lg font-medium text-yellow-300 mb-2",children:"Configuration Error"}),v.jsx("p",{className:"text-yellow-200 mb-4",children:"The application is not properly configured. Please check your environment variables."}),v.jsx("p",{className:"text-sm text-yellow-100 mb-4",children:"Make sure the .env file exists in the frontend directory with the correct Supabase configuration."}),v.jsx("button",{onClick:()=>window.location.reload(),className:"btn-primary",children:"Reload Page"})]})})}):v.jsx(lA,{onLoginSuccess:k})}const G5=({children:t,className:e=""})=>v.jsx(Rt.div,{initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},className:e,children:t}),y_=({children:t,className:e=""})=>v.jsx(Rt.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},transition:{duration:.4,ease:[.4,0,.2,1]},className:e,children:t}),W5=()=>{const t=Jm(),e=re.useRef(null),[r,n]=re.useState(!1),[c,d]=re.useState(!1);re.useEffect(()=>{const k=()=>{n(window.innerWidth<768)};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]),re.useEffect(()=>{if(e.current){e.current.playbackRate=.8;const k=()=>d(!0);return e.current.addEventListener("loadeddata",k),()=>{e.current&&e.current.removeEventListener("loadeddata",k)}}},[]);const{setTransition:m}=ug(),l=k=>{k.includes("login")?m("homepage-to-login"):k.includes("student")||k.includes("student-map")?m("homepage-to-map"):m("default"),setTimeout(()=>{t(k)},200)},w=r?8:20;return v.jsxs("div",{className:"relative min-h-screen overflow-hidden",children:[v.jsxs("div",{className:"absolute inset-0 z-0",children:[v.jsxs("video",{ref:e,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover",preload:"auto",children:[v.jsx("source",{src:"/videos/Animated_Countryside_University_Bus.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]}),v.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-black/20 to-black/60"}),!c&&v.jsx("div",{className:"absolute inset-0 bg-slate-900 flex items-center justify-center",children:v.jsx("div",{className:"loading-spinner"})})]}),v.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center min-h-screen p-4 sm:p-6",children:[v.jsxs(Rt.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-8 sm:mb-16 px-4",children:[v.jsx("h1",{className:"text-3xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-bold mb-2 sm:mb-4 leading-tight",children:v.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"Ganpat University"})}),v.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold text-white mb-4 sm:mb-6 leading-tight",children:"Bus Tracker"}),v.jsx("div",{className:"w-20 sm:w-32 h-1 bg-gradient-to-r from-blue-400 to-purple-400 mx-auto rounded-full"})]}),v.jsxs(G5,{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 md:gap-8 lg:gap-12 items-center justify-center w-full max-w-6xl px-4",children:[v.jsx(y_,{children:v.jsxs(Rt.div,{whileHover:r?{}:{scale:1.05,rotateY:5,rotateX:2},whileTap:{scale:.95},className:"relative group w-full sm:w-auto",children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/30 to-purple-500/30 rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),v.jsxs(fd,{variant:"ultra",glow:!0,className:"w-full sm:w-72 md:w-80 h-40 sm:h-48 flex flex-col items-center justify-center cursor-pointer relative z-10",onClick:()=>l("/driver-login"),children:[v.jsxs("div",{className:"text-center px-2",children:[v.jsx("div",{className:"text-4xl sm:text-6xl mb-2 sm:mb-4 animate-pulse",children:"🚌"}),v.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white mb-1 sm:mb-2",children:"Driver Interface"}),v.jsx("p",{className:"text-white/70 text-xs sm:text-sm",children:"Real-time location sharing & navigation"})]}),v.jsx("div",{className:"absolute bottom-2 sm:bottom-4 right-2 sm:right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:v.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})})]})]})}),v.jsx(y_,{children:v.jsxs(Rt.div,{whileHover:r?{}:{scale:1.05,rotateY:5,rotateX:2},whileTap:{scale:.95},className:"relative group w-full sm:w-auto",children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-500/30 to-blue-500/30 rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),v.jsxs(fd,{variant:"ultra",glow:!0,className:"w-full sm:w-72 md:w-80 h-40 sm:h-48 flex flex-col items-center justify-center cursor-pointer relative z-10",onClick:()=>l("/student-map"),children:[v.jsxs("div",{className:"text-center px-2",children:[v.jsx("div",{className:"text-4xl sm:text-6xl mb-2 sm:mb-4 animate-pulse",children:"🗺️"}),v.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white mb-1 sm:mb-2",children:"Student Map"}),v.jsx("p",{className:"text-white/70 text-xs sm:text-sm",children:"Live bus tracking & route information"})]}),v.jsx("div",{className:"absolute bottom-2 sm:bottom-4 right-2 sm:right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:v.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})})]})]})}),v.jsx(y_,{children:v.jsxs(Rt.div,{whileHover:r?{}:{scale:1.05,rotateY:5,rotateX:2},whileTap:{scale:.95},className:"relative group w-full sm:w-auto",children:[v.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/30 to-pink-500/30 rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),v.jsxs(fd,{variant:"ultra",glow:!0,className:"w-full sm:w-72 md:w-80 h-40 sm:h-48 flex flex-col items-center justify-center cursor-pointer relative z-10",onClick:()=>l("/admin-login"),children:[v.jsxs("div",{className:"text-center px-2",children:[v.jsx("div",{className:"text-4xl sm:text-6xl mb-2 sm:mb-4 animate-pulse",children:"⚙️"}),v.jsx("h3",{className:"text-lg sm:text-xl md:text-2xl font-bold text-white mb-1 sm:mb-2",children:"Admin Panel"}),v.jsx("p",{className:"text-white/70 text-xs sm:text-sm",children:"Fleet management & analytics dashboard"})]}),v.jsx("div",{className:"absolute bottom-2 sm:bottom-4 right-2 sm:right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:v.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})})]})]})})]}),v.jsx(Rt.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:1.2},className:"absolute bottom-4 sm:bottom-8 left-1/2 transform -translate-x-1/2 text-center px-4",children:v.jsx("p",{className:"text-white/60 text-xs sm:text-sm",children:"Powered by cutting-edge technology • Real-time tracking • Premium experience"})}),v.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(w)].map((k,P)=>v.jsx(Rt.div,{className:"absolute w-1 h-1 sm:w-2 sm:h-2 bg-white/20 rounded-full",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},animate:{y:[0,-50,0],opacity:[0,1,0]},transition:{duration:2+Math.random()*2,repeat:1/0,delay:Math.random()*2}},P))})]})]})};function Z5(){console.log("🚀 App component is rendering...");const[t,e]=re.useState(null),[r,n]=re.useState(!0),[c,d]=re.useState(null),[m,l]=re.useState({isAuthenticated:!1,user:null,loading:!0});re.useEffect(()=>{(async()=>{try{for(n(!0);!tr.isInitialized();)await new Promise(L=>setTimeout(L,100));const j=await Tv.getHealth();e(j),d(null)}catch(j){d(j instanceof Error?j.message:"Failed to connect to backend"),e(null)}finally{n(!1)}})()},[]),re.useEffect(()=>{const P=()=>{const j=tr.getCurrentUser(),L=tr.getCurrentProfile();l({isAuthenticated:!!j,user:L||null,loading:!1})};return tr.onAuthStateChange(P),P(),()=>{tr.removeAuthStateChangeListener()}},[]);const w=()=>{var P,j,L,Z,Y,ce,de,G,H,W;return v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center p-6",children:v.jsx("div",{className:"max-w-4xl w-full mx-auto",children:v.jsxs("div",{className:"card-glass p-8",children:[v.jsx("h1",{className:"text-4xl font-bold gradient-text mb-6 text-center",children:"🚍 University Bus Tracking System"}),v.jsxs("div",{className:"space-y-6",children:[r&&v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"loading-spinner mx-auto"}),v.jsx("p",{className:"text-white/70 mt-4",children:"Checking backend connection..."})]}),c&&v.jsx("div",{className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-xl p-4",children:v.jsxs("div",{className:"flex",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:v.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),v.jsxs("div",{className:"ml-3",children:[v.jsx("h3",{className:"text-sm font-medium text-red-300",children:"Connection Error"}),v.jsx("p",{className:"text-sm text-red-200 mt-1",children:c})]})]})}),t&&v.jsx("div",{className:"bg-green-500/20 backdrop-blur-sm border border-green-400/30 rounded-xl p-4",children:v.jsxs("div",{className:"flex",children:[v.jsx("div",{className:"flex-shrink-0",children:v.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:v.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),v.jsxs("div",{className:"ml-3",children:[v.jsx("h3",{className:"text-sm font-medium text-green-300",children:"Backend Connected"}),v.jsxs("div",{className:"text-sm text-green-200 mt-1 space-y-1",children:[v.jsxs("p",{children:[v.jsx("strong",{children:"Status:"})," ",t.status]}),v.jsxs("p",{children:[v.jsx("strong",{children:"Database:"})," ",((j=(P=t.services)==null?void 0:P.database)==null?void 0:j.status)||"Unknown"]}),v.jsxs("p",{children:[v.jsx("strong",{children:"Environment:"})," ",t.environment]}),v.jsxs("p",{children:[v.jsx("strong",{children:"Timestamp:"})," ",new Date(t.timestamp).toLocaleString()]}),((Z=(L=t.services)==null?void 0:L.database)==null?void 0:Z.details)&&v.jsxs("div",{className:"mt-2 text-xs",children:[v.jsxs("p",{children:[v.jsx("strong",{children:"PostgreSQL:"})," ",((Y=t.services.database.details.details)==null?void 0:Y.postgresVersion)||"Unknown"]}),v.jsxs("p",{children:[v.jsx("strong",{children:"Pool Status:"})," ",`Total: ${((ce=t.services.database.details.details)==null?void 0:ce.poolSize)||0}, Idle: ${((de=t.services.database.details.details)==null?void 0:de.idleCount)||0}, Waiting: ${((G=t.services.database.details.details)==null?void 0:G.waitingCount)||0}`]})]})]})]})]})}),v.jsxs("div",{className:"text-center text-sm text-white/60 mt-6",children:[v.jsx("p",{children:"Phase 5: Admin Panel & Analytics Dashboard ✅"}),v.jsx("p",{className:"mt-1",children:"Role-based access control, analytics charts, and system management"}),m.isAuthenticated&&v.jsxs("p",{className:"mt-2 text-green-400",children:["✅ Authenticated as:"," ",((H=m.user)==null?void 0:H.full_name)||((W=m.user)==null?void 0:W.email)]})]}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-8",children:[v.jsx(Bh,{to:"/driver",className:"btn-primary text-center block",children:"🚌 Driver Interface"}),v.jsx(Bh,{to:"/student",className:"btn-primary text-center block",children:"👨‍🎓 Student Map (Live Tracking)"}),v.jsx(Bh,{to:"/admin",className:"btn-primary text-center block",children:"👨‍💼 Admin Panel (Phase 5)"}),v.jsx(Bh,{to:"/premium-demo",className:"btn-secondary text-center block",children:"✨ Premium UI Demo"})]})]})]})})})},k=()=>v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center p-6",children:v.jsx("div",{className:"max-w-md w-full mx-auto text-center",children:v.jsxs("div",{className:"card-glass p-8",children:[v.jsx("h1",{className:"text-6xl font-bold gradient-text mb-4",children:"404"}),v.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Page Not Found"}),v.jsx("p",{className:"text-white/70 mb-6",children:"The page you're looking for doesn't exist."}),v.jsx(Bh,{to:"/",className:"btn-primary inline-block",children:"Go Back Home"})]})})});return v.jsx(MD,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:v.jsx(I5,{children:v.jsx(N5,{children:v.jsxs(kD,{children:[v.jsx(pn,{path:"/",element:v.jsx(W5,{})}),v.jsx(pn,{path:"/legacy",element:v.jsx(w,{})}),v.jsx(pn,{path:"/driver",element:v.jsx(YR,{})}),v.jsx(pn,{path:"/student",element:v.jsx(_2,{})}),v.jsx(pn,{path:"/admin",element:v.jsx(v2,{})}),v.jsx(pn,{path:"/driver-login",element:v.jsx(L5,{})}),v.jsx(pn,{path:"/driver-dashboard",element:v.jsx(R5,{})}),v.jsx(pn,{path:"/student-map",element:v.jsx(_2,{})}),v.jsx(pn,{path:"/admin-login",element:v.jsx(lA,{})}),v.jsx(pn,{path:"/admin-dashboard",element:v.jsx(v2,{})}),v.jsx(pn,{path:"*",element:v.jsx(k,{})})]})})})})}class H5 extends re.Component{constructor(){super(...arguments);Is(this,"state",{hasError:!1})}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,n){console.error("Uncaught error:",r,n)}render(){return this.state.hasError?v.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:v.jsx("div",{className:"max-w-md w-full mx-auto p-6",children:v.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[v.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"🚨 Application Error"}),v.jsx("p",{className:"text-gray-600 mb-4",children:"Something went wrong. Please try refreshing the page."}),this.state.error&&v.jsxs("details",{className:"text-left bg-gray-100 p-4 rounded-lg mb-4",children:[v.jsx("summary",{className:"cursor-pointer font-medium text-gray-700",children:"Error Details"}),v.jsx("pre",{className:"text-xs text-red-600 mt-2 whitespace-pre-wrap",children:this.state.error.toString()})]}),v.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Refresh Page"})]})})}):this.props.children}}const K5=window.fetch;window.fetch=async function(t,e){if(typeof t=="string"&&(t.includes(vu.api.url)||t.includes("localhost")))try{let r=tr.getAccessToken();!r&&tr.isAuthenticated()&&(console.log("🔄 No token found but user is authenticated, attempting to refresh session..."),(await tr.refreshSession()).success&&(r=tr.getAccessToken(),console.log("✅ Session refreshed, new token obtained"))),r&&(e=e||{},e.headers={...e.headers,Authorization:`Bearer ${r}`})}catch{console.log("🔓 Public access - authentication not available")}return K5(t,e)};__.createRoot(document.getElementById("root")).render(v.jsx(sx.StrictMode,{children:v.jsx(H5,{children:v.jsx(Z5,{})})}));
//# sourceMappingURL=index-CfoZpMez.js.map
